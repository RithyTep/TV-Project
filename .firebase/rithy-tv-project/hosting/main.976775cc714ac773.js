"use strict";(self.webpackChunkTV_Project=self.webpackChunkTV_Project||[]).push([[179],{2011:(Vt,$e,W)=>{W.d($e,{Dh:()=>Oe,GT:()=>me,cc:()=>Ve,hO:()=>rt,on:()=>ne,pX:()=>be,xv:()=>Ce});var m=W(4650),ee=W(9260),$=W(4976);Vt=W.hmd(Vt);const fe=["ngOnDestroy"],be=(Ke,Ze,at,Qe={})=>new Proxy(Ke,{get:(je,ze)=>at.runOutsideAngular(()=>{var ct;if(Ke[ze])return!(null===(ct=Qe?.spy)||void 0===ct)&&ct.get&&Qe.spy.get(ze,Ke[ze]),Ke[ze];if(fe.indexOf(ze)>-1)return()=>{};const tt=Ze.toPromise().then(Tt=>{const Ct=Tt&&Tt[ze];return"function"==typeof Ct?Ct.bind(Tt):Ct&&Ct.then?Ct.then(dn=>at.run(()=>dn)):at.run(()=>Ct)});return new Proxy(()=>{},{get:(Tt,Ct)=>tt[Ct],apply:(Tt,Ct,dn)=>tt.then(It=>{var vn;const Rt=It&&It(...dn);return!(null===(vn=Qe?.spy)||void 0===vn)&&vn.apply&&Qe.spy.apply(ze,dn,Rt),Rt})})})}),me=(Ke,Ze)=>{Ze.forEach(at=>{Object.getOwnPropertyNames(at.prototype||at).forEach(Qe=>{Object.defineProperty(Ke.prototype,Qe,Object.getOwnPropertyDescriptor(at.prototype||at,Qe))})})};class Le{constructor(Ze){return Ze}}const Oe=new m.OlP("angularfire2.app.options"),Ce=new m.OlP("angularfire2.app.name");function ne(Ke,Ze,at){const je="object"==typeof at&&at||{};je.name=je.name||"string"==typeof at&&at||"[DEFAULT]";const ct=ee.Z.apps.filter(tt=>tt&&tt.name===je.name)[0]||Ze.runOutsideAngular(()=>ee.Z.initializeApp(Ke,je));try{JSON.stringify(Ke)!==JSON.stringify(ct.options)&&te("error",`${ct.name} Firebase App already initialized with different options${Vt.hot?", you may need to reload as Firebase is not HMR aware.":"."}`)}catch{}return new Le(ct)}const te=(Ke,...Ze)=>{(0,m.X6Q)()&&typeof console<"u"&&console[Ke](...Ze)},ue={provide:Le,useFactory:ne,deps:[Oe,m.R0b,[new m.FiY,Ce]]};let rt=(()=>{class Ke{constructor(at){ee.Z.registerVersion("angularfire",$.q4.full,"core"),ee.Z.registerVersion("angularfire",$.q4.full,"app-compat"),ee.Z.registerVersion("angular",m.q4F.full,at.toString())}static initializeApp(at,Qe){return{ngModule:Ke,providers:[{provide:Oe,useValue:at},{provide:Ce,useValue:Qe}]}}}return Ke.\u0275fac=function(at){return new(at||Ke)(m.LFG(m.Lbi))},Ke.\u0275mod=m.oAB({type:Ke}),Ke.\u0275inj=m.cJS({providers:[ue]}),Ke})();function Ve(Ke,Ze,at,Qe,je){const[,ze,ct]=globalThis.\u0275AngularfireInstanceCache.find(tt=>tt[0]===Ke)||[];if(ze)return function ut(Ke,Ze){try{return Ke.toString()===Ze.toString()}catch{return Ke===Ze}}(je,ct)||(Ae("error",`${Ze} was already initialized on the ${at} Firebase App with different settings.${At?" You may need to reload as Firebase is not HMR aware.":""}`),Ae("warn",{is:je,was:ct})),ze;{const tt=Qe();return globalThis.\u0275AngularfireInstanceCache.push([Ke,tt,je]),tt}}const At=!!Vt.hot,Ae=(Ke,...Ze)=>{(0,m.X6Q)()&&typeof console<"u"&&console[Ke](...Ze)};globalThis.\u0275AngularfireInstanceCache||(globalThis.\u0275AngularfireInstanceCache=[])},4976:(Vt,$e,W)=>{W.d($e,{q4:()=>li,iC:()=>Wu,HU:()=>Ja,vb:()=>fh,JM:()=>Bc,u3:()=>dg});var m=W(4650),ee=W(259),$=W(5861),fe=W(6881),be=W(2090),me=W(4859),Le=W(1877);const Oe=(C,R)=>R.some(P=>C instanceof P);let Ce,ne;const rt=new WeakMap,Ve=new WeakMap,ut=new WeakMap,At=new WeakMap,Ae=new WeakMap;let at={get(C,R,P){if(C instanceof IDBTransaction){if("done"===R)return Ve.get(C);if("objectStoreNames"===R)return C.objectStoreNames||ut.get(C);if("store"===R)return P.objectStoreNames[1]?void 0:P.objectStore(P.objectStoreNames[0])}return ct(C[R])},set:(C,R,P)=>(C[R]=P,!0),has:(C,R)=>C instanceof IDBTransaction&&("done"===R||"store"===R)||R in C};function ze(C){return"function"==typeof C?function je(C){return C!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function ue(){return ne||(ne=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(C)?function(...R){return C.apply(tt(this),R),ct(rt.get(this))}:function(...R){return ct(C.apply(tt(this),R))}:function(R,...P){const H=C.call(tt(this),R,...P);return ut.set(H,R.sort?R.sort():[R]),ct(H)}}(C):(C instanceof IDBTransaction&&function Ze(C){if(Ve.has(C))return;const R=new Promise((P,H)=>{const J=()=>{C.removeEventListener("complete",ce),C.removeEventListener("error",Ee),C.removeEventListener("abort",Ee)},ce=()=>{P(),J()},Ee=()=>{H(C.error||new DOMException("AbortError","AbortError")),J()};C.addEventListener("complete",ce),C.addEventListener("error",Ee),C.addEventListener("abort",Ee)});Ve.set(C,R)}(C),Oe(C,function te(){return Ce||(Ce=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(C,at):C)}function ct(C){if(C instanceof IDBRequest)return function Ke(C){const R=new Promise((P,H)=>{const J=()=>{C.removeEventListener("success",ce),C.removeEventListener("error",Ee)},ce=()=>{P(ct(C.result)),J()},Ee=()=>{H(C.error),J()};C.addEventListener("success",ce),C.addEventListener("error",Ee)});return R.then(P=>{P instanceof IDBCursor&&rt.set(P,C)}).catch(()=>{}),Ae.set(R,C),R}(C);if(At.has(C))return At.get(C);const R=ze(C);return R!==C&&(At.set(C,R),Ae.set(R,C)),R}const tt=C=>Ae.get(C),dn=["get","getKey","getAll","getAllKeys","count"],It=["put","add","delete","clear"],vn=new Map;function Rt(C,R){var P;if(!(C instanceof IDBDatabase)||R in C||"string"!=typeof R)return;if(vn.get(R))return vn.get(R);const H=R.replace(/FromIndex$/,""),J=R!==H,ce=It.includes(H);if(!(H in(J?IDBIndex:IDBObjectStore).prototype)||!ce&&!dn.includes(H))return;const Ee=function(nt){return(P=P||(0,$.Z)(function*(pt,...Dt){const Ot=this.transaction(pt,ce?"readwrite":"readonly");let hn=Ot.store;return J&&(hn=hn.index(Dt.shift())),(yield Promise.all([hn[H](...Dt),ce&&Ot.done]))[0]})).apply(this,arguments)};return vn.set(R,Ee),Ee}var eo,Xi,Ji,Vs,ve,we,De,ye,st,Xe,zt,xt,cr,$t,Dn,ir;!function Qe(C){at=C(at)}(C=>({...C,get:(R,P,H)=>Rt(R,P)||C.get(R,P,H),has:(R,P)=>!!Rt(R,P)||C.has(R,P)}));const Mr="@firebase/installations",yr="0.6.4",kr=1e4,ti=`w:${yr}`,vr="FIS_v2",Ft="https://firebaseinstallations.googleapis.com/v1",_s=36e5,wr=new be.LL("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function tr(C){return C instanceof be.ZR&&C.code.includes("request-failed")}function Pn({projectId:C}){return`${Ft}/projects/${C}/installations`}function Wt(C){return{token:C.token,requestStatus:2,expiresIn:mi(C.expiresIn),creationTime:Date.now()}}function Kt(C,R){return(eo=eo||(0,$.Z)(function*(P,H){const ce=(yield H.json()).error;return wr.create("request-failed",{requestName:P,serverCode:ce.code,serverMessage:ce.message,serverStatus:ce.status})})).apply(this,arguments)}function ni({apiKey:C}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":C})}function br(C){return(Xi=Xi||(0,$.Z)(function*(R){const P=yield R();return P.status>=500&&P.status<600?R():P})).apply(this,arguments)}function mi(C){return Number(C.replace("s","000"))}function zn(C){return new Promise(R=>{setTimeout(R,C)})}const an=/^[cdef][\w-]{21}$/,to="";function wn(){try{const C=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(C),C[0]=112+C[0]%16;const P=function Pi(C){return function dr(C){return btoa(String.fromCharCode(...C)).replace(/\+/g,"-").replace(/\//g,"_")}(C).substr(0,22)}(C);return an.test(P)?P:to}catch{return to}}function Gr(C){return`${C.appName}!${C.appId}`}const ri=new Map;function es(C,R){const P=Gr(C);bs(P,R),function re(C,R){const P=function G(){return!Q&&"BroadcastChannel"in self&&(Q=new BroadcastChannel("[Firebase] FID Change"),Q.onmessage=C=>{bs(C.data.key,C.data.fid)}),Q}();P&&P.postMessage({key:C,fid:R}),function j(){0===ri.size&&Q&&(Q.close(),Q=null)}()}(P,R)}function bs(C,R){const P=ri.get(C);if(P)for(const H of P)H(R)}let Q=null;const V="firebase-installations-database",se=1,ke="firebase-installations-store";let ht=null;function nn(){return ht||(ht=function Tt(C,R,{blocked:P,upgrade:H,blocking:J,terminated:ce}={}){const Ee=indexedDB.open(C,R),Ue=ct(Ee);return H&&Ee.addEventListener("upgradeneeded",nt=>{H(ct(Ee.result),nt.oldVersion,nt.newVersion,ct(Ee.transaction))}),P&&Ee.addEventListener("blocked",()=>P()),Ue.then(nt=>{ce&&nt.addEventListener("close",()=>ce()),J&&nt.addEventListener("versionchange",()=>J())}).catch(()=>{}),Ue}(V,se,{upgrade:(C,R)=>{0===R&&C.createObjectStore(ke)}})),ht}function Qt(C,R){return(Vs=Vs||(0,$.Z)(function*(P,H){const J=Gr(P),Ee=(yield nn()).transaction(ke,"readwrite"),Ue=Ee.objectStore(ke),nt=yield Ue.get(J);return yield Ue.put(H,J),yield Ee.done,(!nt||nt.fid!==H.fid)&&es(P,H.fid),H})).apply(this,arguments)}function fn(C){return(ve=ve||(0,$.Z)(function*(R){const P=Gr(R),J=(yield nn()).transaction(ke,"readwrite");yield J.objectStore(ke).delete(P),yield J.done})).apply(this,arguments)}function Ut(C,R){return(we=we||(0,$.Z)(function*(P,H){const J=Gr(P),Ee=(yield nn()).transaction(ke,"readwrite"),Ue=Ee.objectStore(ke),nt=yield Ue.get(J),pt=H(nt);return void 0===pt?yield Ue.delete(J):yield Ue.put(pt,J),yield Ee.done,pt&&(!nt||nt.fid!==pt.fid)&&es(P,pt.fid),pt})).apply(this,arguments)}function qn(C){return(De=De||(0,$.Z)(function*(R){let P;const H=yield Ut(R.appConfig,J=>{const ce=function Nn(C){return Je(C||{fid:wn(),registrationStatus:0})}(J),Ee=function $i(C,R){if(0===R.registrationStatus){if(!navigator.onLine)return{installationEntry:R,registrationPromise:Promise.reject(wr.create("app-offline"))};const P={fid:R.fid,registrationStatus:1,registrationTime:Date.now()},H=function ts(C,R){return(ye=ye||(0,$.Z)(function*(P,H){try{const J=yield function ra(C,R){return(Ji=Ji||(0,$.Z)(function*({appConfig:P,heartbeatServiceProvider:H},{fid:J}){const ce=Pn(P),Ee=ni(P),Ue=H.getImmediate({optional:!0});if(Ue){const Ot=yield Ue.getHeartbeatsHeader();Ot&&Ee.append("x-firebase-client",Ot)}const pt={method:"POST",headers:Ee,body:JSON.stringify({fid:J,authVersion:vr,appId:P.appId,sdkVersion:ti})},Dt=yield br(()=>fetch(ce,pt));if(Dt.ok){const Ot=yield Dt.json();return{fid:Ot.fid||J,registrationStatus:2,refreshToken:Ot.refreshToken,authToken:Wt(Ot.authToken)}}throw yield Kt("Create Installation",Dt)})).apply(this,arguments)}(P,H);return Qt(P.appConfig,J)}catch(J){throw tr(J)&&409===J.customData.serverCode?yield fn(P.appConfig):yield Qt(P.appConfig,{fid:H.fid,registrationStatus:0}),J}})).apply(this,arguments)}(C,P);return{installationEntry:P,registrationPromise:H}}return 1===R.registrationStatus?{installationEntry:R,registrationPromise:Se(C)}:{installationEntry:R}}(R,ce);return P=Ee.registrationPromise,Ee.installationEntry});return H.fid===to?{installationEntry:yield P}:{installationEntry:H,registrationPromise:P}})).apply(this,arguments)}function Se(C){return(st=st||(0,$.Z)(function*(R){let P=yield pe(R.appConfig);for(;1===P.registrationStatus;)yield zn(100),P=yield pe(R.appConfig);if(0===P.registrationStatus){const{installationEntry:H,registrationPromise:J}=yield qn(R);return J||H}return P})).apply(this,arguments)}function pe(C){return Ut(C,R=>{if(!R)throw wr.create("installation-not-found");return Je(R)})}function Je(C){return function wt(C){return 1===C.registrationStatus&&C.registrationTime+kr<Date.now()}(C)?{fid:C.fid,registrationStatus:0}:C}function St(C,R){return(Xe=Xe||(0,$.Z)(function*({appConfig:P,heartbeatServiceProvider:H},J){const ce=function Gt(C,{fid:R}){return`${Pn(C)}/${R}/authTokens:generate`}(P,J),Ee=function ur(C,{refreshToken:R}){const P=ni(C);return P.append("Authorization",function $r(C){return`${vr} ${C}`}(R)),P}(P,J),Ue=H.getImmediate({optional:!0});if(Ue){const Ot=yield Ue.getHeartbeatsHeader();Ot&&Ee.append("x-firebase-client",Ot)}const pt={method:"POST",headers:Ee,body:JSON.stringify({installation:{sdkVersion:ti,appId:P.appId}})},Dt=yield br(()=>fetch(ce,pt));if(Dt.ok)return Wt(yield Dt.json());throw yield Kt("Generate Auth Token",Dt)})).apply(this,arguments)}function Lt(C){return(zt=zt||(0,$.Z)(function*(R,P=!1){let H;const J=yield Ut(R.appConfig,Ee=>{if(!Jn(Ee))throw wr.create("not-registered");const Ue=Ee.authToken;if(!P&&function Oi(C){return 2===C.requestStatus&&!function no(C){const R=Date.now();return R<C.creationTime||C.creationTime+C.expiresIn<R+_s}(C)}(Ue))return Ee;if(1===Ue.requestStatus)return H=function kn(C,R){return(xt=xt||(0,$.Z)(function*(P,H){let J=yield Ln(P.appConfig);for(;1===J.authToken.requestStatus;)yield zn(100),J=yield Ln(P.appConfig);const ce=J.authToken;return 0===ce.requestStatus?Lt(P,H):ce})).apply(this,arguments)}(R,P),Ee;{if(!navigator.onLine)throw wr.create("app-offline");const nt=function Ua(C){const R={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},C),{authToken:R})}(Ee);return H=function et(C,R){return(cr=cr||(0,$.Z)(function*(P,H){try{const J=yield St(P,H),ce=Object.assign(Object.assign({},H),{authToken:J});return yield Qt(P.appConfig,ce),J}catch(J){if(!tr(J)||401!==J.customData.serverCode&&404!==J.customData.serverCode){const ce=Object.assign(Object.assign({},H),{authToken:{requestStatus:0}});yield Qt(P.appConfig,ce)}else yield fn(P.appConfig);throw J}})).apply(this,arguments)}(R,nt),nt}});return H?yield H:J.authToken})).apply(this,arguments)}function Ln(C){return Ut(C,R=>{if(!Jn(R))throw wr.create("not-registered");return function ns(C){return 1===C.requestStatus&&C.requestTime+kr<Date.now()}(R.authToken)?Object.assign(Object.assign({},R),{authToken:{requestStatus:0}}):R})}function Jn(C){return void 0!==C&&2===C.registrationStatus}function ia(C){return wr.create("missing-app-config-values",{valueName:C})}const tn="installations",sa=C=>{const R=C.getProvider("app").getImmediate(),P=function sr(C){if(!C||!C.options)throw ia("App Configuration");if(!C.name)throw ia("App Name");const R=["projectId","apiKey","appId"];for(const P of R)if(!C.options[P])throw ia(P);return{appName:C.name,projectId:C.options.projectId,apiKey:C.options.apiKey,appId:C.options.appId}}(R);return{app:R,appConfig:P,heartbeatServiceProvider:(0,fe._getProvider)(R,"heartbeat"),_delete:()=>Promise.resolve()}},Ao=C=>{const R=C.getProvider("app").getImmediate(),P=(0,fe._getProvider)(R,tn).getImmediate();return{getId:()=>function Et(C){return($t=$t||(0,$.Z)(function*(R){const P=R,{installationEntry:H,registrationPromise:J}=yield qn(P);return J?J.catch(console.error):Lt(P).catch(console.error),H.fid})).apply(this,arguments)}(P),getToken:J=>function bn(C){return(Dn=Dn||(0,$.Z)(function*(R,P=!1){const H=R;return yield function nr(C){return(ir=ir||(0,$.Z)(function*(R){const{registrationPromise:P}=yield qn(R);P&&(yield P)})).apply(this,arguments)}(H),(yield Lt(H,P)).token})).apply(this,arguments)}(P,J)}};var io;(function Va(){(0,fe._registerComponent)(new me.wA(tn,sa,"PUBLIC")),(0,fe._registerComponent)(new me.wA("installations-internal",Ao,"PRIVATE"))})(),(0,fe.registerVersion)(Mr,yr),(0,fe.registerVersion)(Mr,yr,"esm2017");const $a="@firebase/remote-config",wi=new be.LL("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"});class Md{constructor(R,P,H,J){this.client=R,this.storage=P,this.storageCache=H,this.logger=J}isCachedDataFresh(R,P){if(!P)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const H=Date.now()-P,J=H<=R;return this.logger.debug(`Config fetch cache check. Cache age millis: ${H}. Cache max age millis (minimumFetchIntervalMillis setting): ${R}. Is cache hit: ${J}.`),J}fetch(R){var P=this;return(0,$.Z)(function*(){const[H,J]=yield Promise.all([P.storage.getLastSuccessfulFetchTimestampMillis(),P.storage.getLastSuccessfulFetchResponse()]);if(J&&P.isCachedDataFresh(R.cacheMaxAgeMillis,H))return J;R.eTag=J&&J.eTag;const ce=yield P.client.fetch(R),Ee=[P.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===ce.status&&Ee.push(P.storage.setLastSuccessfulFetchResponse(ce)),yield Promise.all(Ee),ce})()}}function kd(C=navigator){return C.languages&&C.languages[0]||C.language}class Hf{constructor(R,P,H,J,ce,Ee){this.firebaseInstallations=R,this.sdkVersion=P,this.namespace=H,this.projectId=J,this.apiKey=ce,this.appId=Ee}fetch(R){var P=this;return(0,$.Z)(function*(){const[H,J]=yield Promise.all([P.firebaseInstallations.getId(),P.firebaseInstallations.getToken()]),Ee=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${P.projectId}/namespaces/${P.namespace}:fetch?key=${P.apiKey}`,Ue={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":R.eTag||"*"},nt={sdk_version:P.sdkVersion,app_instance_id:H,app_instance_id_token:J,app_id:P.appId,language_code:kd()},pt={method:"POST",headers:Ue,body:JSON.stringify(nt)},Dt=fetch(Ee,pt),Ot=new Promise((cn,Pr)=>{R.signal.addEventListener(()=>{const mo=new Error("The operation was aborted.");mo.name="AbortError",Pr(mo)})});let hn;try{yield Promise.race([Dt,Ot]),hn=yield Dt}catch(cn){let Pr="fetch-client-network";throw"AbortError"===cn?.name&&(Pr="fetch-timeout"),wi.create(Pr,{originalErrorMessage:cn?.message})}let Nt=hn.status;const Yn=hn.headers.get("ETag")||void 0;let Ai,Er;if(200===hn.status){let cn;try{cn=yield hn.json()}catch(Pr){throw wi.create("fetch-client-parse",{originalErrorMessage:Pr?.message})}Ai=cn.entries,Er=cn.state}if("INSTANCE_STATE_UNSPECIFIED"===Er?Nt=500:"NO_CHANGE"===Er?Nt=304:("NO_TEMPLATE"===Er||"EMPTY_CONFIG"===Er)&&(Ai={}),304!==Nt&&200!==Nt)throw wi.create("fetch-status",{httpStatus:Nt});return{status:Nt,eTag:Yn,config:Ai}})()}}class yu{constructor(R,P){this.client=R,this.storage=P}fetch(R){var P=this;return(0,$.Z)(function*(){const H=(yield P.storage.getThrottleMetadata())||{backoffCount:0,throttleEndTimeMillis:Date.now()};return P.attemptFetch(R,H)})()}attemptFetch(R,{throttleEndTimeMillis:P,backoffCount:H}){var J=this;return(0,$.Z)(function*(){yield function jf(C,R){return new Promise((P,H)=>{const J=Math.max(R-Date.now(),0),ce=setTimeout(P,J);C.addEventListener(()=>{clearTimeout(ce),H(wi.create("fetch-throttle",{throttleEndTimeMillis:R}))})})}(R.signal,P);try{const ce=yield J.client.fetch(R);return yield J.storage.deleteThrottleMetadata(),ce}catch(ce){if(!function hc(C){if(!(C instanceof be.ZR&&C.customData))return!1;const R=Number(C.customData.httpStatus);return 429===R||500===R||503===R||504===R}(ce))throw ce;const Ee={throttleEndTimeMillis:Date.now()+(0,be.$s)(H),backoffCount:H+1};return yield J.storage.setThrottleMetadata(Ee),J.attemptFetch(R,Ee)}})()}}class eg{constructor(R,P,H,J,ce){this.app=R,this._client=P,this._storageCache=H,this._storage=J,this._logger=ce,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function fc(C,R){const P=C.target.error||void 0;return wi.create(R,{originalErrorMessage:P&&P?.message})}const Co="app_namespace_store";class Wf{constructor(R,P,H,J=function zf(){return new Promise((C,R)=>{try{const P=indexedDB.open("firebase_remote_config",1);P.onerror=H=>{R(fc(H,"storage-open"))},P.onsuccess=H=>{C(H.target.result)},P.onupgradeneeded=H=>{0===H.oldVersion&&H.target.result.createObjectStore(Co,{keyPath:"compositeKey"})}}catch(P){R(wi.create("storage-open",{originalErrorMessage:P?.message}))}})}()){this.appId=R,this.appName=P,this.namespace=H,this.openDbPromise=J}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(R){return this.set("last_fetch_status",R)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(R){return this.set("last_successful_fetch_timestamp_millis",R)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(R){return this.set("last_successful_fetch_response",R)}getActiveConfig(){return this.get("active_config")}setActiveConfig(R){return this.set("active_config",R)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(R){return this.set("active_config_etag",R)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(R){return this.set("throttle_metadata",R)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}get(R){var P=this;return(0,$.Z)(function*(){const H=yield P.openDbPromise;return new Promise((J,ce)=>{const Ue=H.transaction([Co],"readonly").objectStore(Co),nt=P.createCompositeKey(R);try{const pt=Ue.get(nt);pt.onerror=Dt=>{ce(fc(Dt,"storage-get"))},pt.onsuccess=Dt=>{const Ot=Dt.target.result;J(Ot?Ot.value:void 0)}}catch(pt){ce(wi.create("storage-get",{originalErrorMessage:pt?.message}))}})})()}set(R,P){var H=this;return(0,$.Z)(function*(){const J=yield H.openDbPromise;return new Promise((ce,Ee)=>{const nt=J.transaction([Co],"readwrite").objectStore(Co),pt=H.createCompositeKey(R);try{const Dt=nt.put({compositeKey:pt,value:P});Dt.onerror=Ot=>{Ee(fc(Ot,"storage-set"))},Dt.onsuccess=()=>{ce()}}catch(Dt){Ee(wi.create("storage-set",{originalErrorMessage:Dt?.message}))}})})()}delete(R){var P=this;return(0,$.Z)(function*(){const H=yield P.openDbPromise;return new Promise((J,ce)=>{const Ue=H.transaction([Co],"readwrite").objectStore(Co),nt=P.createCompositeKey(R);try{const pt=Ue.delete(nt);pt.onerror=Dt=>{ce(fc(Dt,"storage-delete"))},pt.onsuccess=()=>{J()}}catch(pt){ce(wi.create("storage-delete",{originalErrorMessage:pt?.message}))}})})()}createCompositeKey(R){return[this.appId,this.appName,this.namespace,R].join()}}class aa{constructor(R){this.storage=R}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}loadFromStorage(){var R=this;return(0,$.Z)(function*(){const P=R.storage.getLastFetchStatus(),H=R.storage.getLastSuccessfulFetchTimestampMillis(),J=R.storage.getActiveConfig(),ce=yield P;ce&&(R.lastFetchStatus=ce);const Ee=yield H;Ee&&(R.lastSuccessfulFetchTimestampMillis=Ee);const Ue=yield J;Ue&&(R.activeConfig=Ue)})()}setLastFetchStatus(R){return this.lastFetchStatus=R,this.storage.setLastFetchStatus(R)}setLastSuccessfulFetchTimestampMillis(R){return this.lastSuccessfulFetchTimestampMillis=R,this.storage.setLastSuccessfulFetchTimestampMillis(R)}setActiveConfig(R){return this.activeConfig=R,this.storage.setActiveConfig(R)}}function bu(){return(io=io||(0,$.Z)(function*(){if(!(0,be.hl)())return!1;try{return yield(0,be.eu)()}catch{return!1}})).apply(this,arguments)}!function Kf(){(0,fe._registerComponent)(new me.wA("remote-config",function C(R,{instanceIdentifier:P}){const H=R.getProvider("app").getImmediate(),J=R.getProvider("installations-internal").getImmediate();if(typeof window>"u")throw wi.create("registration-window");if(!(0,be.hl)())throw wi.create("indexed-db-unavailable");const{projectId:ce,apiKey:Ee,appId:Ue}=H.options;if(!ce)throw wi.create("registration-project-id");if(!Ee)throw wi.create("registration-api-key");if(!Ue)throw wi.create("registration-app-id");const nt=new Wf(Ue,H.name,P=P||"firebase"),pt=new aa(nt),Dt=new Le.Yd($a);Dt.logLevel=Le.in.ERROR;const Ot=new Hf(J,fe.SDK_VERSION,P,ce,Ee,Ue),hn=new yu(Ot,nt),Nt=new Md(hn,nt,pt,Dt),Yn=new eg(H,Nt,pt,nt,Dt);return function is(C){const R=(0,be.m9)(C);R._initializePromise||(R._initializePromise=R._storageCache.loadFromStorage().then(()=>{R._isInitializationComplete=!0}))}(Yn),Yn},"PUBLIC").setMultipleInstances(!0)),(0,fe.registerVersion)($a,"0.4.4"),(0,fe.registerVersion)($a,"0.4.4","esm2017")}();const qf=(C,R)=>R.some(P=>C instanceof P);let bl,pc;const Eu=new WeakMap,Ga=new WeakMap,Lr=new WeakMap,mc=new WeakMap,gc=new WeakMap;let Ha={get(C,R,P){if(C instanceof IDBTransaction){if("done"===R)return Ga.get(C);if("objectStoreNames"===R)return C.objectStoreNames||Lr.get(C);if("store"===R)return P.objectStoreNames[1]?void 0:P.objectStore(P.objectStoreNames[0])}return Gi(C[R])},set:(C,R,P)=>(C[R]=P,!0),has:(C,R)=>C instanceof IDBTransaction&&("done"===R||"store"===R)||R in C};function Tu(C){return"function"==typeof C?function Pd(C){return C!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function Zf(){return pc||(pc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(C)?function(...R){return C.apply(si(this),R),Gi(Eu.get(this))}:function(...R){return Gi(C.apply(si(this),R))}:function(R,...P){const H=C.call(si(this),R,...P);return Lr.set(H,R.sort?R.sort():[R]),Gi(H)}}(C):(C instanceof IDBTransaction&&function El(C){if(Ga.has(C))return;const R=new Promise((P,H)=>{const J=()=>{C.removeEventListener("complete",ce),C.removeEventListener("error",Ee),C.removeEventListener("abort",Ee)},ce=()=>{P(),J()},Ee=()=>{H(C.error||new DOMException("AbortError","AbortError")),J()};C.addEventListener("complete",ce),C.addEventListener("error",Ee),C.addEventListener("abort",Ee)});Ga.set(C,R)}(C),qf(C,function Yf(){return bl||(bl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(C,Ha):C)}function Gi(C){if(C instanceof IDBRequest)return function An(C){const R=new Promise((P,H)=>{const J=()=>{C.removeEventListener("success",ce),C.removeEventListener("error",Ee)},ce=()=>{P(Gi(C.result)),J()},Ee=()=>{H(C.error),J()};C.addEventListener("success",ce),C.addEventListener("error",Ee)});return R.then(P=>{P instanceof IDBCursor&&Eu.set(P,C)}).catch(()=>{}),gc.set(R,C),R}(C);if(mc.has(C))return mc.get(C);const R=Tu(C);return R!==C&&(mc.set(C,R),gc.set(R,C)),R}const si=C=>gc.get(C);function Od(C,R,{blocked:P,upgrade:H,blocking:J,terminated:ce}={}){const Ee=indexedDB.open(C,R),Ue=Gi(Ee);return H&&Ee.addEventListener("upgradeneeded",nt=>{H(Gi(Ee.result),nt.oldVersion,nt.newVersion,Gi(Ee.transaction))}),P&&Ee.addEventListener("blocked",()=>P()),Ue.then(nt=>{ce&&nt.addEventListener("close",()=>ce()),J&&nt.addEventListener("versionchange",()=>J())}).catch(()=>{}),Ue}function ws(C,{blocked:R}={}){const P=indexedDB.deleteDatabase(C);return R&&P.addEventListener("blocked",()=>R()),Gi(P).then(()=>{})}const Nd=["get","getKey","getAll","getAllKeys","count"],Ro=["put","add","delete","clear"],yc=new Map;function ja(C,R){var P;if(!(C instanceof IDBDatabase)||R in C||"string"!=typeof R)return;if(yc.get(R))return yc.get(R);const H=R.replace(/FromIndex$/,""),J=R!==H,ce=Ro.includes(H);if(!(H in(J?IDBIndex:IDBObjectStore).prototype)||!ce&&!Nd.includes(H))return;const Ee=function(nt){return(P=P||(0,$.Z)(function*(pt,...Dt){const Ot=this.transaction(pt,ce?"readwrite":"readonly");let hn=Ot.store;return J&&(hn=hn.index(Dt.shift())),(yield Promise.all([hn[H](...Dt),ce&&Ot.done]))[0]})).apply(this,arguments)};return yc.set(R,Ee),Ee}var rn,Iu,Fd,_c,Ud,Bd,wu,Tl,js,Re,mn,Vd,$d,oi,Gd,Il,ai,Su,Du,wl;!function yi(C){Ha=C(Ha)}(C=>({...C,get:(R,P,H)=>ja(R,P)||C.get(R,P,H),has:(R,P)=>!!ja(R,P)||C.has(R,P)}));const fr="/firebase-messaging-sw.js",_i="/firebase-cloud-messaging-push-scope",Ss="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Dl="https://fcmregistrations.googleapis.com/v1",oo="google.c.a.c_id",Hd="google.c.a.c_l",Au="google.c.a.ts",Al="google.c.a.e";var Ds=(()=>{return(C=Ds||(Ds={})).PUSH_RECEIVED="push-received",C.NOTIFICATION_CLICKED="notification-clicked",Ds;var C})();function ss(C){const R=new Uint8Array(C);return btoa(String.fromCharCode(...R)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function vc(C){const P=(C+"=".repeat((4-C.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),H=atob(P),J=new Uint8Array(H.length);for(let ce=0;ce<H.length;++ce)J[ce]=H.charCodeAt(ce);return J}const Di="fcm_token_details_db",Xf=5,jd="fcm_token_object_Store",Wd="firebase-messaging-database",Jf=1,ao="firebase-messaging-store";let la=null;function bc(){return la||(la=Od(Wd,Jf,{upgrade:(C,R)=>{0===R&&C.createObjectStore(ao)}})),la}function Kd(C){return(Iu=Iu||(0,$.Z)(function*(R){const P=or(R),J=yield(yield bc()).transaction(ao).objectStore(ao).get(P);if(J)return J;{const ce=yield function xl(C){return(rn=rn||(0,$.Z)(function*(R){var P;if("databases"in indexedDB&&!(yield indexedDB.databases()).map(Ue=>Ue.name).includes(Di))return null;let H=null;return(yield Od(Di,Xf,{upgrade:function(Ee,Ue,nt,pt){return(P=P||(0,$.Z)(function*(Dt,Ot,hn,Nt){var Yn;if(Ot<2||!Dt.objectStoreNames.contains(jd))return;const Ai=Nt.objectStore(jd),Er=yield Ai.index("fcmSenderId").get(R);if(yield Ai.clear(),Er)if(2===Ot){const cn=Er;if(!cn.auth||!cn.p256dh||!cn.endpoint)return;H={token:cn.fcmToken,createTime:null!==(Yn=cn.createTime)&&void 0!==Yn?Yn:Date.now(),subscriptionOptions:{auth:cn.auth,p256dh:cn.p256dh,endpoint:cn.endpoint,swScope:cn.swScope,vapidKey:"string"==typeof cn.vapidKey?cn.vapidKey:ss(cn.vapidKey)}}}else if(3===Ot){const cn=Er;H={token:cn.fcmToken,createTime:cn.createTime,subscriptionOptions:{auth:ss(cn.auth),p256dh:ss(cn.p256dh),endpoint:cn.endpoint,swScope:cn.swScope,vapidKey:ss(cn.vapidKey)}}}else if(4===Ot){const cn=Er;H={token:cn.fcmToken,createTime:cn.createTime,subscriptionOptions:{auth:ss(cn.auth),p256dh:ss(cn.p256dh),endpoint:cn.endpoint,swScope:cn.swScope,vapidKey:ss(cn.vapidKey)}}}})).apply(this,arguments)}})).close(),yield ws(Di),yield ws("fcm_vapid_details_db"),yield ws("undefined"),function zd(C){if(!C||!C.subscriptionOptions)return!1;const{subscriptionOptions:R}=C;return"number"==typeof C.createTime&&C.createTime>0&&"string"==typeof C.token&&C.token.length>0&&"string"==typeof R.auth&&R.auth.length>0&&"string"==typeof R.p256dh&&R.p256dh.length>0&&"string"==typeof R.endpoint&&R.endpoint.length>0&&"string"==typeof R.swScope&&R.swScope.length>0&&"string"==typeof R.vapidKey&&R.vapidKey.length>0}(H)?H:null})).apply(this,arguments)}(R.appConfig.senderId);if(ce)return yield Sr(R,ce),ce}})).apply(this,arguments)}function Sr(C,R){return(Fd=Fd||(0,$.Z)(function*(P,H){const J=or(P),Ee=(yield bc()).transaction(ao,"readwrite");return yield Ee.objectStore(ao).put(H,J),yield Ee.done,H})).apply(this,arguments)}function or({appConfig:C}){return C.appId}const vi=new be.LL("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});function Ec(C,R){return(Ud=Ud||(0,$.Z)(function*(P,H){const J=yield Cl(P),ce=Tc(H),Ee={method:"POST",headers:J,body:JSON.stringify(ce)};let Ue;try{Ue=yield(yield fetch(ca(P.appConfig),Ee)).json()}catch(nt){throw vi.create("token-subscribe-failed",{errorInfo:nt?.toString()})}if(Ue.error)throw vi.create("token-subscribe-failed",{errorInfo:Ue.error.message});if(!Ue.token)throw vi.create("token-subscribe-no-token");return Ue.token})).apply(this,arguments)}function xu(C,R){return(wu=wu||(0,$.Z)(function*(P,H){const ce={method:"DELETE",headers:yield Cl(P)};try{const Ue=yield(yield fetch(`${ca(P.appConfig)}/${H}`,ce)).json();if(Ue.error)throw vi.create("token-unsubscribe-failed",{errorInfo:Ue.error.message})}catch(Ee){throw vi.create("token-unsubscribe-failed",{errorInfo:Ee?.toString()})}})).apply(this,arguments)}function ca({projectId:C}){return`${Dl}/projects/${C}/registrations`}function Cl(C){return(Tl=Tl||(0,$.Z)(function*({appConfig:R,installations:P}){const H=yield P.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":R.apiKey,"x-goog-firebase-installations-auth":`FIS ${H}`})})).apply(this,arguments)}function Tc({p256dh:C,auth:R,endpoint:P,vapidKey:H}){const J={web:{endpoint:P,auth:R,p256dh:C}};return H!==Ss&&(J.web.applicationPubKey=H),J}const Cu=6048e5;function Ic(C){return(js=js||(0,$.Z)(function*(R){const P=yield function ko(C,R){return($d=$d||(0,$.Z)(function*(P,H){return(yield P.pushManager.getSubscription())||P.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:vc(H)})})).apply(this,arguments)}(R.swRegistration,R.vapidKey),H={vapidKey:R.vapidKey,swScope:R.swRegistration.scope,endpoint:P.endpoint,auth:ss(P.getKey("auth")),p256dh:ss(P.getKey("p256dh"))},J=yield Kd(R.firebaseDependencies);if(J){if(function ep(C,R){return R.vapidKey===C.vapidKey&&R.endpoint===C.endpoint&&R.auth===C.auth&&R.p256dh===C.p256dh}(J.subscriptionOptions,H))return Date.now()>=J.createTime+Cu?function Ml(C,R){return(mn=mn||(0,$.Z)(function*(P,H){try{const J=yield function qd(C,R){return(Bd=Bd||(0,$.Z)(function*(P,H){const J=yield Cl(P),ce=Tc(H.subscriptionOptions),Ee={method:"PATCH",headers:J,body:JSON.stringify(ce)};let Ue;try{Ue=yield(yield fetch(`${ca(P.appConfig)}/${H.token}`,Ee)).json()}catch(nt){throw vi.create("token-update-failed",{errorInfo:nt?.toString()})}if(Ue.error)throw vi.create("token-update-failed",{errorInfo:Ue.error.message});if(!Ue.token)throw vi.create("token-update-no-token");return Ue.token})).apply(this,arguments)}(P.firebaseDependencies,H),ce=Object.assign(Object.assign({},H),{token:J,createTime:Date.now()});return yield Sr(P.firebaseDependencies,ce),J}catch(J){throw yield function Rl(C){return(Re=Re||(0,$.Z)(function*(R){const P=yield Kd(R.firebaseDependencies);P&&(yield xu(R.firebaseDependencies,P.token),yield function Mo(C){return(_c=_c||(0,$.Z)(function*(R){const P=or(R),J=(yield bc()).transaction(ao,"readwrite");yield J.objectStore(ao).delete(P),yield J.done})).apply(this,arguments)}(R.firebaseDependencies));const H=yield R.swRegistration.pushManager.getSubscription();return!H||H.unsubscribe()})).apply(this,arguments)}(P),J}})).apply(this,arguments)}(R,{token:J.token,createTime:Date.now(),subscriptionOptions:H}):J.token;try{yield xu(R.firebaseDependencies,J.token)}catch(ce){console.warn(ce)}return ua(R.firebaseDependencies,H)}return ua(R.firebaseDependencies,H)})).apply(this,arguments)}function ua(C,R){return(Vd=Vd||(0,$.Z)(function*(P,H){const ce={token:yield Ec(P,H),createTime:Date.now(),subscriptionOptions:H};return yield Sr(P,ce),ce.token})).apply(this,arguments)}function Yd(C){const R={from:C.from,collapseKey:C.collapse_key,messageId:C.fcmMessageId};return function Ru(C,R){if(!R.notification)return;C.notification={};const P=R.notification.title;P&&(C.notification.title=P);const H=R.notification.body;H&&(C.notification.body=H);const J=R.notification.image;J&&(C.notification.image=J);const ce=R.notification.icon;ce&&(C.notification.icon=ce)}(R,C),function rg(C,R){R.data&&(C.data=R.data)}(R,C),function tp(C,R){var P,H,J,ce,Ee;if(!(R.fcmOptions||null!==(P=R.notification)&&void 0!==P&&P.click_action))return;C.fcmOptions={};const Ue=null!==(J=null===(H=R.fcmOptions)||void 0===H?void 0:H.link)&&void 0!==J?J:null===(ce=R.notification)||void 0===ce?void 0:ce.click_action;Ue&&(C.fcmOptions.link=Ue);const nt=null===(Ee=R.fcmOptions)||void 0===Ee?void 0:Ee.analytics_label;nt&&(C.fcmOptions.analyticsLabel=nt)}(R,C),R}function wc(C,R){const P=[];for(let H=0;H<C.length;H++)P.push(C.charAt(H)),H<R.length&&P.push(R.charAt(H));return P.join("")}function za(C){return vi.create("missing-app-config-values",{valueName:C})}wc("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),wc("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class ku{constructor(R,P,H){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const J=function Mu(C){if(!C||!C.options)throw za("App Configuration Object");if(!C.name)throw za("App Name");const R=["projectId","apiKey","appId","messagingSenderId"],{options:P}=C;for(const H of R)if(!P[H])throw za(H);return{appName:C.name,projectId:P.projectId,apiKey:P.apiKey,appId:P.appId,senderId:P.messagingSenderId}}(R);this.firebaseDependencies={app:R,appConfig:J,installations:P,analyticsProvider:H}}_delete(){return Promise.resolve()}}function kl(C,R){return(ai=ai||(0,$.Z)(function*(P,H){if(!navigator)throw vi.create("only-available-in-window");if("default"===Notification.permission&&(yield Notification.requestPermission()),"granted"!==Notification.permission)throw vi.create("permission-blocked");return yield function lo(C,R){return(Il=Il||(0,$.Z)(function*(P,H){H?P.vapidKey=H:P.vapidKey||(P.vapidKey=Ss)})).apply(this,arguments)}(P,H?.vapidKey),yield function da(C,R){return(Gd=Gd||(0,$.Z)(function*(P,H){if(!H&&!P.swRegistration&&(yield function Lo(C){return(oi=oi||(0,$.Z)(function*(R){try{R.swRegistration=yield navigator.serviceWorker.register(fr,{scope:_i}),R.swRegistration.update().catch(()=>{})}catch(P){throw vi.create("failed-service-worker-registration",{browserErrorMessage:P?.message})}})).apply(this,arguments)}(P)),H||!P.swRegistration){if(!(H instanceof ServiceWorkerRegistration))throw vi.create("invalid-sw-registration");P.swRegistration=H}})).apply(this,arguments)}(P,H?.serviceWorkerRegistration),Ic(P)})).apply(this,arguments)}function Sc(C,R){return(Du=Du||(0,$.Z)(function*(P,H){const J=H.data;if(!J.isFirebaseMessaging)return;P.onMessageHandler&&J.messageType===Ds.PUSH_RECEIVED&&("function"==typeof P.onMessageHandler?P.onMessageHandler(Yd(J)):P.onMessageHandler.next(Yd(J)));const ce=J.data;(function np(C){return"object"==typeof C&&!!C&&oo in C})(ce)&&"1"===ce[Al]&&(yield function Ll(C,R,P){return(Su=Su||(0,$.Z)(function*(H,J,ce){const Ee=function rp(C){switch(C){case Ds.NOTIFICATION_CLICKED:return"notification_open";case Ds.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(J);(yield H.firebaseDependencies.analyticsProvider.get()).logEvent(Ee,{message_id:ce[oo],message_name:ce[Hd],message_time:ce[Au],message_device_time:Math.floor(Date.now()/1e3)})})).apply(this,arguments)}(P,J.messageType,ce))})).apply(this,arguments)}const Dc="@firebase/messaging",z0=C=>{const R=new ku(C.getProvider("app").getImmediate(),C.getProvider("installations-internal").getImmediate(),C.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",P=>Sc(R,P)),R},ip=C=>{const R=C.getProvider("messaging").getImmediate();return{getToken:H=>kl(R,H)}};function Pu(){return(wl=wl||(0,$.Z)(function*(){try{yield(0,be.eu)()}catch{return!1}return typeof window<"u"&&(0,be.hl)()&&(0,be.zI)()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")})).apply(this,arguments)}var Oo,Ou,Nu,Ac,Jd,Fu,Uu,fa,th;!function Lu(){(0,fe._registerComponent)(new me.wA("messaging",z0,"PUBLIC")),(0,fe._registerComponent)(new me.wA("messaging-internal",ip,"PRIVATE")),(0,fe.registerVersion)(Dc,"0.12.4"),(0,fe.registerVersion)(Dc,"0.12.4","esm2017")}();const Ka="analytics",nh="firebase_id",rh="origin",qa=6e4,pa="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",ho="https://www.googletagmanager.com/gtag/js",rr=new Le.Yd("@firebase/analytics"),Cn=new be.LL("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Ya(C){if(!C.startsWith(ho)){const R=Cn.create("invalid-gtag-resource",{gtagURL:C});return rr.warn(R.message),""}return C}function xc(C){return Promise.all(C.map(R=>R.catch(P=>P)))}const ah=30,cp=new class lp{constructor(R={},P=1e3){this.throttleMetadata=R,this.intervalMillis=P}getThrottleMetadata(R){return this.throttleMetadata[R]}setThrottleMetadata(R,P){this.throttleMetadata[R]=P}deleteThrottleMetadata(R){delete this.throttleMetadata[R]}};function jr(C){return new Headers({Accept:"application/json","x-goog-api-key":C})}function Rc(C){return(Ac=Ac||(0,$.Z)(function*(R,P=cp,H){const{appId:J,apiKey:ce,measurementId:Ee}=R.options;if(!J)throw Cn.create("no-app-id");if(!ce){if(Ee)return{measurementId:Ee,appId:J};throw Cn.create("no-api-key")}const Ue=P.getThrottleMetadata(J)||{backoffCount:0,throttleEndTimeMillis:Date.now()},nt=new up;return setTimeout((0,$.Z)(function*(){nt.abort()}),void 0!==H?H:qa),lh({appId:J,apiKey:ce,measurementId:Ee},Ue,nt,P)})).apply(this,arguments)}function lh(C,R,P){return(Jd=Jd||(0,$.Z)(function*(H,{throttleEndTimeMillis:J,backoffCount:ce},Ee,Ue=cp){var nt;const{appId:pt,measurementId:Dt}=H;try{yield function zs(C,R){return new Promise((P,H)=>{const J=Math.max(R-Date.now(),0),ce=setTimeout(P,J);C.addEventListener(()=>{clearTimeout(ce),H(Cn.create("fetch-throttle",{throttleEndTimeMillis:R}))})})}(Ee,J)}catch(Ot){if(Dt)return rr.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${Dt} provided in the "measurementId" field in the local Firebase config. [${Ot?.message}]`),{appId:pt,measurementId:Dt};throw Ot}try{const Ot=yield function $u(C){return(Nu=Nu||(0,$.Z)(function*(R){var P;const{appId:H,apiKey:J}=R,ce={method:"GET",headers:jr(J)},Ee=pa.replace("{app-id}",H),Ue=yield fetch(Ee,ce);if(200!==Ue.status&&304!==Ue.status){let nt="";try{const pt=yield Ue.json();null!==(P=pt.error)&&void 0!==P&&P.message&&(nt=pt.error.message)}catch{}throw Cn.create("config-fetch-failed",{httpStatus:Ue.status,responseMessage:nt})}return Ue.json()})).apply(this,arguments)}(H);return Ue.deleteThrottleMetadata(pt),Ot}catch(Ot){const hn=Ot;if(!function ma(C){if(!(C instanceof be.ZR&&C.customData))return!1;const R=Number(C.customData.httpStatus);return 429===R||500===R||503===R||504===R}(hn)){if(Ue.deleteThrottleMetadata(pt),Dt)return rr.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${Dt} provided in the "measurementId" field in the local Firebase config. [${hn?.message}]`),{appId:pt,measurementId:Dt};throw Ot}const Nt=503===Number(null===(nt=hn?.customData)||void 0===nt?void 0:nt.httpStatus)?(0,be.$s)(ce,Ue.intervalMillis,ah):(0,be.$s)(ce,Ue.intervalMillis),Yn={throttleEndTimeMillis:Date.now()+Nt,backoffCount:ce+1};return Ue.setThrottleMetadata(pt,Yn),rr.debug(`Calling attemptFetch again in ${Nt} millis`),lh(H,Yn,Ee,Ue)}})).apply(this,arguments)}class up{constructor(){this.listeners=[]}addEventListener(R){this.listeners.push(R)}abort(){this.listeners.forEach(R=>R())}}let Ol,Wn;function cs(C,R,P,H,J,ce,Ee){return(fa=fa||(0,$.Z)(function*(Ue,nt,pt,Dt,Ot,hn,Nt){var Yn;const Ai=Rc(Ue);Ai.then(xs=>{pt[xs.measurementId]=xs.appId,Ue.options.measurementId&&xs.measurementId!==Ue.options.measurementId&&rr.warn(`The measurement ID in the local Firebase config (${Ue.options.measurementId}) does not match the measurement ID fetched from the server (${xs.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(xs=>rr.error(xs)),nt.push(Ai);const Er=function ls(){return(Uu=Uu||(0,$.Z)(function*(){if(!(0,be.hl)())return rr.warn(Cn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{yield(0,be.eu)()}catch(C){return rr.warn(Cn.create("indexeddb-unavailable",{errorInfo:C?.toString()}).message),!1}return!0})).apply(this,arguments)}().then(xs=>{if(xs)return Dt.getId()}),[cn,Pr]=yield Promise.all([Ai,Er]);(function Vu(C){const R=window.document.getElementsByTagName("script");for(const P of Object.values(R))if(P.src&&P.src.includes(ho)&&P.src.includes(C))return P;return null})(hn)||function On(C,R){const P=function sh(C,R){let P;return window.trustedTypes&&(P=window.trustedTypes.createPolicy(C,R)),P}("firebase-js-sdk-policy",{createScriptURL:Ya}),H=document.createElement("script"),J=`${ho}?l=${C}&id=${R}`;H.src=P?P?.createScriptURL(J):J,H.async=!0,document.head.appendChild(H)}(hn,cn.measurementId),Wn&&(Ot("consent","default",Wn),function Fi(C){Wn=C}(void 0)),Ot("js",new Date);const mo=null!==(Yn=Nt?.config)&&void 0!==Yn?Yn:{};return mo[rh]="firebase",mo.update=!0,null!=Pr&&(mo[nh]=Pr),Ot("config",cn.measurementId,mo),Ol&&(Ot("set",Ol),function Bt(C){Ol=C}(void 0)),cn.measurementId})).apply(this,arguments)}class dp{constructor(R){this.app=R}_delete(){return delete Hi[this.app.options.appId],Promise.resolve()}}let Hi={},us=[];const ch={};let ga,ji,kc="dataLayer",Lc="gtag",ya=!1;function hp(C,R,P){!function Ht(){const C=[];if((0,be.ru)()&&C.push("This is a browser extension environment."),(0,be.zI)()||C.push("Cookies are not available."),C.length>0){const R=C.map((H,J)=>`(${J+1}) ${H}`).join(" "),P=Cn.create("invalid-analytics-context",{errorInfo:R});rr.warn(P.message)}}();const H=C.options.appId;if(!H)throw Cn.create("no-app-id");if(!C.options.apiKey){if(!C.options.measurementId)throw Cn.create("no-api-key");rr.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${C.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Hi[H])throw Cn.create("already-exists",{id:H});if(!ya){!function ig(C){let R=[];Array.isArray(window[C])?R=window[C]:window[C]=R}(kc);const{wrappedGtag:ce,gtagCore:Ee}=function sg(C,R,P,H,J){let ce=function(...Ee){window[H].push(arguments)};return window[J]&&"function"==typeof window[J]&&(ce=window[J]),window[J]=function Cc(C,R,P,H){var J;return function ce(Ee){return(J=J||(0,$.Z)(function*(Ue,...nt){try{if("event"===Ue){const[pt,Dt]=nt;yield function oh(C,R,P,H,J){return(Ou=Ou||(0,$.Z)(function*(ce,Ee,Ue,nt,pt){try{let Dt=[];if(pt&&pt.send_to){let Ot=pt.send_to;Array.isArray(Ot)||(Ot=[Ot]);const hn=yield xc(Ue);for(const Nt of Ot){const Yn=hn.find(Er=>Er.measurementId===Nt),Ai=Yn&&Ee[Yn.appId];if(!Ai){Dt=[];break}Dt.push(Ai)}}0===Dt.length&&(Dt=Object.values(Ee)),yield Promise.all(Dt),ce("event",nt,pt||{})}catch(Dt){rr.error(Dt)}})).apply(this,arguments)}(C,R,P,pt,Dt)}else if("config"===Ue){const[pt,Dt]=nt;yield function ap(C,R,P,H,J,ce){return(Oo=Oo||(0,$.Z)(function*(Ee,Ue,nt,pt,Dt,Ot){const hn=pt[Dt];try{if(hn)yield Ue[hn];else{const Yn=(yield xc(nt)).find(Ai=>Ai.measurementId===Dt);Yn&&(yield Ue[Yn.appId])}}catch(Nt){rr.error(Nt)}Ee("config",Dt,Ot)})).apply(this,arguments)}(C,R,P,H,pt,Dt)}else if("consent"===Ue){const[pt]=nt;C("consent","update",pt)}else if("get"===Ue){const[pt,Dt,Ot]=nt;C("get",pt,Dt,Ot)}else if("set"===Ue){const[pt]=nt;C("set",pt)}else C(Ue,...nt)}catch(pt){rr.error(pt)}})).apply(this,arguments)}}(ce,C,R,P),{gtagCore:ce,wrappedGtag:window[J]}}(Hi,us,ch,kc,Lc);ji=ce,ga=Ee,ya=!0}return Hi[H]=cs(C,us,ch,R,ga,kc,P),new dp(C)}function _a(){return(th=th||(0,$.Z)(function*(){if((0,be.ru)()||!(0,be.zI)()||!(0,be.hl)())return!1;try{return yield(0,be.eu)()}catch{return!1}})).apply(this,arguments)}const No="@firebase/analytics";!function Ul(){(0,fe._registerComponent)(new me.wA(Ka,(R,{options:P})=>hp(R.getProvider("app").getImmediate(),R.getProvider("installations-internal").getImmediate(),P),"PUBLIC")),(0,fe._registerComponent)(new me.wA("analytics-internal",function C(R){try{const P=R.getProvider(Ka).getImmediate();return{logEvent:(H,J,ce)=>function cg(C,R,P,H){C=(0,be.m9)(C),function Mc(C,R,P,H,J){return(Fu=Fu||(0,$.Z)(function*(ce,Ee,Ue,nt,pt){if(pt&&pt.global)ce("event",Ue,nt);else{const Dt=yield Ee;ce("event",Ue,Object.assign(Object.assign({},nt),{send_to:Dt}))}})).apply(this,arguments)}(ji,Hi[C.app.options.appId],R,P,H).catch(J=>rr.error(J))}(P,H,J,ce)}}catch(P){throw Cn.create("interop-component-reg-failed",{reason:P})}},"PRIVATE")),(0,fe.registerVersion)(No,"0.10.0"),(0,fe.registerVersion)(No,"0.10.0","esm2017")}();var Hu=W(4408),zi=W(7565);const Wr=new class ju extends zi.v{}(class Bl extends Hu.o{constructor(R,P){super(R,P),this.scheduler=R,this.work=P}schedule(R,P=0){return P>0?super.schedule(R,P):(this.delay=P,this.state=R,this.scheduler.flush(this),this)}execute(R,P){return P>0||this.closed?super.execute(R,P):this._execute(R,P)}requestAsyncId(R,P,H=0){return null!=H&&H>0||null==H&&this.delay>0?super.requestAsyncId(R,P,H):(R.flush(this),0)}});var hh=W(4986),Dr=W(9751),Qa=W(8505),Xa=W(9468),Wi=W(5363);const li=new m.GfV("7.6.1"),Vl="__angularfire_symbol__analyticsIsSupportedValue",zu="__angularfire_symbol__analyticsIsSupported",va="__angularfire_symbol__remoteConfigIsSupportedValue",As="__angularfire_symbol__remoteConfigIsSupported",Fo="__angularfire_symbol__messagingIsSupportedValue",Kr="__angularfire_symbol__messagingIsSupported";function Bc(C,R,P){if(R){if(1===R.length)return R[0];const ce=R.filter(Ee=>Ee.app===P);if(1===ce.length)return ce[0]}return P.container.getProvider(C).getImmediate({optional:!0})}globalThis[zu]||(globalThis[zu]=_a().then(C=>globalThis[Vl]=C).catch(()=>globalThis[Vl]=!1)),globalThis[Kr]||(globalThis[Kr]=Pu().then(C=>globalThis[Fo]=C).catch(()=>globalThis[Fo]=!1)),globalThis[As]||(globalThis[As]=bu().then(C=>globalThis[va]=C).catch(()=>globalThis[va]=!1));const fh=(C,R)=>{const P=R?[R]:(0,ee.C6)(),H=[];return P.forEach(J=>{J.container.getProvider(C).instances.forEach(Ee=>{H.includes(Ee)||H.push(Ee)})}),H};function ba(){}class $l{constructor(R,P=Wr){this.zone=R,this.delegate=P}now(){return this.delegate.now()}schedule(R,P,H){const J=this.zone;return this.delegate.schedule(function(Ee){J.runGuarded(()=>{R.apply(this,[Ee])})},P,H)}}class Xt{constructor(R){this.zone=R,this.task=null}call(R,P){const H=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ba,{},ba,ba)),P.pipe((0,Qa.b)({next:H,complete:H,error:H})).subscribe(R).add(H)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}let Ja=(()=>{class C{constructor(P){this.ngZone=P,this.outsideAngular=P.runOutsideAngular(()=>new $l(Zone.current)),this.insideAngular=P.run(()=>new $l(Zone.current,hh.z)),globalThis.\u0275AngularFireScheduler||(globalThis.\u0275AngularFireScheduler=this)}}return C.\u0275fac=function(P){return new(P||C)(m.LFG(m.R0b))},C.\u0275prov=m.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})();function Ea(){const C=globalThis.\u0275AngularFireScheduler;if(!C)throw new Error("Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using\nprovideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).");return C}function Uo(C){return Ea().ngZone.run(()=>C())}function Wu(C){return Ea(),function mh(C){return function(P){return(P=P.lift(new Xt(C.ngZone))).pipe((0,Xa.R)(C.outsideAngular),(0,Wi.Q)(C.insideAngular))}}(Ea())(C)}const Ku=(C,R)=>function(){const H=arguments;return R&&setTimeout(()=>{"scheduled"===R.state&&R.invoke()},10),Uo(()=>C.apply(void 0,H))},dg=(C,R)=>function(){let P;const H=arguments;for(let ce=0;ce<arguments.length;ce++)"function"==typeof H[ce]&&(R&&(P||(P=Uo(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ba,{},ba,ba)))),H[ce]=Ku(H[ce],P));const J=function fo(C){return Ea().ngZone.runOutsideAngular(()=>C())}(()=>C.apply(this,H));if(!R){if(J instanceof Dr.y){const ce=Ea();return J.pipe((0,Xa.R)(ce.outsideAngular),(0,Wi.Q)(ce.insideAngular))}return Uo(()=>J)}return J instanceof Dr.y?J.pipe(Wu):J instanceof Promise?Uo(()=>new Promise((ce,Ee)=>J.then(Ue=>Uo(()=>ce(Ue)),Ue=>Uo(()=>Ee(Ue))))):"function"==typeof J&&P?function(){return setTimeout(()=>{P&&"scheduled"===P.state&&P.invoke()},10),J.apply(this,arguments)}:Uo(()=>J)}},1389:(Vt,$e,W)=>{W.d($e,{$:()=>Sr,A:()=>fn,D:()=>Nn,I:()=>Pd,J:()=>ws,L:()=>mn,N:()=>Rd,P:()=>fp,Q:()=>Sl,R:()=>kc,U:()=>Dl,V:()=>oo,W:()=>Hd,X:()=>Ss,Y:()=>Ds,Z:()=>ss,_:()=>jd,a:()=>qa,a0:()=>Mo,a1:()=>or,a2:()=>vi,a3:()=>Cl,a4:()=>Tc,a5:()=>Cu,a6:()=>Ic,a7:()=>Rl,a8:()=>Ml,a9:()=>ua,aA:()=>et,aB:()=>Kr,aC:()=>so,aD:()=>xo,aE:()=>va,aF:()=>Wr,aG:()=>ju,aH:()=>An,aL:()=>rr,aO:()=>Al,aa:()=>ko,ab:()=>ep,ac:()=>Yd,ad:()=>rg,ae:()=>tp,af:()=>np,ai:()=>Mu,aj:()=>za,ak:()=>ku,an:()=>Jf,ao:()=>Wa,aq:()=>Ou,ar:()=>op,as:()=>Oi,at:()=>_u,au:()=>hc,av:()=>St,aw:()=>hn,ax:()=>Uc,ay:()=>eg,az:()=>Gt,b:()=>nh,c:()=>Pc,d:()=>Oc,e:()=>cg,f:()=>Dr,g:()=>li,h:()=>Xa,i:()=>ma,j:()=>zu,k:()=>Er,l:()=>ya,m:()=>mo,o:()=>gh,p:()=>ht,r:()=>Nl,s:()=>ji,u:()=>hp});var Le,Oe,Ce,ne,te,ue,rt,Ve,ut,At,Ae,Ke,Ze,at,Qe,je,ze,ct,tt,Tt,Ct,dn,It,vn,Rt,eo,Xi,Ji,Vs,ve,we,De,ye,st,Xe,zt,xt,cr,$t,Dn,ir,jn,Rr,Mr,yr,kr,ti,vr,Ft,_s,na,Fn,Vi,wr,tr,Pn,Wt,ni,ur,br,mi,$r,ra,zn,dr,an,to,wn,Pi,Gr,ri,es,Hr,vs,bs,re,Q,G,j,V,se,m=W(5861),ee=W(2090),$=W(6881),fe=W(7582),be=W(1877),me=W(4859);const ht={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},fn={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};const Nn=function Ut(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend."}},$i=function qn(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},ts=new ee.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),pe=new be.Yd("@firebase/auth");function wt(M,..._){pe.logLevel<=be.in.ERROR&&pe.error(`Auth (${$.SDK_VERSION}): ${M}`,..._)}function St(M,..._){throw Ln(M,..._)}function Gt(M,..._){return Ln(M,..._)}function Lt(M,_,v){const I=Object.assign(Object.assign({},$i()),{[_]:v});return new ee.LL("auth","Firebase",I).create(_,{appName:M.name})}function kn(M,_,v){if(!(_ instanceof v))throw v.name!==_.constructor.name&&St(M,"argument-error"),Lt(M,"argument-error",`Type of ${_.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Ln(M,..._){if("string"!=typeof M){const v=_[0],I=[..._.slice(1)];return I[0]&&(I[0].appName=M.name),M._errorFactory.create(v,...I)}return ts.create(M,..._)}function et(M,_,...v){if(!M)throw Ln(_,...v)}function Jn(M){const _="INTERNAL ASSERTION FAILED: "+M;throw wt(_),new Error(_)}function Oi(M,_){M||Jn(_)}function no(){var M;return typeof self<"u"&&(null===(M=self.location)||void 0===M?void 0:M.href)||""}function Ua(){return"http:"===ns()||"https:"===ns()}function ns(){var M;return typeof self<"u"&&(null===(M=self.location)||void 0===M?void 0:M.protocol)||null}class nr{constructor(_,v){this.shortDelay=_,this.longDelay=v,Oi(v>_,"Short delay should be less than long delay!"),this.isMobile=(0,ee.uI)()||(0,ee.b$)()}get(){return function Et(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Ua()||(0,ee.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Ni(M,_){Oi(M.emulator,"Emulator should always be set here");const{url:v}=M.emulator;return _?`${v}${_.startsWith("/")?_.slice(1):_}`:v}class ro{static initialize(_,v,I){this.fetchImpl=_,v&&(this.headersImpl=v),I&&(this.responseImpl=I)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:void Jn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:void Jn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:void Jn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ii={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Ba=new nr(3e4,6e4);function pn(M,_){return M.tenantId&&!_.tenantId?Object.assign(Object.assign({},_),{tenantId:M.tenantId}):_}function sr(M,_,v,I){return(Le=Le||(0,m.Z)(function*(O,U,Y,oe,ge={}){return ia(O,ge,(0,m.Z)(function*(){let Be={},jt={};oe&&("GET"===U?jt=oe:Be={body:JSON.stringify(oe)});const Mt=(0,ee.xO)(Object.assign({key:O.config.apiKey},jt)).slice(1),qt=yield O._getAdditionalHeaders();return qt["Content-Type"]="application/json",O.languageCode&&(qt["X-Firebase-Locale"]=O.languageCode),ro.fetch()(yl(O,O.config.apiHost,Y,Mt),Object.assign({method:U,headers:qt,referrerPolicy:"no-referrer"},Be))}))})).apply(this,arguments)}function ia(M,_,v){return(Oe=Oe||(0,m.Z)(function*(I,O,U){I._canInitEmulator=!1;const Y=Object.assign(Object.assign({},Ii),O);try{const oe=new sa(I),ge=yield Promise.race([U(),oe.promise]);oe.clearNetworkTimeout();const Be=yield ge.json();if("needConfirmation"in Be)throw Ao(I,"account-exists-with-different-credential",Be);if(ge.ok&&!("errorMessage"in Be))return Be;{const jt=ge.ok?Be.errorMessage:Be.error.message,[Mt,qt]=jt.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===Mt)throw Ao(I,"credential-already-in-use",Be);if("EMAIL_EXISTS"===Mt)throw Ao(I,"email-already-in-use",Be);if("USER_DISABLED"===Mt)throw Ao(I,"user-disabled",Be);const Un=Y[Mt]||Mt.toLowerCase().replace(/[_\s]+/g,"-");if(qt)throw Lt(I,Un,qt);St(I,Un)}}catch(oe){if(oe instanceof ee.ZR)throw oe;St(I,"network-request-failed",{message:String(oe)})}})).apply(this,arguments)}function tn(M,_,v,I){return(Ce=Ce||(0,m.Z)(function*(O,U,Y,oe,ge={}){const Be=yield sr(O,U,Y,oe,ge);return"mfaPendingCredential"in Be&&St(O,"multi-factor-auth-required",{_serverResponse:Be}),Be})).apply(this,arguments)}function yl(M,_,v,I){const O=`${_}${v}?${I}`;return M.config.emulator?Ni(M.config,O):`${M.config.apiScheme}://${O}`}class sa{constructor(_){this.auth=_,this.timer=null,this.promise=new Promise((v,I)=>{this.timer=setTimeout(()=>I(Gt(this.auth,"network-request-failed")),Ba.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ao(M,_,v){const I={appName:M.name};v.email&&(I.email=v.email),v.phoneNumber&&(I.phoneNumber=v.phoneNumber);const O=Gt(M,_,I);return O.customData._tokenResponse=v,O}function rs(M){if(M)try{const _=new Date(Number(M));if(!isNaN(_.getTime()))return _.toUTCString()}catch{}}function cc(M){return 1e3*Number(M)}function er(M){const[_,v,I]=M.split(".");if(void 0===_||void 0===v||void 0===I)return wt("JWT malformed, contained fewer than 3 sections"),null;try{const O=(0,ee.tV)(v);return O?JSON.parse(O):(wt("Failed to decode base64 JWT payload"),null)}catch(O){return wt("Caught error parsing JWT payload as JSON",O?.toString()),null}}function Ts(M,_){return(Ve=Ve||(0,m.Z)(function*(v,I,O=!1){if(O)return I;try{return yield I}catch(U){throw U instanceof ee.ZR&&function wi({code:M}){return"auth/user-disabled"===M||"auth/user-token-expired"===M}(U)&&v.auth.currentUser===v&&(yield v.auth.signOut()),U}})).apply(this,arguments)}class uc{constructor(_){this.user=_,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(_){var v;if(_){const I=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),I}{this.errorBackoff=3e4;const O=(null!==(v=this.user.stsTokenManager.expirationTime)&&void 0!==v?v:0)-Date.now()-3e5;return Math.max(0,O)}}schedule(_=!1){var v=this;if(!this.isRunning)return;const I=this.getInterval(_);this.timerId=setTimeout((0,m.Z)(function*(){yield v.iteration()}),I)}iteration(){var _=this;return(0,m.Z)(function*(){try{yield _.user.getIdToken(!0)}catch(v){return void("auth/network-request-failed"===v?.code&&_.schedule(!0))}_.schedule()})()}}class vl{constructor(_,v){this.createdAt=_,this.lastLoginAt=v,this._initializeTime()}_initializeTime(){this.lastSignInTime=rs(this.lastLoginAt),this.creationTime=rs(this.createdAt)}_copy(_){this.createdAt=_.createdAt,this.lastLoginAt=_.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function $s(M){return(ut=ut||(0,m.Z)(function*(_){var v;const I=_.auth,O=yield _.getIdToken(),U=yield Ts(_,function _l(M,_){return(ue=ue||(0,m.Z)(function*(v,I){return sr(v,"POST","/v1/accounts:lookup",I)})).apply(this,arguments)}(I,{idToken:O}));et(U?.users.length,I,"internal-error");const Y=U.users[0];_._notifyReloadListener(Y);const oe=null!==(v=Y.providerUserInfo)&&void 0!==v&&v.length?function Si(M){return M.map(_=>{var{providerId:v}=_,I=(0,fe._T)(_,["providerId"]);return{providerId:v,uid:I.rawId||"",displayName:I.displayName||null,email:I.email||null,phoneNumber:I.phoneNumber||null,photoURL:I.photoUrl||null}})}(Y.providerUserInfo):[],ge=function Xm(M,_){return[...M.filter(I=>!_.some(O=>O.providerId===I.providerId)),..._]}(_.providerData,oe),Mt=!!_.isAnonymous&&!(_.email&&Y.passwordHash||ge?.length),qt={uid:Y.localId,displayName:Y.displayName||null,photoURL:Y.photoUrl||null,email:Y.email||null,emailVerified:Y.emailVerified||!1,phoneNumber:Y.phoneNumber||null,tenantId:Y.tenantId||null,providerData:ge,metadata:new vl(Y.createdAt,Y.lastLoginAt),isAnonymous:Mt};Object.assign(_,qt)})).apply(this,arguments)}class oa{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(_){et(_.idToken,"internal-error"),et(typeof _.idToken<"u","internal-error"),et(typeof _.refreshToken<"u","internal-error");const v="expiresIn"in _&&typeof _.expiresIn<"u"?Number(_.expiresIn):function Es(M){const _=er(M);return et(_,"internal-error"),et(typeof _.exp<"u","internal-error"),et(typeof _.iat<"u","internal-error"),Number(_.exp)-Number(_.iat)}(_.idToken);this.updateTokensAndExpiration(_.idToken,_.refreshToken,v)}getToken(_,v=!1){var I=this;return(0,m.Z)(function*(){return et(!I.accessToken||I.refreshToken,_,"user-token-expired"),v||!I.accessToken||I.isExpired?I.refreshToken?(yield I.refresh(_,I.refreshToken),I.accessToken):null:I.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(_,v){var I=this;return(0,m.Z)(function*(){const{accessToken:O,refreshToken:U,expiresIn:Y}=yield function Gs(M,_){return(Ae=Ae||(0,m.Z)(function*(v,I){const O=yield ia(v,{},(0,m.Z)(function*(){const U=(0,ee.xO)({grant_type:"refresh_token",refresh_token:I}).slice(1),{tokenApiHost:Y,apiKey:oe}=v.config,ge=yl(v,Y,"/v1/token",`key=${oe}`),Be=yield v._getAdditionalHeaders();return Be["Content-Type"]="application/x-www-form-urlencoded",ro.fetch()(ge,{method:"POST",headers:Be,body:U})}));return{accessToken:O.access_token,expiresIn:O.expires_in,refreshToken:O.refresh_token}})).apply(this,arguments)}(_,v);I.updateTokensAndExpiration(O,U,Number(Y))})()}updateTokensAndExpiration(_,v,I){this.refreshToken=v||null,this.accessToken=_||null,this.expirationTime=Date.now()+1e3*I}static fromJSON(_,v){const{refreshToken:I,accessToken:O,expirationTime:U}=v,Y=new oa;return I&&(et("string"==typeof I,"internal-error",{appName:_}),Y.refreshToken=I),O&&(et("string"==typeof O,"internal-error",{appName:_}),Y.accessToken=O),U&&(et("number"==typeof U,"internal-error",{appName:_}),Y.expirationTime=U),Y}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(_){this.accessToken=_.accessToken,this.refreshToken=_.refreshToken,this.expirationTime=_.expirationTime}_clone(){return Object.assign(new oa,this.toJSON())}_performRefresh(){return Jn("not implemented")}}function is(M,_){et("string"==typeof M||typeof M>"u","internal-error",{appName:_})}class Hs{constructor(_){var{uid:v,auth:I,stsTokenManager:O}=_,U=(0,fe._T)(_,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new uc(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=v,this.auth=I,this.stsTokenManager=O,this.accessToken=O.accessToken,this.displayName=U.displayName||null,this.email=U.email||null,this.emailVerified=U.emailVerified||!1,this.phoneNumber=U.phoneNumber||null,this.photoURL=U.photoURL||null,this.isAnonymous=U.isAnonymous||!1,this.tenantId=U.tenantId||null,this.providerData=U.providerData?[...U.providerData]:[],this.metadata=new vl(U.createdAt||void 0,U.lastLoginAt||void 0)}getIdToken(_){var v=this;return(0,m.Z)(function*(){const I=yield Ts(v,v.stsTokenManager.getToken(v.auth,_));return et(I,v.auth,"internal-error"),v.accessToken!==I&&(v.accessToken=I,yield v.auth._persistUserIfCurrent(v),v.auth._notifyListenersIfCurrent(v)),I})()}getIdTokenResult(_){return function $a(M){return(rt=rt||(0,m.Z)(function*(_,v=!1){const I=(0,ee.m9)(_),O=yield I.getIdToken(v),U=er(O);et(U&&U.exp&&U.auth_time&&U.iat,I.auth,"internal-error");const Y="object"==typeof U.firebase?U.firebase:void 0,oe=Y?.sign_in_provider;return{claims:U,token:O,authTime:rs(cc(U.auth_time)),issuedAtTime:rs(cc(U.iat)),expirationTime:rs(cc(U.exp)),signInProvider:oe||null,signInSecondFactor:Y?.sign_in_second_factor||null}})).apply(this,arguments)}(this,_)}reload(){return function gi(M){return(At=At||(0,m.Z)(function*(_){const v=(0,ee.m9)(_);yield $s(v),yield v.auth._persistUserIfCurrent(v),v.auth._notifyListenersIfCurrent(v)})).apply(this,arguments)}(this)}_assign(_){this!==_&&(et(this.uid===_.uid,this.auth,"internal-error"),this.displayName=_.displayName,this.photoURL=_.photoURL,this.email=_.email,this.emailVerified=_.emailVerified,this.phoneNumber=_.phoneNumber,this.isAnonymous=_.isAnonymous,this.tenantId=_.tenantId,this.providerData=_.providerData.map(v=>Object.assign({},v)),this.metadata._copy(_.metadata),this.stsTokenManager._assign(_.stsTokenManager))}_clone(_){const v=new Hs(Object.assign(Object.assign({},this),{auth:_,stsTokenManager:this.stsTokenManager._clone()}));return v.metadata._copy(this.metadata),v}_onReload(_){et(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=_,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(_){this.reloadListener?this.reloadListener(_):this.reloadUserInfo=_}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(_,v=!1){var I=this;return(0,m.Z)(function*(){let O=!1;_.idToken&&_.idToken!==I.stsTokenManager.accessToken&&(I.stsTokenManager.updateFromServerResponse(_),O=!0),v&&(yield $s(I)),yield I.auth._persistUserIfCurrent(I),O&&I.auth._notifyListenersIfCurrent(I)})()}delete(){var _=this;return(0,m.Z)(function*(){const v=yield _.getIdToken();return yield Ts(_,function Va(M,_){return(ne=ne||(0,m.Z)(function*(v,I){return sr(v,"POST","/v1/accounts:delete",I)})).apply(this,arguments)}(_.auth,{idToken:v})),_.stsTokenManager.clearRefreshToken(),_.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(_=>Object.assign({},_)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(_,v){var I,O,U,Y,oe,ge,Be,jt;const Mt=null!==(I=v.displayName)&&void 0!==I?I:void 0,qt=null!==(O=v.email)&&void 0!==O?O:void 0,Un=null!==(U=v.phoneNumber)&&void 0!==U?U:void 0,ci=null!==(Y=v.photoURL)&&void 0!==Y?Y:void 0,Cs=null!==(oe=v.tenantId)&&void 0!==oe?oe:void 0,ui=null!==(ge=v._redirectEventId)&&void 0!==ge?ge:void 0,jl=null!==(Be=v.createdAt)&&void 0!==Be?Be:void 0,yh=null!==(jt=v.lastLoginAt)&&void 0!==jt?jt:void 0,{uid:qu,emailVerified:tl,isAnonymous:_h,providerData:vh,stsTokenManager:Hc}=v;et(qu&&Hc,_,"internal-error");const bh=oa.fromJSON(this.name,Hc);et("string"==typeof qu,_,"internal-error"),is(Mt,_.name),is(qt,_.name),et("boolean"==typeof tl,_,"internal-error"),et("boolean"==typeof _h,_,"internal-error"),is(Un,_.name),is(ci,_.name),is(Cs,_.name),is(ui,_.name),is(jl,_.name),is(yh,_.name);const jc=new Hs({uid:qu,auth:_,email:qt,emailVerified:tl,displayName:Mt,isAnonymous:_h,photoURL:ci,phoneNumber:Un,tenantId:Cs,stsTokenManager:bh,createdAt:jl,lastLoginAt:yh});return vh&&Array.isArray(vh)&&(jc.providerData=vh.map(nl=>Object.assign({},nl))),ui&&(jc._redirectEventId=ui),jc}static _fromIdTokenResponse(_,v,I=!1){return(0,m.Z)(function*(){const O=new oa;O.updateFromServerResponse(v);const U=new Hs({uid:v.localId,auth:_,stsTokenManager:O,isAnonymous:I});return yield $s(U),U})()}}const Is=new Map;function so(M){Oi(M instanceof Function,"Expected a class definition");let _=Is.get(M);return _?(Oi(_ instanceof M,"Instance stored in cache mismatched with class"),_):(_=new M,Is.set(M,_),_)}const Rd=(()=>{class M{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,m.Z)(function*(){return!0})()}_set(v,I){var O=this;return(0,m.Z)(function*(){O.storage[v]=I})()}_get(v){var I=this;return(0,m.Z)(function*(){const O=I.storage[v];return void 0===O?null:O})()}_remove(v){var I=this;return(0,m.Z)(function*(){delete I.storage[v]})()}_addListener(v,I){}_removeListener(v,I){}}return M.type="NONE",M})();function xo(M,_,v){return`firebase:${M}:${_}:${v}`}class dc{constructor(_,v,I){this.persistence=_,this.auth=v,this.userKey=I;const{config:O,name:U}=this.auth;this.fullUserKey=xo(this.userKey,O.apiKey,U),this.fullPersistenceKey=xo("persistence",O.apiKey,U),this.boundEventHandler=v._onStorageEvent.bind(v),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(_){return this.persistence._set(this.fullUserKey,_.toJSON())}getCurrentUser(){var _=this;return(0,m.Z)(function*(){const v=yield _.persistence._get(_.fullUserKey);return v?Hs._fromJSON(_.auth,v):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(_){var v=this;return(0,m.Z)(function*(){if(v.persistence===_)return;const I=yield v.getCurrentUser();return yield v.removeCurrentUser(),v.persistence=_,I?v.setCurrentUser(I):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(_,v,I="authUser"){return(0,m.Z)(function*(){var O,U;if(!v.length)return new dc(so(Rd),_,I);const Y=(yield Promise.all(v.map(function(Mt){return(O=O||(0,m.Z)(function*(qt){if(yield qt._isAvailable())return qt})).apply(this,arguments)}))).filter(Mt=>Mt);let oe=Y[0]||so(Rd);const ge=xo(I,_.config.apiKey,_.name);let Be=null;for(const Mt of v)try{const qt=yield Mt._get(ge);if(qt){const Un=Hs._fromJSON(_,qt);Mt!==oe&&(Be=Un),oe=Mt;break}}catch{}const jt=Y.filter(Mt=>Mt._shouldAllowMigration);return oe._shouldAllowMigration&&jt.length?(oe=jt[0],Be&&(yield oe._set(ge,Be.toJSON())),yield Promise.all(v.map(function(Mt){return(U=U||(0,m.Z)(function*(qt){if(qt!==oe)try{yield qt._remove(ge)}catch{}})).apply(this,arguments)})),new dc(oe,_,I)):new dc(oe,_,I)})()}}function Gf(M){const _=M.toLowerCase();if(_.includes("opera/")||_.includes("opr/")||_.includes("opios/"))return"Opera";if(jf(_))return"IEMobile";if(_.includes("msie")||_.includes("trident/"))return"IE";if(_.includes("edge/"))return"Edge";if(Md(_))return"Firefox";if(_.includes("silk/"))return"Silk";if(yu(_))return"Blackberry";if(Jm(_))return"Webos";if(kd(_))return"Safari";if((_.includes("chrome/")||Hf(_))&&!_.includes("edge/"))return"Chrome";if(hc(_))return"Android";{const I=M.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===I?.length)return I[1]}return"Other"}function Md(M=(0,ee.z$)()){return/firefox\//i.test(M)}function kd(M=(0,ee.z$)()){const _=M.toLowerCase();return _.includes("safari/")&&!_.includes("chrome/")&&!_.includes("crios/")&&!_.includes("android")}function Hf(M=(0,ee.z$)()){return/crios\//i.test(M)}function jf(M=(0,ee.z$)()){return/iemobile/i.test(M)}function hc(M=(0,ee.z$)()){return/android/i.test(M)}function yu(M=(0,ee.z$)()){return/blackberry/i.test(M)}function Jm(M=(0,ee.z$)()){return/webos/i.test(M)}function _u(M=(0,ee.z$)()){return/iphone|ipad|ipod/i.test(M)||/macintosh/i.test(M)&&/mobile/i.test(M)}function eg(M=(0,ee.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(M)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(M)}function vu(M=(0,ee.z$)()){return _u(M)||hc(M)||Jm(M)||yu(M)||/windows phone/i.test(M)||jf(M)}function zf(M,_=[]){let v;switch(M){case"Browser":v=Gf((0,ee.z$)());break;case"Worker":v=`${Gf((0,ee.z$)())}-${M}`;break;default:v=M}const I=_.length?_.join(","):"FirebaseCore-web";return`${v}/JsCore/${$.SDK_VERSION}/${I}`}function aa(M,_){return(Ze=Ze||(0,m.Z)(function*(v,I){return sr(v,"GET","/v2/recaptchaConfig",pn(v,I))})).apply(this,arguments)}function Kf(M){return void 0!==M&&void 0!==M.getResponse}function Ld(M){return void 0!==M&&void 0!==M.enterprise}class bu{constructor(_){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===_.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=_.recaptchaKey.split("/")[3],this.emailPasswordEnabled=_.recaptchaEnforcementState.some(v=>"EMAIL_PASSWORD_PROVIDER"===v.provider&&"OFF"!==v.enforcementState)}}function bl(M){return new Promise((_,v)=>{const I=document.createElement("script");I.setAttribute("src",M),I.onload=_,I.onerror=O=>{const U=Gt("internal-error");U.customData=O,v(U)},I.type="text/javascript",I.charset="UTF-8",function qf(){var M,_;return null!==(_=null===(M=document.getElementsByTagName("head"))||void 0===M?void 0:M[0])&&void 0!==_?_:document}().appendChild(I)})}function pc(M){return`__${M}${Math.floor(1e6*Math.random())}`}const Eu="NO_RECAPTCHA";class Ga{constructor(_){this.type="recaptcha-enterprise",this.auth=An(_)}verify(_="verify",v=!1){var I=this;return(0,m.Z)(function*(){var O;function Y(oe,ge,Be){const jt=window.grecaptcha;Ld(jt)?jt.enterprise.ready(()=>{jt.enterprise.execute(oe,{action:_}).then(Mt=>{ge(Mt)}).catch(()=>{ge(Eu)})}):Be(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((oe,ge)=>{(function U(oe){return(O=O||(0,m.Z)(function*(ge){var Be;if(!v){if(null==ge.tenantId&&null!=ge._agentRecaptchaConfig)return ge._agentRecaptchaConfig.siteKey;if(null!=ge.tenantId&&void 0!==ge._tenantRecaptchaConfigs[ge.tenantId])return ge._tenantRecaptchaConfigs[ge.tenantId].siteKey}return new Promise(function(jt,Mt){return(Be=Be||(0,m.Z)(function*(qt,Un){aa(ge,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(ci=>{if(void 0!==ci.recaptchaKey){const Cs=new bu(ci);return null==ge.tenantId?ge._agentRecaptchaConfig=Cs:ge._tenantRecaptchaConfigs[ge.tenantId]=Cs,qt(Cs.siteKey)}Un(new Error("recaptcha Enterprise site key undefined"))}).catch(ci=>{Un(ci)})})).apply(this,arguments)})})).apply(this,arguments)})(I.auth).then(Be=>{if(!v&&Ld(window.grecaptcha))Y(Be,oe,ge);else{if(typeof window>"u")return void ge(new Error("RecaptchaVerifier is only supported in browser"));bl("https://www.google.com/recaptcha/enterprise.js?render="+Be).then(()=>{Y(Be,oe,ge)}).catch(jt=>{ge(jt)})}}).catch(Be=>{ge(Be)})})})()}}function Lr(M,_,v){return(at=at||(0,m.Z)(function*(I,O,U,Y=!1){const oe=new Ga(I);let ge;try{ge=yield oe.verify(U)}catch{ge=yield oe.verify(U,!0)}const Be=Object.assign({},O);return Object.assign(Be,Y?{captchaResp:ge}:{captchaResponse:ge}),Object.assign(Be,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(Be,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),Be})).apply(this,arguments)}class mc{constructor(_){this.auth=_,this.queue=[]}pushCallback(_,v){const I=U=>new Promise((Y,oe)=>{try{Y(_(U))}catch(ge){oe(ge)}});I.onAbort=v,this.queue.push(I);const O=this.queue.length-1;return()=>{this.queue[O]=()=>Promise.resolve()}}runMiddleware(_){var v=this;return(0,m.Z)(function*(){if(v.auth.currentUser===_)return;const I=[];try{for(const O of v.queue)yield O(_),O.onAbort&&I.push(O.onAbort)}catch(O){I.reverse();for(const U of I)try{U()}catch{}throw v.auth._errorFactory.create("login-blocked",{originalMessage:O?.message})}})()}}class gc{constructor(_,v,I,O){this.app=_,this.heartbeatServiceProvider=v,this.appCheckServiceProvider=I,this.config=O,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new El(this),this.idTokenSubscription=new El(this),this.beforeStateQueue=new mc(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ts,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=_.name,this.clientVersion=O.sdkClientVersion}_initializeWithPersistence(_,v){var I=this;return v&&(this._popupRedirectResolver=so(v)),this._initializationPromise=this.queue((0,m.Z)(function*(){var O,U;if(!I._deleted&&(I.persistenceManager=yield dc.create(I,_),!I._deleted)){if(null!==(O=I._popupRedirectResolver)&&void 0!==O&&O._shouldInitProactively)try{yield I._popupRedirectResolver._initialize(I)}catch{}yield I.initializeCurrentUser(v),I.lastNotifiedUid=(null===(U=I.currentUser)||void 0===U?void 0:U.uid)||null,!I._deleted&&(I._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var _=this;return(0,m.Z)(function*(){if(_._deleted)return;const v=yield _.assertedPersistence.getCurrentUser();if(_.currentUser||v){if(_.currentUser&&v&&_.currentUser.uid===v.uid)return _._currentUser._assign(v),void(yield _.currentUser.getIdToken());yield _._updateCurrentUser(v,!0)}})()}initializeCurrentUser(_){var v=this;return(0,m.Z)(function*(){var I;const O=yield v.assertedPersistence.getCurrentUser();let U=O,Y=!1;if(_&&v.config.authDomain){yield v.getOrInitRedirectPersistenceManager();const oe=null===(I=v.redirectUser)||void 0===I?void 0:I._redirectEventId,ge=U?._redirectEventId,Be=yield v.tryRedirectSignIn(_);(!oe||oe===ge)&&Be?.user&&(U=Be.user,Y=!0)}if(!U)return v.directlySetCurrentUser(null);if(!U._redirectEventId){if(Y)try{yield v.beforeStateQueue.runMiddleware(U)}catch(oe){U=O,v._popupRedirectResolver._overrideRedirectResult(v,()=>Promise.reject(oe))}return U?v.reloadAndSetCurrentUserOrClear(U):v.directlySetCurrentUser(null)}return et(v._popupRedirectResolver,v,"argument-error"),yield v.getOrInitRedirectPersistenceManager(),v.redirectUser&&v.redirectUser._redirectEventId===U._redirectEventId?v.directlySetCurrentUser(U):v.reloadAndSetCurrentUserOrClear(U)})()}tryRedirectSignIn(_){var v=this;return(0,m.Z)(function*(){let I=null;try{I=yield v._popupRedirectResolver._completeRedirectFn(v,_,!0)}catch{yield v._setRedirectUser(null)}return I})()}reloadAndSetCurrentUserOrClear(_){var v=this;return(0,m.Z)(function*(){try{yield $s(_)}catch(I){if("auth/network-request-failed"!==I?.code)return v.directlySetCurrentUser(null)}return v.directlySetCurrentUser(_)})()}useDeviceLanguage(){this.languageCode=function bn(){if(typeof navigator>"u")return null;const M=navigator;return M.languages&&M.languages[0]||M.language||null}()}_delete(){var _=this;return(0,m.Z)(function*(){_._deleted=!0})()}updateCurrentUser(_){var v=this;return(0,m.Z)(function*(){const I=_?(0,ee.m9)(_):null;return I&&et(I.auth.config.apiKey===v.config.apiKey,v,"invalid-user-token"),v._updateCurrentUser(I&&I._clone(v))})()}_updateCurrentUser(_,v=!1){var I=this;return(0,m.Z)(function*(){if(!I._deleted)return _&&et(I.tenantId===_.tenantId,I,"tenant-id-mismatch"),v||(yield I.beforeStateQueue.runMiddleware(_)),I.queue((0,m.Z)(function*(){yield I.directlySetCurrentUser(_),I.notifyAuthListeners()}))})()}signOut(){var _=this;return(0,m.Z)(function*(){return yield _.beforeStateQueue.runMiddleware(null),(_.redirectPersistenceManager||_._popupRedirectResolver)&&(yield _._setRedirectUser(null)),_._updateCurrentUser(null,!0)})()}setPersistence(_){var v=this;return this.queue((0,m.Z)(function*(){yield v.assertedPersistence.setPersistence(so(_))}))}initializeRecaptchaConfig(){var _=this;return(0,m.Z)(function*(){const v=yield aa(_,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),I=new bu(v);null==_.tenantId?_._agentRecaptchaConfig=I:_._tenantRecaptchaConfigs[_.tenantId]=I,I.emailPasswordEnabled&&new Ga(_).verify()})()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(_){this._errorFactory=new ee.LL("auth","Firebase",_())}onAuthStateChanged(_,v,I){return this.registerStateListener(this.authStateSubscription,_,v,I)}beforeAuthStateChanged(_,v){return this.beforeStateQueue.pushCallback(_,v)}onIdTokenChanged(_,v,I){return this.registerStateListener(this.idTokenSubscription,_,v,I)}toJSON(){var _;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(_=this._currentUser)||void 0===_?void 0:_.toJSON()}}_setRedirectUser(_,v){var I=this;return(0,m.Z)(function*(){const O=yield I.getOrInitRedirectPersistenceManager(v);return null===_?O.removeCurrentUser():O.setCurrentUser(_)})()}getOrInitRedirectPersistenceManager(_){var v=this;return(0,m.Z)(function*(){if(!v.redirectPersistenceManager){const I=_&&so(_)||v._popupRedirectResolver;et(I,v,"argument-error"),v.redirectPersistenceManager=yield dc.create(v,[so(I._redirectPersistence)],"redirectUser"),v.redirectUser=yield v.redirectPersistenceManager.getCurrentUser()}return v.redirectPersistenceManager})()}_redirectUserForId(_){var v=this;return(0,m.Z)(function*(){var I,O;return v._isInitialized&&(yield v.queue((0,m.Z)(function*(){}))),(null===(I=v._currentUser)||void 0===I?void 0:I._redirectEventId)===_?v._currentUser:(null===(O=v.redirectUser)||void 0===O?void 0:O._redirectEventId)===_?v.redirectUser:null})()}_persistUserIfCurrent(_){var v=this;return(0,m.Z)(function*(){if(_===v.currentUser)return v.queue((0,m.Z)(function*(){return v.directlySetCurrentUser(_)}))})()}_notifyListenersIfCurrent(_){_===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var _,v;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const I=null!==(v=null===(_=this.currentUser)||void 0===_?void 0:_.uid)&&void 0!==v?v:null;this.lastNotifiedUid!==I&&(this.lastNotifiedUid=I,this.authStateSubscription.next(this.currentUser))}registerStateListener(_,v,I,O){if(this._deleted)return()=>{};const U="function"==typeof v?v:v.next.bind(v),Y=this._isInitialized?Promise.resolve():this._initializationPromise;return et(Y,this,"internal-error"),Y.then(()=>U(this.currentUser)),"function"==typeof v?_.addObserver(v,I,O):_.addObserver(v)}directlySetCurrentUser(_){var v=this;return(0,m.Z)(function*(){v.currentUser&&v.currentUser!==_&&v._currentUser._stopProactiveRefresh(),_&&v.isProactiveRefreshEnabled&&_._startProactiveRefresh(),v.currentUser=_,_?yield v.assertedPersistence.setCurrentUser(_):yield v.assertedPersistence.removeCurrentUser()})()}queue(_){return this.operations=this.operations.then(_,_),this.operations}get assertedPersistence(){return et(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(_){!_||this.frameworks.includes(_)||(this.frameworks.push(_),this.frameworks.sort(),this.clientVersion=zf(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var _=this;return(0,m.Z)(function*(){var v;const I={"X-Client-Version":_.clientVersion};_.app.options.appId&&(I["X-Firebase-gmpid"]=_.app.options.appId);const O=yield null===(v=_.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===v?void 0:v.getHeartbeatsHeader();O&&(I["X-Firebase-Client"]=O);const U=yield _._getAppCheckToken();return U&&(I["X-Firebase-AppCheck"]=U),I})()}_getAppCheckToken(){var _=this;return(0,m.Z)(function*(){var v;const I=yield null===(v=_.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===v?void 0:v.getToken();return I?.error&&function Je(M,..._){pe.logLevel<=be.in.WARN&&pe.warn(`Auth (${$.SDK_VERSION}): ${M}`,..._)}(`Error while retrieving App Check token: ${I.error}`),I?.token})()}}function An(M){return(0,ee.m9)(M)}class El{constructor(_){this.auth=_,this.observer=null,this.addObserver=(0,ee.ne)(v=>this.observer=v)}get next(){return et(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Pd(M,_,v){const I=An(M);et(I._canInitEmulator,I,"emulator-config-failed"),et(/^https?:\/\//.test(_),I,"invalid-emulator-scheme");const O=!!v?.disableWarnings,U=Tu(_),{host:Y,port:oe}=function Gi(M){const _=Tu(M),v=/(\/\/)?([^?#/]+)/.exec(M.substr(_.length));if(!v)return{host:"",port:null};const I=v[2].split("@").pop()||"",O=/^(\[[^\]]+\])(:|$)/.exec(I);if(O){const U=O[1];return{host:U,port:si(I.substr(U.length+1))}}{const[U,Y]=I.split(":");return{host:U,port:si(Y)}}}(_);I.config.emulator={url:`${U}//${Y}${null===oe?"":`:${oe}`}/`},I.settings.appVerificationDisabledForTesting=!0,I.emulatorConfig=Object.freeze({host:Y,port:oe,protocol:U.replace(":",""),options:Object.freeze({disableWarnings:O})}),O||function Od(){function M(){const _=document.createElement("p"),v=_.style;_.innerText="Running in emulator mode. Do not use with production credentials.",v.position="fixed",v.width="100%",v.backgroundColor="#ffffff",v.border=".1em solid #000000",v.color="#b50000",v.bottom="0px",v.left="0px",v.margin="0px",v.zIndex="10000",v.textAlign="center",_.classList.add("firebase-emulator-warning"),document.body.appendChild(_)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",M):M())}()}function Tu(M){const _=M.indexOf(":");return _<0?"":M.substr(0,_+1)}function si(M){if(!M)return null;const _=Number(M);return isNaN(_)?null:_}class ws{constructor(_,v){this.providerId=_,this.signInMethod=v}toJSON(){return Jn("not implemented")}_getIdTokenResponse(_){return Jn("not implemented")}_linkToIdToken(_,v){return Jn("not implemented")}_getReauthenticationResolver(_){return Jn("not implemented")}}function Nd(M,_){return(Qe=Qe||(0,m.Z)(function*(v,I){return sr(v,"POST","/v1/accounts:resetPassword",pn(v,I))})).apply(this,arguments)}function Ro(M,_){return(je=je||(0,m.Z)(function*(v,I){return sr(v,"POST","/v1/accounts:update",I)})).apply(this,arguments)}function ja(M,_){return(ct=ct||(0,m.Z)(function*(v,I){return tn(v,"POST","/v1/accounts:signInWithPassword",pn(v,I))})).apply(this,arguments)}function rn(M,_){return(tt=tt||(0,m.Z)(function*(v,I){return sr(v,"POST","/v1/accounts:sendOobCode",pn(v,I))})).apply(this,arguments)}function Fd(M,_){return(Ct=Ct||(0,m.Z)(function*(v,I){return rn(v,I)})).apply(this,arguments)}function _c(M,_){return(dn=dn||(0,m.Z)(function*(v,I){return rn(v,I)})).apply(this,arguments)}class Tl extends ws{constructor(_,v,I,O=null){super("password",I),this._email=_,this._password=v,this._tenantId=O}static _fromEmailAndPassword(_,v){return new Tl(_,v,"password")}static _fromEmailAndCode(_,v,I=null){return new Tl(_,v,"emailLink",I)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(_){const v="string"==typeof _?JSON.parse(_):_;if(v?.email&&v?.password){if("password"===v.signInMethod)return this._fromEmailAndPassword(v.email,v.password);if("emailLink"===v.signInMethod)return this._fromEmailAndCode(v.email,v.password,v.tenantId)}return null}_getIdTokenResponse(_){var v=this;return(0,m.Z)(function*(){var I;switch(v.signInMethod){case"password":const U={returnSecureToken:!0,email:v._email,password:v._password,clientType:"CLIENT_TYPE_WEB"};if(null!==(I=_._getRecaptchaConfig())&&void 0!==I&&I.emailPasswordEnabled){const Y=yield Lr(_,U,"signInWithPassword");return ja(_,Y)}var O;return ja(_,U).catch(function(Y){return(O=O||(0,m.Z)(function*(oe){if("auth/missing-recaptcha-token"===oe.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const ge=yield Lr(_,U,"signInWithPassword");return ja(_,ge)}return Promise.reject(oe)})).apply(this,arguments)});case"emailLink":return function Bd(M,_){return(vn=vn||(0,m.Z)(function*(v,I){return tn(v,"POST","/v1/accounts:signInWithEmailLink",pn(v,I))})).apply(this,arguments)}(_,{email:v._email,oobCode:v._password});default:St(_,"internal-error")}})()}_linkToIdToken(_,v){var I=this;return(0,m.Z)(function*(){switch(I.signInMethod){case"password":return Ro(_,{idToken:v,returnSecureToken:!0,email:I._email,password:I._password});case"emailLink":return function wu(M,_){return(Rt=Rt||(0,m.Z)(function*(v,I){return tn(v,"POST","/v1/accounts:signInWithEmailLink",pn(v,I))})).apply(this,arguments)}(_,{idToken:v,email:I._email,oobCode:I._password});default:St(_,"internal-error")}})()}_getReauthenticationResolver(_){return this._getIdTokenResponse(_)}}function js(M,_){return(eo=eo||(0,m.Z)(function*(v,I){return tn(v,"POST","/v1/accounts:signInWithIdp",pn(v,I))})).apply(this,arguments)}class mn extends ws{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(_){const v=new mn(_.providerId,_.signInMethod);return _.idToken||_.accessToken?(_.idToken&&(v.idToken=_.idToken),_.accessToken&&(v.accessToken=_.accessToken),_.nonce&&!_.pendingToken&&(v.nonce=_.nonce),_.pendingToken&&(v.pendingToken=_.pendingToken)):_.oauthToken&&_.oauthTokenSecret?(v.accessToken=_.oauthToken,v.secret=_.oauthTokenSecret):St("argument-error"),v}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(_){const v="string"==typeof _?JSON.parse(_):_,{providerId:I,signInMethod:O}=v,U=(0,fe._T)(v,["providerId","signInMethod"]);if(!I||!O)return null;const Y=new mn(I,O);return Y.idToken=U.idToken||void 0,Y.accessToken=U.accessToken||void 0,Y.secret=U.secret,Y.nonce=U.nonce,Y.pendingToken=U.pendingToken||null,Y}_getIdTokenResponse(_){return js(_,this.buildRequest())}_linkToIdToken(_,v){const I=this.buildRequest();return I.idToken=v,js(_,I)}_getReauthenticationResolver(_){const v=this.buildRequest();return v.autoCreate=!1,js(_,v)}buildRequest(){const _={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)_.pendingToken=this.pendingToken;else{const v={};this.idToken&&(v.id_token=this.idToken),this.accessToken&&(v.access_token=this.accessToken),this.secret&&(v.oauth_token_secret=this.secret),v.providerId=this.providerId,this.nonce&&!this.pendingToken&&(v.nonce=this.nonce),_.postBody=(0,ee.xO)(v)}return _}}const Gd={USER_NOT_FOUND:"user-not-found"};class ai extends ws{constructor(_){super("phone","phone"),this.params=_}static _fromVerification(_,v){return new ai({verificationId:_,verificationCode:v})}static _fromTokenResponse(_,v){return new ai({phoneNumber:_,temporaryProof:v})}_getIdTokenResponse(_){return function $d(M,_){return(Ji=Ji||(0,m.Z)(function*(v,I){return tn(v,"POST","/v1/accounts:signInWithPhoneNumber",pn(v,I))})).apply(this,arguments)}(_,this._makeVerificationRequest())}_linkToIdToken(_,v){return function oi(M,_){return(Vs=Vs||(0,m.Z)(function*(v,I){const O=yield tn(v,"POST","/v1/accounts:signInWithPhoneNumber",pn(v,I));if(O.temporaryProof)throw Ao(v,"account-exists-with-different-credential",O);return O})).apply(this,arguments)}(_,Object.assign({idToken:v},this._makeVerificationRequest()))}_getReauthenticationResolver(_){return function Il(M,_){return(ve=ve||(0,m.Z)(function*(v,I){return tn(v,"POST","/v1/accounts:signInWithPhoneNumber",pn(v,Object.assign(Object.assign({},I),{operation:"REAUTH"})),Gd)})).apply(this,arguments)}(_,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:_,phoneNumber:v,verificationId:I,verificationCode:O}=this.params;return _&&v?{temporaryProof:_,phoneNumber:v}:{sessionInfo:I,code:O}}toJSON(){const _={providerId:this.providerId};return this.params.phoneNumber&&(_.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(_.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(_.verificationCode=this.params.verificationCode),this.params.verificationId&&(_.verificationId=this.params.verificationId),_}static fromJSON(_){"string"==typeof _&&(_=JSON.parse(_));const{verificationId:v,verificationCode:I,phoneNumber:O,temporaryProof:U}=_;return I||v||O||U?new ai({verificationId:v,verificationCode:I,phoneNumber:O,temporaryProof:U}):null}}class wl{constructor(_){var v,I,O,U,Y,oe;const ge=(0,ee.zd)((0,ee.pd)(_)),Be=null!==(v=ge.apiKey)&&void 0!==v?v:null,jt=null!==(I=ge.oobCode)&&void 0!==I?I:null,Mt=function Su(M){switch(M){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(O=ge.mode)&&void 0!==O?O:null);et(Be&&jt&&Mt,"argument-error"),this.apiKey=Be,this.operation=Mt,this.code=jt,this.continueUrl=null!==(U=ge.continueUrl)&&void 0!==U?U:null,this.languageCode=null!==(Y=ge.languageCode)&&void 0!==Y?Y:null,this.tenantId=null!==(oe=ge.tenantId)&&void 0!==oe?oe:null}static parseLink(_){const v=function Du(M){const _=(0,ee.zd)((0,ee.pd)(M)).link,v=_?(0,ee.zd)((0,ee.pd)(_)).deep_link_id:null,I=(0,ee.zd)((0,ee.pd)(M)).deep_link_id;return(I?(0,ee.zd)((0,ee.pd)(I)).link:null)||I||v||_||M}(_);try{return new wl(v)}catch{return null}}}let Sl=(()=>{class M{constructor(){this.providerId=M.PROVIDER_ID}static credential(v,I){return Tl._fromEmailAndPassword(v,I)}static credentialWithLink(v,I){const O=wl.parseLink(I);return et(O,"argument-error"),Tl._fromEmailAndCode(v,O.code,O.tenantId)}}return M.PROVIDER_ID="password",M.EMAIL_PASSWORD_SIGN_IN_METHOD="password",M.EMAIL_LINK_SIGN_IN_METHOD="emailLink",M})();class fr{constructor(_){this.providerId=_,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(_){this.defaultLanguageCode=_}setCustomParameters(_){return this.customParameters=_,this}getCustomParameters(){return this.customParameters}}class _i extends fr{constructor(){super(...arguments),this.scopes=[]}addScope(_){return this.scopes.includes(_)||this.scopes.push(_),this}getScopes(){return[...this.scopes]}}class Ss extends _i{static credentialFromJSON(_){const v="string"==typeof _?JSON.parse(_):_;return et("providerId"in v&&"signInMethod"in v,"argument-error"),mn._fromParams(v)}credential(_){return this._credential(Object.assign(Object.assign({},_),{nonce:_.rawNonce}))}_credential(_){return et(_.idToken||_.accessToken,"argument-error"),mn._fromParams(Object.assign(Object.assign({},_),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(_){return Ss.oauthCredentialFromTaggedObject(_)}static credentialFromError(_){return Ss.oauthCredentialFromTaggedObject(_.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:_}){if(!_)return null;const{oauthIdToken:v,oauthAccessToken:I,oauthTokenSecret:O,pendingToken:U,nonce:Y,providerId:oe}=_;if(!I&&!O&&!v&&!U||!oe)return null;try{return new Ss(oe)._credential({idToken:v,accessToken:I,nonce:Y,pendingToken:U})}catch{return null}}}let Dl=(()=>{class M extends _i{constructor(){super("facebook.com")}static credential(v){return mn._fromParams({providerId:M.PROVIDER_ID,signInMethod:M.FACEBOOK_SIGN_IN_METHOD,accessToken:v})}static credentialFromResult(v){return M.credentialFromTaggedObject(v)}static credentialFromError(v){return M.credentialFromTaggedObject(v.customData||{})}static credentialFromTaggedObject({_tokenResponse:v}){if(!v||!("oauthAccessToken"in v)||!v.oauthAccessToken)return null;try{return M.credential(v.oauthAccessToken)}catch{return null}}}return M.FACEBOOK_SIGN_IN_METHOD="facebook.com",M.PROVIDER_ID="facebook.com",M})(),oo=(()=>{class M extends _i{constructor(){super("google.com"),this.addScope("profile")}static credential(v,I){return mn._fromParams({providerId:M.PROVIDER_ID,signInMethod:M.GOOGLE_SIGN_IN_METHOD,idToken:v,accessToken:I})}static credentialFromResult(v){return M.credentialFromTaggedObject(v)}static credentialFromError(v){return M.credentialFromTaggedObject(v.customData||{})}static credentialFromTaggedObject({_tokenResponse:v}){if(!v)return null;const{oauthIdToken:I,oauthAccessToken:O}=v;if(!I&&!O)return null;try{return M.credential(I,O)}catch{return null}}}return M.GOOGLE_SIGN_IN_METHOD="google.com",M.PROVIDER_ID="google.com",M})(),Hd=(()=>{class M extends _i{constructor(){super("github.com")}static credential(v){return mn._fromParams({providerId:M.PROVIDER_ID,signInMethod:M.GITHUB_SIGN_IN_METHOD,accessToken:v})}static credentialFromResult(v){return M.credentialFromTaggedObject(v)}static credentialFromError(v){return M.credentialFromTaggedObject(v.customData||{})}static credentialFromTaggedObject({_tokenResponse:v}){if(!v||!("oauthAccessToken"in v)||!v.oauthAccessToken)return null;try{return M.credential(v.oauthAccessToken)}catch{return null}}}return M.GITHUB_SIGN_IN_METHOD="github.com",M.PROVIDER_ID="github.com",M})();class Al extends ws{constructor(_,v){super(_,_),this.pendingToken=v}_getIdTokenResponse(_){return js(_,this.buildRequest())}_linkToIdToken(_,v){const I=this.buildRequest();return I.idToken=v,js(_,I)}_getReauthenticationResolver(_){const v=this.buildRequest();return v.autoCreate=!1,js(_,v)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(_){const v="string"==typeof _?JSON.parse(_):_,{providerId:I,signInMethod:O,pendingToken:U}=v;return I&&O&&U&&I===O?new Al(I,U):null}static _create(_,v){return new Al(_,v)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Ds extends fr{constructor(_){et(_.startsWith("saml."),"argument-error"),super(_)}static credentialFromResult(_){return Ds.samlCredentialFromTaggedObject(_)}static credentialFromError(_){return Ds.samlCredentialFromTaggedObject(_.customData||{})}static credentialFromJSON(_){const v=Al.fromJSON(_);return et(v,"argument-error"),v}static samlCredentialFromTaggedObject({_tokenResponse:_}){if(!_)return null;const{pendingToken:v,providerId:I}=_;if(!v||!I)return null;try{return Al._create(I,v)}catch{return null}}}let ss=(()=>{class M extends _i{constructor(){super("twitter.com")}static credential(v,I){return mn._fromParams({providerId:M.PROVIDER_ID,signInMethod:M.TWITTER_SIGN_IN_METHOD,oauthToken:v,oauthTokenSecret:I})}static credentialFromResult(v){return M.credentialFromTaggedObject(v)}static credentialFromError(v){return M.credentialFromTaggedObject(v.customData||{})}static credentialFromTaggedObject({_tokenResponse:v}){if(!v)return null;const{oauthAccessToken:I,oauthTokenSecret:O}=v;if(!I||!O)return null;try{return M.credential(I,O)}catch{return null}}}return M.TWITTER_SIGN_IN_METHOD="twitter.com",M.PROVIDER_ID="twitter.com",M})();function vc(M,_){return(we=we||(0,m.Z)(function*(v,I){return tn(v,"POST","/v1/accounts:signUp",pn(v,I))})).apply(this,arguments)}class Di{constructor(_){this.user=_.user,this.providerId=_.providerId,this._tokenResponse=_._tokenResponse,this.operationType=_.operationType}static _fromIdTokenResponse(_,v,I,O=!1){return(0,m.Z)(function*(){const U=yield Hs._fromIdTokenResponse(_,I,O),Y=Xf(I);return new Di({user:U,providerId:Y,_tokenResponse:I,operationType:v})})()}static _forOperation(_,v,I){return(0,m.Z)(function*(){yield _._updateTokensIfNecessary(I,!0);const O=Xf(I);return new Di({user:_,providerId:O,_tokenResponse:I,operationType:v})})()}}function Xf(M){return M.providerId?M.providerId:"phoneNumber"in M?"phone":null}function jd(M){return(De=De||(0,m.Z)(function*(_){var v;const I=An(_);if(yield I._initializationPromise,null!==(v=I.currentUser)&&void 0!==v&&v.isAnonymous)return new Di({user:I.currentUser,providerId:null,operationType:"signIn"});const O=yield vc(I,{returnSecureToken:!0}),U=yield Di._fromIdTokenResponse(I,"signIn",O,!0);return yield I._updateCurrentUser(U.user),U})).apply(this,arguments)}class xl extends ee.ZR{constructor(_,v,I,O){var U;super(v.code,v.message),this.operationType=I,this.user=O,Object.setPrototypeOf(this,xl.prototype),this.customData={appName:_.name,tenantId:null!==(U=_.tenantId)&&void 0!==U?U:void 0,_serverResponse:v.customData._serverResponse,operationType:I}}static _fromErrorAndOperation(_,v,I,O){return new xl(_,v,I,O)}}function zd(M,_,v,I){return("reauthenticate"===_?v._getReauthenticationResolver(M):v._getIdTokenResponse(M)).catch(U=>{throw"auth/multi-factor-auth-required"===U.code?xl._fromErrorAndOperation(M,U,_,I):U})}function Wd(M){return new Set(M.map(({providerId:_})=>_).filter(_=>!!_))}function Jf(M,_){return(ye=ye||(0,m.Z)(function*(v,I){const O=(0,ee.m9)(v);yield la(!0,O,I);const{providerUserInfo:U}=yield function ii(M,_){return(te=te||(0,m.Z)(function*(v,I){return sr(v,"POST","/v1/accounts:update",I)})).apply(this,arguments)}(O.auth,{idToken:yield O.getIdToken(),deleteProvider:[I]}),Y=Wd(U||[]);return O.providerData=O.providerData.filter(oe=>Y.has(oe.providerId)),Y.has("phone")||(O.phoneNumber=null),yield O.auth._persistUserIfCurrent(O),O})).apply(this,arguments)}function ao(M,_){return(st=st||(0,m.Z)(function*(v,I,O=!1){const U=yield Ts(v,I._linkToIdToken(v.auth,yield v.getIdToken()),O);return Di._forOperation(v,"link",U)})).apply(this,arguments)}function la(M,_,v){return(Xe=Xe||(0,m.Z)(function*(I,O,U){yield $s(O);const oe=!1===I?"provider-already-linked":"no-such-provider";et(Wd(O.providerData).has(U)===I,O.auth,oe)})).apply(this,arguments)}function bc(M,_){return(zt=zt||(0,m.Z)(function*(v,I,O=!1){const{auth:U}=v,Y="reauthenticate";try{const oe=yield Ts(v,zd(U,Y,I,v),O);et(oe.idToken,U,"internal-error");const ge=er(oe.idToken);et(ge,U,"internal-error");const{sub:Be}=ge;return et(v.uid===Be,U,"user-mismatch"),Di._forOperation(v,Y,oe)}catch(oe){throw"auth/user-not-found"===oe?.code&&St(U,"user-mismatch"),oe}})).apply(this,arguments)}function Kd(M,_){return(xt=xt||(0,m.Z)(function*(v,I,O=!1){const U="signIn",Y=yield zd(v,U,I),oe=yield Di._fromIdTokenResponse(v,U,Y);return O||(yield v._updateCurrentUser(oe.user)),oe})).apply(this,arguments)}function Sr(M,_){return(cr=cr||(0,m.Z)(function*(v,I){return Kd(An(v),I)})).apply(this,arguments)}function Mo(M,_){return($t=$t||(0,m.Z)(function*(v,I){const O=(0,ee.m9)(v);return yield la(!1,O,I.providerId),ao(O,I)})).apply(this,arguments)}function or(M,_){return(Dn=Dn||(0,m.Z)(function*(v,I){return bc((0,ee.m9)(v),I)})).apply(this,arguments)}function vi(M,_){return(jn=jn||(0,m.Z)(function*(v,I){const O=An(v),U=yield function ng(M,_){return(ir=ir||(0,m.Z)(function*(v,I){return tn(v,"POST","/v1/accounts:signInWithCustomToken",pn(v,I))})).apply(this,arguments)}(O,{token:I,returnSecureToken:!0}),Y=yield Di._fromIdTokenResponse(O,"signIn",U);return yield O._updateCurrentUser(Y.user),Y})).apply(this,arguments)}class Ec{constructor(_,v){this.factorId=_,this.uid=v.mfaEnrollmentId,this.enrollmentTime=new Date(v.enrolledAt).toUTCString(),this.displayName=v.displayName}static _fromServerResponse(_,v){return"phoneInfo"in v?qd._fromServerResponse(_,v):"totpInfo"in v?xu._fromServerResponse(_,v):St(_,"internal-error")}}class qd extends Ec{constructor(_){super("phone",_),this.phoneNumber=_.phoneInfo}static _fromServerResponse(_,v){return new qd(v)}}class xu extends Ec{constructor(_){super("totp",_)}static _fromServerResponse(_,v){return new xu(v)}}function ca(M,_,v){var I;et((null===(I=v.url)||void 0===I?void 0:I.length)>0,M,"invalid-continue-uri"),et(typeof v.dynamicLinkDomain>"u"||v.dynamicLinkDomain.length>0,M,"invalid-dynamic-link-domain"),_.continueUrl=v.url,_.dynamicLinkDomain=v.dynamicLinkDomain,_.canHandleCodeInApp=v.handleCodeInApp,v.iOS&&(et(v.iOS.bundleId.length>0,M,"missing-ios-bundle-id"),_.iOSBundleId=v.iOS.bundleId),v.android&&(et(v.android.packageName.length>0,M,"missing-android-pkg-name"),_.androidInstallApp=v.android.installApp,_.androidMinimumVersionCode=v.android.minimumVersion,_.androidPackageName=v.android.packageName)}function Cl(M,_,v){return(Rr=Rr||(0,m.Z)(function*(I,O,U){var Y;const oe=An(I),ge={requestType:"PASSWORD_RESET",email:O,clientType:"CLIENT_TYPE_WEB"};if(null!==(Y=oe._getRecaptchaConfig())&&void 0!==Y&&Y.emailPasswordEnabled){const jt=yield Lr(oe,ge,"getOobCode",!0);U&&ca(oe,jt,U),yield Fd(oe,jt)}else{var Be;U&&ca(oe,ge,U),yield Fd(oe,ge).catch(function(jt){return(Be=Be||(0,m.Z)(function*(Mt){if("auth/missing-recaptcha-token"!==Mt.code)return Promise.reject(Mt);{console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const qt=yield Lr(oe,ge,"getOobCode",!0);U&&ca(oe,qt,U),yield Fd(oe,qt)}})).apply(this,arguments)})}})).apply(this,arguments)}function Tc(M,_,v){return(Mr=Mr||(0,m.Z)(function*(I,O,U){yield Nd((0,ee.m9)(I),{oobCode:O,newPassword:U})})).apply(this,arguments)}function Cu(M,_){return(yr=yr||(0,m.Z)(function*(v,I){yield function yc(M,_){return(ze=ze||(0,m.Z)(function*(v,I){return sr(v,"POST","/v1/accounts:update",pn(v,I))})).apply(this,arguments)}((0,ee.m9)(v),{oobCode:I})})).apply(this,arguments)}function Ic(M,_){return(kr=kr||(0,m.Z)(function*(v,I){const O=(0,ee.m9)(v),U=yield Nd(O,{oobCode:I}),Y=U.requestType;switch(et(Y,O,"internal-error"),Y){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":et(U.newEmail,O,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":et(U.mfaInfo,O,"internal-error");default:et(U.email,O,"internal-error")}let oe=null;return U.mfaInfo&&(oe=Ec._fromServerResponse(An(O),U.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===U.requestType?U.newEmail:U.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===U.requestType?U.email:U.newEmail)||null,multiFactorInfo:oe},operation:Y}})).apply(this,arguments)}function Rl(M,_){return(ti=ti||(0,m.Z)(function*(v,I){const{data:O}=yield Ic((0,ee.m9)(v),I);return O.email})).apply(this,arguments)}function Ml(M,_,v){return(vr=vr||(0,m.Z)(function*(I,O,U){var Y;const oe=An(I),ge={returnSecureToken:!0,email:O,password:U,clientType:"CLIENT_TYPE_WEB"};let Be;if(null!==(Y=oe._getRecaptchaConfig())&&void 0!==Y&&Y.emailPasswordEnabled){const Un=yield Lr(oe,ge,"signUpPassword");Be=vc(oe,Un)}else{var jt;Be=vc(oe,ge).catch(function(Un){return(jt=jt||(0,m.Z)(function*(ci){if("auth/missing-recaptcha-token"===ci.code){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const Cs=yield Lr(oe,ge,"signUpPassword");return vc(oe,Cs)}return Promise.reject(ci)})).apply(this,arguments)})}const Mt=yield Be.catch(Un=>Promise.reject(Un)),qt=yield Di._fromIdTokenResponse(oe,"signIn",Mt);return yield oe._updateCurrentUser(qt.user),qt})).apply(this,arguments)}function ua(M,_,v){return Sr((0,ee.m9)(M),Sl.credential(_,v))}function ko(M,_,v){return(Ft=Ft||(0,m.Z)(function*(I,O,U){var Y;const oe=An(I),ge={requestType:"EMAIL_SIGNIN",email:O,clientType:"CLIENT_TYPE_WEB"};function Be(Mt,qt){et(qt.handleCodeInApp,oe,"argument-error"),qt&&ca(oe,Mt,qt)}if(null!==(Y=oe._getRecaptchaConfig())&&void 0!==Y&&Y.emailPasswordEnabled){const Mt=yield Lr(oe,ge,"getOobCode",!0);Be(Mt,U),yield _c(oe,Mt)}else{var jt;Be(ge,U),yield _c(oe,ge).catch(function(Mt){return(jt=jt||(0,m.Z)(function*(qt){if("auth/missing-recaptcha-token"!==qt.code)return Promise.reject(qt);{console.log("Email link sign-in is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const Un=yield Lr(oe,ge,"getOobCode",!0);Be(Un,U),yield _c(oe,Un)}})).apply(this,arguments)})}})).apply(this,arguments)}function ep(M,_){return"EMAIL_SIGNIN"===wl.parseLink(_)?.operation}function Yd(M,_,v){return(_s=_s||(0,m.Z)(function*(I,O,U){const Y=(0,ee.m9)(I),oe=Sl.credentialWithLink(O,U||no());return et(oe._tenantId===(Y.tenantId||null),Y,"tenant-id-mismatch"),Sr(Y,oe)})).apply(this,arguments)}function rg(M,_){return(Fn=Fn||(0,m.Z)(function*(v,I){const U={identifier:I,continueUri:Ua()?no():"http://localhost"},{signinMethods:Y}=yield function Ru(M,_){return(na=na||(0,m.Z)(function*(v,I){return sr(v,"POST","/v1/accounts:createAuthUri",pn(v,I))})).apply(this,arguments)}((0,ee.m9)(v),U);return Y||[]})).apply(this,arguments)}function tp(M,_){return(Vi=Vi||(0,m.Z)(function*(v,I){const O=(0,ee.m9)(v),Y={requestType:"VERIFY_EMAIL",idToken:yield v.getIdToken()};I&&ca(O.auth,Y,I);const{email:oe}=yield function Iu(M,_){return(Tt=Tt||(0,m.Z)(function*(v,I){return rn(v,I)})).apply(this,arguments)}(O.auth,Y);oe!==v.email&&(yield v.reload())})).apply(this,arguments)}function np(M,_,v){return(wr=wr||(0,m.Z)(function*(I,O,U){const Y=(0,ee.m9)(I),ge={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield I.getIdToken(),newEmail:O};U&&ca(Y.auth,ge,U);const{email:Be}=yield function Ud(M,_){return(It=It||(0,m.Z)(function*(v,I){return rn(v,I)})).apply(this,arguments)}(Y.auth,ge);Be!==I.email&&(yield I.reload())})).apply(this,arguments)}function Mu(M,_){return(Pn=Pn||(0,m.Z)(function*(v,{displayName:I,photoURL:O}){if(void 0===I&&void 0===O)return;const U=(0,ee.m9)(v),oe={idToken:yield U.getIdToken(),displayName:I,photoUrl:O,returnSecureToken:!0},ge=yield Ts(U,function wc(M,_){return(tr=tr||(0,m.Z)(function*(v,I){return sr(v,"POST","/v1/accounts:update",I)})).apply(this,arguments)}(U.auth,oe));U.displayName=ge.displayName||null,U.photoURL=ge.photoUrl||null;const Be=U.providerData.find(({providerId:jt})=>"password"===jt);Be&&(Be.displayName=U.displayName,Be.photoURL=U.photoURL),yield U._updateTokensIfNecessary(ge)})).apply(this,arguments)}function za(M,_){return Lo((0,ee.m9)(M),_,null)}function ku(M,_){return Lo((0,ee.m9)(M),null,_)}function Lo(M,_,v){return(Wt=Wt||(0,m.Z)(function*(I,O,U){const{auth:Y}=I,ge={idToken:yield I.getIdToken(),returnSecureToken:!0};O&&(ge.email=O),U&&(ge.password=U);const Be=yield Ts(I,Ro(Y,ge));yield I._updateTokensIfNecessary(Be,!0)})).apply(this,arguments)}class lo{constructor(_,v,I={}){this.isNewUser=_,this.providerId=v,this.profile=I}}class kl extends lo{constructor(_,v,I,O){super(_,v,I),this.username=O}}class Ll extends lo{constructor(_,v){super(_,"facebook.com",v)}}class rp extends kl{constructor(_,v){super(_,"github.com",v,"string"==typeof v?.login?v?.login:null)}}class Sc extends lo{constructor(_,v){super(_,"google.com",v)}}class Dc extends kl{constructor(_,v,I){super(_,"twitter.com",v,I)}}function Wa(M){const{user:_,_tokenResponse:v}=M;return _.isAnonymous&&!v?{providerId:null,isNewUser:!1,profile:null}:function da(M){var _,v;if(!M)return null;const{providerId:I}=M,O=M.rawUserInfo?JSON.parse(M.rawUserInfo):{},U=M.isNewUser||"identitytoolkit#SignupNewUserResponse"===M.kind;if(!I&&M?.idToken){const Y=null===(v=null===(_=er(M.idToken))||void 0===_?void 0:_.firebase)||void 0===v?void 0:v.sign_in_provider;if(Y)return new lo(U,"anonymous"!==Y&&"custom"!==Y?Y:null)}if(!I)return null;switch(I){case"facebook.com":return new Ll(U,O);case"github.com":return new rp(U,O);case"google.com":return new Sc(U,O);case"twitter.com":return new Dc(U,O,M.screenName||null);case"custom":case"anonymous":return new lo(U,null);default:return new lo(U,I,O)}}(v)}class Po{constructor(_,v,I){this.type=_,this.credential=v,this.auth=I}static _fromIdtoken(_,v){return new Po("enroll",_,v)}static _fromMfaPendingCredential(_){return new Po("signin",_)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(_){var v,I;if(_?.multiFactorSession){if(null!==(v=_.multiFactorSession)&&void 0!==v&&v.pendingCredential)return Po._fromMfaPendingCredential(_.multiFactorSession.pendingCredential);if(null!==(I=_.multiFactorSession)&&void 0!==I&&I.idToken)return Po._fromIdtoken(_.multiFactorSession.idToken)}return null}}class Oo{constructor(_,v,I){this.session=_,this.hints=v,this.signInResolver=I}static _fromError(_,v){var I;const O=An(_),U=v.customData._serverResponse,Y=(U.mfaInfo||[]).map(ge=>Ec._fromServerResponse(O,ge));et(U.mfaPendingCredential,O,"internal-error");const oe=Po._fromMfaPendingCredential(U.mfaPendingCredential);return new Oo(oe,Y,function(ge){return(I=I||(0,m.Z)(function*(Be){const jt=yield Be._process(O,oe);delete U.mfaInfo,delete U.mfaPendingCredential;const Mt=Object.assign(Object.assign({},U),{idToken:jt.idToken,refreshToken:jt.refreshToken});switch(v.operationType){case"signIn":const qt=yield Di._fromIdTokenResponse(O,v.operationType,Mt);return yield O._updateCurrentUser(qt.user),qt;case"reauthenticate":return et(v.user,O,"internal-error"),Di._forOperation(v.user,v.operationType,Mt);default:St(O,"internal-error")}})).apply(this,arguments)})}resolveSignIn(_){var v=this;return(0,m.Z)(function*(){return v.signInResolver(_)})()}}function Ou(M,_){var v;const I=(0,ee.m9)(M),O=_;return et(_.customData.operationType,I,"argument-error"),et(null===(v=O.customData._serverResponse)||void 0===v?void 0:v.mfaPendingCredential,I,"argument-error"),Oo._fromError(I,O)}class co{constructor(_){this.user=_,this.enrolledFactors=[],_._onReload(v=>{v.mfaInfo&&(this.enrolledFactors=v.mfaInfo.map(I=>Ec._fromServerResponse(_.auth,I)))})}static _fromUser(_){return new co(_)}getSession(){var _=this;return(0,m.Z)(function*(){return Po._fromIdtoken(yield _.user.getIdToken(),_.user.auth)})()}enroll(_,v){var I=this;return(0,m.Z)(function*(){const O=_,U=yield I.getSession(),Y=yield Ts(I.user,O._process(I.user.auth,U,v));return yield I.user._updateTokensIfNecessary(Y),I.user.reload()})()}unenroll(_){var v=this;return(0,m.Z)(function*(){const I="string"==typeof _?_:_.uid,O=yield v.user.getIdToken();try{const U=yield Ts(v.user,function eh(M,_){return sr(M,"POST","/v2/accounts/mfaEnrollment:withdraw",pn(M,_))}(v.user.auth,{idToken:O,mfaEnrollmentId:I}));v.enrolledFactors=v.enrolledFactors.filter(({uid:Y})=>Y!==I),yield v.user._updateTokensIfNecessary(U),yield v.user.reload()}catch(U){throw U}})()}}const uo=new WeakMap;function op(M){const _=(0,ee.m9)(M);return uo.has(_)||uo.set(_,co._fromUser(_)),uo.get(_)}const ha="__sak";class Uu{constructor(_,v){this.storageRetriever=_,this.type=v}_isAvailable(){try{return this.storage?(this.storage.setItem(ha,"1"),this.storage.removeItem(ha),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(_,v){return this.storage.setItem(_,JSON.stringify(v)),Promise.resolve()}_get(_){const v=this.storage.getItem(_);return Promise.resolve(v?JSON.parse(v):null)}_remove(_){return this.storage.removeItem(_),Promise.resolve()}get storage(){return this.storageRetriever()}}const nh=(()=>{class M extends Uu{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(v,I)=>this.onStorageEvent(v,I),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function fa(){const M=(0,ee.z$)();return kd(M)||_u(M)}()&&function tg(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=vu(),this._shouldAllowMigration=!0}forAllChangedKeys(v){for(const I of Object.keys(this.listeners)){const O=this.storage.getItem(I),U=this.localCache[I];O!==U&&v(I,U,O)}}onStorageEvent(v,I=!1){if(!v.key)return void this.forAllChangedKeys((oe,ge,Be)=>{this.notifyListeners(oe,Be)});const O=v.key;if(I?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const oe=this.storage.getItem(O);if(v.newValue!==oe)null!==v.newValue?this.storage.setItem(O,v.newValue):this.storage.removeItem(O);else if(this.localCache[O]===v.newValue&&!I)return}const U=()=>{const oe=this.storage.getItem(O);!I&&this.localCache[O]===oe||this.notifyListeners(O,oe)},Y=this.storage.getItem(O);!function Co(){return(0,ee.w1)()&&10===document.documentMode}()||Y===v.newValue||v.newValue===v.oldValue?U():setTimeout(U,10)}notifyListeners(v,I){this.localCache[v]=I;const O=this.listeners[v];if(O)for(const U of Array.from(O))U(I&&JSON.parse(I))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((v,I,O)=>{this.onStorageEvent(new StorageEvent("storage",{key:v,oldValue:I,newValue:O}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(v,I){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[v]||(this.listeners[v]=new Set,this.localCache[v]=this.storage.getItem(v)),this.listeners[v].add(I)}_removeListener(v,I){this.listeners[v]&&(this.listeners[v].delete(I),0===this.listeners[v].size&&delete this.listeners[v]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(v,I){var O=()=>super._set,U=this;return(0,m.Z)(function*(){yield O().call(U,v,I),U.localCache[v]=JSON.stringify(I)})()}_get(v){var I=()=>super._get,O=this;return(0,m.Z)(function*(){const U=yield I().call(O,v);return O.localCache[v]=JSON.stringify(U),U})()}_remove(v){var I=()=>super._remove,O=this;return(0,m.Z)(function*(){yield I().call(O,v),delete O.localCache[v]})()}}return M.type="LOCAL",M})(),qa=(()=>{class M extends Uu{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(v,I){}_removeListener(v,I){}}return M.type="SESSION",M})();let ho=(()=>{class M{constructor(v){this.eventTarget=v,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(v){const I=this.receivers.find(U=>U.isListeningto(v));if(I)return I;const O=new M(v);return this.receivers.push(O),O}isListeningto(v){return this.eventTarget===v}handleEvent(v){var I=this;return(0,m.Z)(function*(){var O;const U=v,{eventId:Y,eventType:oe,data:ge}=U.data,Be=I.handlersMap[oe];if(!Be?.size)return;U.ports[0].postMessage({status:"ack",eventId:Y,eventType:oe});const jt=Array.from(Be).map(function(qt){return(O=O||(0,m.Z)(function*(Un){return Un(U.origin,ge)})).apply(this,arguments)}),Mt=yield function pa(M){var _;return Promise.all(M.map(function(v){return(_=_||(0,m.Z)(function*(I){try{return{fulfilled:!0,value:yield I}}catch(O){return{fulfilled:!1,reason:O}}})).apply(this,arguments)}))}(jt);U.ports[0].postMessage({status:"done",eventId:Y,eventType:oe,response:Mt})})()}_subscribe(v,I){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[v]||(this.handlersMap[v]=new Set),this.handlersMap[v].add(I)}_unsubscribe(v,I){this.handlersMap[v]&&I&&this.handlersMap[v].delete(I),(!I||0===this.handlersMap[v].size)&&delete this.handlersMap[v],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return M.receivers=[],M})();function rr(M="",_=10){let v="";for(let I=0;I<_;I++)v+=Math.floor(10*Math.random());return M+v}class ih{constructor(_){this.target=_,this.handlers=new Set}removeMessageHandler(_){_.messageChannel&&(_.messageChannel.port1.removeEventListener("message",_.onMessage),_.messageChannel.port1.close()),this.handlers.delete(_)}_send(_,v,I=50){var O=this;return(0,m.Z)(function*(){const U=typeof MessageChannel<"u"?new MessageChannel:null;if(!U)throw new Error("connection_unavailable");let Y,oe;return new Promise((ge,Be)=>{const jt=rr("",20);U.port1.start();const Mt=setTimeout(()=>{Be(new Error("unsupported_event"))},I);oe={messageChannel:U,onMessage(qt){const Un=qt;if(Un.data.eventId===jt)switch(Un.data.status){case"ack":clearTimeout(Mt),Y=setTimeout(()=>{Be(new Error("timeout"))},3e3);break;case"done":clearTimeout(Y),ge(Un.data.response);break;default:clearTimeout(Mt),clearTimeout(Y),Be(new Error("invalid_response"))}}},O.handlers.add(oe),U.port1.addEventListener("message",oe.onMessage),O.target.postMessage({eventType:_,eventId:jt,data:v},[U.port2])}).finally(()=>{oe&&O.removeMessageHandler(oe)})})()}}function Cn(){return window}function xc(){return typeof Cn().WorkerGlobalScope<"u"&&"function"==typeof Cn().importScripts}const ap="firebaseLocalStorageDb",oh=1,Cc="firebaseLocalStorage",sg="fbase_key";class Vu{constructor(_){this.request=_}toPromise(){return new Promise((_,v)=>{this.request.addEventListener("success",()=>{_(this.request.result)}),this.request.addEventListener("error",()=>{v(this.request.error)})})}}function ah(M,_){return M.transaction([Cc],_?"readwrite":"readonly").objectStore(Cc)}function lp(){const M=indexedDB.open(ap,oh);return new Promise((_,v)=>{M.addEventListener("error",()=>{v(M.error)}),M.addEventListener("upgradeneeded",()=>{const I=M.result;try{I.createObjectStore(Cc,{keyPath:sg})}catch(O){v(O)}}),M.addEventListener("success",(0,m.Z)(function*(){const I=M.result;I.objectStoreNames.contains(Cc)?_(I):(I.close(),yield function Pl(){const M=indexedDB.deleteDatabase(ap);return new Vu(M).toPromise()}(),_(yield lp()))}))})}function cp(M,_,v){return(ur=ur||(0,m.Z)(function*(I,O,U){const Y=ah(I,!0).put({[sg]:O,value:U});return new Vu(Y).toPromise()})).apply(this,arguments)}function $u(M,_){const v=ah(M,!0).delete(_);return new Vu(v).toPromise()}const ma=(()=>{class M{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var v=this;return(0,m.Z)(function*(){return v.db||(v.db=yield lp()),v.db})()}_withRetries(v){var I=this;return(0,m.Z)(function*(){let O=0;for(;;)try{const U=yield I._openDb();return yield v(U)}catch(U){if(O++>3)throw U;I.db&&(I.db.close(),I.db=void 0)}})()}initializeServiceWorkerMessaging(){var v=this;return(0,m.Z)(function*(){return xc()?v.initializeReceiver():v.initializeSender()})()}initializeReceiver(){var v=this;return(0,m.Z)(function*(){var I,O;v.receiver=ho._getInstance(function ig(){return xc()?self:null}()),v.receiver._subscribe("keyChanged",function(U,Y){return(I=I||(0,m.Z)(function*(oe,ge){return{keyProcessed:(yield v._poll()).includes(ge.key)}})).apply(this,arguments)}),v.receiver._subscribe("ping",function(U,Y){return(O=O||(0,m.Z)(function*(oe,ge){return["keyChanged"]})).apply(this,arguments)})})()}initializeSender(){var v=this;return(0,m.Z)(function*(){var I,O;if(v.activeServiceWorker=yield function sh(){return(ni=ni||(0,m.Z)(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}(),!v.activeServiceWorker)return;v.sender=new ih(v.activeServiceWorker);const U=yield v.sender._send("ping",{},800);U&&null!==(I=U[0])&&void 0!==I&&I.fulfilled&&null!==(O=U[0])&&void 0!==O&&O.value.includes("keyChanged")&&(v.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(v){var I=this;return(0,m.Z)(function*(){if(I.sender&&I.activeServiceWorker&&function On(){var M;return(null===(M=navigator?.serviceWorker)||void 0===M?void 0:M.controller)||null}()===I.activeServiceWorker)try{yield I.sender._send("keyChanged",{key:v},I.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,m.Z)(function*(){try{if(!indexedDB)return!1;const v=yield lp();return yield cp(v,ha,"1"),yield $u(v,ha),!0}catch{}return!1})()}_withPendingWrite(v){var I=this;return(0,m.Z)(function*(){I.pendingWrites++;try{yield v()}finally{I.pendingWrites--}})()}_set(v,I){var O=this;return(0,m.Z)(function*(){return O._withPendingWrite((0,m.Z)(function*(){return yield O._withRetries(U=>cp(U,v,I)),O.localCache[v]=I,O.notifyServiceWorker(v)}))})()}_get(v){var I=this;return(0,m.Z)(function*(){const O=yield I._withRetries(U=>function jr(M,_){return(br=br||(0,m.Z)(function*(v,I){const O=ah(v,!1).get(I),U=yield new Vu(O).toPromise();return void 0===U?null:U.value})).apply(this,arguments)}(U,v));return I.localCache[v]=O,O})()}_remove(v){var I=this;return(0,m.Z)(function*(){return I._withPendingWrite((0,m.Z)(function*(){return yield I._withRetries(O=>$u(O,v)),delete I.localCache[v],I.notifyServiceWorker(v)}))})()}_poll(){var v=this;return(0,m.Z)(function*(){const I=yield v._withRetries(Y=>{const oe=ah(Y,!1).getAll();return new Vu(oe).toPromise()});if(!I)return[];if(0!==v.pendingWrites)return[];const O=[],U=new Set;for(const{fbase_key:Y,value:oe}of I)U.add(Y),JSON.stringify(v.localCache[Y])!==JSON.stringify(oe)&&(v.notifyListeners(Y,oe),O.push(Y));for(const Y of Object.keys(v.localCache))v.localCache[Y]&&!U.has(Y)&&(v.notifyListeners(Y,null),O.push(Y));return O})()}notifyListeners(v,I){this.localCache[v]=I;const O=this.listeners[v];if(O)for(const U of Array.from(O))U(I)}startPolling(){var v=this;this.stopPolling(),this.pollTimer=setInterval((0,m.Z)(function*(){return v._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(v,I){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[v]||(this.listeners[v]=new Set,this._get(v)),this.listeners[v].add(I)}_removeListener(v,I){this.listeners[v]&&(this.listeners[v].delete(I),0===this.listeners[v].size&&delete this.listeners[v]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return M.type="LOCAL",M})(),Gu=1e12;class ag{constructor(_){this.auth=_,this.counter=Gu,this._widgets=new Map}render(_,v){const I=this.counter;return this._widgets.set(I,new as(_,this.auth.name,v||{})),this.counter++,I}reset(_){var v;const I=_||Gu;null===(v=this._widgets.get(I))||void 0===v||v.delete(),this._widgets.delete(I)}getResponse(_){var v;return(null===(v=this._widgets.get(_||Gu))||void 0===v?void 0:v.getResponse())||""}execute(_){var v=this;return(0,m.Z)(function*(){var I;return null===(I=v._widgets.get(_||Gu))||void 0===I||I.execute(),""})()}}class as{constructor(_,v,I){this.params=I,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const O="string"==typeof _?document.getElementById(_):_;et(O,"argument-error",{appName:v}),this.container=O,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function Wn(M){const _=[],v="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let I=0;I<M;I++)_.push(v.charAt(Math.floor(Math.random()*v.length)));return _.join("")}(50);const{callback:_,"expired-callback":v}=this.params;if(_)try{_(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,v)try{v()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Fi=pc("rcb"),Bt=new nr(3e4,6e4);class cs{constructor(){var _;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(_=Cn().grecaptcha)||void 0===_||!_.render)}load(_,v=""){return et(function dp(M){return M.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(M)}(v),_,"argument-error"),this.shouldResolveImmediately(v)&&Kf(Cn().grecaptcha)?Promise.resolve(Cn().grecaptcha):new Promise((I,O)=>{const U=Cn().setTimeout(()=>{O(Gt(_,"network-request-failed"))},Bt.get());Cn()[Fi]=()=>{Cn().clearTimeout(U),delete Cn()[Fi];const oe=Cn().grecaptcha;if(!oe||!Kf(oe))return void O(Gt(_,"internal-error"));const ge=oe.render;oe.render=(Be,jt)=>{const Mt=ge(Be,jt);return this.counter++,Mt},this.hostLanguage=v,I(oe)},bl(`https://www.google.com/recaptcha/api.js??${(0,ee.xO)({onload:Fi,render:"explicit",hl:v})}`).catch(()=>{clearTimeout(U),O(Gt(_,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(_){var v;return!(null===(v=Cn().grecaptcha)||void 0===v||!v.render)&&(_===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Hi{load(_){return(0,m.Z)(function*(){return new ag(_)})()}clearedOneInstance(){}}const us="recaptcha",ch={theme:"light",type:"image"};class kc{constructor(_,v=Object.assign({},ch),I){this.parameters=v,this.type=us,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=An(I),this.isInvisible="invisible"===this.parameters.size,et(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const O="string"==typeof _?document.getElementById(_):_;et(O,this.auth,"argument-error"),this.container=O,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Hi:new cs,this.validateStartingState()}verify(){var _=this;return(0,m.Z)(function*(){_.assertNotDestroyed();const v=yield _.render(),I=_.getAssertedRecaptcha();return I.getResponse(v)||new Promise(U=>{const Y=oe=>{oe&&(_.tokenChangeListeners.delete(Y),U(oe))};_.tokenChangeListeners.add(Y),_.isInvisible&&I.execute(v)})})()}render(){try{this.assertNotDestroyed()}catch(_){return Promise.reject(_)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(_=>{throw this.renderPromise=null,_})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(_=>{this.container.removeChild(_)})}validateStartingState(){et(!this.parameters.sitekey,this.auth,"argument-error"),et(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),et(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(_){return v=>{if(this.tokenChangeListeners.forEach(I=>I(v)),"function"==typeof _)_(v);else if("string"==typeof _){const I=Cn()[_];"function"==typeof I&&I(v)}}}assertNotDestroyed(){et(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var _=this;return(0,m.Z)(function*(){if(yield _.init(),!_.widgetId){let v=_.container;if(!_.isInvisible){const I=document.createElement("div");v.appendChild(I),v=I}_.widgetId=_.getAssertedRecaptcha().render(v,_.parameters)}return _.widgetId})()}init(){var _=this;return(0,m.Z)(function*(){et(Ua()&&!xc(),_.auth,"internal-error"),yield function Lc(){let M=null;return new Promise(_=>{"complete"!==document.readyState?(M=()=>_(),window.addEventListener("load",M)):_()}).catch(_=>{throw M&&window.removeEventListener("load",M),_})}(),_.recaptcha=yield _._recaptchaLoader.load(_.auth,_.auth.languageCode||void 0);const v=yield function Wf(M){return(Ke=Ke||(0,m.Z)(function*(_){return(yield sr(_,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}(_.auth);et(v,_.auth,"internal-error"),_.parameters.sitekey=v})()}getAssertedRecaptcha(){return et(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class ga{constructor(_,v){this.verificationId=_,this.onConfirmation=v}confirm(_){const v=ai._fromVerification(this.verificationId,_);return this.onConfirmation(v)}}function ji(M,_,v){return(mi=mi||(0,m.Z)(function*(I,O,U){const Y=An(I),oe=yield Ht(Y,O,(0,ee.m9)(U));return new ga(oe,ge=>Sr(Y,ge))})).apply(this,arguments)}function ya(M,_,v){return($r=$r||(0,m.Z)(function*(I,O,U){const Y=(0,ee.m9)(I);yield la(!1,Y,"phone");const oe=yield Ht(Y.auth,O,(0,ee.m9)(U));return new ga(oe,ge=>Mo(Y,ge))})).apply(this,arguments)}function Nl(M,_,v){return(ra=ra||(0,m.Z)(function*(I,O,U){const Y=(0,ee.m9)(I),oe=yield Ht(Y.auth,O,(0,ee.m9)(U));return new ga(oe,ge=>or(Y,ge))})).apply(this,arguments)}function Ht(M,_,v){return(zn=zn||(0,m.Z)(function*(I,O,U){var Y;const oe=yield U.verify();try{let ge;if(et("string"==typeof oe,I,"argument-error"),et(U.type===us,I,"argument-error"),ge="string"==typeof O?{phoneNumber:O}:O,"session"in ge){const Be=ge.session;if("phoneNumber"in ge)return et("enroll"===Be.type,I,"internal-error"),(yield function Nu(M,_){return sr(M,"POST","/v2/accounts/mfaEnrollment:start",pn(M,_))}(I,{idToken:Be.credential,phoneEnrollmentInfo:{phoneNumber:ge.phoneNumber,recaptchaToken:oe}})).phoneSessionInfo.sessionInfo;{et("signin"===Be.type,I,"internal-error");const jt=(null===(Y=ge.multiFactorHint)||void 0===Y?void 0:Y.uid)||ge.multiFactorUid;return et(jt,I,"missing-multi-factor-info"),(yield function up(M,_){return sr(M,"POST","/v2/accounts/mfaSignIn:start",pn(M,_))}(I,{mfaPendingCredential:Be.credential,mfaEnrollmentId:jt,phoneSignInInfo:{recaptchaToken:oe}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:Be}=yield function Vd(M,_){return(Xi=Xi||(0,m.Z)(function*(v,I){return sr(v,"POST","/v1/accounts:sendVerificationCode",pn(v,I))})).apply(this,arguments)}(I,{phoneNumber:ge.phoneNumber,recaptchaToken:oe});return Be}}finally{U._reset()}})).apply(this,arguments)}function hp(M,_){return(dr=dr||(0,m.Z)(function*(v,I){yield ao((0,ee.m9)(v),I)})).apply(this,arguments)}let fp=(()=>{class M{constructor(v){this.providerId=M.PROVIDER_ID,this.auth=An(v)}verifyPhoneNumber(v,I){return Ht(this.auth,v,(0,ee.m9)(I))}static credential(v,I){return ai._fromVerification(v,I)}static credentialFromResult(v){return M.credentialFromTaggedObject(v)}static credentialFromError(v){return M.credentialFromTaggedObject(v.customData||{})}static credentialFromTaggedObject({_tokenResponse:v}){if(!v)return null;const{phoneNumber:I,temporaryProof:O}=v;return I&&O?ai._fromTokenResponse(I,O):null}}return M.PROVIDER_ID="phone",M.PHONE_SIGN_IN_METHOD="phone",M})();function ds(M,_){return _?so(_):(et(M._popupRedirectResolver,M,"argument-error"),M._popupRedirectResolver)}class _a extends ws{constructor(_){super("custom","custom"),this.params=_}_getIdTokenResponse(_){return js(_,this._buildIdpRequest())}_linkToIdToken(_,v){return js(_,this._buildIdpRequest(v))}_getReauthenticationResolver(_){return js(_,this._buildIdpRequest())}_buildIdpRequest(_){const v={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return _&&(v.idToken=_),v}}function zr(M){return Kd(M.auth,new _a(M),M.bypassAuthState)}function lg(M){const{auth:_,user:v}=M;return et(v,_,"internal-error"),bc(v,new _a(M),M.bypassAuthState)}function uh(M){return(an=an||(0,m.Z)(function*(_){const{auth:v,user:I}=_;return et(I,v,"internal-error"),ao(I,new _a(_),_.bypassAuthState)})).apply(this,arguments)}class Za{constructor(_,v,I,O,U=!1){this.auth=_,this.resolver=I,this.user=O,this.bypassAuthState=U,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(v)?v:[v]}execute(){var v,_=this;return new Promise(function(I,O){return(v=v||(0,m.Z)(function*(U,Y){_.pendingPromise={resolve:U,reject:Y};try{_.eventManager=yield _.resolver._initialize(_.auth),yield _.onExecution(),_.eventManager.registerConsumer(_)}catch(oe){_.reject(oe)}})).apply(this,arguments)})}onAuthEvent(_){var v=this;return(0,m.Z)(function*(){const{urlResponse:I,sessionId:O,postBody:U,tenantId:Y,error:oe,type:ge}=_;if(oe)return void v.reject(oe);const Be={auth:v.auth,requestUri:I,sessionId:O,tenantId:Y||void 0,postBody:U||void 0,user:v.user,bypassAuthState:v.bypassAuthState};try{v.resolve(yield v.getIdpTask(ge)(Be))}catch(jt){v.reject(jt)}})()}onError(_){this.reject(_)}getIdpTask(_){switch(_){case"signInViaPopup":case"signInViaRedirect":return zr;case"linkViaPopup":case"linkViaRedirect":return uh;case"reauthViaPopup":case"reauthViaRedirect":return lg;default:St(this.auth,"internal-error")}}resolve(_){Oi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(_),this.unregisterAndCleanUp()}reject(_){Oi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(_),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Fl=new nr(2e3,1e4);function Pc(M,_,v){return(to=to||(0,m.Z)(function*(I,O,U){const Y=An(I);kn(I,O,fr);const oe=ds(Y,U);return new No(Y,"signInViaPopup",O,oe).executeNotNull()})).apply(this,arguments)}function cg(M,_,v){return(wn=wn||(0,m.Z)(function*(I,O,U){const Y=(0,ee.m9)(I);kn(Y.auth,O,fr);const oe=ds(Y.auth,U);return new No(Y.auth,"reauthViaPopup",O,oe,Y).executeNotNull()})).apply(this,arguments)}function Oc(M,_,v){return(Pi=Pi||(0,m.Z)(function*(I,O,U){const Y=(0,ee.m9)(I);kn(Y.auth,O,fr);const oe=ds(Y.auth,U);return new No(Y.auth,"linkViaPopup",O,oe,Y).executeNotNull()})).apply(this,arguments)}let No=(()=>{class M extends Za{constructor(v,I,O,U,Y){super(v,I,U,Y),this.provider=O,this.authWindow=null,this.pollId=null,M.currentPopupAction&&M.currentPopupAction.cancel(),M.currentPopupAction=this}executeNotNull(){var v=this;return(0,m.Z)(function*(){const I=yield v.execute();return et(I,v.auth,"internal-error"),I})()}onExecution(){var v=this;return(0,m.Z)(function*(){Oi(1===v.filter.length,"Popup operations only handle one event");const I=rr();v.authWindow=yield v.resolver._openPopup(v.auth,v.provider,v.filter[0],I),v.authWindow.associatedEvent=I,v.resolver._originValidation(v.auth).catch(O=>{v.reject(O)}),v.resolver._isIframeWebStorageSupported(v.auth,O=>{O||v.reject(Gt(v.auth,"web-storage-unsupported"))}),v.pollUserCancellation()})()}get eventId(){var v;return(null===(v=this.authWindow)||void 0===v?void 0:v.associatedEvent)||null}cancel(){this.reject(Gt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,M.currentPopupAction=null}pollUserCancellation(){const v=()=>{var I,O;this.pollId=null!==(O=null===(I=this.authWindow)||void 0===I?void 0:I.window)&&void 0!==O&&O.closed?window.setTimeout(()=>{this.pollId=null,this.reject(Gt(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(v,Fl.get())};v()}}return M.currentPopupAction=null,M})();const dh="pendingRedirect",Ul=new Map;class Hu extends Za{constructor(_,v,I=!1){super(_,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],v,void 0,I),this.eventId=null}execute(){var _=()=>super.execute,v=this;return(0,m.Z)(function*(){let I=Ul.get(v.auth._key());if(!I){try{const U=(yield function Bl(M,_){return(Gr=Gr||(0,m.Z)(function*(v,I){const O=hh(I),U=Nc(v);if(!(yield U._isAvailable()))return!1;const Y="true"===(yield U._get(O));return yield U._remove(O),Y})).apply(this,arguments)}(v.resolver,v.auth))?yield _().call(v):null;I=()=>Promise.resolve(U)}catch(O){I=()=>Promise.reject(O)}Ul.set(v.auth._key(),I)}return v.bypassAuthState||Ul.set(v.auth._key(),()=>Promise.resolve(null)),I()})()}onAuthEvent(_){var v=()=>super.onAuthEvent,I=this;return(0,m.Z)(function*(){if("signInViaRedirect"===_.type)return v().call(I,_);if("unknown"!==_.type){if(_.eventId){const O=yield I.auth._redirectUserForId(_.eventId);if(O)return I.user=O,v().call(I,_);I.resolve(null)}}else I.resolve(null)})()}onExecution(){return(0,m.Z)(function*(){})()}cleanUp(){}}function zi(M,_){return(ri=ri||(0,m.Z)(function*(v,I){return Nc(v)._set(hh(I),"true")})).apply(this,arguments)}function ju(){Ul.clear()}function Wr(M,_){Ul.set(M._key(),_)}function Nc(M){return so(M._redirectPersistence)}function hh(M){return xo(dh,M.config.apiKey,M.name)}function Dr(M,_,v){return function Qa(M,_,v){return(es=es||(0,m.Z)(function*(I,O,U){const Y=An(I);kn(I,O,fr),yield Y._initializationPromise;const oe=ds(Y,U);return yield zi(oe,Y),oe._openRedirect(Y,O,"signInViaRedirect")})).apply(this,arguments)}(M,_,v)}function Xa(M,_,v){return function Wi(M,_,v){return(Hr=Hr||(0,m.Z)(function*(I,O,U){const Y=(0,ee.m9)(I);kn(Y.auth,O,fr),yield Y.auth._initializationPromise;const oe=ds(Y.auth,U);yield zi(oe,Y.auth);const ge=yield As(Y);return oe._openRedirect(Y.auth,O,"reauthViaRedirect",ge)})).apply(this,arguments)}(M,_,v)}function li(M,_,v){return function Vl(M,_,v){return(vs=vs||(0,m.Z)(function*(I,O,U){const Y=(0,ee.m9)(I);kn(Y.auth,O,fr),yield Y.auth._initializationPromise;const oe=ds(Y.auth,U);yield la(!1,Y,O.providerId),yield zi(oe,Y.auth);const ge=yield As(Y);return oe._openRedirect(Y.auth,O,"linkViaRedirect",ge)})).apply(this,arguments)}(M,_,v)}function zu(M,_){return(bs=bs||(0,m.Z)(function*(v,I){return yield An(v)._initializationPromise,va(v,I,!1)})).apply(this,arguments)}function va(M,_){return(re=re||(0,m.Z)(function*(v,I,O=!1){const U=An(v),Y=ds(U,I),ge=yield new Hu(U,Y,O).execute();return ge&&!O&&(delete ge.user._redirectEventId,yield U._persistUserIfCurrent(ge.user),yield U._setRedirectUser(null,I)),ge})).apply(this,arguments)}function As(M){return(Q=Q||(0,m.Z)(function*(_){const v=rr(`${_.uid}:::`);return _._redirectEventId=v,yield _.auth._setRedirectUser(_),yield _.auth._persistUserIfCurrent(_),v})).apply(this,arguments)}class Kr{constructor(_){this.auth=_,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(_){this.consumers.add(_),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,_)&&(this.sendToConsumer(this.queuedRedirectEvent,_),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(_){this.consumers.delete(_)}onEvent(_){if(this.hasEventBeenHandled(_))return!1;let v=!1;return this.consumers.forEach(I=>{this.isEventForConsumer(_,I)&&(v=!0,this.sendToConsumer(_,I),this.saveEventToCache(_))}),this.hasHandledPotentialRedirect||!function Fc(M){switch(M.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ug(M);default:return!1}}(_)||(this.hasHandledPotentialRedirect=!0,v||(this.queuedRedirectEvent=_,v=!0)),v}sendToConsumer(_,v){var I;if(_.error&&!ug(_)){const O=(null===(I=_.error.code)||void 0===I?void 0:I.split("auth/")[1])||"internal-error";v.onError(Gt(this.auth,O))}else v.onAuthEvent(_)}isEventForConsumer(_,v){const I=null===v.eventId||!!_.eventId&&_.eventId===v.eventId;return v.filter.includes(_.type)&&I}hasEventBeenHandled(_){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ws(_))}saveEventToCache(_){this.cachedEventUids.add(Ws(_)),this.lastProcessedEventTime=Date.now()}}function Ws(M){return[M.type,M.eventId,M.sessionId,M.tenantId].filter(_=>_).join("-")}function ug({type:M,error:_}){return"unknown"===M&&"auth/no-auth-event"===_?.code}function Uc(M){return(G=G||(0,m.Z)(function*(_,v={}){return sr(_,"GET","/v1/projects",v)})).apply(this,arguments)}const Bc=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,fh=/^https?/;function $l(M){const _=no(),{protocol:v,hostname:I}=new URL(_);if(M.startsWith("chrome-extension://")){const Y=new URL(M);return""===Y.hostname&&""===I?"chrome-extension:"===v&&M.replace("chrome-extension://","")===_.replace("chrome-extension://",""):"chrome-extension:"===v&&Y.hostname===I}if(!fh.test(v))return!1;if(Bc.test(M))return I===M;const O=M.replace(/\./g,"\\.");return new RegExp("^(.+\\."+O+"|"+O+")$","i").test(I)}const Xt=new nr(3e4,6e4);function Ja(){const M=Cn().___jsl;if(M?.H)for(const _ of Object.keys(M.H))if(M.H[_].r=M.H[_].r||[],M.H[_].L=M.H[_].L||[],M.H[_].r=[...M.H[_].L],M.CP)for(let v=0;v<M.CP.length;v++)M.CP[v]=null}let fo=null;const ph=new nr(5e3,15e3),po="__/auth/iframe",Wu="emulator/auth/iframe",mh={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ku=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function dg(M){const _=M.config;et(_.authDomain,M,"auth-domain-config-required");const v=_.emulator?Ni(_,Wu):`https://${M.config.authDomain}/${po}`,I={apiKey:_.apiKey,appName:M.name,v:$.SDK_VERSION},O=Ku.get(M.config.apiHost);O&&(I.eid=O);const U=M._getFrameworks();return U.length&&(I.fw=U.join(",")),`${v}?${(0,ee.xO)(I).slice(1)}`}const R={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},P=500,H=600,J="_blank",ce="http://localhost";class Ee{constructor(_){this.window=_,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const pt="__/auth/handler",Dt="emulator/auth/handler",Ot=encodeURIComponent("fac");function hn(M,_,v,I,O,U){return(se=se||(0,m.Z)(function*(Y,oe,ge,Be,jt,Mt){et(Y.config.authDomain,Y,"auth-domain-config-required"),et(Y.config.apiKey,Y,"invalid-api-key");const qt={apiKey:Y.config.apiKey,appName:Y.name,authType:ge,redirectUrl:Be,v:$.SDK_VERSION,eventId:jt};if(oe instanceof fr){oe.setDefaultLanguage(Y.languageCode),qt.providerId=oe.providerId||"",(0,ee.xb)(oe.getCustomParameters())||(qt.customParameters=JSON.stringify(oe.getCustomParameters()));for(const[ui,jl]of Object.entries(Mt||{}))qt[ui]=jl}if(oe instanceof _i){const ui=oe.getScopes().filter(jl=>""!==jl);ui.length>0&&(qt.scopes=ui.join(","))}Y.tenantId&&(qt.tid=Y.tenantId);const Un=qt;for(const ui of Object.keys(Un))void 0===Un[ui]&&delete Un[ui];const ci=yield Y._getAppCheckToken(),Cs=ci?`#${Ot}=${encodeURIComponent(ci)}`:"";return`${function Nt({config:M}){return M.emulator?Ni(M,Dt):`https://${M.authDomain}/${pt}`}(Y)}?${(0,ee.xO)(Un).slice(1)}${Cs}`})).apply(this,arguments)}const Yn="webStorageSupport",Er=class Ai{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=qa,this._completeRedirectFn=va,this._overrideRedirectResult=Wr}_openPopup(_,v,I,O){var U=this;return(0,m.Z)(function*(){var Y;Oi(null===(Y=U.eventManagers[_._key()])||void 0===Y?void 0:Y.manager,"_initialize() not called before _openPopup()");const oe=yield hn(_,v,I,no(),O);return function Ue(M,_,v,I=P,O=H){const U=Math.max((window.screen.availHeight-O)/2,0).toString(),Y=Math.max((window.screen.availWidth-I)/2,0).toString();let oe="";const ge=Object.assign(Object.assign({},R),{width:I.toString(),height:O.toString(),top:U,left:Y}),Be=(0,ee.z$)().toLowerCase();v&&(oe=Hf(Be)?J:v),Md(Be)&&(_=_||ce,ge.scrollbars="yes");const jt=Object.entries(ge).reduce((qt,[Un,ci])=>`${qt}${Un}=${ci},`,"");if(function fc(M=(0,ee.z$)()){var _;return _u(M)&&!(null===(_=window.navigator)||void 0===_||!_.standalone)}(Be)&&"_self"!==oe)return function nt(M,_){const v=document.createElement("a");v.href=M,v.target=_;const I=document.createEvent("MouseEvent");I.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),v.dispatchEvent(I)}(_||"",oe),new Ee(null);const Mt=window.open(_||"",oe,jt);et(Mt,M,"popup-blocked");try{Mt.focus()}catch{}return new Ee(Mt)}(_,oe,rr())})()}_openRedirect(_,v,I,O){var U=this;return(0,m.Z)(function*(){return yield U._originValidation(_),function Ya(M){Cn().location.href=M}(yield hn(_,v,I,no(),O)),new Promise(()=>{})})()}_initialize(_){const v=_._key();if(this.eventManagers[v]){const{manager:O,promise:U}=this.eventManagers[v];return O?Promise.resolve(O):(Oi(U,"If manager is not set, promise should be"),U)}const I=this.initAndGetManager(_);return this.eventManagers[v]={promise:I},I.catch(()=>{delete this.eventManagers[v]}),I}initAndGetManager(_){var v=this;return(0,m.Z)(function*(){const I=yield function C(M){return(V=V||(0,m.Z)(function*(_){const v=yield function Uo(M){return fo=fo||function Ea(M){return new Promise((_,v)=>{var I,O,U;function Y(){Ja(),gapi.load("gapi.iframes",{callback:()=>{_(gapi.iframes.getContext())},ontimeout:()=>{Ja(),v(Gt(M,"network-request-failed"))},timeout:Xt.get()})}if(null!==(O=null===(I=Cn().gapi)||void 0===I?void 0:I.iframes)&&void 0!==O&&O.Iframe)_(gapi.iframes.getContext());else{if(null===(U=Cn().gapi)||void 0===U||!U.load){const oe=pc("iframefcb");return Cn()[oe]=()=>{gapi.load?Y():v(Gt(M,"network-request-failed"))},bl(`https://apis.google.com/js/api.js?onload=${oe}`).catch(ge=>v(ge))}Y()}}).catch(_=>{throw fo=null,_})}(M),fo}(_),I=Cn().gapi;return et(I,_,"internal-error"),v.open({where:document.body,url:dg(_),messageHandlersFilter:I.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:mh,dontclear:!0},O=>{var U;return new Promise(function(Y,oe){return(U=U||(0,m.Z)(function*(ge,Be){yield O.restyle({setHideOnLeave:!1});const jt=Gt(_,"network-request-failed"),Mt=Cn().setTimeout(()=>{Be(jt)},ph.get());function qt(){Cn().clearTimeout(Mt),ge(O)}O.ping(qt).then(qt,()=>{Be(jt)})})).apply(this,arguments)})})})).apply(this,arguments)}(_),O=new Kr(_);return I.register("authEvent",U=>(et(U?.authEvent,_,"invalid-auth-event"),{status:O.onEvent(U.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),v.eventManagers[_._key()]={manager:O},v.iframes[_._key()]=I,O})()}_isIframeWebStorageSupported(_,v){this.iframes[_._key()].send(Yn,{type:Yn},O=>{var U;const Y=null===(U=O?.[0])||void 0===U?void 0:U[Yn];void 0!==Y&&v(!!Y),St(_,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(_){const v=_._key();return this.originValidationPromises[v]||(this.originValidationPromises[v]=function ba(M){return(j=j||(0,m.Z)(function*(_){if(_.config.emulator)return;const{authorizedDomains:v}=yield Uc(_);for(const I of v)try{if($l(I))return}catch{}St(_,"unauthorized-domain")})).apply(this,arguments)}(_)),this.originValidationPromises[v]}get _shouldInitProactively(){return vu()||kd()||_u()}};class cn{constructor(_){this.factorId=_}_process(_,v,I){switch(v.type){case"enroll":return this._finalizeEnroll(_,v.credential,I);case"signin":return this._finalizeSignIn(_,v.credential);default:return Jn("unexpected MultiFactorSessionType")}}}class Pr extends cn{constructor(_){super("phone"),this.credential=_}static _fromCredential(_){return new Pr(_)}_finalizeEnroll(_,v,I){return function Ac(M,_){return sr(M,"POST","/v2/accounts/mfaEnrollment:finalize",pn(M,_))}(_,{idToken:v,displayName:I,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(_,v){return function Ol(M,_){return sr(M,"POST","/v2/accounts/mfaSignIn:finalize",pn(M,_))}(_,{mfaPendingCredential:v,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let mo=(()=>{class M{constructor(){}static assertion(v){return Pr._fromCredential(v)}}return M.FACTOR_ID="phone",M})();var Hl="@firebase/auth";class el{constructor(_){this.auth=_,this.internalListeners=new Map}getUid(){var _;return this.assertAuthConfigured(),(null===(_=this.auth.currentUser)||void 0===_?void 0:_.uid)||null}getToken(_){var v=this;return(0,m.Z)(function*(){return v.assertAuthConfigured(),yield v.auth._initializationPromise,v.auth.currentUser?{accessToken:yield v.auth.currentUser.getIdToken(_)}:null})()}addAuthTokenListener(_){if(this.assertAuthConfigured(),this.internalListeners.has(_))return;const v=this.auth.onIdTokenChanged(I=>{_(I?.stsTokenManager.accessToken||null)});this.internalListeners.set(_,v),this.updateProactiveRefresh()}removeAuthTokenListener(_){this.assertAuthConfigured();const v=this.internalListeners.get(_);v&&(this.internalListeners.delete(_),v(),this.updateProactiveRefresh())}assertAuthConfigured(){et(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const gp=(0,ee.Pz)("authIdTokenMaxAge")||300;let fg=null;const K0=M=>{var _;return function(v){return(_=_||(0,m.Z)(function*(I){const O=I&&(yield I.getIdTokenResult()),U=O&&((new Date).getTime()-Date.parse(O.issuedAtTime))/1e3;if(U&&U>gp)return;const Y=O?.token;fg!==Y&&(fg=Y,yield fetch(M,{method:Y?"POST":"DELETE",headers:Y?{Authorization:`Bearer ${Y}`}:{}}))})).apply(this,arguments)}};function gh(M=(0,$.getApp)()){const _=(0,$._getProvider)(M,"auth");if(_.isInitialized())return _.getImmediate();const v=function Ha(M,_){const v=(0,$._getProvider)(M,"auth");if(v.isInitialized()){const O=v.getImmediate(),U=v.getOptions();if((0,ee.vZ)(U,_??{}))return O;St(O,"already-initialized")}return v.initialize({options:_})}(M,{popupRedirectResolver:Er,persistence:[ma,nh,qa]}),I=(0,ee.Pz)("authTokenSyncURL");if(I){const U=K0(I);(function Pu(M,_,v){(0,ee.m9)(M).beforeAuthStateChanged(_,v)})(v,U,()=>U(v.currentUser)),function Lu(M,_,v,I){(0,ee.m9)(M).onIdTokenChanged(_,v,I)}(v,Y=>U(Y))}const O=(0,ee.q4)("auth");return O&&Pd(v,`http://${O}`),v}!function mp(M){(0,$._registerComponent)(new me.wA("auth",(_,{options:v})=>{const I=_.getProvider("app").getImmediate(),O=_.getProvider("heartbeat"),U=_.getProvider("app-check-internal"),{apiKey:Y,authDomain:oe}=I.options;et(Y&&!Y.includes(":"),"invalid-api-key",{appName:I.name});const ge={apiKey:Y,authDomain:oe,clientPlatform:M,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:zf(M)},Be=new gc(I,O,U,ge);return function yi(M,_){const v=_?.persistence||[],I=(Array.isArray(v)?v:[v]).map(so);_?.errorMap&&M._updateErrorMap(_.errorMap),M._initializeWithPersistence(I,_?.popupRedirectResolver)}(Be,v),Be},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((_,v,I)=>{_.getProvider("auth-internal").initialize()})),(0,$._registerComponent)(new me.wA("auth-internal",_=>{const v=An(_.getProvider("auth").getImmediate());return new el(v)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,$.registerVersion)(Hl,"0.23.2",function Gc(M){switch(M){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(M)),(0,$.registerVersion)(Hl,"0.23.2","esm2017")}("Browser")},2090:(Vt,$e,W)=>{W.d($e,{$s:()=>es,BH:()=>ze,G6:()=>Vs,L:()=>Ce,LL:()=>Xe,P0:()=>at,Pz:()=>je,Sg:()=>ct,UG:()=>Ct,US:()=>me,ZB:()=>ue,ZR:()=>st,aH:()=>Qe,b$:()=>vn,eu:()=>we,hl:()=>ve,jU:()=>dn,m9:()=>bs,ne:()=>Pn,pd:()=>wr,q4:()=>Ze,r3:()=>yr,ru:()=>It,tV:()=>ne,uI:()=>Tt,vZ:()=>Ft,w1:()=>eo,xO:()=>Fn,xb:()=>ti,z$:()=>tt,zI:()=>De,zd:()=>Vi});const fe=function(re){const Q=[];let G=0;for(let j=0;j<re.length;j++){let V=re.charCodeAt(j);V<128?Q[G++]=V:V<2048?(Q[G++]=V>>6|192,Q[G++]=63&V|128):55296==(64512&V)&&j+1<re.length&&56320==(64512&re.charCodeAt(j+1))?(V=65536+((1023&V)<<10)+(1023&re.charCodeAt(++j)),Q[G++]=V>>18|240,Q[G++]=V>>12&63|128,Q[G++]=V>>6&63|128,Q[G++]=63&V|128):(Q[G++]=V>>12|224,Q[G++]=V>>6&63|128,Q[G++]=63&V|128)}return Q},me={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(re,Q){if(!Array.isArray(re))throw Error("encodeByteArray takes an array as a parameter");this.init_();const G=Q?this.byteToCharMapWebSafe_:this.byteToCharMap_,j=[];for(let V=0;V<re.length;V+=3){const se=re[V],ke=V+1<re.length,ht=ke?re[V+1]:0,nn=V+2<re.length,Qt=nn?re[V+2]:0;let qn=(15&ht)<<2|Qt>>6,Nn=63&Qt;nn||(Nn=64,ke||(qn=64)),j.push(G[se>>2],G[(3&se)<<4|ht>>4],G[qn],G[Nn])}return j.join("")},encodeString(re,Q){return this.HAS_NATIVE_SUPPORT&&!Q?btoa(re):this.encodeByteArray(fe(re),Q)},decodeString(re,Q){return this.HAS_NATIVE_SUPPORT&&!Q?atob(re):function(re){const Q=[];let G=0,j=0;for(;G<re.length;){const V=re[G++];if(V<128)Q[j++]=String.fromCharCode(V);else if(V>191&&V<224){const se=re[G++];Q[j++]=String.fromCharCode((31&V)<<6|63&se)}else if(V>239&&V<365){const nn=((7&V)<<18|(63&re[G++])<<12|(63&re[G++])<<6|63&re[G++])-65536;Q[j++]=String.fromCharCode(55296+(nn>>10)),Q[j++]=String.fromCharCode(56320+(1023&nn))}else{const se=re[G++],ke=re[G++];Q[j++]=String.fromCharCode((15&V)<<12|(63&se)<<6|63&ke)}}return Q.join("")}(this.decodeStringToByteArray(re,Q))},decodeStringToByteArray(re,Q){this.init_();const G=Q?this.charToByteMapWebSafe_:this.charToByteMap_,j=[];for(let V=0;V<re.length;){const se=G[re.charAt(V++)],ht=V<re.length?G[re.charAt(V)]:0;++V;const Qt=V<re.length?G[re.charAt(V)]:64;++V;const Ut=V<re.length?G[re.charAt(V)]:64;if(++V,null==se||null==ht||null==Qt||null==Ut)throw new Le;j.push(se<<2|ht>>4),64!==Qt&&(j.push(ht<<4&240|Qt>>2),64!==Ut&&j.push(Qt<<6&192|Ut))}return j},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let re=0;re<this.ENCODED_VALS.length;re++)this.byteToCharMap_[re]=this.ENCODED_VALS.charAt(re),this.charToByteMap_[this.byteToCharMap_[re]]=re,this.byteToCharMapWebSafe_[re]=this.ENCODED_VALS_WEBSAFE.charAt(re),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[re]]=re,re>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(re)]=re,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(re)]=re)}}};class Le extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ce=function(re){return function(re){const Q=fe(re);return me.encodeByteArray(Q,!0)}(re).replace(/\./g,"")},ne=function(re){try{return me.decodeString(re,!0)}catch(Q){console.error("base64Decode failed: ",Q)}return null};function ue(re,Q){if(!(Q instanceof Object))return Q;switch(Q.constructor){case Date:return new Date(Q.getTime());case Object:void 0===re&&(re={});break;case Array:re=[];break;default:return Q}for(const G in Q)!Q.hasOwnProperty(G)||!rt(G)||(re[G]=ue(re[G],Q[G]));return re}function rt(re){return"__proto__"!==re}const Ke=()=>{try{return function Ve(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const re=process.env.__FIREBASE_DEFAULTS__;return re?JSON.parse(re):void 0})()||(()=>{if(typeof document>"u")return;let re;try{re=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const Q=re&&ne(re[1]);return Q&&JSON.parse(Q)})()}catch(re){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${re}`)}},Ze=re=>{var Q,G;return null===(G=null===(Q=Ke())||void 0===Q?void 0:Q.emulatorHosts)||void 0===G?void 0:G[re]},at=re=>{const Q=Ze(re);if(!Q)return;const G=Q.lastIndexOf(":");if(G<=0||G+1===Q.length)throw new Error(`Invalid host ${Q} with no separate hostname and port!`);const j=parseInt(Q.substring(G+1),10);return"["===Q[0]?[Q.substring(1,G-1),j]:[Q.substring(0,G),j]},Qe=()=>{var re;return null===(re=Ke())||void 0===re?void 0:re.config},je=re=>{var Q;return null===(Q=Ke())||void 0===Q?void 0:Q[`_${re}`]};class ze{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((Q,G)=>{this.resolve=Q,this.reject=G})}wrapCallback(Q){return(G,j)=>{G?this.reject(G):this.resolve(j),"function"==typeof Q&&(this.promise.catch(()=>{}),1===Q.length?Q(G):Q(G,j))}}}function ct(re,Q){if(re.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const j=Q||"demo-project",V=re.iat||0,se=re.sub||re.user_id;if(!se)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const ke=Object.assign({iss:`https://securetoken.google.com/${j}`,aud:j,iat:V,exp:V+3600,auth_time:V,sub:se,user_id:se,firebase:{sign_in_provider:"custom",identities:{}}},re);return[Ce(JSON.stringify({alg:"none",type:"JWT"})),Ce(JSON.stringify(ke)),""].join(".")}function tt(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Tt(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(tt())}function Ct(){var re;const Q=null===(re=Ke())||void 0===re?void 0:re.forceEnvironment;if("node"===Q)return!0;if("browser"===Q)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch{return!1}}function dn(){return"object"==typeof self&&self.self===self}function It(){const re="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof re&&void 0!==re.id}function vn(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function eo(){const re=tt();return re.indexOf("MSIE ")>=0||re.indexOf("Trident/")>=0}function Vs(){return!Ct()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ve(){try{return"object"==typeof indexedDB}catch{return!1}}function we(){return new Promise((re,Q)=>{try{let G=!0;const j="validate-browser-context-for-indexeddb-analytics-module",V=self.indexedDB.open(j);V.onsuccess=()=>{V.result.close(),G||self.indexedDB.deleteDatabase(j),re(!0)},V.onupgradeneeded=()=>{G=!1},V.onerror=()=>{var se;Q((null===(se=V.error)||void 0===se?void 0:se.message)||"")}}catch(G){Q(G)}})}function De(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}class st extends Error{constructor(Q,G,j){super(G),this.code=Q,this.customData=j,this.name="FirebaseError",Object.setPrototypeOf(this,st.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Xe.prototype.create)}}class Xe{constructor(Q,G,j){this.service=Q,this.serviceName=G,this.errors=j}create(Q,...G){const j=G[0]||{},V=`${this.service}/${Q}`,se=this.errors[Q],ke=se?function zt(re,Q){return re.replace(xt,(G,j)=>{const V=Q[j];return null!=V?String(V):`<${j}?>`})}(se,j):"Error";return new st(V,`${this.serviceName}: ${ke} (${V}).`,j)}}const xt=/\{\$([^}]+)}/g;function yr(re,Q){return Object.prototype.hasOwnProperty.call(re,Q)}function ti(re){for(const Q in re)if(Object.prototype.hasOwnProperty.call(re,Q))return!1;return!0}function Ft(re,Q){if(re===Q)return!0;const G=Object.keys(re),j=Object.keys(Q);for(const V of G){if(!j.includes(V))return!1;const se=re[V],ke=Q[V];if(_s(se)&&_s(ke)){if(!Ft(se,ke))return!1}else if(se!==ke)return!1}for(const V of j)if(!G.includes(V))return!1;return!0}function _s(re){return null!==re&&"object"==typeof re}function Fn(re){const Q=[];for(const[G,j]of Object.entries(re))Array.isArray(j)?j.forEach(V=>{Q.push(encodeURIComponent(G)+"="+encodeURIComponent(V))}):Q.push(encodeURIComponent(G)+"="+encodeURIComponent(j));return Q.length?"&"+Q.join("&"):""}function Vi(re){const Q={};return re.replace(/^\?/,"").split("&").forEach(j=>{if(j){const[V,se]=j.split("=");Q[decodeURIComponent(V)]=decodeURIComponent(se)}}),Q}function wr(re){const Q=re.indexOf("?");if(!Q)return"";const G=re.indexOf("#",Q);return re.substring(Q,G>0?G:void 0)}function Pn(re,Q){const G=new Wt(re,Q);return G.subscribe.bind(G)}class Wt{constructor(Q,G){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=G,this.task.then(()=>{Q(this)}).catch(j=>{this.error(j)})}next(Q){this.forEachObserver(G=>{G.next(Q)})}error(Q){this.forEachObserver(G=>{G.error(Q)}),this.close(Q)}complete(){this.forEachObserver(Q=>{Q.complete()}),this.close()}subscribe(Q,G,j){let V;if(void 0===Q&&void 0===G&&void 0===j)throw new Error("Missing Observer.");V=function ni(re,Q){if("object"!=typeof re||null===re)return!1;for(const G of Q)if(G in re&&"function"==typeof re[G])return!0;return!1}(Q,["next","error","complete"])?Q:{next:Q,error:G,complete:j},void 0===V.next&&(V.next=ur),void 0===V.error&&(V.error=ur),void 0===V.complete&&(V.complete=ur);const se=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?V.error(this.finalError):V.complete()}catch{}}),this.observers.push(V),se}unsubscribeOne(Q){void 0===this.observers||void 0===this.observers[Q]||(delete this.observers[Q],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(Q){if(!this.finalized)for(let G=0;G<this.observers.length;G++)this.sendOne(G,Q)}sendOne(Q,G){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[Q])try{G(this.observers[Q])}catch(j){typeof console<"u"&&console.error&&console.error(j)}})}close(Q){this.finalized||(this.finalized=!0,void 0!==Q&&(this.finalError=Q),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ur(){}const wn=1e3,Pi=2,Gr=144e5,ri=.5;function es(re,Q=wn,G=Pi){const j=Q*Math.pow(G,re),V=Math.round(ri*j*(Math.random()-.5)*2);return Math.min(Gr,j+V)}function bs(re){return re&&re._delegate?re._delegate:re}},6673:(Vt,$e,W)=>{var m=W(4650);let ee=null;function $(){return ee}class be{}const me=new m.OlP("DocumentToken");let Le=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:function(){return function Oe(){return(0,m.LFG)(ne)}()},providedIn:"platform"}),n})();const Ce=new m.OlP("Location Initialized");let ne=(()=>{class n extends Le{constructor(t){super(),this._doc=t,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return $().getBaseHref(this._doc)}onPopState(t){const r=$().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=$().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,i){te()?this._history.pushState(t,r,i):this._location.hash=i}replaceState(t,r,i){te()?this._history.replaceState(t,r,i):this._location.hash=i}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(me))},n.\u0275prov=m.Yz7({token:n,factory:function(){return function ue(){return new ne((0,m.LFG)(me))}()},providedIn:"platform"}),n})();function te(){return!!window.history.pushState}function rt(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function Ve(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function ut(n){return n&&"?"!==n[0]?"?"+n:n}let At=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:function(){return(0,m.f3M)(Ke)},providedIn:"root"}),n})();const Ae=new m.OlP("appBaseHref");let Ke=(()=>{class n extends At{constructor(t,r){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??(0,m.f3M)(me).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return rt(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+ut(this._platformLocation.search),i=this._platformLocation.hash;return i&&t?`${r}${i}`:r}pushState(t,r,i,s){const o=this.prepareExternalUrl(i+ut(s));this._platformLocation.pushState(t,r,o)}replaceState(t,r,i,s){const o=this.prepareExternalUrl(i+ut(s));this._platformLocation.replaceState(t,r,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(Le),m.LFG(Ae,8))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Ze=(()=>{class n extends At{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=rt(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,i,s){let o=this.prepareExternalUrl(i+ut(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.pushState(t,r,o)}replaceState(t,r,i,s){let o=this.prepareExternalUrl(i+ut(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(Le),m.LFG(Ae,8))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})(),at=(()=>{class n{constructor(t){this._subject=new m.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const r=this._locationStrategy.getBaseHref();this._basePath=function ct(n){if(new RegExp("^(https?:)?//").test(n)){const[,t]=n.split(/\/\/[^\/]+/);return t}return n}(Ve(ze(r))),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+ut(r))}normalize(t){return n.stripTrailingSlash(function je(n,e){if(!n||!e.startsWith(n))return e;const t=e.substring(n.length);return""===t||["/",";","?","#"].includes(t[0])?t:e}(this._basePath,ze(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",i=null){this._locationStrategy.pushState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+ut(r)),i)}replaceState(t,r="",i=null){this._locationStrategy.replaceState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+ut(r)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(i=>i(t,r))}subscribe(t,r,i){return this._subject.subscribe({next:t,error:r,complete:i})}}return n.normalizeQueryParams=ut,n.joinWithSlash=rt,n.stripTrailingSlash=Ve,n.\u0275fac=function(t){return new(t||n)(m.LFG(At))},n.\u0275prov=m.Yz7({token:n,factory:function(){return function Qe(){return new at((0,m.LFG)(At))}()},providedIn:"root"}),n})();function ze(n){return n.replace(/\/index.html$/,"")}class Ii{constructor(e,t,r,i){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=i}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Ba=(()=>{class n{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,r,i){this._viewContainer=t,this._template=r,this._differs=i,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=this._viewContainer;t.forEachOperation((i,s,o)=>{if(null==i.previousIndex)r.createEmbeddedView(this._template,new Ii(i.item,this._ngForOf,-1,-1),null===o?void 0:o);else if(null==o)r.remove(null===s?void 0:s);else if(null!==s){const u=r.get(s);r.move(u,o),pn(u,i)}});for(let i=0,s=r.length;i<s;i++){const u=r.get(i).context;u.index=i,u.count=s,u.ngForOf=this._ngForOf}t.forEachIdentityChange(i=>{pn(r.get(i.currentIndex),i)})}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(m.Y36(m.s_b),m.Y36(m.Rgc),m.Y36(m.ZZ4))},n.\u0275dir=m.lG2({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),n})();function pn(n,e){n.context.$implicit=e.item}let eg=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({}),n})();const fc="browser",Co="server";function Wf(n){return n===Co}let bu=(()=>{class n{}return n.\u0275prov=(0,m.Yz7)({token:n,providedIn:"root",factory:()=>new qf((0,m.LFG)(me),window)}),n})();class qf{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function pc(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const r=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let i=r.currentNode;for(;i;){const s=i.shadowRoot;if(s){const o=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(o)return o}i=r.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),r=t.left+this.window.pageXOffset,i=t.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(r-s[0],i-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=bl(this.window.history)||bl(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function bl(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class Ic extends be{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Rl extends Ic{static makeCurrent(){!function fe(n){ee||(ee=n)}(new Rl)}onAndCancel(e,t,r){return e.addEventListener(t,r,!1),()=>{e.removeEventListener(t,r,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function ua(){return Ml=Ml||document.querySelector("base"),Ml?Ml.getAttribute("href"):null}();return null==t?null:function ep(n){ko=ko||document.createElement("a"),ko.setAttribute("href",n);const e=ko.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Ml=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function Ua(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const r=t.indexOf("="),[i,s]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===e)return decodeURIComponent(s)}return null}(document.cookie,e)}}let ko,Ml=null;const Yd=new m.OlP("TRANSITION_ID"),rg=[{provide:m.ip1,useFactory:function Ru(n,e,t){return()=>{t.get(m.CZH).donePromise.then(()=>{const r=$(),i=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<i.length;s++)r.remove(i[s])})}},deps:[Yd,me,m.zs3],multi:!0}];let np=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})();const wc=new m.OlP("EventManagerPlugins");let Mu=(()=>{class n{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(i=>{i.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,i){return this._findPluginFor(r).addEventListener(t,r,i)}addGlobalEventListener(t,r,i){return this._findPluginFor(r).addGlobalEventListener(t,r,i)}getZone(){return this._zone}_findPluginFor(t){const r=this._eventNameToPlugin.get(t);if(r)return r;const i=this._plugins;for(let s=0;s<i.length;s++){const o=i[s];if(o.supports(t))return this._eventNameToPlugin.set(t,o),o}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(wc),m.LFG(m.R0b))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})();class za{constructor(e){this._doc=e}addGlobalEventListener(e,t,r){const i=$().getGlobalEventTarget(this._doc,e);if(!i)throw new Error(`Unsupported event target ${i} for event ${t}`);return this.addEventListener(i,t,r)}}let ku=(()=>{class n{constructor(){this.usageCount=new Map}addStyles(t){for(const r of t)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(t){for(const r of t)0===this.changeUsageCount(r,-1)&&this.onStyleRemoved(r)}onStyleRemoved(t){}onStyleAdded(t){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(t,r){const i=this.usageCount;let s=i.get(t)??0;return s+=r,s>0?i.set(t,s):i.delete(t),s}ngOnDestroy(){for(const t of this.getAllStyles())this.onStyleRemoved(t);this.usageCount.clear()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})(),Lo=(()=>{class n extends ku{constructor(t){super(),this.doc=t,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(t){for(const r of this.hostNodes)this.addStyleToHost(r,t)}onStyleRemoved(t){const r=this.styleRef;r.get(t)?.forEach(s=>s.remove()),r.delete(t)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const r of this.getAllStyles())this.addStyleToHost(t,r)}removeHost(t){this.hostNodes.delete(t)}addStyleToHost(t,r){const i=this.doc.createElement("style");i.textContent=r,t.appendChild(i);const s=this.styleRef.get(r);s?s.push(i):this.styleRef.set(r,[i])}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(me))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})();const da={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},lo=/%COMP%/g,Wa=new m.OlP("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function Lu(n,e){return e.flat(100).map(t=>t.replace(lo,n))}function Pu(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let os=(()=>{class n{constructor(t,r,i,s){this.eventManager=t,this.sharedStylesHost=r,this.appId=i,this.removeStylesOnCompDestory=s,this.rendererByCompId=new Map,this.defaultRenderer=new Zd(t)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;const i=this.getOrCreateRenderer(t,r);return i instanceof Ou?i.applyToHost(t):i instanceof Oo&&i.applyStyles(),i}getOrCreateRenderer(t,r){const i=this.rendererByCompId;let s=i.get(r.id);if(!s){const o=this.eventManager,u=this.sharedStylesHost,d=this.removeStylesOnCompDestory;switch(r.encapsulation){case m.ifc.Emulated:s=new Ou(o,u,r,this.appId,d);break;case m.ifc.ShadowDom:return new Po(o,u,t,r);default:s=new Oo(o,u,r,d)}s.onDestroy=()=>i.delete(r.id),i.set(r.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(Mu),m.LFG(Lo),m.LFG(m.AFp),m.LFG(Wa))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})();class Zd{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(da[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){(sp(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(sp(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error(`The selector "${e}" did not match any elements`);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;const s=da[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){const i=da[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(m.JOm.DashCase|m.JOm.Important)?e.style.setProperty(t,r,i&m.JOm.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&m.JOm.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e[t]=r}setValue(e,t){e.nodeValue=t}listen(e,t,r){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,Pu(r)):this.eventManager.addEventListener(e,t,Pu(r))}}function sp(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class Po extends Zd{constructor(e,t,r,i){super(e),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=Lu(i.id,i.styles);for(const o of s){const u=document.createElement("style");u.textContent=o,this.shadowRoot.appendChild(u)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Oo extends Zd{constructor(e,t,r,i,s=r.id){super(e),this.sharedStylesHost=t,this.removeStylesOnCompDestory=i,this.rendererUsageCount=0,this.styles=Lu(s,r.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class Ou extends Oo{constructor(e,t,r,i,s){const o=i+"-"+r.id;super(e,t,r,s,o),this.contentAttr=function z0(n){return"_ngcontent-%COMP%".replace(lo,n)}(o),this.hostAttr=function ip(n){return"_nghost-%COMP%".replace(lo,n)}(o)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){const r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}}let Nu=(()=>{class n extends za{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,i){return t.addEventListener(r,i,!1),()=>this.removeEventListener(t,r,i)}removeEventListener(t,r,i){return t.removeEventListener(r,i)}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(me))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})();const Ac=["alt","control","meta","shift"],Jd={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Fu={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let eh=(()=>{class n extends za{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,r,i){const s=n.parseEventName(r),o=n.eventCallback(s.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>$().onAndCancel(t,s.domEventName,o))}static parseEventName(t){const r=t.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const s=n._normalizeKey(r.pop());let o="",u=r.indexOf("code");if(u>-1&&(r.splice(u,1),o="code."),Ac.forEach(f=>{const g=r.indexOf(f);g>-1&&(r.splice(g,1),o+=f+".")}),o+=s,0!=r.length||0===s.length)return null;const d={};return d.domEventName=i,d.fullKey=o,d}static matchEventFullKeyCode(t,r){let i=Jd[t.key]||t.key,s="";return r.indexOf("code.")>-1&&(i=t.code,s="code."),!(null==i||!i)&&(i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),Ac.forEach(o=>{o!==i&&(0,Fu[o])(t)&&(s+=o+".")}),s+=i,s===r)}static eventCallback(t,r,i){return s=>{n.matchEventFullKeyCode(s,t)&&i.runGuarded(()=>r(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(me))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})();const nh=(0,m.eFA)(m._c5,"browser",[{provide:m.Lbi,useValue:fc},{provide:m.g9A,useValue:function fa(){Rl.makeCurrent()},multi:!0},{provide:me,useFactory:function Bu(){return(0,m.RDi)(document),document},deps:[]}]),rh=new m.OlP(""),qa=[{provide:m.rWj,useClass:class tp{addToWindow(e){m.dqk.getAngularTestability=(r,i=!0)=>{const s=e.findTestabilityInTree(r,i);if(null==s)throw new Error("Could not find testability for element.");return s},m.dqk.getAllAngularTestabilities=()=>e.getAllTestabilities(),m.dqk.getAllAngularRootElements=()=>e.getAllRootElements(),m.dqk.frameworkStabilizers||(m.dqk.frameworkStabilizers=[]),m.dqk.frameworkStabilizers.push(r=>{const i=m.dqk.getAllAngularTestabilities();let s=i.length,o=!1;const u=function(d){o=o||d,s--,0==s&&r(o)};i.forEach(function(d){d.whenStable(u)})})}findTestabilityInTree(e,t,r){return null==t?null:e.getTestability(t)??(r?$().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:m.lri,useClass:m.dDg,deps:[m.R0b,m.eoX,m.rWj]},{provide:m.dDg,useClass:m.dDg,deps:[m.R0b,m.eoX,m.rWj]}],pa=[{provide:m.zSh,useValue:"root"},{provide:m.qLn,useFactory:function th(){return new m.qLn},deps:[]},{provide:wc,useClass:Nu,multi:!0,deps:[me,m.R0b,m.Lbi]},{provide:wc,useClass:eh,multi:!0,deps:[me]},{provide:os,useClass:os,deps:[Mu,Lo,m.AFp,Wa]},{provide:m.FYo,useExisting:os},{provide:ku,useExisting:Lo},{provide:Lo,useClass:Lo,deps:[me]},{provide:Mu,useClass:Mu,deps:[wc,m.R0b]},{provide:class Zf{},useClass:np,deps:[]},[]];let ho=(()=>{class n{constructor(t){}static withServerTransition(t){return{ngModule:n,providers:[{provide:m.AFp,useValue:t.appId},{provide:Yd,useExisting:m.AFp},rg]}}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(rh,12))},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({providers:[...pa,...qa],imports:[eg,m.hGG]}),n})(),xc=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(me))},n.\u0275prov=m.Yz7({token:n,factory:function(t){let r=null;return r=t?new t:function Ya(){return new xc((0,m.LFG)(me))}(),r},providedIn:"root"}),n})();typeof window<"u"&&window;var Wn=W(8996),Fi=W(7669);function Bt(...n){const e=(0,Fi.yG)(n);return(0,Wn.D)(n,e)}var ls=W(7579);class cs extends ls.x{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:r}=this;if(e)throw t;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}}const Hi=(0,W(3888).d)(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});var us=W(9751);const{isArray:ch}=Array,{getPrototypeOf:kc,prototype:Lc,keys:ga}=Object;var Nl=W(4671),Ht=W(4004);const{isArray:hp}=Array;var zr=W(5403),lg=W(9672);function uh(...n){const e=(0,Fi.yG)(n),t=(0,Fi.jO)(n),{args:r,keys:i}=function ji(n){if(1===n.length){const e=n[0];if(ch(e))return{args:e,keys:null};if(function ya(n){return n&&"object"==typeof n&&kc(n)===Lc}(e)){const t=ga(e);return{args:t.map(r=>e[r]),keys:t}}}return{args:n,keys:null}}(n);if(0===r.length)return(0,Wn.D)([],e);const s=new us.y(function Za(n,e,t=Nl.y){return r=>{Fl(e,()=>{const{length:i}=n,s=new Array(i);let o=i,u=i;for(let d=0;d<i;d++)Fl(e,()=>{const f=(0,Wn.D)(n[d],e);let g=!1;f.subscribe((0,zr.x)(r,b=>{s[d]=b,g||(g=!0,u--),u||r.next(t(s.slice()))},()=>{--o||r.complete()}))},r)},r)}}(r,e,i?o=>function _a(n,e){return n.reduce((t,r,i)=>(t[r]=e[i],t),{})}(i,o):Nl.y));return t?s.pipe(function ds(n){return(0,Ht.U)(e=>function fp(n,e){return hp(e)?n(...e):n(e)}(n,e))}(t)):s}function Fl(n,e,t){n?(0,lg.f)(t,n,e):e()}var Pc=W(8189);function Oc(...n){return function cg(){return(0,Pc.J)(1)}()((0,Wn.D)(n,(0,Fi.yG)(n)))}var No=W(8421);function dh(n){return new us.y(e=>{(0,No.Xf)(n()).subscribe(e)})}var Ul=W(9635),Hu=W(576);function Bl(n,e){const t=(0,Hu.m)(n)?n:()=>n,r=i=>i.error(t());return new us.y(e?i=>e.schedule(r,0,i):r)}var zi=W(515),ju=W(727),Wr=W(4482);function Nc(){return(0,Wr.e)((n,e)=>{let t=null;n._refCount++;const r=(0,zr.x)(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(t=null);const i=n._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}class hh extends us.y{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,(0,Wr.A)(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new ju.w0;const t=this.getSubject();e.add(this.source.subscribe((0,zr.x)(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),e.closed&&(this._connection=null,e=ju.w0.EMPTY)}return e}refCount(){return Nc()(this)}}function Dr(n,e){return(0,Wr.e)((t,r)=>{let i=null,s=0,o=!1;const u=()=>o&&!i&&r.complete();t.subscribe((0,zr.x)(r,d=>{i?.unsubscribe();let f=0;const g=s++;(0,No.Xf)(n(d,g)).subscribe(i=(0,zr.x)(r,b=>r.next(e?e(d,b,g,f++):b),()=>{i=null,u()}))},()=>{o=!0,u()}))})}function Qa(n){return n<=0?()=>zi.E:(0,Wr.e)((e,t)=>{let r=0;e.subscribe((0,zr.x)(t,i=>{++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function Xa(...n){const e=(0,Fi.yG)(n);return(0,Wr.e)((t,r)=>{(e?Oc(n,t,e):Oc(n,t)).subscribe(r)})}function Wi(n,e){return(0,Wr.e)((t,r)=>{let i=0;t.subscribe((0,zr.x)(r,s=>n.call(e,s,i++)&&r.next(s)))})}var li=W(5577);function Vl(n){return(0,Wr.e)((e,t)=>{let r=!1;e.subscribe((0,zr.x)(t,i=>{r=!0,t.next(i)},()=>{r||t.next(n),t.complete()}))})}function zu(n=va){return(0,Wr.e)((e,t)=>{let r=!1;e.subscribe((0,zr.x)(t,i=>{r=!0,t.next(i)},()=>r?t.complete():t.error(n())))})}function va(){return new Hi}function As(n,e){const t=arguments.length>=2;return r=>r.pipe(n?Wi((i,s)=>n(i,s,r)):Nl.y,Qa(1),t?Vl(e):zu(()=>new Hi))}function Fo(n,e){return(0,Hu.m)(e)?(0,li.z)(n,e,1):(0,li.z)(n,1)}var Kr=W(8505);function Ws(n){return(0,Wr.e)((e,t)=>{let s,r=null,i=!1;r=e.subscribe((0,zr.x)(t,void 0,void 0,o=>{s=(0,No.Xf)(n(o,Ws(n)(e))),r?(r.unsubscribe(),r=null,s.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(t))})}function Fc(n,e){return(0,Wr.e)(function ug(n,e,t,r,i){return(s,o)=>{let u=t,d=e,f=0;s.subscribe((0,zr.x)(o,g=>{const b=f++;d=u?n(d,g,b):(u=!0,g),r&&o.next(d)},i&&(()=>{u&&o.next(d),o.complete()})))}}(n,e,arguments.length>=2,!0))}function Uc(n){return n<=0?()=>zi.E:(0,Wr.e)((e,t)=>{let r=[];e.subscribe((0,zr.x)(t,i=>{r.push(i),n<r.length&&r.shift()},()=>{for(const i of r)t.next(i);t.complete()},void 0,()=>{r=null}))})}function Bc(n,e){const t=arguments.length>=2;return r=>r.pipe(n?Wi((i,s)=>n(i,s,r)):Nl.y,Uc(1),t?Vl(e):zu(()=>new Hi))}function $l(n){return(0,Wr.e)((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}const Xt="primary",Ja=Symbol("RouteTitle");class Ea{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function fo(n){return new Ea(n)}function Uo(n,e,t){const r=t.path.split("/");if(r.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||r.length<n.length))return null;const i={};for(let s=0;s<r.length;s++){const o=r[s],u=n[s];if(o.startsWith(":"))i[o.substring(1)]=u;else if(o!==u.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function po(n,e){const t=n?Object.keys(n):void 0,r=e?Object.keys(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!Wu(n[i],e[i]))return!1;return!0}function Wu(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}return n===e}function mh(n){return Array.prototype.concat.apply([],n)}function Ku(n){return n.length>0?n[n.length-1]:null}function C(n,e){for(const t in n)n.hasOwnProperty(t)&&e(n[t],t)}function R(n){return(0,m.CqO)(n)?n:(0,m.QGY)(n)?(0,Wn.D)(Promise.resolve(n)):Bt(n)}const P=!1,H={exact:function Ue(n,e,t){if(!Er(n.segments,e.segments)||!Ot(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const r in e.children)if(!n.children[r]||!Ue(n.children[r],e.children[r],t))return!1;return!0},subset:pt},J={exact:function Ee(n,e){return po(n,e)},subset:function nt(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>Wu(n[t],e[t]))},ignored:()=>!0};function ce(n,e,t){return H[t.paths](n.root,e.root,t.matrixParams)&&J[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function pt(n,e,t){return Dt(n,e,e.segments,t)}function Dt(n,e,t,r){if(n.segments.length>t.length){const i=n.segments.slice(0,t.length);return!(!Er(i,t)||e.hasChildren()||!Ot(i,t,r))}if(n.segments.length===t.length){if(!Er(n.segments,t)||!Ot(n.segments,t,r))return!1;for(const i in e.children)if(!n.children[i]||!pt(n.children[i],e.children[i],r))return!1;return!0}{const i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!!(Er(n.segments,i)&&Ot(n.segments,i,r)&&n.children[Xt])&&Dt(n.children[Xt],e,s,r)}}function Ot(n,e,t){return e.every((r,i)=>J[t](n[i].parameters,r.parameters))}class hn{constructor(e=new Nt([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=fo(this.queryParams)),this._queryParamMap}toString(){return xs.serialize(this)}}class Nt{constructor(e,t){this.segments=e,this.children=t,this.parent=null,C(t,(r,i)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Vc(this)}}class Yn{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=fo(this.parameters)),this._parameterMap}toString(){return hg(this)}}function Er(n,e){return n.length===e.length&&n.every((t,r)=>t.path===e[r].path)}let Pr=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:function(){return new mo},providedIn:"root"}),n})();class mo{parse(e){const t=new O(e);return new hn(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${$c(e.root,!0)}`,r=function fg(n){const e=Object.keys(n).map(t=>{const r=n[t];return Array.isArray(r)?r.map(i=>`${Hl(t)}=${Hl(i)}`).join("&"):`${Hl(t)}=${Hl(r)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${r}${"string"==typeof e.fragment?`#${function pp(n){return encodeURI(n)}(e.fragment)}`:""}`}}const xs=new mo;function Vc(n){return n.segments.map(e=>hg(e)).join("/")}function $c(n,e){if(!n.hasChildren())return Vc(n);if(e){const t=n.children[Xt]?$c(n.children[Xt],!1):"",r=[];return C(n.children,(i,s)=>{s!==Xt&&r.push(`${s}:${$c(i,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function cn(n,e){let t=[];return C(n.children,(r,i)=>{i===Xt&&(t=t.concat(e(r,i)))}),C(n.children,(r,i)=>{i!==Xt&&(t=t.concat(e(r,i)))}),t}(n,(r,i)=>i===Xt?[$c(n.children[Xt],!1)]:[`${i}:${$c(r,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[Xt]?`${Vc(n)}/${t[0]}`:`${Vc(n)}/(${t.join("//")})`}}function Gl(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Hl(n){return Gl(n).replace(/%3B/gi,";")}function el(n){return Gl(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Gc(n){return decodeURIComponent(n)}function mp(n){return Gc(n.replace(/\+/g,"%20"))}function hg(n){return`${el(n.path)}${function gp(n){return Object.keys(n).map(e=>`;${el(e)}=${el(n[e])}`).join("")}(n.parameters)}`}const K0=/^[^\/()?;=#]+/;function gh(n){const e=n.match(K0);return e?e[0]:""}const M=/^[^=?&#]+/,v=/^[^&#]+/;class O{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Nt([],{}):new Nt([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[Xt]=new Nt(e,t)),r}parseSegment(){const e=gh(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new m.vHH(4009,P);return this.capture(e),new Yn(Gc(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=gh(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const i=gh(this.remaining);i&&(r=i,this.capture(r))}e[Gc(t)]=Gc(r)}parseQueryParam(e){const t=function _(n){const e=n.match(M);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const o=function I(n){const e=n.match(v);return e?e[0]:""}(this.remaining);o&&(r=o,this.capture(r))}const i=mp(t),s=mp(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=gh(this.remaining),i=this.remaining[r.length];if("/"!==i&&")"!==i&&";"!==i)throw new m.vHH(4010,P);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=Xt);const o=this.parseChildren();t[s]=1===Object.keys(o).length?o[Xt]:new Nt([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new m.vHH(4011,P)}}function U(n){return n.segments.length>0?new Nt([],{[Xt]:n}):n}function Y(n){const e={};for(const r of Object.keys(n.children)){const s=Y(n.children[r]);(s.segments.length>0||s.hasChildren())&&(e[r]=s)}return function oe(n){if(1===n.numberOfChildren&&n.children[Xt]){const e=n.children[Xt];return new Nt(n.segments.concat(e.segments),e.children)}return n}(new Nt(n.segments,e))}function ge(n){return n instanceof hn}const Be=!1;function Un(n,e,t,r,i){if(0===t.length)return ui(e.root,e.root,e.root,r,i);const s=function qu(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new yh(!0,0,n);let e=0,t=!1;const r=n.reduce((i,s,o)=>{if("object"==typeof s&&null!=s){if(s.outlets){const u={};return C(s.outlets,(d,f)=>{u[f]="string"==typeof d?d.split("/"):d}),[...i,{outlets:u}]}if(s.segmentPath)return[...i,s.segmentPath]}return"string"!=typeof s?[...i,s]:0===o?(s.split("/").forEach((u,d)=>{0==d&&"."===u||(0==d&&""===u?t=!0:".."===u?e++:""!=u&&i.push(u))}),i):[...i,s]},[]);return new yh(t,e,r)}(t);return s.toRoot()?ui(e.root,e.root,new Nt([],{}),r,i):function o(d){const f=function vh(n,e,t,r){if(n.isAbsolute)return new tl(e.root,!0,0);if(-1===r)return new tl(t,t===e.root,0);return function Hc(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new m.vHH(4005,Be&&"Invalid number of '../'");i=r.segments.length}return new tl(r,!1,i-s)}(t,r+(ci(n.commands[0])?0:1),n.numberOfDoubleDots)}(s,e,n.snapshot?._urlSegment,d),g=f.processChildren?nl(f.segmentGroup,f.index,s.commands):jc(f.segmentGroup,f.index,s.commands);return ui(e.root,f.segmentGroup,g,r,i)}(n.snapshot?._lastPathIndex)}function ci(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function Cs(n){return"object"==typeof n&&null!=n&&n.outlets}function ui(n,e,t,r,i){let o,s={};r&&C(r,(d,f)=>{s[f]=Array.isArray(d)?d.map(g=>`${g}`):`${d}`}),o=n===e?t:jl(n,e,t);const u=U(Y(o));return new hn(u,s,i)}function jl(n,e,t){const r={};return C(n.children,(i,s)=>{r[s]=i===e?t:jl(i,e,t)}),new Nt(n.segments,r)}class yh{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&ci(r[0]))throw new m.vHH(4003,Be&&"Root segment cannot have matrix parameters");const i=r.find(Cs);if(i&&i!==Ku(r))throw new m.vHH(4004,Be&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class tl{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}}function jc(n,e,t){if(n||(n=new Nt([],{})),0===n.segments.length&&n.hasChildren())return nl(n,e,t);const r=function q0(n,e,t){let r=0,i=e;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;const o=n.segments[i],u=t[r];if(Cs(u))break;const d=`${u}`,f=r<t.length-1?t[r+1]:null;if(i>0&&void 0===d)break;if(d&&f&&"object"==typeof f&&void 0===f.outlets){if(!Y0(d,f,o))return s;r+=2}else{if(!Y0(d,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){const s=new Nt(n.segments.slice(0,r.pathIndex),{});return s.children[Xt]=new Nt(n.segments.slice(r.pathIndex),n.children),nl(s,0,i)}return r.match&&0===i.length?new Nt(n.segments,{}):r.match&&!n.hasChildren()?yp(n,e,t):r.match?nl(n,0,i):yp(n,e,t)}function nl(n,e,t){if(0===t.length)return new Nt(n.segments,{});{const r=function bh(n){return Cs(n[0])?n[0].outlets:{[Xt]:n}}(t),i={};if(!r[Xt]&&n.children[Xt]&&1===n.numberOfChildren&&0===n.children[Xt].segments.length){const s=nl(n.children[Xt],e,t);return new Nt(n.segments,s.children)}return C(r,(s,o)=>{"string"==typeof s&&(s=[s]),null!==s&&(i[o]=jc(n.children[o],e,s))}),C(n.children,(s,o)=>{void 0===r[o]&&(i[o]=s)}),new Nt(n.segments,i)}}function yp(n,e,t){const r=n.segments.slice(0,e);let i=0;for(;i<t.length;){const s=t[i];if(Cs(s)){const d=_p(s.outlets);return new Nt(r,d)}if(0===i&&ci(t[0])){r.push(new Yn(n.segments[e].path,WE(t[0]))),i++;continue}const o=Cs(s)?s.outlets[Xt]:`${s}`,u=i<t.length-1?t[i+1]:null;o&&u&&ci(u)?(r.push(new Yn(o,WE(u))),i+=2):(r.push(new Yn(o,{})),i++)}return new Nt(r,{})}function _p(n){const e={};return C(n,(t,r)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[r]=yp(new Nt([],{}),0,t))}),e}function WE(n){const e={};return C(n,(t,r)=>e[r]=`${t}`),e}function Y0(n,e,t){return n==t.path&&po(e,t.parameters)}const vp="imperative";class rl{constructor(e,t){this.id=e,this.url=t}}class Z0 extends rl{constructor(e,t,r="imperative",i=null){super(e,t),this.type=0,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class zc extends rl{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class bp extends rl{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Yu extends rl{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=16}}class Ep extends rl{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Eh extends rl{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class oA extends rl{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class aA extends rl{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Mk extends rl{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class lA extends rl{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Q0{constructor(e){this.route=e,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class cA{constructor(e){this.route=e,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class KE{constructor(e){this.snapshot=e,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class pg{constructor(e){this.snapshot=e,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class X0{constructor(e){this.snapshot=e,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class qE{constructor(e){this.snapshot=e,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class J0{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let uA=(()=>{class n{createUrlTree(t,r,i,s,o,u){return Un(t||r.root,i,s,o,u)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})(),hA=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:function(e){return uA.\u0275fac(e)},providedIn:"root"}),n})();class QE{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=e_(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){const t=e_(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=il(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return il(e,this._root).map(t=>t.value)}}function e_(n,e){if(n===e.value)return e;for(const t of e.children){const r=e_(n,t);if(r)return r}return null}function il(n,e){if(n===e.value)return[e];for(const t of e.children){const r=il(n,t);if(r.length)return r.unshift(e),r}return[]}class go{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function Th(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class fA extends QE{constructor(e,t){super(e),this.snapshot=t,t_(this,e)}toString(){return this.snapshot.toString()}}function pA(n,e){const t=function kk(n,e){const o=new mg([],{},{},"",{},Xt,e,null,n.root,-1,{});return new JE("",new go(o,[]))}(n,e),r=new cs([new Yn("",{})]),i=new cs({}),s=new cs({}),o=new cs({}),u=new cs(""),d=new Ih(r,i,o,u,s,Xt,e,t.root);return d.snapshot=t.root,new fA(new go(d,[]),t)}class Ih{constructor(e,t,r,i,s,o,u,d){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=u,this.title=this.data?.pipe((0,Ht.U)(f=>f[Ja]))??Bt(void 0),this._futureSnapshot=d}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Ht.U)(e=>fo(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Ht.U)(e=>fo(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function mA(n,e="emptyOnly"){const t=n.pathFromRoot;let r=0;if("always"!==e)for(r=t.length-1;r>=1;){const i=t[r],s=t[r-1];if(i.routeConfig&&""===i.routeConfig.path)r--;else{if(s.component)break;r--}}return function XE(n){return n.reduce((e,t)=>({params:{...e.params,...t.params},data:{...e.data,...t.data},resolve:{...t.data,...e.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(r))}class mg{get title(){return this.data?.[Ja]}constructor(e,t,r,i,s,o,u,d,f,g,b){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=u,this.routeConfig=d,this._urlSegment=f,this._lastPathIndex=g,this._resolve=b}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=fo(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=fo(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class JE extends QE{constructor(e,t){super(t),this.url=e,t_(this,t)}toString(){return eT(this._root)}}function t_(n,e){e.value._routerState=n,e.children.forEach(t=>t_(n,t))}function eT(n){const e=n.children.length>0?` { ${n.children.map(eT).join(", ")} } `:"";return`${n.value}${e}`}function Tp(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,po(e.queryParams,t.queryParams)||n.queryParams.next(t.queryParams),e.fragment!==t.fragment&&n.fragment.next(t.fragment),po(e.params,t.params)||n.params.next(t.params),function ph(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!po(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.url.next(t.url),po(e.data,t.data)||n.data.next(t.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function Ta(n,e){const t=po(n.params,e.params)&&function Ai(n,e){return Er(n,e)&&n.every((t,r)=>po(t.parameters,e[r].parameters))}(n.url,e.url);return t&&!(!n.parent!=!e.parent)&&(!n.parent||Ta(n.parent,e.parent))}function wh(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=e.value;const i=function tT(n,e,t){return e.children.map(r=>{for(const i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return wh(n,r,i);return wh(n,r)})}(n,e,t);return new go(r,i)}{if(n.shouldAttach(e.value)){const s=n.retrieve(e.value);if(null!==s){const o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(u=>wh(n,u)),o}}const r=function nT(n){return new Ih(new cs(n.url),new cs(n.params),new cs(n.queryParams),new cs(n.fragment),new cs(n.data),n.outlet,n.component,n)}(e.value),i=e.children.map(s=>wh(n,s));return new go(r,i)}}const rT="ngNavigationCancelingError";function gA(n,e){const{redirectTo:t,navigationBehaviorOptions:r}=ge(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=yA(!1,0,e);return i.url=t,i.navigationBehaviorOptions=r,i}function yA(n,e,t){const r=new Error("NavigationCancelingError: "+(n||""));return r[rT]=!0,r.cancellationCode=e,t&&(r.url=t),r}function gg(n){return yg(n)&&ge(n.url)}function yg(n){return n&&n[rT]}class Lk{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new _g,this.attachRef=null}}let _g=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(t,r){const i=this.getOrCreateContext(t);i.outlet=r,this.contexts.set(t,i)}onChildOutletDestroyed(t){const r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new Lk,this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const wp=!1;let n_=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=Xt,this.activateEvents=new m.vpe,this.deactivateEvents=new m.vpe,this.attachEvents=new m.vpe,this.detachEvents=new m.vpe,this.parentContexts=(0,m.f3M)(_g),this.location=(0,m.f3M)(m.s_b),this.changeDetector=(0,m.f3M)(m.sBO),this.environmentInjector=(0,m.f3M)(m.lqb)}ngOnChanges(t){if(t.name){const{firstChange:r,previousValue:i}=t.name;if(r)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new m.vHH(4012,wp);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new m.vHH(4012,wp);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new m.vHH(4012,wp);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new m.vHH(4013,wp);this._activatedRoute=t;const i=this.location,o=t.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,d=new _A(t,u,i.injector);if(r&&function vA(n){return!!n.resolveComponentFactory}(r)){const f=r.resolveComponentFactory(o);this.activated=i.createComponent(f,i.length,d)}else this.activated=i.createComponent(o,{index:i.length,injector:d,environmentInjector:r??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=m.lG2({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[m.TTD]}),n})();class _A{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===Ih?this.route:e===_g?this.childContexts:this.parent.get(e,t)}}let r_=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=m.Xpm({type:n,selectors:[["ng-component"]],standalone:!0,features:[m.jDz],decls:1,vars:0,template:function(t,r){1&t&&m._UZ(0,"router-outlet")},dependencies:[n_],encapsulation:2}),n})();function i_(n,e){return n.providers&&!n._injector&&(n._injector=(0,m.MMx)(n.providers,e,`Route: ${n.path}`)),n._injector??e}function vg(n){const e=n.children&&n.children.map(vg),t=e?{...n,children:e}:{...n};return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==Xt&&(t.component=r_),t}function Bo(n){return n.outlet||Xt}function oT(n,e){const t=n.filter(r=>Bo(r)===e);return t.push(...n.filter(r=>Bo(r)!==e)),t}function Sp(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class aT{constructor(e,t,r,i){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i}activate(e){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),Tp(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){const i=Th(t);e.children.forEach(s=>{const o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),C(i,(s,o)=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){const i=e.value,s=t?t.value:null;if(i===s)if(i.component){const o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Th(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],i);if(r&&r.outlet){const o=r.outlet.detach(),u=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:u})}}deactivateRouteAndOutlet(e,t){const r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Th(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(e,t,r){const i=Th(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new qE(s.value.snapshot))}),e.children.length&&this.forwardEvent(new pg(e.value.snapshot))}activateRoutes(e,t,r){const i=e.value,s=t?t.value:null;if(Tp(i),i===s)if(i.component){const o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){const o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const u=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(u.contexts),o.attachRef=u.componentRef,o.route=u.route.value,o.outlet&&o.outlet.attach(u.componentRef,u.route.value),Tp(u.route.value),this.activateChildRoutes(e,null,o.children)}else{const u=Sp(i.snapshot),d=u?.get(m._Vd)??null;o.attachRef=null,o.route=i,o.resolver=d,o.injector=u,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}}class IA{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class o_{constructor(e,t){this.component=e,this.route=t}}function Dp(n,e,t){const r=n._root;return Sh(r,e?e._root:null,t,[r.value])}function Zu(n,e){const t=Symbol(),r=e.get(n,t);return r===t?"function"!=typeof n||(0,m.Z0I)(n)?e.get(n):n:r}function Sh(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=Th(e);return n.children.forEach(o=>{(function lT(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,o=e?e.value:null,u=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const d=function Nk(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!Er(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Er(n.url,e.url)||!po(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Ta(n,e)||!po(n.queryParams,e.queryParams);default:return!Ta(n,e)}}(o,s,s.routeConfig.runGuardsAndResolvers);d?i.canActivateChecks.push(new IA(r)):(s.data=o.data,s._resolvedData=o._resolvedData),Sh(n,e,s.component?u?u.children:null:t,r,i),d&&u&&u.outlet&&u.outlet.isActivated&&i.canDeactivateChecks.push(new o_(u.outlet.component,o))}else o&&Ap(e,u,i),i.canActivateChecks.push(new IA(r)),Sh(n,null,s.component?u?u.children:null:t,r,i)})(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),C(s,(o,u)=>Ap(o,t.getContext(u),i)),i}function Ap(n,e,t){const r=Th(n),i=n.value;C(r,(s,o)=>{Ap(s,i.component?e?e.children.getContext(o):null:e,t)}),t.canDeactivateChecks.push(new o_(i.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,i))}function Dh(n){return"function"==typeof n}function zl(n){return n instanceof Hi||"EmptyError"===n?.name}const bg=Symbol("INITIAL_VALUE");function Wc(){return Dr(n=>uh(n.map(e=>e.pipe(Qa(1),Xa(bg)))).pipe((0,Ht.U)(e=>{for(const t of e)if(!0!==t){if(t===bg)return bg;if(!1===t||t instanceof hn)return t}return!0}),Wi(e=>e!==bg),Qa(1)))}function f_(n){return(0,Ul.z)((0,Kr.b)(e=>{if(ge(e))throw gA(0,e)}),(0,Ht.U)(e=>!0===e))}const p_={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function hT(n,e,t,r,i){const s=m_(n,e,t);return s.matched?function Ah(n,e,t,r){const i=e.canMatch;return i&&0!==i.length?Bt(i.map(o=>{const u=Zu(o,n);return R(function u_(n){return n&&Dh(n.canMatch)}(u)?u.canMatch(e,t):n.runInContext(()=>u(e,t)))})).pipe(Wc(),f_()):Bt(!0)}(r=i_(e,r),e,t).pipe((0,Ht.U)(o=>!0===o?s:{...p_})):Bt(s)}function m_(n,e,t){if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?{...p_}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const i=(e.matcher||Uo)(t,n,e);if(!i)return{...p_};const s={};C(i.posParams,(u,d)=>{s[d]=u.path});const o=i.consumed.length>0?{...s,...i.consumed[i.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function xh(n,e,t,r){if(t.length>0&&function RA(n,e,t){return t.some(r=>g_(n,e,r)&&Bo(r)!==Xt)}(n,t,r)){const s=new Nt(e,function fT(n,e,t,r){const i={};i[Xt]=r,r._sourceSegment=n,r._segmentIndexShift=e.length;for(const s of t)if(""===s.path&&Bo(s)!==Xt){const o=new Nt([],{});o._sourceSegment=n,o._segmentIndexShift=e.length,i[Bo(s)]=o}return i}(n,e,r,new Nt(t,n.children)));return s._sourceSegment=n,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:[]}}if(0===t.length&&function pT(n,e,t){return t.some(r=>g_(n,e,r))}(n,t,r)){const s=new Nt(n.segments,function CA(n,e,t,r,i){const s={};for(const o of r)if(g_(n,t,o)&&!i[Bo(o)]){const u=new Nt([],{});u._sourceSegment=n,u._segmentIndexShift=e.length,s[Bo(o)]=u}return{...i,...s}}(n,e,t,r,n.children));return s._sourceSegment=n,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:t}}const i=new Nt(n.segments,n.children);return i._sourceSegment=n,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:t}}function g_(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function mT(n,e,t,r){return!!(Bo(n)===r||r!==Xt&&g_(e,t,n))&&("**"===n.path||m_(e,n,t).matched)}function Ch(n,e,t){return 0===e.length&&!n.children[t]}const Ig=!1;class Wl{constructor(e){this.segmentGroup=e||null}}class Rh{constructor(e){this.urlTree=e}}function xp(n){return Bl(new Wl(n))}function y_(n){return Bl(new Rh(n))}class gT{constructor(e,t,r,i,s){this.injector=e,this.configLoader=t,this.urlSerializer=r,this.urlTree=i,this.config=s,this.allowRedirects=!0}apply(){const e=xh(this.urlTree.root,[],[],this.config).segmentGroup,t=new Nt(e.segments,e.children);return this.expandSegmentGroup(this.injector,this.config,t,Xt).pipe((0,Ht.U)(s=>this.createUrlTree(Y(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Ws(s=>{if(s instanceof Rh)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof Wl?this.noMatchError(s):s}))}match(e){return this.expandSegmentGroup(this.injector,this.config,e.root,Xt).pipe((0,Ht.U)(i=>this.createUrlTree(Y(i),e.queryParams,e.fragment))).pipe(Ws(i=>{throw i instanceof Wl?this.noMatchError(i):i}))}noMatchError(e){return new m.vHH(4002,Ig)}createUrlTree(e,t,r){const i=U(e);return new hn(i,t,r)}expandSegmentGroup(e,t,r,i){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(e,t,r).pipe((0,Ht.U)(s=>new Nt([],s))):this.expandSegment(e,r,t,r.segments,i,!0)}expandChildren(e,t,r){const i=[];for(const s of Object.keys(r.children))"primary"===s?i.unshift(s):i.push(s);return(0,Wn.D)(i).pipe(Fo(s=>{const o=r.children[s],u=oT(t,s);return this.expandSegmentGroup(e,u,o,s).pipe((0,Ht.U)(d=>({segment:d,outlet:s})))}),Fc((s,o)=>(s[o.outlet]=o.segment,s),{}),Bc())}expandSegment(e,t,r,i,s,o){return(0,Wn.D)(r).pipe(Fo(u=>this.expandSegmentAgainstRoute(e,t,r,u,i,s,o).pipe(Ws(f=>{if(f instanceof Wl)return Bt(null);throw f}))),As(u=>!!u),Ws((u,d)=>{if(zl(u))return Ch(t,i,s)?Bt(new Nt([],{})):xp(t);throw u}))}expandSegmentAgainstRoute(e,t,r,i,s,o,u){return mT(i,t,s,o)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(e,t,i,s,o):u&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o):xp(t):xp(t)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,r,i,o):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,r,i){const s=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?y_(s):this.lineralizeSegments(r,s).pipe((0,li.z)(o=>{const u=new Nt(o,{});return this.expandSegment(e,u,t,o,i,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){const{matched:u,consumedSegments:d,remainingSegments:f,positionalParamSegments:g}=m_(t,i,s);if(!u)return xp(t);const b=this.applyRedirectCommands(d,i.redirectTo,g);return i.redirectTo.startsWith("/")?y_(b):this.lineralizeSegments(i,b).pipe((0,li.z)(T=>this.expandSegment(e,t,r,T.concat(f),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){return"**"===r.path?(e=i_(r,e),r.loadChildren?(r._loadedRoutes?Bt({routes:r._loadedRoutes,injector:r._loadedInjector}):this.configLoader.loadChildren(e,r)).pipe((0,Ht.U)(u=>(r._loadedRoutes=u.routes,r._loadedInjector=u.injector,new Nt(i,{})))):Bt(new Nt(i,{}))):hT(t,r,i,e).pipe(Dr(({matched:o,consumedSegments:u,remainingSegments:d})=>o?this.getChildConfig(e=r._injector??e,r,i).pipe((0,li.z)(g=>{const b=g.injector??e,T=g.routes,{segmentGroup:w,slicedSegments:x}=xh(t,u,d,T),k=new Nt(w.segments,w.children);if(0===x.length&&k.hasChildren())return this.expandChildren(b,T,k).pipe((0,Ht.U)(K=>new Nt(u,K)));if(0===T.length&&0===x.length)return Bt(new Nt(u,{}));const N=Bo(r)===s;return this.expandSegment(b,k,T,x,N?Xt:s,!0).pipe((0,Ht.U)(X=>new Nt(u.concat(X.segments),X.children)))})):xp(t)))}getChildConfig(e,t,r){return t.children?Bt({routes:t.children,injector:e}):t.loadChildren?void 0!==t._loadedRoutes?Bt({routes:t._loadedRoutes,injector:t._loadedInjector}):function xA(n,e,t,r){const i=e.canLoad;return void 0===i||0===i.length?Bt(!0):Bt(i.map(o=>{const u=Zu(o,n);return R(function l_(n){return n&&Dh(n.canLoad)}(u)?u.canLoad(e,t):n.runInContext(()=>u(e,t)))})).pipe(Wc(),f_())}(e,t,r).pipe((0,li.z)(i=>i?this.configLoader.loadChildren(e,t).pipe((0,Kr.b)(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):function kA(n){return Bl(yA(Ig,3))}())):Bt({routes:[],injector:e})}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),0===i.numberOfChildren)return Bt(r);if(i.numberOfChildren>1||!i.children[Xt])return e.redirectTo,Bl(new m.vHH(4e3,Ig));i=i.children[Xt]}}applyRedirectCommands(e,t,r){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r)}applyRedirectCreateUrlTree(e,t,r,i){const s=this.createSegmentGroup(e,t.root,r,i);return new hn(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const r={};return C(e,(i,s)=>{if("string"==typeof i&&i.startsWith(":")){const u=i.substring(1);r[s]=t[u]}else r[s]=i}),r}createSegmentGroup(e,t,r,i){const s=this.createSegments(e,t.segments,r,i);let o={};return C(t.children,(u,d)=>{o[d]=this.createSegmentGroup(e,u,r,i)}),new Nt(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){const i=r[t.path.substring(1)];if(!i)throw new m.vHH(4001,Ig);return i}findOrReturn(e,t){let r=0;for(const i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}}class __{}class Cp{constructor(e,t,r,i,s,o,u){this.injector=e,this.rootComponentType=t,this.config=r,this.urlTree=i,this.url=s,this.paramsInheritanceStrategy=o,this.urlSerializer=u}recognize(){const e=xh(this.urlTree.root,[],[],this.config.filter(t=>void 0===t.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,e,Xt).pipe((0,Ht.U)(t=>{if(null===t)return null;const r=new mg([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Xt,this.rootComponentType,null,this.urlTree.root,-1,{}),i=new go(r,t),s=new JE(this.url,i);return this.inheritParamsAndData(s._root),s}))}inheritParamsAndData(e){const t=e.value,r=mA(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),e.children.forEach(i=>this.inheritParamsAndData(i))}processSegmentGroup(e,t,r,i){return 0===r.segments.length&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i)}processChildren(e,t,r){return(0,Wn.D)(Object.keys(r.children)).pipe(Fo(i=>{const s=r.children[i],o=oT(t,i);return this.processSegmentGroup(e,o,s,i)}),Fc((i,s)=>i&&s?(i.push(...s),i):null),function fh(n,e=!1){return(0,Wr.e)((t,r)=>{let i=0;t.subscribe((0,zr.x)(r,s=>{const o=n(s,i++);(o||e)&&r.next(s),!o&&r.complete()}))})}(i=>null!==i),Vl(null),Bc(),(0,Ht.U)(i=>{if(null===i)return null;const s=_T(i);return function OA(n){n.sort((e,t)=>e.value.outlet===Xt?-1:t.value.outlet===Xt?1:e.value.outlet.localeCompare(t.value.outlet))}(s),s}))}processSegment(e,t,r,i,s){return(0,Wn.D)(t).pipe(Fo(o=>this.processSegmentAgainstRoute(o._injector??e,o,r,i,s)),As(o=>!!o),Ws(o=>{if(zl(o))return Ch(r,i,s)?Bt([]):Bt(null);throw o}))}processSegmentAgainstRoute(e,t,r,i,s){if(t.redirectTo||!mT(t,r,i,s))return Bt(null);let o;if("**"===t.path){const u=i.length>0?Ku(i).parameters:{},d=ET(r)+i.length;o=Bt({snapshot:new mg(i,u,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,sl(t),Bo(t),t.component??t._loadedComponent??null,t,bT(r),d,TT(t)),consumedSegments:[],remainingSegments:[]})}else o=hT(r,t,i,e).pipe((0,Ht.U)(({matched:u,consumedSegments:d,remainingSegments:f,parameters:g})=>{if(!u)return null;const b=ET(r)+d.length;return{snapshot:new mg(d,g,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,sl(t),Bo(t),t.component??t._loadedComponent??null,t,bT(r),b,TT(t)),consumedSegments:d,remainingSegments:f}}));return o.pipe(Dr(u=>{if(null===u)return Bt(null);const{snapshot:d,consumedSegments:f,remainingSegments:g}=u;e=t._injector??e;const b=t._loadedInjector??e,T=function NA(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(t),{segmentGroup:w,slicedSegments:x}=xh(r,f,g,T.filter(N=>void 0===N.redirectTo));if(0===x.length&&w.hasChildren())return this.processChildren(b,T,w).pipe((0,Ht.U)(N=>null===N?null:[new go(d,N)]));if(0===T.length&&0===x.length)return Bt([new go(d,[])]);const k=Bo(t)===s;return this.processSegment(b,T,w,x,k?Xt:s).pipe((0,Ht.U)(N=>null===N?null:[new go(d,N)]))}))}}function FA(n){const e=n.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function _T(n){const e=[],t=new Set;for(const r of n){if(!FA(r)){e.push(r);continue}const i=e.find(s=>r.value.routeConfig===s.value.routeConfig);void 0!==i?(i.children.push(...r.children),t.add(i)):e.push(r)}for(const r of t){const i=_T(r.children);e.push(new go(r.value,i))}return e.filter(r=>!t.has(r))}function bT(n){let e=n;for(;e._sourceSegment;)e=e._sourceSegment;return e}function ET(n){let e=n,t=e._segmentIndexShift??0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift??0;return t-1}function sl(n){return n.data||{}}function TT(n){return n.resolve||{}}function b_(n){return"string"==typeof n.title||null===n.title}function E_(n){return Dr(e=>{const t=n(e);return t?(0,Wn.D)(t).pipe((0,Ht.U)(()=>e)):Bt(e)})}const Mh=new m.OlP("ROUTES");let I_=(()=>{class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,m.f3M)(m.Sil)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return Bt(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const r=R(t.loadComponent()).pipe((0,Ht.U)(ST),(0,Kr.b)(s=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=s}),$l(()=>{this.componentLoaders.delete(t)})),i=new hh(r,()=>new ls.x).pipe(Nc());return this.componentLoaders.set(t,i),i}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Bt({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const s=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe((0,Ht.U)(u=>{this.onLoadEndListener&&this.onLoadEndListener(r);let d,f,g=!1;Array.isArray(u)?f=u:(d=u.create(t).injector,f=mh(d.get(Mh,[],m.XFs.Self|m.XFs.Optional)));return{routes:f.map(vg),injector:d}}),$l(()=>{this.childrenLoaders.delete(r)})),o=new hh(s,()=>new ls.x).pipe(Nc());return this.childrenLoaders.set(r,o),o}loadModuleFactoryOrRoutes(t){return R(t()).pipe((0,Ht.U)(ST),(0,li.z)(r=>r instanceof m.YKP||Array.isArray(r)?Bt(r):(0,Wn.D)(this.compiler.compileModuleAsync(r))))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function ST(n){return function Ia(n){return n&&"object"==typeof n&&"default"in n}(n)?n.default:n}let Sg=(()=>{class n{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new ls.x,this.configLoader=(0,m.f3M)(I_),this.environmentInjector=(0,m.f3M)(m.lqb),this.urlSerializer=(0,m.f3M)(Pr),this.rootContexts=(0,m.f3M)(_g),this.navigationId=0,this.afterPreactivation=()=>Bt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=i=>this.events.next(new cA(i)),this.configLoader.onLoadStartListener=i=>this.events.next(new Q0(i))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:r})}setupNavigations(t){return this.transitions=new cs({id:0,targetPageId:0,currentUrlTree:t.currentUrlTree,currentRawUrl:t.currentUrlTree,extractedUrl:t.urlHandlingStrategy.extract(t.currentUrlTree),urlAfterRedirects:t.urlHandlingStrategy.extract(t.currentUrlTree),rawUrl:t.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:vp,restoredState:null,currentSnapshot:t.routerState.snapshot,targetSnapshot:null,currentRouterState:t.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Wi(r=>0!==r.id),(0,Ht.U)(r=>({...r,extractedUrl:t.urlHandlingStrategy.extract(r.rawUrl)})),Dr(r=>{let i=!1,s=!1;return Bt(r).pipe((0,Kr.b)(o=>{this.currentNavigation={id:o.id,initialUrl:o.rawUrl,extractedUrl:o.extractedUrl,trigger:o.source,extras:o.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Dr(o=>{const u=t.browserUrlTree.toString(),d=!t.navigated||o.extractedUrl.toString()!==u||u!==t.currentUrlTree.toString();if(!d&&"reload"!==(o.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const g="";return this.events.next(new Yu(o.id,t.serializeUrl(r.rawUrl),g,0)),t.rawUrlTree=o.rawUrl,o.resolve(null),zi.E}if(t.urlHandlingStrategy.shouldProcessUrl(o.rawUrl))return DT(o.source)&&(t.browserUrlTree=o.extractedUrl),Bt(o).pipe(Dr(g=>{const b=this.transitions?.getValue();return this.events.next(new Z0(g.id,this.urlSerializer.serialize(g.extractedUrl),g.source,g.restoredState)),b!==this.transitions?.getValue()?zi.E:Promise.resolve(g)}),function yT(n,e,t,r){return Dr(i=>function LA(n,e,t,r,i){return new gT(n,e,t,r,i).apply()}(n,e,t,i.extractedUrl,r).pipe((0,Ht.U)(s=>({...i,urlAfterRedirects:s}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,t.config),(0,Kr.b)(g=>{this.currentNavigation={...this.currentNavigation,finalUrl:g.urlAfterRedirects},r.urlAfterRedirects=g.urlAfterRedirects}),function UA(n,e,t,r,i){return(0,li.z)(s=>function v_(n,e,t,r,i,s,o="emptyOnly"){return new Cp(n,e,t,r,i,o,s).recognize().pipe(Dr(u=>null===u?function PA(n){return new us.y(e=>e.error(n))}(new __):Bt(u)))}(n,e,t,s.urlAfterRedirects,r.serialize(s.urlAfterRedirects),r,i).pipe((0,Ht.U)(o=>({...s,targetSnapshot:o}))))}(this.environmentInjector,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),(0,Kr.b)(g=>{if(r.targetSnapshot=g.targetSnapshot,"eager"===t.urlUpdateStrategy){if(!g.extras.skipLocationChange){const T=t.urlHandlingStrategy.merge(g.urlAfterRedirects,g.rawUrl);t.setBrowserUrl(T,g)}t.browserUrlTree=g.urlAfterRedirects}const b=new Eh(g.id,this.urlSerializer.serialize(g.extractedUrl),this.urlSerializer.serialize(g.urlAfterRedirects),g.targetSnapshot);this.events.next(b)}));if(d&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){const{id:g,extractedUrl:b,source:T,restoredState:w,extras:x}=o,k=new Z0(g,this.urlSerializer.serialize(b),T,w);this.events.next(k);const N=pA(b,this.rootComponentType).snapshot;return Bt(r={...o,targetSnapshot:N,urlAfterRedirects:b,extras:{...x,skipLocationChange:!1,replaceUrl:!1}})}{const g="";return this.events.next(new Yu(o.id,t.serializeUrl(r.extractedUrl),g,1)),t.rawUrlTree=o.rawUrl,o.resolve(null),zi.E}}),(0,Kr.b)(o=>{const u=new oA(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(u)}),(0,Ht.U)(o=>r={...o,guards:Dp(o.targetSnapshot,o.currentSnapshot,this.rootContexts)}),function Eg(n,e){return(0,li.z)(t=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return 0===o.length&&0===s.length?Bt({...t,guardsResult:!0}):function DA(n,e,t,r){return(0,Wn.D)(n).pipe((0,li.z)(i=>function AA(n,e,t,r,i){const s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||0===s.length)return Bt(!0);const o=s.map(u=>{const d=Sp(e)??i,f=Zu(u,d);return R(function wA(n){return n&&Dh(n.canDeactivate)}(f)?f.canDeactivate(n,e,t,r):d.runInContext(()=>f(n,e,t,r))).pipe(As())});return Bt(o).pipe(Wc())}(i.component,i.route,t,e,r)),As(i=>!0!==i,!0))}(o,r,i,n).pipe((0,li.z)(u=>u&&function cT(n){return"boolean"==typeof n}(u)?function d_(n,e,t,r){return(0,Wn.D)(e).pipe(Fo(i=>Oc(function Qu(n,e){return null!==n&&e&&e(new KE(n)),Bt(!0)}(i.route.parent,r),function Tg(n,e){return null!==n&&e&&e(new X0(n)),Bt(!0)}(i.route,r),function h_(n,e,t){const r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>function a_(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(o)).filter(o=>null!==o).map(o=>dh(()=>Bt(o.guards.map(d=>{const f=Sp(o.node)??t,g=Zu(d,f);return R(function c_(n){return n&&Dh(n.canActivateChild)}(g)?g.canActivateChild(r,n):f.runInContext(()=>g(r,n))).pipe(As())})).pipe(Wc())));return Bt(s).pipe(Wc())}(n,i.path,t),function dT(n,e,t){const r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||0===r.length)return Bt(!0);const i=r.map(s=>dh(()=>{const o=Sp(e)??t,u=Zu(s,o);return R(function Fk(n){return n&&Dh(n.canActivate)}(u)?u.canActivate(e,n):o.runInContext(()=>u(e,n))).pipe(As())}));return Bt(i).pipe(Wc())}(n,i.route,t))),As(i=>!0!==i,!0))}(r,s,n,e):Bt(u)),(0,Ht.U)(u=>({...t,guardsResult:u})))})}(this.environmentInjector,o=>this.events.next(o)),(0,Kr.b)(o=>{if(r.guardsResult=o.guardsResult,ge(o.guardsResult))throw gA(0,o.guardsResult);const u=new aA(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot,!!o.guardsResult);this.events.next(u)}),Wi(o=>!!o.guardsResult||(t.restoreHistory(o),this.cancelNavigationTransition(o,"",3),!1)),E_(o=>{if(o.guards.canActivateChecks.length)return Bt(o).pipe((0,Kr.b)(u=>{const d=new Mk(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(d)}),Dr(u=>{let d=!1;return Bt(u).pipe(function Uk(n,e){return(0,li.z)(t=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return Bt(t);let s=0;return(0,Wn.D)(i).pipe(Fo(o=>function Bk(n,e,t,r){const i=n.routeConfig,s=n._resolve;return void 0!==i?.title&&!b_(i)&&(s[Ja]=i.title),function IT(n,e,t,r){const i=function Vk(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===i.length)return Bt({});const s={};return(0,Wn.D)(i).pipe((0,li.z)(o=>function wT(n,e,t,r){const i=Sp(e)??r,s=Zu(n,i);return R(s.resolve?s.resolve(e,t):i.runInContext(()=>s(e,t)))}(n[o],e,t,r).pipe(As(),(0,Kr.b)(u=>{s[o]=u}))),Uc(1),function ba(n){return(0,Ht.U)(()=>n)}(s),Ws(o=>zl(o)?zi.E:Bl(o)))}(s,n,e,r).pipe((0,Ht.U)(o=>(n._resolvedData=o,n.data=mA(n,t).resolve,i&&b_(i)&&(n.data[Ja]=i.title),null)))}(o.route,r,n,e)),(0,Kr.b)(()=>s++),Uc(1),(0,li.z)(o=>s===i.length?Bt(t):zi.E))})}(t.paramsInheritanceStrategy,this.environmentInjector),(0,Kr.b)({next:()=>d=!0,complete:()=>{d||(t.restoreHistory(u),this.cancelNavigationTransition(u,"",2))}}))}),(0,Kr.b)(u=>{const d=new lA(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(d)}))}),E_(o=>{const u=d=>{const f=[];d.routeConfig?.loadComponent&&!d.routeConfig._loadedComponent&&f.push(this.configLoader.loadComponent(d.routeConfig).pipe((0,Kr.b)(g=>{d.component=g}),(0,Ht.U)(()=>{})));for(const g of d.children)f.push(...u(g));return f};return uh(u(o.targetSnapshot.root)).pipe(Vl(),Qa(1))}),E_(()=>this.afterPreactivation()),(0,Ht.U)(o=>{const u=function Ip(n,e,t){const r=wh(n,e._root,t?t._root:void 0);return new fA(r,e)}(t.routeReuseStrategy,o.targetSnapshot,o.currentRouterState);return r={...o,targetRouterState:u}}),(0,Kr.b)(o=>{t.currentUrlTree=o.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(o.urlAfterRedirects,o.rawUrl),t.routerState=o.targetRouterState,"deferred"===t.urlUpdateStrategy&&(o.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,o),t.browserUrlTree=o.urlAfterRedirects)}),((n,e,t)=>(0,Ht.U)(r=>(new aT(e,r.targetRouterState,r.currentRouterState,t).activate(n),r)))(this.rootContexts,t.routeReuseStrategy,o=>this.events.next(o)),Qa(1),(0,Kr.b)({next:o=>{i=!0,this.lastSuccessfulNavigation=this.currentNavigation,t.navigated=!0,this.events.next(new zc(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(t.currentUrlTree))),t.titleStrategy?.updateTitle(o.targetRouterState.snapshot),o.resolve(!0)},complete:()=>{i=!0}}),$l(()=>{i||s||this.cancelNavigationTransition(r,"",1),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),Ws(o=>{if(s=!0,yg(o)){gg(o)||(t.navigated=!0,t.restoreHistory(r,!0));const u=new bp(r.id,this.urlSerializer.serialize(r.extractedUrl),o.message,o.cancellationCode);if(this.events.next(u),gg(o)){const d=t.urlHandlingStrategy.merge(o.url,t.rawUrlTree),f={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===t.urlUpdateStrategy||DT(r.source)};t.scheduleNavigation(d,vp,null,f,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{t.restoreHistory(r,!0);const u=new Ep(r.id,this.urlSerializer.serialize(r.extractedUrl),o,r.targetSnapshot??void 0);this.events.next(u);try{r.resolve(t.errorHandler(o))}catch(d){r.reject(d)}}return zi.E}))}))}cancelNavigationTransition(t,r,i){const s=new bp(t.id,this.urlSerializer.serialize(t.extractedUrl),r,i);this.events.next(s),t.resolve(!1)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function DT(n){return n!==vp}let AT=(()=>{class n{buildTitle(t){let r,i=t.root;for(;void 0!==i;)r=this.getResolvedTitleForRoute(i)??r,i=i.children.find(s=>s.outlet===Xt);return r}getResolvedTitleForRoute(t){return t.data[Ja]}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:function(){return(0,m.f3M)(BA)},providedIn:"root"}),n})(),BA=(()=>{class n extends AT{constructor(t){super(),this.title=t}updateTitle(t){const r=this.buildTitle(t);void 0!==r&&this.title.setTitle(r)}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(xc))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),xT=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:function(){return(0,m.f3M)($A)},providedIn:"root"}),n})();class VA{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}let $A=(()=>{class n extends VA{}return n.\u0275fac=function(){let e;return function(r){return(e||(e=m.n5z(n)))(r||n)}}(),n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const gn=new m.OlP("",{providedIn:"root",factory:()=>({})});let CT=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:function(){return(0,m.f3M)(RT)},providedIn:"root"}),n})(),RT=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function HA(n){throw n}function jA(n,e,t){return e.parse("/")}const MT={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},zA={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Rs=(()=>{class n{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,m.f3M)(m.c2e),this.isNgZoneEnabled=!1,this.options=(0,m.f3M)(gn,{optional:!0})||{},this.errorHandler=this.options.errorHandler||HA,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||jA,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,m.f3M)(CT),this.routeReuseStrategy=(0,m.f3M)(xT),this.urlCreationStrategy=(0,m.f3M)(hA),this.titleStrategy=(0,m.f3M)(AT),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=mh((0,m.f3M)(Mh,{optional:!0})??[]),this.navigationTransitions=(0,m.f3M)(Sg),this.urlSerializer=(0,m.f3M)(Pr),this.location=(0,m.f3M)(at),this.isNgZoneEnabled=(0,m.f3M)(m.R0b)instanceof m.R0b&&m.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new hn,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=pA(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId??0},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),vp,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const r="popstate"===t.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,r,t.state)},0)}))}navigateToSyncWithBrowser(t,r,i){const s={replaceUrl:!0},o=i?.navigationId?i:null;if(i){const d={...i};delete d.navigationId,delete d.\u0275routerPageId,0!==Object.keys(d).length&&(s.state=d)}const u=this.parseUrl(t);this.scheduleNavigation(u,r,o,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(t){this.config=t.map(vg),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,r={}){const{relativeTo:i,queryParams:s,fragment:o,queryParamsHandling:u,preserveFragment:d}=r,f=d?this.currentUrlTree.fragment:o;let g=null;switch(u){case"merge":g={...this.currentUrlTree.queryParams,...s};break;case"preserve":g=this.currentUrlTree.queryParams;break;default:g=s||null}return null!==g&&(g=this.removeEmptyProps(g)),this.urlCreationStrategy.createUrlTree(i,this.routerState,this.currentUrlTree,t,g,f??null)}navigateByUrl(t,r={skipLocationChange:!1}){const i=ge(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(s,vp,null,r)}navigate(t,r={skipLocationChange:!1}){return function WA(n){for(let e=0;e<n.length;e++){const t=n[e];if(null==t)throw new m.vHH(4008,false)}}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let r;try{r=this.urlSerializer.parse(t)}catch(i){r=this.malformedUriErrorHandler(i,this.urlSerializer,t)}return r}isActive(t,r){let i;if(i=!0===r?{...MT}:!1===r?{...zA}:r,ge(t))return ce(this.currentUrlTree,t,i);const s=this.parseUrl(t);return ce(this.currentUrlTree,s,i)}removeEmptyProps(t){return Object.keys(t).reduce((r,i)=>{const s=t[i];return null!=s&&(r[i]=s),r},{})}scheduleNavigation(t,r,i,s,o){if(this.disposed)return Promise.resolve(!1);let u,d,f,g;return o?(u=o.resolve,d=o.reject,f=o.promise):f=new Promise((b,T)=>{u=b,d=T}),g="computed"===this.canceledNavigationResolution?i&&i.\u0275routerPageId?i.\u0275routerPageId:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:g,source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:s,resolve:u,reject:d,promise:f,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),f.catch(b=>Promise.reject(b))}setBrowserUrl(t,r){const i=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl){const o={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(i,"",o)}else{const s={...r.extras.state,...this.generateNgRouterState(r.id,r.targetPageId)};this.location.go(i,"",s)}}restoreHistory(t,r=!1){if("computed"===this.canceledNavigationResolution){const s=this.currentPageId-(this.browserPageId??this.currentPageId);0!==s?this.location.historyGo(s):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===s&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class S_{}let D_=(()=>{class n{constructor(t,r,i,s,o){this.router=t,this.injector=i,this.preloadingStrategy=s,this.loader=o}setUpPreloading(){this.subscription=this.router.events.pipe(Wi(t=>t instanceof zc),Fo(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const i=[];for(const s of r){s.providers&&!s._injector&&(s._injector=(0,m.MMx)(s.providers,t,`Route: ${s.path}`));const o=s._injector??t,u=s._loadedInjector??o;(s.loadChildren&&!s._loadedRoutes&&void 0===s.canLoad||s.loadComponent&&!s._loadedComponent)&&i.push(this.preloadConfig(o,s)),(s.children||s._loadedRoutes)&&i.push(this.processRoutes(u,s.children??s._loadedRoutes))}return(0,Wn.D)(i).pipe((0,Pc.J)())}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>{let i;i=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(t,r):Bt(null);const s=i.pipe((0,li.z)(o=>null===o?Bt(void 0):(r._loadedRoutes=o.routes,r._loadedInjector=o.injector,this.processRoutes(o.injector??t,o.routes))));if(r.loadComponent&&!r._loadedComponent){const o=this.loader.loadComponent(r);return(0,Wn.D)([s,o]).pipe((0,Pc.J)())}return s})}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(Rs),m.LFG(m.Sil),m.LFG(m.lqb),m.LFG(S_),m.LFG(I_))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const kp=new m.OlP("");let LT=(()=>{class n{constructor(t,r,i,s,o={}){this.urlSerializer=t,this.transitions=r,this.viewportScroller=i,this.zone=s,this.options=o,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},o.scrollPositionRestoration=o.scrollPositionRestoration||"disabled",o.anchorScrolling=o.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof Z0?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof zc&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof J0&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new J0(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return n.\u0275fac=function(t){m.$Z()},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})();var Vo=(()=>((Vo=Vo||{})[Vo.COMPLETE=0]="COMPLETE",Vo[Vo.FAILED=1]="FAILED",Vo[Vo.REDIRECTING=2]="REDIRECTING",Vo))();const Lp=!1;function Xu(n,e){return{\u0275kind:n,\u0275providers:e}}const x_=new m.OlP("",{providedIn:"root",factory:()=>!1});function Pp(){const n=(0,m.f3M)(m.zs3);return e=>{const t=n.get(m.z2F);if(e!==t.components[0])return;const r=n.get(Rs),i=n.get(PT);1===n.get(Ag)&&r.initialNavigation(),n.get(OT,null,m.XFs.Optional)?.setUpPreloading(),n.get(kp,null,m.XFs.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}const PT=new m.OlP(Lp?"bootstrap done indicator":"",{factory:()=>new ls.x}),Ag=new m.OlP(Lp?"initial navigation":"",{providedIn:"root",factory:()=>1});function ZA(){let n=[];return n=Lp?[{provide:m.Xts,multi:!0,useFactory:()=>{const e=(0,m.f3M)(Rs);return()=>e.events.subscribe(t=>{console.group?.(`Router Event: ${t.constructor.name}`),console.log(function YE(n){if(!("type"in n))return`Unknown Router Event: ${n.constructor.name}`;switch(n.type){case 14:return`ActivationEnd(path: '${n.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${n.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${n.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${n.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state}, shouldActivate: ${n.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 2:return`NavigationCancel(id: ${n.id}, url: '${n.url}')`;case 16:return`NavigationSkipped(id: ${n.id}, url: '${n.url}')`;case 1:return`NavigationEnd(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${n.id}, url: '${n.url}', error: ${n.error})`;case 0:return`NavigationStart(id: ${n.id}, url: '${n.url}')`;case 6:return`ResolveEnd(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 5:return`ResolveStart(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 10:return`RouteConfigLoadEnd(path: ${n.route.path})`;case 9:return`RouteConfigLoadStart(path: ${n.route.path})`;case 4:return`RoutesRecognized(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 15:return`Scroll(anchor: '${n.anchor}', position: '${n.position?`${n.position[0]}, ${n.position[1]}`:null}')`}}(t)),console.log(t),console.groupEnd?.()})}}]:[],Xu(1,n)}const OT=new m.OlP(Lp?"router preloader":"");function QA(n){return Xu(0,[{provide:OT,useExisting:D_},{provide:S_,useExisting:n}])}const Ph=!1,ex=new m.OlP(Ph?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),C_=[at,{provide:Pr,useClass:mo},Rs,_g,{provide:Ih,useFactory:function A_(n){return n.routerState.root},deps:[Rs]},I_,Ph?{provide:x_,useValue:!0}:[]];function tx(){return new m.PXZ("Router",Rs)}let nx=(()=>{class n{constructor(t){}static forRoot(t,r){return{ngModule:n,providers:[C_,Ph&&r?.enableTracing?ZA().\u0275providers:[],{provide:Mh,multi:!0,useValue:t},{provide:ex,useFactory:UT,deps:[[Rs,new m.FiY,new m.tp0]]},{provide:gn,useValue:r||{}},r?.useHash?{provide:At,useClass:Ze}:{provide:At,useClass:Ke},{provide:kp,useFactory:()=>{const n=(0,m.f3M)(bu),e=(0,m.f3M)(m.R0b),t=(0,m.f3M)(gn),r=(0,m.f3M)(Sg),i=(0,m.f3M)(Pr);return t.scrollOffset&&n.setOffset(t.scrollOffset),new LT(i,r,n,e,t)}},r?.preloadingStrategy?QA(r.preloadingStrategy).\u0275providers:[],{provide:m.PXZ,multi:!0,useFactory:tx},r?.initialNavigation?ix(r):[],[{provide:BT,useFactory:Pp},{provide:m.tb,multi:!0,useExisting:BT}]]}}static forChild(t){return{ngModule:n,providers:[{provide:Mh,multi:!0,useValue:t}]}}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(ex,8))},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({imports:[r_]}),n})();function UT(n){if(Ph&&n)throw new m.vHH(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function ix(n){return["disabled"===n.initialNavigation?Xu(3,[{provide:m.ip1,multi:!0,useFactory:()=>{const e=(0,m.f3M)(Rs);return()=>{e.setUpLocationChangeListener()}}},{provide:Ag,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?Xu(2,[{provide:Ag,useValue:0},{provide:m.ip1,multi:!0,deps:[m.zs3],useFactory:e=>{const t=e.get(Ce,Promise.resolve());return()=>t.then(()=>new Promise(r=>{const i=e.get(Rs),s=e.get(PT);(function Hk(n,e){n.events.pipe(Wi(t=>t instanceof zc||t instanceof bp||t instanceof Ep||t instanceof Yu),(0,Ht.U)(t=>t instanceof zc||t instanceof Yu?Vo.COMPLETE:t instanceof bp&&(0===t.code||1===t.code)?Vo.REDIRECTING:Vo.FAILED),Wi(t=>t!==Vo.REDIRECTING),Qa(1)).subscribe(()=>{e()})})(i,()=>{r(!0)}),e.get(Sg).afterPreactivation=()=>(r(!0),s.closed?Bt(void 0):s),i.initialNavigation()}))}}]).\u0275providers:[]]}const BT=new m.OlP(Ph?"Router Initializer":"");let Cg=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275cmp=m.Xpm({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(r,i){1&r&&m._UZ(0,"router-outlet")},dependencies:[n_]}),e})();function Np(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var r,i,s,o,u,Rg={exports:{}};r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,Rg.exports=u={buildAbsoluteURL:function(d,f,g){if(g=g||{},d=d.trim(),!(f=f.trim())){if(!g.alwaysNormalize)return d;var b=u.parseURL(d);if(!b)throw new Error("Error trying to parse base URL.");return b.path=u.normalizePath(b.path),u.buildURLFromParts(b)}var T=u.parseURL(f);if(!T)throw new Error("Error trying to parse relative URL.");if(T.scheme)return g.alwaysNormalize?(T.path=u.normalizePath(T.path),u.buildURLFromParts(T)):f;var w=u.parseURL(d);if(!w)throw new Error("Error trying to parse base URL.");if(!w.netLoc&&w.path&&"/"!==w.path[0]){var x=i.exec(w.path);w.netLoc=x[1],w.path=x[2]}w.netLoc&&!w.path&&(w.path="/");var k={scheme:w.scheme,netLoc:T.netLoc,path:null,params:T.params,query:T.query,fragment:T.fragment};if(!T.netLoc&&(k.netLoc=w.netLoc,"/"!==T.path[0]))if(T.path){var N=w.path,z=N.substring(0,N.lastIndexOf("/")+1)+T.path;k.path=u.normalizePath(z)}else k.path=w.path,T.params||(k.params=w.params,T.query||(k.query=w.query));return null===k.path&&(k.path=g.alwaysNormalize?u.normalizePath(T.path):T.path),u.buildURLFromParts(k)},parseURL:function(d){var f=r.exec(d);return f?{scheme:f[1]||"",netLoc:f[2]||"",path:f[3]||"",params:f[4]||"",query:f[5]||"",fragment:f[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(s,"");d.length!==(d=d.replace(o,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};var Nh=Rg.exports;function R_(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function hs(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?R_(Object(t),!0).forEach(function(r){M_(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):R_(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function M_(n,e,t){return e=function k_(n){var e=function VT(n,e){if("object"!=typeof n||null===n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var r=t.call(n,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(n)}(n,"string");return"symbol"==typeof e?e:String(e)}(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function di(){return di=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},di.apply(this,arguments)}const en=Number.isFinite||function(n){return"number"==typeof n&&isFinite(n)};let F=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n}({}),ln=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),Ne=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.UNKNOWN="unknown",n}({});const Kc=function(){},Mg={trace:Kc,debug:Kc,log:Kc,warn:Kc,info:Kc,error:Kc};let Fp=Mg;const de=Fp,Kk=/^(\d+)x(\d+)$/,kg=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Ar{constructor(e){"string"==typeof e&&(e=Ar.parseAttrList(e));for(const t in e)e.hasOwnProperty(t)&&("X-"===t.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const r=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){const t=Kk.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const r={};for(kg.lastIndex=0;null!==(t=kg.exec(e));){let s=t[2];0===s.indexOf('"')&&s.lastIndexOf('"')===s.length-1&&(s=s.slice(1,-1)),r[t[1].trim()]=s}return r}}function lx(n){return"SCTE35-OUT"===n||"SCTE35-IN"===n}class $T{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const r=t.attr;for(const i in r)if(Object.prototype.hasOwnProperty.call(e,i)&&e[i]!==r[i]){de.warn(`DATERANGE tag attribute: "${i}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=i;break}e=di(new Ar({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=new Date(this.attr["END-DATE"]);en(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(en(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&en(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class Up{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var hr={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class GT{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[hr.AUDIO]:null,[hr.VIDEO]:null,[hr.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const r=e.split("@",2),i=[];i[0]=1===r.length?t?t.byteRangeEndOffset:0:parseInt(r[1]),i[1]=parseInt(r[0])+i[0],this._byteRange=i}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Nh.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class Bp extends GT{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new Up,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(1===r.length)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime||!en(this.programDateTime))return null;const e=en(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),r=t.length;if(r>1||1===r&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,r,i,s,o=!1){const{elementaryStreams:u}=this,d=u[e];d?(d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,r),d.startDTS=Math.min(d.startDTS,i),d.endDTS=Math.max(d.endDTS,s)):u[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:s,partial:o}}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[hr.AUDIO]=null,e[hr.VIDEO]=null,e[hr.AUDIOVIDEO]=null}}class cx extends GT{constructor(e,t,r,i,s){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new Up,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}class dx{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.misses=this.updated||this.advanced?Math.floor(.6*e.misses):e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&en(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function L_(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function HT(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}var Or={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ms={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function jT(n){switch(n){case Ms.FAIRPLAY:return Or.FAIRPLAY;case Ms.PLAYREADY:return Or.PLAYREADY;case Ms.WIDEVINE:return Or.WIDEVINE;case Ms.CLEARKEY:return Or.CLEARKEY}}var zT_WIDEVINE="edef8ba979d64acea3c827dcd51d21ed";function Lg(n){switch(n){case Or.FAIRPLAY:return Ms.FAIRPLAY;case Or.PLAYREADY:return Ms.PLAYREADY;case Or.WIDEVINE:return Ms.WIDEVINE;case Or.CLEARKEY:return Ms.CLEARKEY}}function O_(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[Or.FAIRPLAY,Or.WIDEVINE,Or.PLAYREADY,Or.CLEARKEY].filter(i=>!!e[i]):[];return!r[Or.WIDEVINE]&&t&&r.push(Or.WIDEVINE),r}const WT=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function al(n,e,t){return Uint8Array.prototype.slice?n.slice(e,t):new Uint8Array(Array.prototype.slice.call(n,e,t))}const KT=(n,e)=>e+10<=n.length&&73===n[e]&&68===n[e+1]&&51===n[e+2]&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,Ng=(n,e)=>e+10<=n.length&&51===n[e]&&68===n[e+1]&&73===n[e+2]&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,N_=(n,e)=>{const t=e;let r=0;for(;KT(n,e);)r+=10,r+=Vp(n,e+6),Ng(n,e+10)&&(r+=10),e+=r;if(r>0)return n.subarray(t,t+r)},Vp=(n,e)=>{let t=0;return t=(127&n[e])<<21,t|=(127&n[e+1])<<14,t|=(127&n[e+2])<<7,t|=127&n[e+3],t},qT=(n,e)=>KT(n,e)&&Vp(n,e+6)+10<=n.length-e,F_=n=>n&&"PRIV"===n.key&&"com.apple.streaming.transportStreamTimestamp"===n.info,U_=n=>{const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Vp(n,4);return{type:e,size:t,data:n.subarray(10,10+t)}},ll=n=>{let e=0;const t=[];for(;KT(n,e);){const r=Vp(n,e+6);e+=10;const i=e+r;for(;e+8<i;){const s=U_(n.subarray(e)),o=Fg(s);o&&t.push(o),e+=s.size+10}Ng(n,e)&&(e+=10)}return t},Fg=n=>"PRIV"===n.type?Ug(n):"W"===n.type[0]?px(n):$p(n),Ug=n=>{if(n.size<2)return;const e=wa(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}},$p=n=>{if(n.size<2)return;if("TXXX"===n.type){let t=1;const r=wa(n.data.subarray(t),!0);t+=r.length+1;const i=wa(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=wa(n.data.subarray(1));return{key:n.type,data:e}},px=n=>{if("WXXX"===n.type){if(n.size<2)return;let t=1;const r=wa(n.data.subarray(t),!0);t+=r.length+1;const i=wa(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=wa(n.data);return{key:n.type,data:e}},ZT=n=>{if(8===n.data.byteLength){const e=new Uint8Array(n.data);let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,1&e[3]&&(r+=47721858.84),Math.round(r)}},wa=(n,e=!1)=>{const t=function mx(){return!B_&&typeof self.TextDecoder<"u"&&(B_=new self.TextDecoder("utf-8")),B_}();if(t){const f=t.decode(n);if(e){const g=f.indexOf("\0");return-1!==g?f.substring(0,g):f}return f.replace(/\0/g,"")}const r=n.length;let i,s,o,u="",d=0;for(;d<r;){if(i=n[d++],0===i&&e)return u;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(i);break;case 12:case 13:s=n[d++],u+=String.fromCharCode((31&i)<<6|63&s);break;case 14:s=n[d++],o=n[d++],u+=String.fromCharCode((15&i)<<12|(63&s)<<6|(63&o)<<0)}}return u};let B_;const Ks_hexDump=function(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e},Bg=Math.pow(2,32)-1,qk=[].push,QT={video:1,audio:2,id3:3,text:4};function Ki(n){return String.fromCharCode.apply(null,n)}function XT(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function yn(n,e){const t=JT(n,e);return t<0?4294967296+t:t}function JT(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function V_(n,e,t){n[e]=t>>24,n[e+1]=t>>16&255,n[e+2]=t>>8&255,n[e+3]=255&t}function Kn(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let i=0;i<r;){const s=yn(n,i),u=s>1?i+s:r;if(Ki(n.subarray(i+4,i+8))===e[0])if(1===e.length)t.push(n.subarray(i+8,u));else{const d=Kn(n.subarray(i+8,u),e.slice(1));d.length&&qk.apply(t,d)}i=u}return t}function eI(n){const e=[],t=n[0];let r=8;const i=yn(n,r);r+=4,r+=0===t?8:16,r+=2;let u=n.length+0;const d=XT(n,r);r+=2;for(let f=0;f<d;f++){let g=r;const b=yn(n,g);g+=4;const T=2147483647&b;if((2147483648&b)>>>31==1)return de.warn("SIDX has hierarchical references (not supported)"),null;const x=yn(n,g);g+=4,e.push({referenceSize:T,subsegmentDuration:x,info:{duration:x/i,start:u,end:u+T-1}}),u+=T,g+=4,r=g}return{earliestPresentationTime:0,timescale:i,version:t,referencesCount:d,references:e}}function Vg(n){const e=[],t=Kn(n,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],o=Kn(s,["tkhd"])[0];if(o){let u=o[0],d=0===u?12:20;const f=yn(o,d),g=Kn(s,["mdia","mdhd"])[0];if(g){u=g[0],d=0===u?12:20;const b=yn(g,d),T=Kn(s,["mdia","hdlr"])[0];if(T){const w=Ki(T.subarray(8,12)),x={soun:hr.AUDIO,vide:hr.VIDEO}[w];if(x){const k=Kn(s,["mdia","minf","stbl","stsd"])[0];let N;k&&(N=Ki(k.subarray(12,16))),e[f]={timescale:b,type:x},e[x]={timescale:b,id:f,codec:N}}}}}}return Kn(n,["moov","mvex","trex"]).forEach(i=>{const s=yn(i,4),o=e[s];o&&(o.default={duration:yn(i,12),flags:yn(i,20)})}),e}function $g(n){const e=Kn(n,["schm"])[0];if(e){const t=Ki(e.subarray(4,8));if("cbcs"===t||"cenc"===t)return Kn(n,["schi","tenc"])[0]}return de.error("[eme] missing 'schm' box"),null}function vx(n){const e=yn(n,0);let t=8;1&e&&(t+=4),4&e&&(t+=4);let r=0;const i=yn(n,4);for(let s=0;s<i;s++)256&e&&(r+=yn(n,t),t+=4),512&e&&(t+=4),1024&e&&(t+=4),2048&e&&(t+=4);return r}function Ju(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function tI(n,e){const t=[],r=e.samples,i=e.timescale,s=e.id;let o=!1;return Kn(r,["moof"]).map(d=>{const f=d.byteOffset-8;Kn(d,["traf"]).map(b=>{const T=Kn(b,["tfdt"]).map(w=>{const x=w[0];let k=yn(w,4);return 1===x&&(k*=Math.pow(2,32),k+=yn(w,8)),k/i})[0];return void 0!==T&&(n=T),Kn(b,["tfhd"]).map(w=>{const x=yn(w,4),k=16777215&yn(w,0);let K=0;const ie=0!=(16&k);let le=0;const Me=0!=(32&k);let Ie=8;x===s&&(0!=(1&k)&&(Ie+=8),0!=(2&k)&&(Ie+=4),0!=(8&k)&&(K=yn(w,Ie),Ie+=4),ie&&(le=yn(w,Ie),Ie+=4),Me&&(Ie+=4),"video"===e.type&&(o=function nI(n){if(!n)return!1;const e=n.indexOf("."),t=e<0?n:n.substring(0,e);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}(e.codec)),Kn(b,["trun"]).map(We=>{const ot=We[0],Fe=16777215&yn(We,0),Jt=0!=(1&Fe);let bt=0;const Bn=0!=(4&Fe),Li=0!=(256&Fe);let gr=0;const dt=0!=(512&Fe);let yt=0;const He=0!=(1024&Fe),ft=0!=(2048&Fe);let In=0;const Gn=yn(We,4);let Sn=8;Jt&&(bt=yn(We,Sn),Sn+=4),Bn&&(Sn+=4);let _r=bt+f;for(let Hn=0;Hn<Gn;Hn++){if(Li?(gr=yn(We,Sn),Sn+=4):gr=K,dt?(yt=yn(We,Sn),Sn+=4):yt=le,He&&(Sn+=4),ft&&(In=0===ot?yn(We,Sn):JT(We,Sn),Sn+=4),e.type===hr.VIDEO){let ea=0;for(;ea<yt;){const ta=yn(r,_r);_r+=4,rI(o,r[_r])&&iI(r.subarray(_r,_r+ta),o?2:1,n+In/i,t),_r+=ta,ea+=ta+4}}n+=gr/i}}))})})}),t}function rI(n,e){if(n){const t=e>>1&63;return 39===t||40===t}return 6==(31&e)}function iI(n,e,t,r){const i=Tx(n);let s=0;s+=e;let o=0,u=0,d=!1,f=0;for(;s<i.length;){o=0;do{if(s>=i.length)break;f=i[s++],o+=f}while(255===f);u=0;do{if(s>=i.length)break;f=i[s++],u+=f}while(255===f);const g=i.length-s;if(!d&&4===o&&s<i.length){if(d=!0,181===i[s++]){const T=XT(i,s);if(s+=2,49===T){const w=yn(i,s);if(s+=4,1195456820===w){const x=i[s++];if(3===x){const k=i[s++],z=64&k,X=z?2+3*(31&k):0,K=new Uint8Array(X);if(z){K[0]=k;for(let ie=1;ie<X;ie++)K[ie]=i[s++]}r.push({type:x,payloadType:o,pts:t,bytes:K})}}}}}else if(5===o&&u<g){if(d=!0,u>16){const b=[];for(let x=0;x<16;x++){const k=i[s++].toString(16);b.push(1==k.length?"0"+k:k),(3===x||5===x||7===x||9===x)&&b.push("-")}const T=u-16,w=new Uint8Array(T);for(let x=0;x<T;x++)w[x]=i[s++];r.push({payloadType:o,pts:t,uuid:b.join(""),userData:wa(w),userDataBytes:w})}}else if(u<g)s+=u;else if(u>g)break}}function Tx(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)0===n[r]&&0===n[r+1]&&3===n[r+2]?(t.push(r+2),r+=2):r++;if(0===t.length)return n;const i=e-t.length,s=new Uint8Array(i);let o=0;for(r=0;r<i;o++,r++)o===t[0]&&(o++,t.shift()),s[r]=n[o];return s}let Hg={};class ed{static clearKeyUriToKeyIdMap(){Hg={}}constructor(e,t,r,i=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=s,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case Ms.FAIRPLAY:case Ms.WIDEVINE:case Ms.PLAYREADY:case Ms.CLEARKEY:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"===this.method&&!this.iv&&de.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=function wx(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}(e);return new ed(this.method,this.uri,"identity",this.keyFormatVersions,r)}const t=function P_(n){const e=n.split(":");let t=null;if("data"===e[0]&&2===e.length){const r=e[1].split(";"),i=r[r.length-1].split(",");if(2===i.length){const o=i[1];"base64"===i[0]?(r.splice(-1,1),t=L_(o)):t=function hx(n){const e=HT(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}(o)}}return t}(this.uri);if(t)switch(this.keyFormat){case Ms.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Ms.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function Gg(n,e,t){if(16!==n.byteLength)throw new RangeError("Invalid system id");let r,i,s;if(e){r=1,i=new Uint8Array(16*e.length);for(let u=0;u<e.length;u++){const d=e[u];if(16!==d.byteLength)throw new RangeError("Invalid key");i.set(d,16*u)}}else r=0,i=new Uint8Array;r>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),function Yk(n,...e){const t=e.length;let r=8,i=t;for(;i--;)r+=e[i].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=255&r,s.set(n,4),i=0,r=8;i<t;i++)s.set(e[i],r),r+=e[i].byteLength;return s}([112,115,115,104],new Uint8Array([r,0,0,0]),n,s,i,o,t||new Uint8Array)}(r,null,t);const i=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),s=String.fromCharCode.apply(null,Array.from(i)),o=s.substring(s.indexOf("<"),s.length),f=(new DOMParser).parseFromString(o,"text/xml").getElementsByTagName("KID")[0];if(f){const g=f.childNodes[0]?f.childNodes[0].nodeValue:f.getAttribute("VALUE");if(g){const b=L_(g).subarray(0,16);(function ol(n){const e=function(r,i,s){const o=r[i];r[i]=r[s],r[s]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)})(b),this.keyId=b}}break}default:{let r=t.subarray(0,16);if(16!==r.length){const i=new Uint8Array(16);i.set(r,16-r.length),r=i}this.keyId=r;break}}if(!this.keyId||16!==this.keyId.byteLength){let r=Hg[this.uri];if(!r){const i=Object.keys(Hg).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,i),Hg[this.uri]=r}this.keyId=r}return this}}const Sa=/\{\$([a-zA-Z0-9-_]+)\}/g;function Fh(n){return Sa.test(n)}function ar(n,e,t){if(null!==n.variableList||n.hasVariableRefs)for(let r=t.length;r--;){const i=t[r],s=e[i];s&&(e[i]=Kl(n,s))}}function Kl(n,e){if(null!==n.variableList||n.hasVariableRefs){const t=n.variableList;return e.replace(Sa,r=>{const i=r.substring(2,r.length-1),s=t?.[i];return void 0===s?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),r):s})}return e}function Gp(n,e,t){let i,s,r=n.variableList;if(r||(n.variableList=r={}),"QUERYPARAM"in e){i=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(!o.has(i))throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`);s=o.get(i)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else i=e.NAME,s=e.VALUE;i in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):r[i]=s||""}function $o(n,e,t){const r=e.IMPORT;if(t&&r in t){let i=n.variableList;i||(n.variableList=i={}),i[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}function Uh(){if(!(typeof self>"u"))return self.MediaSource||self.WebKitMediaSource}const Bh={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},td=Uh();function qc(n,e){var t;return null!=(t=td?.isTypeSupported(`${e||"video"}/mp4;codecs="${n}"`))&&t}const nd=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,rd=/#EXT-X-MEDIA:(.*)/g,$h=/^#EXT(?:INF|-X-TARGETDURATION):/m,id=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Gh=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Go{static findGroup(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(i.id===t)return i}}static convertAVC1ToAVCOTI(e){const t=e.split(".");if(t.length>2){let r=t.shift()+".";return r+=parseInt(t.shift()).toString(16),r+=("000"+parseInt(t.shift()).toString(16)).slice(-4),r}return e}static resolve(e,t){return Nh.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return $h.test(e)}static parseMasterPlaylist(e,t){const i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Fh(e)},s=[];let o;for(nd.lastIndex=0;null!=(o=nd.exec(e));)if(o[1]){var u;const f=new Ar(o[1]);ar(i,f,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const g=Kl(i,o[2]),b={attrs:f,bitrate:f.decimalInteger("AVERAGE-BANDWIDTH")||f.decimalInteger("BANDWIDTH"),name:f.NAME,url:Go.resolve(g,t)},T=f.decimalResolution("RESOLUTION");T&&(b.width=T.width,b.height=T.height),oI((f.CODECS||"").split(/[ ,]+/).filter(w=>w),b),b.videoCodec&&-1!==b.videoCodec.indexOf("avc1")&&(b.videoCodec=Go.convertAVC1ToAVCOTI(b.videoCodec)),null!=(u=b.unknownCodecs)&&u.length||s.push(b),i.levels.push(b)}else if(o[3]){const g=o[4];switch(o[3]){case"SESSION-DATA":{const b=new Ar(g);ar(i,b,["DATA-ID","LANGUAGE","VALUE","URI"]);const T=b["DATA-ID"];T&&(null===i.sessionData&&(i.sessionData={}),i.sessionData[T]=b);break}case"SESSION-KEY":{const b=$_(g,t,i);b.encrypted&&b.isSupported()?(null===i.sessionKeys&&(i.sessionKeys=[]),i.sessionKeys.push(b)):de.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${g}"`);break}case"DEFINE":{const b=new Ar(g);ar(i,b,["NAME","VALUE","QUERYPARAM"]),Gp(i,b,t)}break;case"CONTENT-STEERING":{const b=new Ar(g);ar(i,b,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:Go.resolve(b["SERVER-URI"],t),pathwayId:b["PATHWAY-ID"]||"."};break}case"START":i.startTimeOffset=G_(g)}}return i.levels=s.length>0&&s.length<i.levels.length?s:i.levels,0===i.levels.length&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,r){let i;const s={},o=r.levels,u={AUDIO:o.map(f=>({id:f.attrs.AUDIO,audioCodec:f.audioCodec})),SUBTITLES:o.map(f=>({id:f.attrs.SUBTITLES,textCodec:f.textCodec})),"CLOSED-CAPTIONS":[]};let d=0;for(rd.lastIndex=0;null!==(i=rd.exec(e));){const f=new Ar(i[1]),g=f.TYPE;if(g){const b=u[g],T=s[g]||[];s[g]=T,ar(r,f,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const w={attrs:f,bitrate:0,id:d++,groupId:f["GROUP-ID"]||"",instreamId:f["INSTREAM-ID"],name:f.NAME||f.LANGUAGE||"",type:g,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:f.LANGUAGE,url:f.URI?Go.resolve(f.URI,t):""};if(null!=b&&b.length){const x=Go.findGroup(b,w.groupId)||b[0];H_(w,x,"audioCodec"),H_(w,x,"textCodec")}T.push(w)}}return s}static parseLevelPlaylist(e,t,r,i,s,o){const u=new dx(t),d=u.fragments;let N,z,X,f=null,g=0,b=0,T=0,w=0,x=null,k=new Bp(i,t),K=-1,ie=!1;for(id.lastIndex=0,u.m3u8=e,u.hasVariableRefs=Fh(e);null!==(N=id.exec(e));){ie&&(ie=!1,k=new Bp(i,t),k.start=T,k.sn=g,k.cc=w,k.level=r,f&&(k.initSegment=f,k.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null));const We=N[1];if(We){k.duration=parseFloat(We);const ot=(" "+N[2]).slice(1);k.title=ot||null,k.tagList.push(ot?["INF",We,ot]:["INF",We])}else if(N[3]){if(en(k.duration)){k.start=T,X&&W_(k,X,u),k.sn=g,k.level=r,k.cc=w,k.urlId=s,d.push(k);const ot=(" "+N[3]).slice(1);k.relurl=Kl(u,ot),j_(k,x),x=k,T+=k.duration,g++,b=0,ie=!0}}else if(N[4]){const ot=(" "+N[4]).slice(1);x?k.setByteRange(ot,x):k.setByteRange(ot)}else if(N[5])k.rawProgramDateTime=(" "+N[5]).slice(1),k.tagList.push(["PROGRAM-DATE-TIME",k.rawProgramDateTime]),-1===K&&(K=d.length);else{if(N=N[0].match(Gh),!N){de.warn("No matches on slow regex match for level playlist!");continue}for(z=1;z<N.length&&!(typeof N[z]<"u");z++);const ot=(" "+N[z]).slice(1),Fe=(" "+N[z+1]).slice(1),Jt=N[z+2]?(" "+N[z+2]).slice(1):"";switch(ot){case"PLAYLIST-TYPE":u.type=Fe.toUpperCase();break;case"MEDIA-SEQUENCE":g=u.startSN=parseInt(Fe);break;case"SKIP":{const bt=new Ar(Fe);ar(u,bt,["RECENTLY-REMOVED-DATERANGES"]);const Bn=bt.decimalInteger("SKIPPED-SEGMENTS");if(en(Bn)){u.skippedSegments=Bn;for(let gr=Bn;gr--;)d.unshift(null);g+=Bn}const Li=bt.enumeratedString("RECENTLY-REMOVED-DATERANGES");Li&&(u.recentlyRemovedDateranges=Li.split("\t"));break}case"TARGETDURATION":u.targetduration=Math.max(parseInt(Fe),1);break;case"VERSION":u.version=parseInt(Fe);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"#":(Fe||Jt)&&k.tagList.push(Jt?[Fe,Jt]:[Fe]);break;case"DISCONTINUITY":w++,k.tagList.push(["DIS"]);break;case"GAP":k.gap=!0,k.tagList.push([ot]);break;case"BITRATE":k.tagList.push([ot,Fe]);break;case"DATERANGE":{const bt=new Ar(Fe);ar(u,bt,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),ar(u,bt,bt.clientAttrs);const Bn=new $T(bt,u.dateRanges[bt.ID]);Bn.isValid||u.skippedSegments?u.dateRanges[Bn.id]=Bn:de.warn(`Ignoring invalid DATERANGE tag: "${Fe}"`),k.tagList.push(["EXT-X-DATERANGE",Fe]);break}case"DEFINE":{const bt=new Ar(Fe);ar(u,bt,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in bt?$o(u,bt,o):Gp(u,bt,t)}break;case"DISCONTINUITY-SEQUENCE":w=parseInt(Fe);break;case"KEY":{const bt=$_(Fe,t,u);if(bt.isSupported()){if("NONE"===bt.method){X=void 0;break}X||(X={}),X[bt.keyFormat]&&(X=di({},X)),X[bt.keyFormat]=bt}else de.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${Fe}"`);break}case"START":u.startTimeOffset=G_(Fe);break;case"MAP":{const bt=new Ar(Fe);if(ar(u,bt,["BYTERANGE","URI"]),k.duration){const Bn=new Bp(i,t);z_(Bn,bt,r,X),f=Bn,k.initSegment=f,f.rawProgramDateTime&&!k.rawProgramDateTime&&(k.rawProgramDateTime=f.rawProgramDateTime)}else z_(k,bt,r,X),f=k,ie=!0;break}case"SERVER-CONTROL":{const bt=new Ar(Fe);u.canBlockReload=bt.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=bt.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&bt.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=bt.optionalFloat("PART-HOLD-BACK",0),u.holdBack=bt.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const bt=new Ar(Fe);u.partTarget=bt.decimalFloatingPoint("PART-TARGET");break}case"PART":{let bt=u.partList;bt||(bt=u.partList=[]);const Bn=b>0?bt[bt.length-1]:void 0,Li=b++,gr=new Ar(Fe);ar(u,gr,["BYTERANGE","URI"]);const dt=new cx(gr,k,t,Li,Bn);bt.push(dt),k.duration+=dt.duration;break}case"PRELOAD-HINT":{const bt=new Ar(Fe);ar(u,bt,["URI"]),u.preloadHint=bt;break}case"RENDITION-REPORT":{const bt=new Ar(Fe);ar(u,bt,["URI"]),u.renditionReports=u.renditionReports||[],u.renditionReports.push(bt);break}default:de.warn(`line parsed but not handled: ${N}`)}}}x&&!x.relurl?(d.pop(),T-=x.duration,u.partList&&(u.fragmentHint=x)):u.partList&&(j_(k,x),k.cc=w,u.fragmentHint=k,X&&W_(k,X,u));const le=d.length,Me=d[0],Ie=d[le-1];if(T+=u.skippedSegments*u.targetduration,T>0&&le&&Ie){u.averagetargetduration=T/le;const We=Ie.sn;u.endSN="initSegment"!==We?We:0,u.live||(Ie.endList=!0),Me&&(u.startCC=Me.cc)}else u.endSN=0,u.startCC=0;return u.fragmentHint&&(T+=u.fragmentHint.duration),u.totalduration=T,u.endCC=w,K>0&&function aI(n,e){let t=n[e];for(let r=e;r--;){const i=n[r];if(!i)return;i.programDateTime=t.programDateTime-1e3*i.duration,t=i}}(d,K),u}}function $_(n,e,t){var r,i;const s=new Ar(n);ar(t,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const o=null!=(r=s.METHOD)?r:"",u=s.URI,d=s.hexadecimalInteger("IV"),f=s.KEYFORMATVERSIONS,g=null!=(i=s.KEYFORMAT)?i:"identity";u&&s.IV&&!d&&de.error(`Invalid IV: ${s.IV}`);const b=u?Go.resolve(u,e):"",T=(f||"1").split("/").map(Number).filter(Number.isFinite);return new ed(o,b,g,T,d)}function G_(n){const t=new Ar(n).decimalFloatingPoint("TIME-OFFSET");return en(t)?t:null}function oI(n,e){["video","audio","text"].forEach(t=>{const r=n.filter(i=>function Vh(n,e){const t=Bh[e];return!!t&&!0===t[n.slice(0,4)]}(i,t));if(r.length){const i=r.filter(s=>0===s.lastIndexOf("avc1",0)||0===s.lastIndexOf("mp4a",0));e[`${t}Codec`]=i.length>0?i[0]:r[0],n=n.filter(s=>-1===r.indexOf(s))}}),e.unknownCodecs=n}function H_(n,e,t){const r=e[t];r&&(n[t]=r)}function j_(n,e){n.rawProgramDateTime?n.programDateTime=Date.parse(n.rawProgramDateTime):null!=e&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime),en(n.programDateTime)||(n.programDateTime=null,n.rawProgramDateTime=null)}function z_(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function W_(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&r.push(n)}var Zn={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},un={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function K_(n){const{type:e}=n;switch(e){case Zn.AUDIO_TRACK:return un.AUDIO;case Zn.SUBTITLE_TRACK:return un.SUBTITLE;default:return un.MAIN}}function q_(n,e){let t=n.url;return(void 0===t||0===t.indexOf("data:"))&&(t=e.url),t}class Sx{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.LEVEL_LOADING,this.onLevelLoading,this),e.on(F.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(F.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.LEVEL_LOADING,this.onLevelLoading,this),e.off(F.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(F.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,o=new(t.pLoader||t.loader)(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Zn.MANIFEST,url:r,deliveryDirectives:null})}onLevelLoading(e,t){const{id:r,level:i,url:s,deliveryDirectives:o}=t;this.load({id:r,level:i,responseType:"text",type:Zn.LEVEL,url:s,deliveryDirectives:o})}onAudioTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:Zn.AUDIO_TRACK,url:s,deliveryDirectives:o})}onSubtitleTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:Zn.SUBTITLE_TRACK,url:s,deliveryDirectives:o})}load(e){var t;const r=this.hls.config;let s,i=this.getInternalLoader(e);if(i){const f=i.context;if(f&&f.url===e.url)return void de.trace("[playlist-loader]: playlist request ongoing");de.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}if(s=e.type===Zn.MANIFEST?r.manifestLoadPolicy.default:di({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),null!=(t=e.deliveryDirectives)&&t.part){let f;if(e.type===Zn.LEVEL&&null!==e.level?f=this.hls.levels[e.level].details:e.type===Zn.AUDIO_TRACK&&null!==e.id?f=this.hls.audioTracks[e.id].details:e.type===Zn.SUBTITLE_TRACK&&null!==e.id&&(f=this.hls.subtitleTracks[e.id].details),f){const g=f.partTarget,b=f.targetduration;if(g&&b){const T=1e3*Math.max(3*g,.8*b);s=di({},s,{maxTimeToFirstByteMs:Math.min(T,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(T,s.maxTimeToFirstByteMs)})}}}const o=s.errorRetry||s.timeoutRetry||{};i.load(e,{loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},{onSuccess:(f,g,b,T)=>{const w=this.getInternalLoader(b);this.resetInternalLoader(b.type);const x=f.data;0===x.indexOf("#EXTM3U")?(g.parsing.start=performance.now(),Go.isMediaPlaylist(x)?this.handleTrackOrLevelPlaylist(f,g,b,T||null,w):this.handleMasterPlaylist(f,g,b,T)):this.handleManifestParsingError(f,b,new Error("no EXTM3U delimiter"),T||null,g)},onError:(f,g,b,T)=>{this.handleNetworkError(g,b,!1,f,T)},onTimeout:(f,g,b)=>{this.handleNetworkError(g,b,!0,void 0,f)}})}handleMasterPlaylist(e,t,r,i){const s=this.hls,o=e.data,u=q_(e,r),d=Go.parseMasterPlaylist(o,u);if(d.playlistParsingError)return void this.handleManifestParsingError(e,r,d.playlistParsingError,i,t);const{contentSteering:f,levels:g,sessionData:b,sessionKeys:T,startTimeOffset:w,variableList:x}=d;this.variableList=x;const{AUDIO:k=[],SUBTITLES:N,"CLOSED-CAPTIONS":z}=Go.parseMasterPlaylistMedia(o,u,d);k.length&&!k.some(K=>!K.url)&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(de.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),k.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ar({}),bitrate:0,url:""})),s.trigger(F.MANIFEST_LOADED,{levels:g,audioTracks:k,subtitles:N,captions:z,contentSteering:f,url:u,stats:t,networkDetails:i,sessionData:b,sessionKeys:T,startTimeOffset:w,variableList:x})}handleTrackOrLevelPlaylist(e,t,r,i,s){const o=this.hls,{id:u,level:d,type:f}=r,g=q_(e,r),b=en(u)?u:0,T=en(d)?d:b,w=K_(r),x=Go.parseLevelPlaylist(e.data,g,T,w,b,this.variableList);if(f===Zn.MANIFEST){const k={attrs:new Ar({}),bitrate:0,details:x,name:"",url:g};o.trigger(F.MANIFEST_LOADED,{levels:[k],audioTracks:[],url:g,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=x,this.handlePlaylistLoaded(x,e,t,r,i,s)}handleManifestParsingError(e,t,r,i,s){this.hls.trigger(F.ERROR,{type:ln.NETWORK_ERROR,details:Ne.MANIFEST_PARSING_ERROR,fatal:t.type===Zn.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,r=!1,i,s){let o=`A network ${r?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===Zn.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===Zn.AUDIO_TRACK||e.type===Zn.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(o);de.warn(`[playlist-loader]: ${o}`);let d=Ne.UNKNOWN,f=!1;const g=this.getInternalLoader(e);switch(e.type){case Zn.MANIFEST:d=r?Ne.MANIFEST_LOAD_TIMEOUT:Ne.MANIFEST_LOAD_ERROR,f=!0;break;case Zn.LEVEL:d=r?Ne.LEVEL_LOAD_TIMEOUT:Ne.LEVEL_LOAD_ERROR,f=!1;break;case Zn.AUDIO_TRACK:d=r?Ne.AUDIO_TRACK_LOAD_TIMEOUT:Ne.AUDIO_TRACK_LOAD_ERROR,f=!1;break;case Zn.SUBTITLE_TRACK:d=r?Ne.SUBTITLE_TRACK_LOAD_TIMEOUT:Ne.SUBTITLE_LOAD_ERROR,f=!1}g&&this.resetInternalLoader(e.type);const b={type:ln.NETWORK_ERROR,details:d,fatal:f,url:e.url,loader:g,context:e,error:u,networkDetails:t,stats:s};i&&(b.response=hs({url:t?.url||e.url,data:void 0},i)),this.hls.trigger(F.ERROR,b)}handlePlaylistLoaded(e,t,r,i,s,o){const u=this.hls,{type:d,level:f,id:g,groupId:b,deliveryDirectives:T}=i,w=q_(t,i),x=K_(i),k="number"==typeof i.level&&x===un.MAIN?f:void 0;if(!e.fragments.length){const z=new Error("No Segments found in Playlist");return void u.trigger(F.ERROR,{type:ln.NETWORK_ERROR,details:Ne.LEVEL_EMPTY_ERROR,fatal:!1,url:w,error:z,reason:z.message,response:t,context:i,level:k,parent:x,networkDetails:s,stats:r})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const N=e.playlistParsingError;if(N)u.trigger(F.ERROR,{type:ln.NETWORK_ERROR,details:Ne.LEVEL_PARSING_ERROR,fatal:!1,url:w,error:N,reason:N.message,response:t,context:i,level:k,parent:x,networkDetails:s,stats:r});else switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),d){case Zn.MANIFEST:case Zn.LEVEL:u.trigger(F.LEVEL_LOADED,{details:e,level:k||0,id:g||0,stats:r,networkDetails:s,deliveryDirectives:T});break;case Zn.AUDIO_TRACK:u.trigger(F.AUDIO_TRACK_LOADED,{details:e,id:g||0,groupId:b||"",stats:r,networkDetails:s,deliveryDirectives:T});break;case Zn.SUBTITLE_TRACK:u.trigger(F.SUBTITLE_TRACK_LOADED,{details:e,id:g||0,groupId:b||"",stats:r,networkDetails:s,deliveryDirectives:T})}}}function jg(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function zg(n,e){const t=n.mode;if("disabled"===t&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){de.debug(`[texttrack-utils]: ${r}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,n.addCue(i)}catch(i){de.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}"disabled"===t&&(n.mode=t)}function Hh(n){const e=n.mode;if("disabled"===e&&(n.mode="hidden"),n.cues)for(let t=n.cues.length;t--;)n.removeCue(n.cues[t]);"disabled"===e&&(n.mode=e)}function jh(n,e,t,r){const i=n.mode;if("disabled"===i&&(n.mode="hidden"),n.cues&&n.cues.length>0){const s=function Y_(n,e,t){const r=[],i=function Wg(n,e){if(e<n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,i=t;for(;r<=i;){const s=Math.floor((i+r)/2);if(e<n[s].startTime)i=s-1;else{if(!(e>n[s].startTime&&r<t))return s;r=s+1}}return n[r].startTime-e<e-n[i].startTime?r:i}(n,e);if(i>-1)for(let s=i,o=n.length;s<o;s++){const u=n[s];if(u.startTime>=e&&u.endTime<=t)r.push(u);else if(u.startTime>t)return r}return r}(n.cues,e,t);for(let o=0;o<s.length;o++)(!r||r(s[o]))&&n.removeCue(s[o])}"disabled"===i&&(n.mode=i)}var Da_emsg="https://aomedia.org/emsg/ID3";function Hp(){if(!(typeof self>"u"))return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}const jp=(()=>{const n=Hp();try{new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function Kg(n,e){return n.getTime()/1e3-e}function Q_(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class lI{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(F.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(F.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(F.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(F.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(Hh(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if("metadata"===r.kind&&"id3"===r.label)return jg(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:i}}}=this;if(!r&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Hp();for(let u=0;u<s.length;u++){const d=s[u].type;if(d===Da_emsg&&!r||!i)continue;const f=ll(s[u].data);if(f){const g=s[u].pts;let b=g+s[u].duration;b>jp&&(b=jp),b-g<=0&&(b=g+.25);for(let w=0;w<f.length;w++){const x=f[w];if(!F_(x)){this.updateId3CueEnds(g,d);const k=new o(g,b,"");k.value=x,d&&(k.type=d),this.id3Track.addCue(k)}}}}}updateId3CueEnds(e,t){var r;const i=null==(r=this.id3Track)?void 0:r.cues;if(i)for(let s=i.length;s--;){const o=i[s];o.type===t&&o.startTime<e&&o.endTime===jp&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:i}){const{id3Track:s,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:d}}=o;if(s&&(u||d)){let f;f="audio"===i?g=>"org.id3"===g.type&&d:"video"===i?g=>g.type===Da_emsg&&u:g=>"org.id3"===g.type&&d||g.type===Da_emsg&&u,jh(s,t,r,f)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:r,id3Track:i}=this,{dateRanges:s}=t,o=Object.keys(s);if(i){const g=Object.keys(r).filter(b=>!o.includes(b));for(let b=g.length;b--;){const T=g[b];Object.keys(r[T].cues).forEach(w=>{i.removeCue(r[T].cues[w])}),delete r[T]}}const u=t.fragments[t.fragments.length-1];if(0===o.length||!en(u?.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const d=u.programDateTime/1e3-u.start,f=Hp();for(let g=0;g<o.length;g++){const b=o[g],T=s[b],w=r[b],x=w?.cues||{};let k=w?.durationKnown||!1;const N=Kg(T.startDate,d);let z=jp;const X=T.endDate;if(X)z=Kg(X,d),k=!0;else if(T.endOnNext&&!k){const ie=o.reduce((le,Me)=>{const Ie=s[Me];return Ie.class===T.class&&Ie.id!==Me&&Ie.startDate>T.startDate&&le.push(Ie),le},[]).sort((le,Me)=>le.startDate.getTime()-Me.startDate.getTime())[0];ie&&(z=Kg(ie.startDate,d),k=!0)}const K=Object.keys(T.attr);for(let ie=0;ie<K.length;ie++){const le=K[ie];if("ID"===(n=le)||"CLASS"===n||"START-DATE"===n||"DURATION"===n||"END-DATE"===n||"END-ON-NEXT"===n)continue;let Me=x[le];if(Me)k&&!w.durationKnown&&(Me.endTime=z);else{let Ie=T.attr[le];Me=new f(N,z,""),lx(le)&&(Ie=Q_(Ie)),Me.value={key:le,data:Ie},Me.type="com.apple.quicktime.HLS",Me.id=b,this.id3Track.addCue(Me),x[le]=Me}}r[b]={cues:x,dateRange:T,durationKnown:k}}var n}}class cI{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(null===e)return null;const{holdBack:t,partHoldBack:r,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:u}=this.config,d=this.hls.userConfig;let f=u&&r||t;return(d.liveSyncDuration||d.liveSyncDurationCount||0===f)&&(f=void 0!==s?s:o*i),f+Math.min(1*this.stallCount,i)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(null===e||null===t||null===r)return null;const i=r.edge,u=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(i-r.totalduration,e-t-this.edgeStalled),u)}get drift(){const{levelDetails:e}=this;return null===e?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;return null===e?0:Math.max(e.age-3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration),0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(F.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(F.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(F.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(F.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(F.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(F.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var r;t.details===Ne.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(r=this.levelDetails)&&r.live&&de.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(null===r)return;this._latency=r;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:s}=this.config;if(!i||1===s)return;const o=this.targetLatency;if(null===o)return;const u=r-o,d=Math.min(this.maxLatency,o+t.targetduration);if(t.live&&u<d&&u>.05&&this.forwardBufferLength>1){const g=Math.min(2,Math.max(1,s)),b=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20;e.playbackRate=Math.min(g,Math.max(1,b))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}const zp=["NONE","TYPE-0","TYPE-1",null];var zh_No="",zh_Yes="YES",zh_v2="v2";class X_{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Wh{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>t).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){const t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}get audioGroupId(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}get textGroupId(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}}function qg(n,e){const t=e.startPTS;if(en(t)){let i,r=0;e.sn>n.sn?(r=t-n.start,i=n):(r=n.start-t,i=e),i.duration!==r&&(i.duration=r)}else e.start=e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?n.start+(n.minEndPTS-n.start):n.start+n.duration:Math.max(n.start-e.duration,0)}function J_(n,e,t,r,i,s){r-t<=0&&(de.warn("Fragment should have a positive duration",e),r=t+e.duration,s=i+e.duration);let u=t,d=r;const f=e.startPTS,g=e.endPTS;if(en(f)){const N=Math.abs(f-t);e.deltaPTS=en(e.deltaPTS)?Math.max(N,e.deltaPTS):N,u=Math.max(t,f),t=Math.min(t,f),i=Math.min(i,e.startDTS),d=Math.min(r,g),r=Math.max(r,g),s=Math.max(s,e.endDTS)}const b=t-e.start;0!==e.start&&(e.start=t),e.duration=r-e.start,e.startPTS=t,e.maxStartPTS=u,e.startDTS=i,e.endPTS=r,e.minEndPTS=d,e.endDTS=s;const T=e.sn;if(!n||T<n.startSN||T>n.endSN)return 0;let w;const x=T-n.startSN,k=n.fragments;for(k[x]=e,w=x;w>0;w--)qg(k[w],k[w-1]);for(w=x;w<k.length-1;w++)qg(k[w],k[w+1]);return n.fragmentHint&&qg(k[k.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,b}function Yg(n,e){const t=e.startSN+e.skippedSegments-n.startSN,r=n.fragments;t<0||t>=r.length||Zg(e,r[t].start)}function Zg(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].start+=e;n.fragmentHint&&(n.fragmentHint.start+=e)}}function ev(n,e,t){var r;return null!=n&&n.details?tv(null==(r=n.details)?void 0:r.partList,e,t):null}function tv(n,e,t){if(n)for(let r=n.length;r--;){const i=n[r];if(i.index===t&&i.fragment.sn===e)return i}return null}function Wp(n){switch(n.details){case Ne.FRAG_LOAD_TIMEOUT:case Ne.KEY_LOAD_TIMEOUT:case Ne.LEVEL_LOAD_TIMEOUT:case Ne.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function nv(n,e){const t=Wp(e);return n.default[(t?"timeout":"error")+"Retry"]}function Qg(n,e){const t="linear"===n.backoff?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function Kp(n){return hs(hs({},n),{errorRetry:null,timeoutRetry:null})}function Aa(n,e,t,r){return!!n&&e<n.maxNumRetry&&(function xx(n){return 0===n&&!1===navigator.onLine||!!n&&(n<400||n>499)}(r)||!!t)}const mI={search:function(n,e){let t=0,r=n.length-1,i=null,s=null;for(;t<=r;){i=(t+r)/2|0,s=n[i];const o=e(s);if(o>0)t=i+1;else{if(!(o<0))return s;r=i-1}}return null}};function xa(n,e,t=0,r=0){let i=null;if(n?i=e[n.sn-e[0].sn+1]||null:0===t&&0===e[0].start&&(i=e[0]),i&&0===qp(t,r,i))return i;const s=mI.search(e,qp.bind(null,t,r));return!s||s===n&&i?i:s}function qp(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function Cx(n,e,t){const r=1e3*Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return(t.endProgramDateTime||0)-r>n}const Zk=3e5;function gI(n,e,t){if(performance.now()-n.lastErrorPerfMs>Zk)return!0;const r=n.details;if(e.details===Ne.FRAG_GAP&&r&&e.frag){const s=xa(null,r.fragments,e.frag.start);if(s&&!s.gap)return!0}if(t&&n.errors.length<t.errors.length){const i=n.errors[n.errors.length-1];if(r&&i.frag&&e.frag&&Math.abs(i.frag.start-e.frag.start)>3*r.targetduration)return!0}return!1}class sv{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=de.log.bind(de,`${t}:`),this.warn=de.warn.bind(de,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t){const r=t?.renditionReports;if(r){let i=-1;for(let s=0;s<r.length;s++){const o=r[s];let u;try{u=new self.URL(o.URI,t.url).href}catch(d){de.warn(`Could not construct new URL for Rendition Report: ${d}`),u=o.URI||""}if(u===e){i=s;break}u===e.substring(0,u.length)&&(i=s)}if(-1!==i){const s=r[i],o=parseInt(s["LAST-MSN"])||t?.lastPartSn;let u=parseInt(s["LAST-PART"])||t?.lastPartIndex;if(this.hls.config.lowLatencyMode){const d=Math.min(t.age-t.partTarget,t.targetduration);u>=0&&d>t.partTarget&&(u+=1)}return new X_(o,u>=0?u:void 0,zh_No)}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,r){const{details:i,stats:s}=t,o=self.performance.now(),u=s.loading.first?Math.max(0,o-s.loading.first):0;if(i.advancedDateTime=Date.now()-u,i.live||null!=r&&r.live){if(i.reloaded(r),r&&this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),r&&i.fragments.length>0&&function Ax(n,e){let t=null;const r=n.fragments;for(let d=r.length-1;d>=0;d--){const f=r[d].initSegment;if(f){t=f;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let s,i=0;if(function hI(n,e,t){const r=e.skippedSegments,i=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let f=i;f<=s;f++){const g=d[o+f];let b=u[f];r&&!b&&f<r&&(b=e.fragments[f]=g),g&&b&&t(g,b)}}(n,e,(d,f)=>{d.relurl&&(i=d.cc-f.cc),en(d.startPTS)&&en(d.endPTS)&&(f.start=f.startPTS=d.startPTS,f.startDTS=d.startDTS,f.maxStartPTS=d.maxStartPTS,f.endPTS=d.endPTS,f.endDTS=d.endDTS,f.minEndPTS=d.minEndPTS,f.duration=d.endPTS-d.startPTS,f.duration&&(s=f),e.PTSKnown=e.alignedSliding=!0),f.elementaryStreams=d.elementaryStreams,f.loader=d.loader,f.stats=d.stats,f.urlId=d.urlId,d.initSegment&&(f.initSegment=d.initSegment,t=d.initSegment)}),t&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(f=>{var g;(!f.initSegment||f.initSegment.relurl===(null==(g=t)?void 0:g.relurl))&&(f.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(d=>!d),e.deltaUpdateFailed){de.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let d=e.skippedSegments;d--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=function uI(n,e,t){const r=di({},n);return t&&t.forEach(i=>{delete r[i]}),Object.keys(e).forEach(i=>{const s=new $T(e[i].attr,r[i]);s.isValid?r[i]=s:de.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[i].attr)}"`)}),r}(n.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const o=e.fragments;if(i){de.warn("discontinuity sliding from playlist, take drift into account");for(let d=0;d<o.length;d++)o[d].cc+=i}e.skippedSegments&&(e.startCC=e.fragments[0].cc),function dI(n,e,t){if(n&&e){let r=0;for(let i=0,s=n.length;i<=s;i++){const o=n[i],u=e[i+r];o&&u&&o.index===u.index&&o.fragment.sn===u.fragment.sn?t(o,u):r--}}}(n.partList,e.partList,(d,f)=>{f.elementaryStreams=d.elementaryStreams,f.stats=d.stats}),s?J_(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):Yg(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const d=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=d),e.driftEndTime=u,e.driftEnd=d}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime}(r,i),!this.canLoad||!i.live)return;let d,f,g;if(i.canBlockReload&&i.endSN&&i.advanced){const N=this.hls.config.lowLatencyMode,z=i.lastPartSn,X=i.endSN,K=i.lastPartIndex,le=z===X;-1!==K?(f=le?X+1:z,g=le?N?0:K:K+1):f=X+1;const Ie=i.age;let ot=Math.min(Ie+i.ageHeader-i.partTarget,1.5*i.targetduration);if(ot>0){if(r&&ot>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${ot} with playlist age: ${i.age}`),ot=0;else{const Fe=Math.floor(ot/i.targetduration);f+=Fe,void 0!==g&&(g+=Math.round(ot%i.targetduration/i.partTarget)),this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${Ie.toFixed(2)}s goal: ${ot} skip sn ${Fe} to part ${g}`)}i.tuneInGoal=ot}if(d=this.getDeliveryDirectives(i,t.deliveryDirectives,f,g),N||!le)return void this.loadPlaylist(d)}else(i.canBlockReload||i.canSkipUntil)&&(d=this.getDeliveryDirectives(i,t.deliveryDirectives,f,g));const b=this.hls.mainForwardBufferInfo,x=function fI(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&4*t>e){const s=1e3*r[r.length-1].duration;s<t&&(t=s)}}else t/=2;return Math.round(t)}(i,1e3*(i.edge-(b?b.end-b.len:0)));i.updated&&o>this.requestScheduled+x&&(this.requestScheduled=s.loading.start),void 0!==f&&i.canBlockReload?this.requestScheduled=s.loading.first+x-(1e3*i.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+x<o?this.requestScheduled=o:this.requestScheduled-o<=0&&(this.requestScheduled+=x);let k=this.requestScheduled-o;k=Math.max(0,k),this.log(`reload live playlist ${e} in ${Math.round(k)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(d),k)}else this.clearTimer()}getDeliveryDirectives(e,t,r,i){let s=function Dx(n,e){const{canSkipUntil:t,canSkipDateRanges:r,endSN:i}=n;return t&&(void 0!==e?e-i:0)<t?r?zh_v2:zh_Yes:zh_No}(e,r);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,s=zh_No),new X_(r,i,s)}checkRetry(e){const t=e.details,r=Wp(e),i=e.errorAction,{action:s,retryCount:o=0,retryConfig:u}=i||{},d=!!i&&!!u&&(5===s||!i.resolved&&2===s);if(d){var f;if(this.requestScheduled=-1,o>=u.maxNumRetry)return!1;if(r&&null!=(f=e.context)&&f.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const g=Qg(u,o);this.timer=self.setTimeout(()=>this.loadPlaylist(),g),this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" in ${g}ms`)}e.levelRetry=!0,i.resolved=!0}return d}}let hi;class yI extends sv{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(F.LEVEL_LOADED,this.onLevelLoaded,this),e.on(F.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(F.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(F.FRAG_LOADED,this.onFragLoaded,this),e.on(F.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(F.LEVEL_LOADED,this.onLevelLoaded,this),e.off(F.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(F.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(F.FRAG_LOADED,this.onFragLoaded,this),e.off(F.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=[],i={};let s;t.levels.forEach(o=>{var u;const d=o.attrs;-1!==(null==(u=o.audioCodec)?void 0:u.indexOf("mp4a.40.34"))&&(hi||(hi=/chrome|firefox/i.test(navigator.userAgent)),hi&&(o.audioCodec=void 0));const{AUDIO:f,CODECS:g,"FRAME-RATE":b,"PATHWAY-ID":T,RESOLUTION:w,SUBTITLES:x}=d,N=`${T||"."}-${o.bitrate}-${w}-${b}-${g}`;s=i[N],s?s.addFallback(o):(s=new Wh(o),i[N]=s,r.push(s)),Xg(s,"audio",f),Xg(s,"text",x)}),this.filterAndSortMediaOptions(r,t)}filterAndSortMediaOptions(e,t){let r=[],i=[],s=!1,o=!1,u=!1,d=e.filter(({audioCodec:w,videoCodec:x,width:k,height:N,unknownCodecs:z})=>(s||(s=!(!k||!N)),o||(o=!!x),u||(u=!!w),!(null!=z&&z.length)&&(!w||qc(w,"audio"))&&(!x||qc(x,"video"))));if((s||o)&&u&&(d=d.filter(({videoCodec:w,width:x,height:k})=>!!w||!(!x||!k))),0===d.length)return void Promise.resolve().then(()=>{if(this.hls){const w=new Error("no level with compatible codecs found in manifest");this.hls.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:w,reason:w.message})}});t.audioTracks&&(r=t.audioTracks.filter(w=>!w.audioCodec||qc(w.audioCodec,"audio")),_I(r)),t.subtitles&&(i=t.subtitles,_I(i));const f=d.slice(0);d.sort((w,x)=>w.attrs["HDCP-LEVEL"]!==x.attrs["HDCP-LEVEL"]?(w.attrs["HDCP-LEVEL"]||"")>(x.attrs["HDCP-LEVEL"]||"")?1:-1:w.bitrate!==x.bitrate?w.bitrate-x.bitrate:w.attrs["FRAME-RATE"]!==x.attrs["FRAME-RATE"]?w.attrs.decimalFloatingPoint("FRAME-RATE")-x.attrs.decimalFloatingPoint("FRAME-RATE"):w.attrs.SCORE!==x.attrs.SCORE?w.attrs.decimalFloatingPoint("SCORE")-x.attrs.decimalFloatingPoint("SCORE"):s&&w.height!==x.height?w.height-x.height:0);let g=f[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==f.length))for(let w=0;w<f.length;w++)if(f[w].pathwayId===d[0].pathwayId){g=f[w];break}this._levels=d;for(let w=0;w<d.length;w++)if(d[w]===g){this._firstLevel=w,this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${g.bitrate}`);break}const T={levels:d,audioTracks:r,subtitleTracks:i,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:u,video:o,altAudio:!(u&&!o)&&r.some(w=>!!w.url)};this.hls.trigger(F.MANIFEST_PARSED,T),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const g=new Error("invalid level idx"),b=e<0;if(this.hls.trigger(F.ERROR,{type:ln.OTHER_ERROR,details:Ne.LEVEL_SWITCH_ERROR,level:e,fatal:b,error:g,reason:g.message}),b)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,o=t[e],u=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&o.details&&i&&s===u)return;this.log(`Switching to level ${e}${u?" with Pathway "+u:""} from level ${r}${s?" with Pathway "+s:""}`);const d=di({},o,{level:e,maxBitrate:o.maxBitrate,attrs:o.attrs,uri:o.uri,urlId:o.urlId});delete d._attrs,delete d._urlId,this.hls.trigger(F.LEVEL_SWITCHING,d);const f=o.details;if(!f||f.live){const g=this.switchParams(o.uri,i?.details);this.loadPlaylist(g)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===Zn.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragLoaded(e,{frag:t}){if(void 0!==t&&t.type===un.MAIN){const r=this._levels[t.level];void 0!==r&&(r.loadError=0)}}onLevelLoaded(e,t){var r;const{level:i,details:s}=t,o=this._levels[i];var u;if(!o)return this.warn(`Invalid level index ${i}`),void(null!=(u=t.deliveryDirectives)&&u.skip&&(s.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===o.fragmentError&&(o.loadError=0),this.playlistLoaded(i,t,o.details)):null!=(r=t.deliveryDirectives)&&r.skip&&(s.deltaUpdateFailed=!0)}onAudioTrackSwitched(e,t){const r=this.currentLevel;if(!r)return;const i=this.hls.audioTracks[t.id].groupId;if(r.audioGroupIds&&r.audioGroupId!==i){let s=-1;for(let o=0;o<r.audioGroupIds.length;o++)if(r.audioGroupIds[o]===i){s=o;break}-1!==s&&s!==r.urlId&&(r.urlId=s,this.canLoad&&this.startLoad())}}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){const i=r.urlId;let s=r.uri;if(e)try{s=e.addDirectives(s)}catch(u){this.warn(`Could not construct new URL with HLS Delivery Directives: ${u}`)}const o=r.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${void 0!==e?.msn?" at sn "+e.msn+" part "+e.part:""} with${o?" Pathway "+o:""} URI ${i+1}/${r.url.length} ${s}`),this.clearTimer(),this.hls.trigger(F.LEVEL_LOADING,{url:s,level:t,id:i,deliveryDirectives:e||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e,t){const r=(s,o)=>o!==t,i=this._levels.filter((s,o)=>o!==e||(s.url.length>1&&void 0!==t?(s.url=s.url.filter(r),s.audioGroupIds&&(s.audioGroupIds=s.audioGroupIds.filter(r)),s.textGroupIds&&(s.textGroupIds=s.textGroupIds.filter(r)),s.urlId=0,!0):(this.steering&&this.steering.removeLevel(s),!1)));this.hls.trigger(F.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){t.forEach((r,i)=>{const{details:s}=r;null!=s&&s.fragments&&s.fragments.forEach(o=>{o.level=i})}),this._levels=t}}function Xg(n,e,t){t&&("audio"===e?(n.audioGroupIds||(n.audioGroupIds=[]),n.audioGroupIds[n.url.length-1]=t):"text"===e&&(n.textGroupIds||(n.textGroupIds=[]),n.textGroupIds[n.url.length-1]=t))}function _I(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}class Mx{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(F.BUFFER_APPENDED,this.onBufferAppended,this),e.on(F.FRAG_BUFFERED,this.onFragBuffered,this),e.on(F.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(F.BUFFER_APPENDED,this.onBufferAppended,this),e.off(F.FRAG_BUFFERED,this.onFragBuffered,this),e.off(F.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let i=r.length;i--;){const s=r[i];if(!s)break;const o=s.end;if(s.start<=e&&null!==o&&e<=o)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:r}=this,i=Object.keys(r);for(let s=i.length;s--;){const o=r[i[s]];if(o?.body.type===t&&o.buffered){const u=o.body;if(u.start<=e&&e<=u.end)return u}}return null}detectEvictedFragments(e,t,r,i){this.timeRanges&&(this.timeRanges[e]=t);const s=i?.fragment.sn||-1;Object.keys(this.fragments).forEach(o=>{const u=this.fragments[o];if(!u||s>=u.body.sn)return;if(!u.buffered&&!u.loaded)return void(u.body.type===r&&this.removeFragment(u.body));const d=u.range[e];d&&d.time.some(f=>{const g=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return g&&this.removeFragment(u.body),g})})}detectPartialFragments(e){const t=this.timeRanges,{frag:r,part:i}=e;if(!t||"initSegment"===r.sn)return;const s=sd(r),o=this.fragments[s];if(!o||o.buffered&&r.gap)return;const u=!r.relurl;Object.keys(t).forEach(d=>{const f=r.elementaryStreams[d];f&&(o.range[d]=this.getBufferedTimes(r,i,u||!0===f.partial,t[d]))}),o.loaded=null,Object.keys(o.range).length?(o.buffered=!0,(o.body.endList=r.endList||o.body.endList)&&(this.endListFragments[o.body.type]=o),Yp(o)||this.removeParts(r.sn-1,r.type)):this.removeFragment(o.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter(i=>i.fragment.sn>=e))}fragBuffered(e,t){const r=sd(e);let i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,r,i){const s={time:[],partial:r},o=e.start,u=e.end,d=e.minEndPTS||u,f=e.maxStartPTS||o;for(let g=0;g<i.length;g++){const b=i.start(g)-this.bufferPadding,T=i.end(g)+this.bufferPadding;if(f>=b&&d<=T){s.time.push({startPTS:Math.max(o,i.start(g)),endPTS:Math.min(u,i.end(g))});break}if(o<T&&u>b)s.partial=!0,s.time.push({startPTS:Math.max(o,i.start(g)),endPTS:Math.min(u,i.end(g))});else if(u<=b)break}return s}getPartialFragment(e){let r,i,s,t=null,o=0;const{bufferPadding:u,fragments:d}=this;return Object.keys(d).forEach(f=>{const g=d[f];g&&Yp(g)&&(i=g.body.start-u,s=g.body.end+u,e>=i&&e<=s&&(r=Math.min(e-i,s-e),o<=r&&(t=g.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||Yp(t))}getState(e){const t=sd(e),r=this.fragments[t];return r?r.buffered?Yp(r)?"PARTIAL":"OK":"APPENDING":"NOT_LOADED"}isTimeBuffered(e,t,r){let i,s;for(let o=0;o<r.length;o++){if(i=r.start(o)-this.bufferPadding,s=r.end(o)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onFragLoaded(e,t){const{frag:r,part:i}=t;if("initSegment"===r.sn||r.bitrateTest)return;const s=i?null:t,o=sd(r);this.fragments[o]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:i,timeRanges:s}=t;if("initSegment"===r.sn)return;const o=r.type;if(i){let u=this.activePartLists[o];u||(this.activePartLists[o]=u=[]),u.push(i)}this.timeRanges=s,Object.keys(s).forEach(u=>{this.detectEvictedFragments(u,s[u],o,i)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=sd(e);return!!this.fragments[t]}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,r,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const u=this.fragments[o];if(!u)return;const d=u.body;d.type!==r||i&&!d.gap||d.start<t&&d.end>e&&(u.buffered||s)&&this.removeFragment(d)})}removeFragment(e){const t=sd(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const i=e.sn;this.activePartLists[e.type]=r.filter(s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function Yp(n){var e,t,r;return n.buffered&&(n.body.gap||(null==(e=n.range.video)?void 0:e.partial)||(null==(t=n.range.audio)?void 0:t.partial)||(null==(r=n.range.audiovideo)?void 0:r.partial))}function sd(n){return`${n.type}_${n.level}_${n.urlId}_${n.sn}`}const od=Math.pow(2,17);class kx{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new ql({type:ln.NETWORK_ERROR,details:Ne.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(r?"part list":"url")),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,o=i.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(w=>"GAP"===w[0]))return void d(ov(e));e.gap=!1}const f=this.loader=e.loader=s?new s(i):new o(i),g=vI(e),b=Kp(i.fragLoadPolicy.default),T={loadPolicy:b,timeout:b.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:od};e.stats=f.stats,f.load(g,T,{onSuccess:(w,x,k,N)=>{this.resetLoader(e,f);let z=w.data;k.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(z.slice(0,16)),z=z.slice(16)),u({frag:e,part:null,payload:z,networkDetails:N})},onError:(w,x,k,N)=>{this.resetLoader(e,f),d(new ql({type:ln.NETWORK_ERROR,details:Ne.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:hs({url:r,data:void 0},w),error:new Error(`HTTP Error ${w.code} ${w.text}`),networkDetails:k,stats:N}))},onAbort:(w,x,k)=>{this.resetLoader(e,f),d(new ql({type:ln.NETWORK_ERROR,details:Ne.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:k,stats:w}))},onTimeout:(w,x,k)=>{this.resetLoader(e,f),d(new ql({type:ln.NETWORK_ERROR,details:Ne.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${T.timeout}ms`),networkDetails:k,stats:w}))},onProgress:(w,x,k,N)=>{t&&t({frag:e,part:null,payload:k,networkDetails:N})}})})}loadPart(e,t,r){this.abort();const i=this.config,s=i.fLoader,o=i.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void d(ov(e,t));const f=this.loader=e.loader=s?new s(i):new o(i),g=vI(e,t),b=Kp(i.fragLoadPolicy.default),T={loadPolicy:b,timeout:b.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:od};t.stats=f.stats,f.load(g,T,{onSuccess:(w,x,k,N)=>{this.resetLoader(e,f),this.updateStatsFromPart(e,t);const z={frag:e,part:t,payload:w.data,networkDetails:N};r(z),u(z)},onError:(w,x,k,N)=>{this.resetLoader(e,f),d(new ql({type:ln.NETWORK_ERROR,details:Ne.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:hs({url:g.url,data:void 0},w),error:new Error(`HTTP Error ${w.code} ${w.text}`),networkDetails:k,stats:N}))},onAbort:(w,x,k)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,f),d(new ql({type:ln.NETWORK_ERROR,details:Ne.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:k,stats:w}))},onTimeout:(w,x,k)=>{this.resetLoader(e,f),d(new ql({type:ln.NETWORK_ERROR,details:Ne.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${T.timeout}ms`),networkDetails:k,stats:w}))}})})}updateStatsFromPart(e,t){const r=e.stats,i=t.stats,s=i.total;if(r.loaded+=i.loaded,s){const d=Math.round(e.duration/t.duration),f=Math.min(Math.round(r.loaded/s),d),b=(d-f)*Math.round(r.loaded/f);r.total=r.loaded+b}else r.total=Math.max(r.loaded,r.total);const o=r.loading,u=i.loading;o.start?o.first+=u.first-u.start:(o.start=u.start,o.first=u.first),o.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function vI(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(en(i)&&en(s)){var o;let u=i,d=s;if("initSegment"===n.sn&&"AES-128"===(null==(o=n.decryptdata)?void 0:o.method)){const f=s-i;f%16&&(d=s+(16-f%16)),0!==i&&(r.resetIV=!0,u=i-16)}r.rangeStart=u,r.rangeEnd=d}return r}function ov(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:ln.MEDIA_ERROR,details:Ne.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new ql(r)}class ql extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class bI{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const t in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[t].loader;if(r){if(e&&e!==r.context.frag.type)return;r.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=Ne.KEY_LOAD_ERROR,r,i,s){return new ql({type:ln.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:r,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:i}=e;for(let s=0;s<t.length;s++){const o=t[s];if(i<=o.cc&&("initSegment"===r||"initSegment"===o.sn||r<o.sn)){this.emeController.selectKeySystemFormat(o).then(u=>{o.setKeyFormat(u)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const f=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,Ne.KEY_LOAD_ERROR,f))}const o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,Ne.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let u=this.keyUriToKeyInfo[o];if(null!=(r=u)&&r.decryptdata.key)return s.key=u.decryptdata.key,Promise.resolve({frag:e,keyInfo:u});var d;if(null!=(i=u)&&i.keyLoadPromise)switch(null==(d=u.mediaKeySessionContext)?void 0:d.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return u.keyLoadPromise.then(f=>(s.key=f.keyInfo.decryptdata.key,{frag:e,keyInfo:u}))}switch(u=this.keyUriToKeyInfo[o]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===s.keyFormat?this.loadKeyHTTP(u,e):this.loadKeyEME(u,e);case"AES-128":return this.loadKeyHTTP(u,e);default:return Promise.reject(this.createKeyLoadError(e,Ne.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then(s=>(e.mediaKeySessionContext=s,r))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=new(0,r.loader)(r);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((o,u)=>{const d={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},f=r.keyLoadPolicy.default;s.load(d,{loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},{onSuccess:(T,w,x,k)=>{const{frag:N,keyInfo:z,url:X}=x;if(!N.decryptdata||z!==this.keyUriToKeyInfo[X])return u(this.createKeyLoadError(N,Ne.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),k));z.decryptdata.key=N.decryptdata.key=new Uint8Array(T.data),N.keyLoader=null,z.loader=null,o({frag:N,keyInfo:z})},onError:(T,w,x,k)=>{this.resetLoader(w),u(this.createKeyLoadError(t,Ne.KEY_LOAD_ERROR,new Error(`HTTP Error ${T.code} loading key ${T.text}`),x,hs({url:d.url,data:void 0},T)))},onTimeout:(T,w,x)=>{this.resetLoader(w),u(this.createKeyLoadError(t,Ne.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),x))},onAbort:(T,w,x)=>{this.resetLoader(w),u(this.createKeyLoadError(t,Ne.INTERNAL_ABORTED,new Error("key loading aborted"),x))}})})}resetLoader(e){const{frag:t,keyInfo:r,url:i}=e,s=r.loader;t.keyLoader===s&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],s&&s.destroy()}}class Qk{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const EI={length:0,start:()=>0,end:()=>0};class pr{static isBuffered(e,t){try{if(e){const r=pr.getBuffered(e);for(let i=0;i<r.length;i++)if(t>=r.start(i)&&t<=r.end(i))return!0}}catch{}return!1}static bufferInfo(e,t,r){try{if(e){const i=pr.getBuffered(e),s=[];let o;for(o=0;o<i.length;o++)s.push({start:i.start(o),end:i.end(o)});return this.bufferedInfo(s,t,r)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.sort(function(f,g){return f.start-g.start||g.end-f.end});let i=[];if(r)for(let f=0;f<e.length;f++){const g=i.length;if(g){const b=i[g-1].end;e[f].start-b<r?e[f].end>b&&(i[g-1].end=e[f].end):i.push(e[f])}else i.push(e[f])}else i=e;let o,s=0,u=t,d=t;for(let f=0;f<i.length;f++){const g=i[f].start,b=i[f].end;if(t+r>=g&&t<b)u=g,d=b,s=d-t;else if(t+r<g){o=g;break}}return{len:s,start:u||0,end:d||0,nextStart:o}}static getBuffered(e){try{return e.buffered}catch(t){return de.log("failed to get media.buffered",t),EI}}}class jo{constructor(e,t,r,i=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=s,this.partial=o}}function TI(n,e){let t=null;for(let r=0,i=n.length;r<i;r++){const s=n[r];if(s&&s.cc===e){t=s;break}}return t}function zo(n,e){if(n){const t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function ey(n,e){const t=e.fragments;for(let r=0,i=t.length;r<i;r++)zo(t[r],n);e.fragmentHint&&zo(e.fragmentHint,n),e.alignedSliding=!0}function wI(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;const s=r[Math.round(r.length/2)-1],o=TI(t,s.cc)||t[Math.round(t.length/2)-1],u=s.programDateTime,d=o.programDateTime;null!==u&&null!==d&&ey((d-u)/1e3-(o.start-s.start),n)}class Ox{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class av{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class Nx{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let i=0;i<4;i++)r[i]=t.getUint32(4*i);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],s=r[1],o=r[2],u=r[3],d=this.invSubMix,f=d[0],g=d[1],b=d[2],T=d[3],w=new Uint32Array(256);let x=0,k=0,N=0;for(N=0;N<256;N++)w[N]=N<128?N<<1:N<<1^283;for(N=0;N<256;N++){let z=k^k<<1^k<<2^k<<3^k<<4;z=z>>>8^255&z^99,e[x]=z,t[z]=x;const X=w[x],K=w[X],ie=w[K];let le=257*w[z]^16843008*z;i[x]=le<<24|le>>>8,s[x]=le<<16|le>>>16,o[x]=le<<8|le>>>24,u[x]=le,le=16843009*ie^65537*K^257*X^16843008*x,f[z]=le<<24|le>>>8,g[z]=le<<16|le>>>16,b[z]=le<<8|le>>>24,T[z]=le,x?(x=X^w[w[w[ie^X]]],k^=w[w[k]]):x=k=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,i=0;for(;i<t.length&&r;)r=t[i]===this.key[i],i++;if(r)return;this.key=t;const s=this.keySize=t.length;if(4!==s&&6!==s&&8!==s)throw new Error("Invalid aes key size="+s);const o=this.ksRows=4*(s+6+1);let u,d;const f=this.keySchedule=new Uint32Array(o),g=this.invKeySchedule=new Uint32Array(o),b=this.sBox,T=this.rcon,w=this.invSubMix,x=w[0],k=w[1],N=w[2],z=w[3];let X,K;for(u=0;u<o;u++)u<s?X=f[u]=t[u]:(K=X,u%s==0?(K=K<<8|K>>>24,K=b[K>>>24]<<24|b[K>>>16&255]<<16|b[K>>>8&255]<<8|b[255&K],K^=T[u/s|0]<<24):s>6&&u%s==4&&(K=b[K>>>24]<<24|b[K>>>16&255]<<16|b[K>>>8&255]<<8|b[255&K]),f[u]=X=(f[u-s]^K)>>>0);for(d=0;d<o;d++)u=o-d,K=3&d?f[u]:f[u-4],g[d]=d<4||u<=4?K:x[b[K>>>24]]^k[b[K>>>16&255]]^N[b[K>>>8&255]]^z[b[255&K]],g[d]=g[d]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,r){const i=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,u=this.invSubMix,d=u[0],f=u[1],g=u[2],b=u[3],T=this.uint8ArrayToUint32Array_(r);let w=T[0],x=T[1],k=T[2],N=T[3];const z=new Int32Array(e),X=new Int32Array(z.length);let K,ie,le,Me,Ie,We,ot,Fe,Jt,bt,Bn,Li,gr,dt;const yt=this.networkToHostOrderSwap;for(;t<z.length;){for(Jt=yt(z[t]),bt=yt(z[t+1]),Bn=yt(z[t+2]),Li=yt(z[t+3]),Ie=Jt^s[0],We=Li^s[1],ot=Bn^s[2],Fe=bt^s[3],gr=4,dt=1;dt<i;dt++)K=d[Ie>>>24]^f[We>>16&255]^g[ot>>8&255]^b[255&Fe]^s[gr],ie=d[We>>>24]^f[ot>>16&255]^g[Fe>>8&255]^b[255&Ie]^s[gr+1],le=d[ot>>>24]^f[Fe>>16&255]^g[Ie>>8&255]^b[255&We]^s[gr+2],Me=d[Fe>>>24]^f[Ie>>16&255]^g[We>>8&255]^b[255&ot]^s[gr+3],Ie=K,We=ie,ot=le,Fe=Me,gr+=4;K=o[Ie>>>24]<<24^o[We>>16&255]<<16^o[ot>>8&255]<<8^o[255&Fe]^s[gr],ie=o[We>>>24]<<24^o[ot>>16&255]<<16^o[Fe>>8&255]<<8^o[255&Ie]^s[gr+1],le=o[ot>>>24]<<24^o[Fe>>16&255]<<16^o[Ie>>8&255]<<8^o[255&We]^s[gr+2],Me=o[Fe>>>24]<<24^o[Ie>>16&255]<<16^o[We>>8&255]<<8^o[255&ot]^s[gr+3],X[t]=yt(K^w),X[t+1]=yt(Me^x),X[t+2]=yt(le^k),X[t+3]=yt(ie^N),w=Jt,x=bt,k=Bn,N=Li,t+=4}return X.buffer}}class lv{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}null===this.subtle&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function Zp(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?al(n,0,e-t):n}(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r){return this.useSoftware?new Promise((i,s)=>{this.softwareDecrypt(new Uint8Array(e),t,r);const o=this.flush();o?i(o.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r)}softwareDecrypt(e,t,r){const{currentIV:i,currentResult:s,remainderData:o}=this;this.logOnce("JS AES decrypt"),o&&(e=Ju(o,e),this.remainderData=null);const u=this.getValidChunk(e);if(!u.length)return null;i&&(r=i);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new Nx),d.expandKey(t);const f=s;return this.currentResult=d.decrypt(u.buffer,0,r),this.currentIV=al(u,-16).buffer,f||null}webCryptoDecrypt(e,t,r){const i=this.subtle;return(this.key!==t||!this.fastAesKey)&&(this.key=t,this.fastAesKey=new av(i,t)),this.fastAesKey.expandKey().then(s=>i?(this.logOnce("WebCrypto AES decrypt"),new Ox(i,new Uint8Array(r)).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(de.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,r)))}onWebCryptoError(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);const i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%16;return r!==e.length&&(t=al(e,0,r),this.remainderData=al(e,r)),t}logOnce(e){this.logEnabled&&(de.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}class ty extends Qk{constructor(e,t,r,i,s){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state="STOPPED",this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=s,this.logPrefix=i,this.log=de.log.bind(de,`${i}:`),this.warn=de.warn.bind(de,`${i}:`),this.hls=e,this.fragmentLoader=new kx(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new lv(e.config),e.on(F.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state="STOPPED"}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const r=t.partList;if(null!=r&&r.length){const s=r[r.length-1];return pr.isBuffered(this.media,s.start+s.duration/2)}return this.fragmentTracker.isEndListAppended(t.fragments[t.fragments.length-1].type)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levels[this.levelLastLoaded])?void 0:e.details}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);const i=this.config;this.levels&&i.autoStartLoad&&"STOPPED"===this.state&&this.startLoad(i.startPosition)}onMediaDetaching(){const e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:r,mediaBuffer:i,state:s}=this,o=r?r.currentTime:0,u=pr.bufferInfo(i||r,o,e.maxBufferHole);if(this.log(`media seeking to ${en(o)?o.toFixed(3):o}, state: ${s}`),"ENDED"===this.state)this.resetLoadingState();else if(t){const d=e.maxFragLookUpTolerance,f=t.start-d,g=t.start+t.duration+d;if(!u.len||g<u.start||f>u.end){const b=o>g;(o<f||b)&&(b&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(o,1/0,this.playlistType,!0),this.lastCurrentTime=o),!this.loadedmetadata&&!u.len&&(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state="STOPPED",this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){this._doFragLoad(e,t,r,s=>{if(this.fragContextChanged(e))return this.warn(`Fragment ${e.sn}${s.part?" p: "+s.part.index:""} of level ${e.level} was dropped during download.`),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(s)}).then(s=>{if(!s)return;const o=this.state;this.fragContextChanged(e)?("FRAG_LOADING"===o||!this.fragCurrent&&"PARSING"===o)&&(this.fragmentTracker.removeFragment(e),this.state="IDLE"):("payload"in s&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(F.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s))}).catch(s=>{"STOPPED"===this.state||"ERROR"===this.state||(this.warn(s),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if("APPENDING"===r.getState(e)){const o=this.getFwdBufferInfo(this.mediaBuffer,e.type),u=Math.max(e.duration,o?o.len:this.config.maxBufferLength);this.reduceMaxBufferLength(u)&&r.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),"PARTIAL"===r.getState(e)&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,r=null){e-t&&this.hls.trigger(F.BUFFER_FLUSHING,{startOffset:e,endOffset:t,type:r})}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{if(!r||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:i}=this,{payload:s}=r,o=e.decryptdata;if(s&&s.byteLength>0&&o&&o.key&&o.iv&&"AES-128"===o.method){const u=self.performance.now();return this.decrypter.decrypt(new Uint8Array(s),o.key.buffer,o.iv.buffer).catch(d=>{throw i.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:e}),d}).then(d=>{const f=self.performance.now();return i.trigger(F.FRAG_DECRYPTED,{frag:e,payload:d,stats:{tstart:u,tdecrypt:f}}),r.payload=d,r})}return r}).then(r=>{const{fragCurrent:i,hls:s,levels:o}=this;if(!o)throw new Error("init load aborted, missing levels");const u=e.stats;this.state="IDLE",t.fragmentError=0,e.data=new Uint8Array(r.payload),u.parsing.start=u.buffering.start=self.performance.now(),u.parsing.end=u.buffering.end=self.performance.now(),r.frag===i&&s.trigger(F.FRAG_BUFFERED,{stats:u,frag:i,part:null,id:e.type}),this.tick()}).catch(r=>{"STOPPED"===this.state||"ERROR"===this.state||(this.warn(r),this.resetFragmentLoading(e))})}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}fragBufferedComplete(e,t){var r,i,s,o;const u=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===un.MAIN?"level":"track"} ${e.level} (frag:[${(null!=(r=e.startPTS)?r:NaN).toFixed(3)}-${(null!=(i=e.endPTS)?i:NaN).toFixed(3)}] > buffer:${u?function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}(pr.getBuffered(u)):"(detached)"})`),this.state="IDLE",u&&(!this.loadedmetadata&&e.type==un.MAIN&&u.buffered.length&&(null==(s=this.fragCurrent)?void 0:s.sn)===(null==(o=this.fragPrevious)?void 0:o.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:i,partsLoaded:s}=e,o=!s||0===s.length||s.some(d=>!d),u=new jo(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!o);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,i){var s;const o=t?.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let u=null;if(!e.encrypted||null!=(s=e.decryptdata)&&s.key?!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state="KEY_LOADING",this.fragCurrent=e,u=this.keyLoader.load(e).then(g=>{if(!this.fragContextChanged(g.frag))return this.hls.trigger(F.KEY_LOADED,g),"KEY_LOADING"===this.state&&(this.state="IDLE"),g}),this.hls.trigger(F.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(u=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){const g=o.partList;if(g&&i){r>e.end&&o.fragmentHint&&(e=o.fragmentHint);const b=this.getNextPart(g,e,r);if(b>-1){const T=g[b];let w;return this.log(`Loading part sn: ${e.sn} p: ${T.index} cc: ${e.cc} of playlist [${o.startSN}-${o.endSN}] parts [0-${b}-${g.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=T.start+T.duration,this.state="FRAG_LOADING",w=u?u.then(x=>!x||this.fragContextChanged(x.frag)?null:this.doFragPartsLoad(e,T,t,i)).catch(x=>this.handleFragLoadError(x)):this.doFragPartsLoad(e,T,t,i).catch(x=>this.handleFragLoadError(x)),this.hls.trigger(F.FRAG_LOADING,{frag:e,part:T,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):w}if(!e.url||this.loadedEndOfParts(g,r))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${o?"of ["+o.startSN+"-"+o.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),en(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state="FRAG_LOADING";const d=this.config.progressive;let f;return f=d&&u?u.then(g=>!g||this.fragContextChanged(g?.frag)?null:this.fragmentLoader.load(e,i)).catch(g=>this.handleFragLoadError(g)):Promise.all([this.fragmentLoader.load(e,d?i:void 0),u]).then(([g])=>(!d&&g&&i&&i(g),g)).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(F.FRAG_LOADING,{frag:e,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):f}doFragPartsLoad(e,t,r,i){return new Promise((s,o)=>{var u;const d=[],f=null==(u=r.details)?void 0:u.partList,g=b=>{this.fragmentLoader.loadPart(e,b,i).then(T=>{d[b.index]=T;const w=T.part;this.hls.trigger(F.FRAG_LOADED,T);const x=ev(r,e.sn,b.index+1)||tv(f,e.sn,b.index+1);if(!x)return s({frag:e,part:w,partsLoaded:d});g(x)}).catch(o)};g(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===Ne.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(F.ERROR,t)}else this.hls.trigger(F.ERROR,{type:ln.OTHER_ERROR,details:Ne.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||"PARSING"!==this.state)return void(!this.fragCurrent&&"STOPPED"!==this.state&&"ERROR"!==this.state&&(this.state="IDLE"));const{frag:r,part:i,level:s}=t,o=self.performance.now();r.stats.parsing.end=o,i&&(i.stats.parsing.end=o),this.updateLevelTiming(r,i,s,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:i,sn:s,part:o}=e;if(null==t||!t[i])return this.warn(`Levels object was unset while buffering fragment ${s} of level ${i}. The current chunk will not be buffered.`),null;const u=t[i],d=o>-1?ev(u,s,o):null,f=d?d.fragment:function pI(n,e,t){if(null==n||!n.details)return null;const r=n.details;let i=r.fragments[e-r.startSN];return i||(i=r.fragmentHint,i&&i.sn===e)?i:e<r.startSN&&t&&t.sn===e?t:null}(u,s,r);return f?(r&&r!==f&&(f.stats=r.stats),{frag:f,part:d,level:u}):null}bufferFragmentData(e,t,r,i,s){var o;if(!e||"PARSING"!==this.state)return;const{data1:u,data2:d}=e;let f=u;if(u&&d&&(f=Ju(u,d)),null!=(o=f)&&o.length&&(this.hls.trigger(F.BUFFER_APPENDING,{type:e.type,frag:t,part:r,chunkMeta:i,parent:t.type,data:f}),e.dropped&&e.independent&&!r)){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!pr.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const r=t.currentTime,i=pr.bufferInfo(t,r,0),o=Math.min(2*this.config.maxFragLookUpTolerance,.25*e.duration),u=Math.max(Math.min(e.start-o,i.end-o),r+o);e.start-u>o&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){const r=this.getLoadPosition();return en(r)?this.getFwdBufferInfoAtPos(e,r,t):null}getFwdBufferInfoAtPos(e,t,r){const{config:{maxBufferHole:i}}=this,s=pr.bufferInfo(e,t,i);if(0===s.len&&void 0!==s.nextStart){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&s.nextStart<o.end)return pr.bufferInfo(e,t,Math.max(s.nextStart,i))}return s}getMaxBufferLength(e){const{config:t}=this;let r;return r=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config;return t.maxMaxBufferLength>=(e||t.maxBufferLength)&&(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0)}getAppendedFrag(e,t=un.MAIN){const r=this.fragmentTracker.getAppendedFrag(e,un.MAIN);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,i=r.length;if(!i)return null;const{config:s}=this,o=r[0].start;let u;if(t.live){const d=s.initialLiveManifestSize;if(i<d)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${d})`),null;!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition&&(u=this.getInitialLiveFragment(t,r),this.startPosition=u?this.hls.liveSyncPosition||u.start:e)}else e<=o&&(u=r[0]);return u||(u=this.getFragmentAtPosition(e,s.lowLatencyMode?t.partEnd:t.fragmentEnd,t)),this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return("OK"===r||"PARTIAL"===r&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,i,s){const o=e.gap,u=this.getNextFragment(this.nextLoadPosition,t);if(null===u)return u;if(e=u,o&&e&&!e.gap&&r.nextStart){const d=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,i);if(null!==d&&r.len+d.len>=s)return this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,r){let i=-1,s=!1,o=!0;for(let u=0,d=e.length;u<d;u++){const f=e[u];if(o=o&&!f.independent,i>-1&&r<f.start)break;const g=f.loaded;g?i=-1:(s||f.independent||o)&&f.fragment===t&&(i=u),s=g}return i}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){const r=this.fragPrevious;let i=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),i=function rv(n,e,t){if(null===e||!Array.isArray(n)||!n.length||!en(e))return null;if(e<(n[0].programDateTime||0))return null;if(e>=(n[n.length-1].endProgramDateTime||0))return null;t=t||0;for(let s=0;s<n.length;++s){const o=n[s];if(Cx(e,t,o))return o}return null}(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=r.sn+1;if(s>=e.startSN&&s<=e.endSN){const o=t[s-e.startSN];r.cc===o.cc&&(i=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=function iv(n,e){return mI.search(n,t=>t.cc<e?1:t.cc>e?-1:0)}(t,r.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;null!==s&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,r){const{config:i}=this;let{fragPrevious:s}=this,{fragments:o,endSN:u}=r;const{fragmentHint:d}=r,f=i.maxFragLookUpTolerance,g=r.partList,b=!!(i.lowLatencyMode&&null!=g&&g.length&&d);let T;if(b&&d&&!this.bitrateTest&&(o=o.concat(d),u=d.sn),T=e<t?xa(s,o,e,e>t-f?0:f):o[o.length-1],T){const w=T.sn-r.startSN,x=this.fragmentTracker.getState(T);if(("OK"===x||"PARTIAL"===x&&T.gap)&&(s=T),s&&T.sn===s.sn&&(!b||g[0].fragment.sn>T.sn)&&s&&T.level===s.level){const N=o[w+1];T=T.sn<u&&"OK"!==this.fragmentTracker.getState(N)?N:null}}return T}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const i=this.hls.liveSyncPosition,s=r.currentTime,u=e.edge,d=s>=e.fragments[0].start-t.maxFragLookUpTolerance&&s<=u;null!==i&&r.duration>i&&(s<i||!d)&&(!d&&r.readyState<4||s<u-(void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration))&&(this.loadedmetadata||(this.nextLoadPosition=i),r.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${i.toFixed(3)}`),r.currentTime=i))}alignPlaylists(e,t){const{levels:r,levelLastLoaded:i,fragPrevious:s}=this,o=null!==i?r[i]:null,u=e.fragments.length;if(!u)return this.warn("No fragments in live playlist"),0;const d=e.fragments[0].start,f=!t,g=e.alignedSliding&&en(d);if(f||!g&&!d){!function II(n,e,t){e&&(function Lx(n,e,t){if(function cl(n,e,t){return!(!e.details||!(t.endCC>t.startCC||n&&n.cc<t.startCC))}(n,t,e)){const r=function Ca(n,e,t=0){const r=n.fragments,i=e.fragments;if(!i.length||!r.length)return void de.log("No fragments to align");const s=TI(r,i[0].cc);if(s&&(!s||s.startPTS))return s;de.log("No frag in previous level to align on")}(t.details,e);r&&en(r.start)&&(de.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),ey(r.start,e))}}(n,t,e),!t.alignedSliding&&e.details&&function Px(n,e){if(!e.fragments.length||!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=e.fragments[0].programDateTime,r=n.fragments[0].programDateTime,i=(r-t)/1e3+e.fragments[0].start;i&&en(i)&&(de.log(`Adjusting PTS using programDateTime delta ${r-t}ms, sliding:${i.toFixed(3)} ${n.url} `),ey(i,n))}(t,e.details),!t.alignedSliding&&e.details&&!t.skippedSegments&&Yg(e.details,t))}(s,o,e);const b=e.fragments[0].start;return this.log(`Live playlist sliding: ${b.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${s?s.sn:"na"} fragments: ${u}`),b}return d}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){const i=null!==this.startTimeOffset,s=i?this.startTimeOffset:e.startTimeOffset;null!==s&&en(s)?(r=t+s,s<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Start time offset ${s} found in ${i?"multivariant":"media"} playlist, adjust startPosition to ${r}`),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&"FRAG_LOADING_WAITING_RETRY"!==this.state)&&(this.state="IDLE")}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const b=this.getCurrentContext(t.chunkMeta);b&&(t.frag=b.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;var i;if(this.fragContextChanged(r))return void this.warn(`Frag load error must match current frag to retry ${r.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);const s=t.details===Ne.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(r,!0);const o=t.errorAction,{action:u,retryCount:d=0,retryConfig:f}=o||{};if(o&&5===u&&f){var g;this.resetStartWhenNotLoaded(null!=(g=this.levelLastLoaded)?g:r.level);const b=Qg(f,d);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${d+1}/${f.maxNumRetry} in ${b}ms`),o.resolved=!0,this.retryDate=self.performance.now()+b,this.state="FRAG_LOADING_WAITING_RETRY"}else f&&o?(this.resetFragmentErrors(e),d<f.maxNumRetry?s||(o.resolved=!0):de.warn(`${t.details} reached or exceeded max retry (${d})`)):this.state=2===o?.action?"WAITING_LEVEL":"ERROR";this.tickImmediate()}reduceLengthAndFlushBuffer(e){if("PARSING"===this.state||"PARSED"===this.state){const t=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,t),i=r&&r.len>.5;i&&this.reduceMaxBufferLength(r.len);const s=!i;return s&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(e){e===un.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),"STOPPED"!==this.state&&(this.state="IDLE")}afterBufferFlushed(e,t,r){if(!e)return;const i=pr.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),"ENDED"===this.state&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state="IDLE"}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=this.levels?this.levels[e].details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){var t;this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(null!=(t=this.levelLastLoaded)?t:e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,i){var s;const o=r.details;if(o){if(Object.keys(e.elementaryStreams).reduce((d,f)=>{const g=e.elementaryStreams[f];if(g){const b=g.endPTS-g.startPTS;if(b<=0)return this.warn(`Could not parse fragment ${e.sn} ${f} duration reliably (${b})`),d||!1;const T=i?0:J_(o,e,g.startPTS,g.endPTS,g.startDTS,g.endDTS);return this.hls.trigger(F.LEVEL_PTS_UPDATED,{details:o,level:r,drift:T,type:f,frag:e,start:g.startPTS,end:g.endPTS}),!0}return d},!1))r.fragmentError=0;else if(null===(null==(s=this.transmuxer)?void 0:s.error)){const d=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(0===r.fragmentError&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(d.message),this.hls.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:e,reason:`Found no media in msn ${e.sn} of level "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state="PARSED",this.hls.trigger(F.FRAG_PARSED,{frag:e,part:t})}else this.warn("level.details undefined")}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){var t,r,i;"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(null!=(t=null!=(r=this.levelLastLoaded)?r:null==(i=this.fragCurrent)?void 0:i.level)?t:0),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Qp(){return self.SourceBuffer||self.WebKitSourceBuffer}function Ra(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class cv{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Ju(this.cachedData,e),this.cachedData=null);let s,r=N_(e,0),i=r?r.length:0;const o=this._audioTrack,u=this._id3Track,d=r?(n=>{const e=ll(n);for(let t=0;t<e.length;t++){const r=e[t];if(F_(r))return ZT(r)}})(r):void 0,f=e.length;for((null===this.basePTS||0===this.frameIndex&&en(d))&&(this.basePTS=CI(d,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:"org.id3",duration:Number.POSITIVE_INFINITY});i<f;){if(this.canParse(e,i)){const g=this.appendFrame(o,e,i);g?(this.frameIndex++,this.lastPTS=g.sample.pts,i+=g.length,s=i):i=f}else qT(e,i)?(r=N_(e,i),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:"org.id3",duration:Number.POSITIVE_INFINITY}),i+=r.length,s=i):i++;if(i===f&&s!==f){const g=al(e,s);this.cachedData=this.cachedData?Ju(this.cachedData,g):g}}return{audioTrack:o,videoTrack:Ra(),id3Track:u,textTrack:Ra()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Ra(),id3Track:this._id3Track,textTrack:Ra()}}destroy(){}}const CI=(n,e,t)=>en(n)?90*n:9e4*e+(t?9e4*t.baseTime/t.timescale:0);function uv(n,e){return 255===n[e]&&240==(246&n[e+1])}function dv(n,e){return 1&n[e+1]?7:9}function ry(n,e){return(3&n[e+3])<<11|n[e+4]<<3|(224&n[e+5])>>>5}function iy(n,e){return e+1<n.length&&uv(n,e)}function Vx(n,e){if(iy(n,e)){const t=dv(n,e);if(e+t>=n.length)return!1;const r=ry(n,e);if(r<=t)return!1;const i=e+r;return i===n.length||iy(n,i)}return!1}function kI(n,e,t,r,i){if(!n.samplerate){const s=function RI(n,e,t,r){let i,s,o,u;const d=navigator.userAgent.toLowerCase(),f=r,g=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=1+((192&e[t+2])>>>6);const b=(60&e[t+2])>>>2;if(!(b>g.length-1))return o=(1&e[t+2])<<2,o|=(192&e[t+3])>>>6,de.log(`manifest codec:${r}, ADTS type:${i}, samplingIndex:${b}`),/firefox/i.test(d)?b>=6?(i=5,u=new Array(4),s=b-3):(i=2,u=new Array(2),s=b):-1!==d.indexOf("android")?(i=2,u=new Array(2),s=b):(i=5,u=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&b>=6?s=b-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(b>=6&&1===o||/vivaldi/i.test(d))||!r&&1===o)&&(i=2,u=new Array(2)),s=b)),u[0]=i<<3,u[0]|=(14&b)>>1,u[1]|=(1&b)<<7,u[1]|=o<<3,5===i&&(u[1]|=(14&s)>>1,u[2]=(1&s)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:g[b],channelCount:o,codec:"mp4a.40."+i,manifestCodec:f};n.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${b}`})}(e,t,r,i);if(!s)return;n.config=s.config,n.samplerate=s.samplerate,n.channelCount=s.channelCount,n.codec=s.codec,n.manifestCodec=s.manifestCodec,de.log(`parsed codec:${n.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function LI(n){return 9216e4/n}function PI(n,e,t,r,i){const o=r+i*LI(n.samplerate),u=function $x(n,e){const t=dv(n,e);if(e+t<=n.length){const r=ry(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}(e,t);let d;if(u){const{frameLength:b,headerLength:T}=u,w=T+b,x=Math.max(0,t+w-e.length);x?(d=new Uint8Array(w-T),d.set(e.subarray(t+T,e.length),0)):d=e.subarray(t+T,t+w);const k={unit:d,pts:o};return x||n.samples.push(k),{sample:k,length:w,missing:x}}const f=e.length-t;return d=new Uint8Array(f),d.set(e.subarray(t,e.length),0),{sample:{unit:d,pts:o},length:f,missing:-1}}const Hx=/\/emsg[-/]ID3/i;let sy=null;const zx=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Wx=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Kx=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],qx=[0,1,1,4];function OI(n,e,t,r,i){if(t+24>e.length)return;const s=NI(e,t);if(s&&t+s.frameLength<=e.length){const u=r+i*(9e4*s.samplesPerFrame/s.sampleRate),d={unit:e.subarray(t,t+s.frameLength),pts:u,dts:u};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(d),{sample:d,length:s.frameLength,missing:0}}}function NI(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,i=n[e+2]>>4&15,s=n[e+2]>>2&3;if(1!==t&&0!==i&&15!==i&&3!==s){const u=n[e+3]>>6,f=1e3*zx[14*(3===t?3-r:3===r?3:4)+i-1],b=Wx[3*(3===t?0:2===t?1:2)+s],T=3===u?1:2,w=Kx[t][r],x=qx[r],k=8*w*x,N=Math.floor(w*f/b+(n[e+2]>>1&1))*x;if(null===sy){const K=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);sy=K?parseInt(K[1]):0}return!!sy&&sy<=87&&2===r&&f>=224e3&&0===u&&(n[e+3]=128|n[e+3]),{sampleRate:b,channelCount:T,frameLength:N,samplesPerFrame:k}}}function hv(n,e){return 255===n[e]&&224==(224&n[e+1])&&0!=(6&n[e+1])}function fv(n,e){return e+1<n.length&&hv(n,e)}function UI(n,e){if(e+1<n.length&&hv(n,e)){const r=NI(n,e);let i=4;null!=r&&r.frameLength&&(i=r.frameLength);const s=e+i;return s===n.length||fv(n,s)}return!1}class pv{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(0===s)throw new Error("no bytes available");i.set(e.subarray(r,r+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*s,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&de.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let i,t=8,r=8;for(let s=0;s<e;s++)0!==r&&(i=this.readEG(),r=(t+i+256)%256),t=0===r?t:r}readSPS(){let s,o,u,e=0,t=0,r=0,i=0;const d=this.readUByte.bind(this),f=this.readBits.bind(this),g=this.readUEG.bind(this),b=this.readBoolean.bind(this),T=this.skipBits.bind(this),w=this.skipEG.bind(this),x=this.skipUEG.bind(this),k=this.skipScalingList.bind(this);d();const N=d();if(f(5),T(3),d(),x(),100===N||110===N||122===N||244===N||44===N||83===N||86===N||118===N||128===N){const Me=g();if(3===Me&&T(1),x(),x(),T(1),b())for(o=3!==Me?8:12,u=0;u<o;u++)b()&&k(u<6?16:64)}x();const z=g();if(0===z)g();else if(1===z)for(T(1),w(),w(),s=g(),u=0;u<s;u++)w();x(),T(1);const X=g(),K=g(),ie=f(1);0===ie&&T(1),T(1),b()&&(e=g(),t=g(),r=g(),i=g());let le=[1,1];if(b()&&b())switch(d()){case 1:le=[1,1];break;case 2:le=[12,11];break;case 3:le=[10,11];break;case 4:le=[16,11];break;case 5:le=[40,33];break;case 6:le=[24,11];break;case 7:le=[20,11];break;case 8:le=[32,11];break;case 9:le=[80,33];break;case 10:le=[18,11];break;case 11:le=[15,11];break;case 12:le=[64,33];break;case 13:le=[160,99];break;case 14:le=[4,3];break;case 15:le=[3,2];break;case 16:le=[2,1];break;case 255:le=[d()<<8|d(),d()<<8|d()]}return{width:Math.ceil(16*(X+1)-2*e-2*t),height:(2-ie)*(K+1)*16-(ie?2:4)*(r+i),pixelRatio:le}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class BI{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new lv(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,r){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(u=>{const d=new Uint8Array(u);i.set(d,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,r),this.decrypter.isSync())))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)r.set(e.subarray(s,s+16),i);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(r.subarray(i,i+16),s);return e}decryptAvcSample(e,t,r,i,s){const o=Tx(s.data),u=this.getAvcEncryptedData(o);this.decryptBuffer(u.buffer).then(d=>{s.data=this.getAvcDecryptedUnit(o,d),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,i)})}decryptAvcSamples(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void i();const s=e[t].units;for(;!(r>=s.length);r++){const o=s[r];if(!(o.data.length<=48||1!==o.type&&5!==o.type||(this.decryptAvcSample(e,t,r,i,o),this.decrypter.isSync())))return}}}}const qi=188;class Yl{constructor(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}static probe(e){const t=Yl.syncOffset(e);return t>0&&de.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(e){const t=e.length;let r=Math.min(940,e.length-qi)+1,i=0;for(;i<r;){let s=!1,o=-1,u=0;for(let d=i;d<t;d+=qi){if(71!==e[d]){if(u)return-1;break}if(u++,-1===o&&(o=d,0!==o&&(r=Math.min(o+18612,e.length-qi)+1)),s||(s=0===oy(e,d)),s&&u>1&&(0===o&&u>2||d+qi>r))return o}i++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:QT[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=Yl.createTrack("video"),this._audioTrack=Yl.createTrack("audio",i),this._id3Track=Yl.createTrack("id3"),this._txtTrack=Yl.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_avcTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(e,t,r=!1,i=!1){let s;r||(this.sampleAes=null);const o=this._avcTrack,u=this._audioTrack,d=this._id3Track,f=this._txtTrack;let g=o.pid,b=o.pesData,T=u.pid,w=d.pid,x=u.pesData,k=d.pesData,N=null,z=this.pmtParsed,X=this._pmtId,K=e.length;if(this.remainderData&&(K=(e=Ju(this.remainderData,e)).length,this.remainderData=null),K<qi&&!i)return this.remainderData=e,{audioTrack:u,videoTrack:o,id3Track:d,textTrack:f};const ie=Math.max(0,Yl.syncOffset(e));K-=(K-ie)%qi,K<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,K,e.buffer.byteLength-K));let le=0;for(let Ie=ie;Ie<K;Ie+=qi)if(71===e[Ie]){const We=!!(64&e[Ie+1]),ot=oy(e,Ie);let Jt;if((48&e[Ie+3])>>4>1){if(Jt=Ie+5+e[Ie+4],Jt===Ie+qi)continue}else Jt=Ie+4;switch(ot){case g:We&&(b&&(s=Wo(b))&&this.parseAVCPES(o,f,s,!1),b={data:[],size:0}),b&&(b.data.push(e.subarray(Jt,Ie+qi)),b.size+=Ie+qi-Jt);break;case T:if(We){if(x&&(s=Wo(x)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,s);break;case"mp3":this.parseMPEGPES(u,s)}x={data:[],size:0}}x&&(x.data.push(e.subarray(Jt,Ie+qi)),x.size+=Ie+qi-Jt);break;case w:We&&(k&&(s=Wo(k))&&this.parseID3PES(d,s),k={data:[],size:0}),k&&(k.data.push(e.subarray(Jt,Ie+qi)),k.size+=Ie+qi-Jt);break;case 0:We&&(Jt+=e[Jt]+1),X=this._pmtId=VI(e,Jt);break;case X:{We&&(Jt+=e[Jt]+1);const bt=$I(e,Jt,this.typeSupported,r);g=bt.avc,g>0&&(o.pid=g),T=bt.audio,T>0&&(u.pid=T,u.segmentCodec=bt.segmentCodec),w=bt.id3,w>0&&(d.pid=w),null!==N&&!z&&(de.warn(`MPEG-TS PMT found at ${Ie} after unknown PID '${N}'. Backtracking to sync byte @${ie} to parse all TS packets.`),N=null,Ie=ie-188),z=this.pmtParsed=!0;break}case 17:case 8191:break;default:N=ot}}else le++;if(le>0){const Ie=new Error(`Found ${le} TS packet/s that do not start with 0x47`);this.observer.emit(F.ERROR,F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.FRAG_PARSING_ERROR,fatal:!1,error:Ie,reason:Ie.message})}o.pesData=b,u.pesData=x,d.pesData=k;const Me={audioTrack:u,videoTrack:o,id3Track:d,textTrack:f};return i&&this.extractRemainingSamples(Me),Me}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:i,textTrack:s}=e,o=r.pesData,u=t.pesData,d=i.pesData;let f;if(o&&(f=Wo(o))?(this.parseAVCPES(r,s,f,!0),r.pesData=null):r.pesData=o,u&&(f=Wo(u))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,f);break;case"mp3":this.parseMPEGPES(t,f)}t.pesData=null}else null!=u&&u.size&&de.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;d&&(f=Wo(d))?(this.parseID3PES(i,f),i.pesData=null):i.pesData=d}demuxSampleAes(e,t,r){const i=this.demux(e,r,!0,!this.config.progressive),s=this.sampleAes=new BI(this.observer,this.config,t);return this.decrypt(i,s)}decrypt(e,t){return new Promise(r=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{r(e)}):r(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{r(e)})})}destroy(){this._duration=0}parseAVCPES(e,t,r,i){const s=this.parseAVCNALu(e,r.data);let u,o=this.avcSample,d=!1;r.data=null,o&&s.length&&!e.audFound&&(Jp(o,e),o=this.avcSample=Xp(!1,r.pts,r.dts,"")),s.forEach(f=>{var g;switch(f.type){case 1:{let T=!1;u=!0;const w=f.data;if(d&&w.length>4){const x=new pv(w).readSliceType();(2===x||4===x||7===x||9===x)&&(T=!0)}var b;T&&null!=(b=o)&&b.frame&&!o.key&&(Jp(o,e),o=this.avcSample=null),o||(o=this.avcSample=Xp(!0,r.pts,r.dts,"")),o.frame=!0,o.key=T;break}case 5:u=!0,null!=(g=o)&&g.frame&&!o.key&&(Jp(o,e),o=this.avcSample=null),o||(o=this.avcSample=Xp(!0,r.pts,r.dts,"")),o.key=!0,o.frame=!0;break;case 6:u=!0,iI(f.data,1,r.pts,t.samples);break;case 7:if(u=!0,d=!0,!e.sps){const T=f.data,x=new pv(T).readSPS();e.width=x.width,e.height=x.height,e.pixelRatio=x.pixelRatio,e.sps=[T],e.duration=this._duration;const k=T.subarray(1,4);let N="avc1.";for(let z=0;z<3;z++){let X=k[z].toString(16);X.length<2&&(X="0"+X),N+=X}e.codec=N}break;case 8:u=!0,e.pps||(e.pps=[f.data]);break;case 9:u=!1,e.audFound=!0,o&&Jp(o,e),o=this.avcSample=Xp(!1,r.pts,r.dts,"");break;case 12:u=!0;break;default:u=!1,o&&(o.debug+="unknown NAL "+f.type+" ")}o&&u&&o.units.push(f)}),i&&o&&(Jp(o,e),this.avcSample=null)}getLastNalUnit(e){var t;let i,r=this.avcSample;if((!r||0===r.units.length)&&(r=e[e.length-1]),null!=(t=r)&&t.units){const s=r.units;i=s[s.length-1]}return i}parseAVCNALu(e,t){const r=t.byteLength;let i=e.naluState||0;const s=i,o=[];let d,f,g,u=0,b=-1,T=0;for(-1===i&&(b=0,T=31&t[0],i=0,u=1);u<r;)if(d=t[u++],i)if(1!==i)if(d)if(1===d){if(b>=0){const w={data:t.subarray(b,u-i-1),type:T};o.push(w)}else{const w=this.getLastNalUnit(e.samples);if(w&&(s&&u<=4-s&&w.state&&(w.data=w.data.subarray(0,w.data.byteLength-s)),f=u-i-1,f>0)){const x=new Uint8Array(w.data.byteLength+f);x.set(w.data,0),x.set(t.subarray(0,f),w.data.byteLength),w.data=x,w.state=0}}u<r?(g=31&t[u],b=u,T=g,i=0):i=-1}else i=0;else i=3;else i=d?0:2;else i=d?0:1;if(b>=0&&i>=0){const w={data:t.subarray(b,r),type:T,state:i};o.push(w)}if(0===o.length){const w=this.getLastNalUnit(e.samples);if(w){const x=new Uint8Array(w.data.byteLength+t.byteLength);x.set(w.data,0),x.set(t,w.data.byteLength),w.data=x}}return e.naluState=i,o}parseAACPES(e,t){let r=0;const i=this.aacOverFlow;let o,u,d,s=t.data;if(i){this.aacOverFlow=null;const b=i.missing,T=i.sample.unit.byteLength;if(-1===b){const w=new Uint8Array(T+s.byteLength);w.set(i.sample.unit,0),w.set(s,T),s=w}else{const w=T-b;i.sample.unit.set(s.subarray(0,b),w),e.samples.push(i.sample),r=i.missing}}for(o=r,u=s.length;o<u-1&&!iy(s,o);o++);if(o!==r){let b;const T=o<u-1;b=T?`AAC PES did not start with ADTS header,offset:${o}`:"No ADTS header found in AAC PES";const w=new Error(b);if(de.warn(`parsing error: ${b}`),this.observer.emit(F.ERROR,F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.FRAG_PARSING_ERROR,fatal:!1,levelRetry:T,error:w,reason:b}),!T)return}if(kI(e,this.observer,s,o,this.audioCodec),void 0!==t.pts)d=t.pts;else{if(!i)return void de.warn("[tsdemuxer]: AAC PES unknown PTS");{const b=LI(e.samplerate);d=i.sample.pts+b}}let g,f=0;for(;o<u;){if(g=PI(e,s,o,d,f),o+=g.length,g.missing){this.aacOverFlow=g;break}for(f++;o<u-1&&!iy(s,o);o++);}}parseMPEGPES(e,t){const r=t.data,i=r.length;let s=0,o=0;const u=t.pts;if(void 0!==u)for(;o<i;)if(fv(r,o)){const d=OI(e,r,o,u,s);if(!d)break;o+=d.length,s++}else o++;else de.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseID3PES(e,t){if(void 0===t.pts)return void de.warn("[tsdemuxer]: ID3 PES unknown PTS");const r=di({},t,{type:this._avcTrack?Da_emsg:"org.id3",duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function Xp(n,e,t,r){return{key:n,frame:!1,pts:e,dts:t,units:[],debug:r,length:0}}function oy(n,e){return((31&n[e+1])<<8)+n[e+2]}function VI(n,e){return(31&n[e+10])<<8|n[e+11]}function $I(n,e,t,r){const i={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},o=e+3+((15&n[e+1])<<8|n[e+2])-4;for(e+=12+((15&n[e+10])<<8|n[e+11]);e<o;){const d=oy(n,e);switch(n[e]){case 207:if(!r){de.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===i.audio&&(i.audio=d);break;case 21:-1===i.id3&&(i.id3=d);break;case 219:if(!r){de.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===i.avc&&(i.avc=d);break;case 3:case 4:!0!==t.mpeg&&!0!==t.mp3?de.log("MPEG audio found, not supported in this browser"):-1===i.audio&&(i.audio=d,i.segmentCodec="mp3");break;case 36:de.warn("Unsupported HEVC stream type found")}e+=5+((15&n[e+3])<<8|n[e+4])}return i}function Wo(n){let t,r,i,s,o,e=0;const u=n.data;if(!n||0===n.size)return null;for(;u[0].length<19&&u.length>1;){const f=new Uint8Array(u[0].length+u[1].length);f.set(u[0]),f.set(u[1],u[0].length),u[0]=f,u.splice(1,1)}if(t=u[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(r=(t[4]<<8)+t[5],r&&r>n.size-6)return null;const f=t[7];192&f&&(s=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&f?(o=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,s-o>54e5&&(de.warn(`${Math.round((s-o)/9e4)}s delta between PTS and DTS, align them`),s=o)):o=s),i=t[8];let g=i+9;if(n.size<=g)return null;n.size-=g;const b=new Uint8Array(n.size);for(let T=0,w=u.length;T<w;T++){t=u[T];let x=t.byteLength;if(g){if(g>x){g-=x;continue}t=t.subarray(g),x-=g,g=0}b.set(t,e),e+=x}return r&&(r-=i+3),{data:b,pts:s,dts:o,len:r}}return null}function Jp(n,e){if(n.units.length&&n.frame){if(void 0===n.pts){const t=e.samples,r=t.length;if(!r)return void e.dropped++;{const i=t[r-1];n.pts=i.pts,n.dts=i.dts}}e.samples.push(n)}n.debug.length&&de.log(n.pts+"/"+n.dts+":"+n.debug)}class ad{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const ld=Math.pow(2,32)-1;let Yc=(()=>{class n{static init(){let t;for(t in n.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},n.types)n.types.hasOwnProperty(t)&&(n.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);n.HDLR_TYPES={video:r,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);n.STTS=n.STSC=n.STCO=o,n.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),n.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),n.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),n.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const u=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),f=new Uint8Array([0,0,0,1]);n.FTYP=n.box(n.types.ftyp,u,f,u,d),n.DINF=n.box(n.types.dinf,n.box(n.types.dref,s))}static box(t,...r){let i=8,s=r.length;const o=s;for(;s--;)i+=r[s].byteLength;const u=new Uint8Array(i);for(u[0]=i>>24&255,u[1]=i>>16&255,u[2]=i>>8&255,u[3]=255&i,u.set(t,4),s=0,i=8;s<o;s++)u.set(r[s],i),i+=r[s].byteLength;return u}static hdlr(t){return n.box(n.types.hdlr,n.HDLR_TYPES[t])}static mdat(t){return n.box(n.types.mdat,t)}static mdhd(t,r){r*=t;const i=Math.floor(r/(ld+1)),s=Math.floor(r%(ld+1));return n.box(n.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s,85,196,0,0]))}static mdia(t){return n.box(n.types.mdia,n.mdhd(t.timescale,t.duration),n.hdlr(t.type),n.minf(t))}static mfhd(t){return n.box(n.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}static minf(t){return n.box(n.types.minf,"audio"===t.type?n.box(n.types.smhd,n.SMHD):n.box(n.types.vmhd,n.VMHD),n.DINF,n.stbl(t))}static moof(t,r,i){return n.box(n.types.moof,n.mfhd(t),n.traf(i,r))}static moov(t){let r=t.length;const i=[];for(;r--;)i[r]=n.trak(t[r]);return n.box.apply(null,[n.types.moov,n.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(n.mvex(t)))}static mvex(t){let r=t.length;const i=[];for(;r--;)i[r]=n.trex(t[r]);return n.box.apply(null,[n.types.mvex,...i])}static mvhd(t,r){r*=t;const i=Math.floor(r/(ld+1)),s=Math.floor(r%(ld+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n.box(n.types.mvhd,o)}static sdtp(t){const r=t.samples||[],i=new Uint8Array(4+r.length);let s,o;for(s=0;s<r.length;s++)o=r[s].flags,i[s+4]=o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy;return n.box(n.types.sdtp,i)}static stbl(t){return n.box(n.types.stbl,n.stsd(t),n.box(n.types.stts,n.STTS),n.box(n.types.stsc,n.STSC),n.box(n.types.stsz,n.STSZ),n.box(n.types.stco,n.STCO))}static avc1(t){let s,o,u,r=[],i=[];for(s=0;s<t.sps.length;s++)o=t.sps[s],u=o.byteLength,r.push(u>>>8&255),r.push(255&u),r=r.concat(Array.prototype.slice.call(o));for(s=0;s<t.pps.length;s++)o=t.pps[s],u=o.byteLength,i.push(u>>>8&255),i.push(255&u),i=i.concat(Array.prototype.slice.call(o));const d=n.box(n.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(i))),f=t.width,g=t.height,b=t.pixelRatio[0],T=t.pixelRatio[1];return n.box(n.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,255&f,g>>8&255,255&g,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,n.box(n.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),n.box(n.types.pasp,new Uint8Array([b>>24,b>>16&255,b>>8&255,255&b,T>>24,T>>16&255,T>>8&255,255&T])))}static esds(t){const r=t.config.length;return new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t.config).concat([6,1,2]))}static mp4a(t){const r=t.samplerate;return n.box(n.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),n.box(n.types.esds,n.esds(t)))}static mp3(t){const r=t.samplerate;return n.box(n.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))}static stsd(t){return n.box(n.types.stsd,n.STSD,"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?n.mp3(t):n.mp4a(t):n.avc1(t))}static tkhd(t){const r=t.id,i=t.duration*t.timescale,s=t.width,o=t.height,u=Math.floor(i/(ld+1)),d=Math.floor(i%(ld+1));return n.box(n.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,o>>8&255,255&o,0,0]))}static traf(t,r){const i=n.sdtp(t),s=t.id,o=Math.floor(r/(ld+1)),u=Math.floor(r%(ld+1));return n.box(n.types.traf,n.box(n.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),n.box(n.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,u>>24,u>>16&255,u>>8&255,255&u])),n.trun(t,i.length+16+20+8+16+8+8),i)}static trak(t){return t.duration=t.duration||4294967295,n.box(n.types.trak,n.tkhd(t),n.mdia(t))}static trex(t){const r=t.id;return n.box(n.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,r){const i=t.samples||[],s=i.length,o=12+16*s,u=new Uint8Array(o);let d,f,g,b,T,w;for(u.set(["video"===t.type?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,255&s,(r+=8+o)>>>24&255,r>>>16&255,r>>>8&255,255&r],0),d=0;d<s;d++)f=i[d],g=f.duration,b=f.size,T=f.flags,w=f.cts,u.set([g>>>24&255,g>>>16&255,g>>>8&255,255&g,b>>>24&255,b>>>16&255,b>>>8&255,255&b,T.isLeading<<2|T.dependsOn,T.isDependedOn<<6|T.hasRedundancy<<4|T.paddingValue<<1|T.isNonSync,61440&T.degradPrio,15&T.degradPrio,w>>>24&255,w>>>16&255,w>>>8&255,255&w],12+16*d);return n.box(n.types.trun,u)}static initSegment(t){n.types||n.init();const r=n.moov(t),i=new Uint8Array(n.FTYP.byteLength+r.byteLength);return i.set(n.FTYP),i.set(r,n.FTYP.byteLength),i}}return n.types=void 0,n.HDLR_TYPES=void 0,n.STTS=void 0,n.STSC=void 0,n.STCO=void 0,n.STSZ=void 0,n.VMHD=void 0,n.SMHD=void 0,n.STSD=void 0,n.FTYP=void 0,n.DINF=void 0,n})();const Zx=9e4;function ay(n,e,t=1,r=!1){const i=n*e*t;return r?Math.round(i):i}function ly(n,e=!1){return ay(n,1e3,1/Zx,e)}let ul,Zl=null,mv=null;class Kh{constructor(e,t,r,i=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===Zl){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Zl=o?parseInt(o[1]):0}if(null===mv){const s=navigator.userAgent.match(/Safari\/(\d+)/i);mv=s?parseInt(s[1]):0}}destroy(){}resetTimeStamp(e){de.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){de.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){de.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let t=!1;const r=e.reduce((i,s)=>{const o=s.pts-i;return o<-4294967296?(t=!0,Ls(i,s.pts)):o>0?i:s.pts},e[0].pts);return t&&de.debug("PTS rollover detected"),r}remux(e,t,r,i,s,o,u,d){let f,g,b,T,w,x,k=s,N=s;const X=t.pid>-1,K=t.samples.length,ie=e.samples.length>0,le=u&&K>0||K>1;if((!(e.pid>-1)||ie)&&(!X||le)||this.ISGenerated||u){this.ISGenerated||(b=this.generateIS(e,t,s,o));const Ie=this.isVideoContiguous;let ot,We=-1;if(le&&(We=function Yr(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}(t.samples),!Ie&&this.config.forceKeyFrameOnDiscontinuity))if(x=!0,We>0){de.warn(`[mp4-remuxer]: Dropped ${We} out of ${K} video samples due to a missing keyframe`);const Fe=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(We),t.dropped+=We,N+=(t.samples[0].pts-Fe)/t.inputTimeScale,ot=N}else-1===We&&(de.warn(`[mp4-remuxer]: No keyframe found out of ${K} video samples`),x=!1);if(this.ISGenerated){if(ie&&le){const Fe=this.getVideoStartPts(t.samples),bt=(Ls(e.samples[0].pts,Fe)-Fe)/t.inputTimeScale;k+=Math.max(0,bt),N+=Math.max(0,-bt)}if(ie){if(e.samplerate||(de.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),b=this.generateIS(e,t,s,o)),g=this.remuxAudio(e,k,this.isAudioContiguous,o,X||le||d===un.AUDIO?N:void 0),le){const Fe=g?g.endPTS-g.startPTS:0;t.inputTimeScale||(de.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),b=this.generateIS(e,t,s,o)),f=this.remuxVideo(t,N,Ie,Fe)}}else le&&(f=this.remuxVideo(t,N,Ie,0));f&&(f.firstKeyFrame=We,f.independent=-1!==We,f.firstKeyFramePTS=ot)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(w=Jx(r,s,this._initPTS,this._initDTS)),i.samples.length&&(T=gv(i,s,this._initPTS))),{audio:g,video:f,initSegment:b,independent:x,text:T,id3:w}}generateIS(e,t,r,i){const s=e.samples,o=t.samples,u=this.typeSupported,d={},f=this._initPTS;let T,w,x,g=!f||i,b="audio/mp4";if(g&&(T=w=1/0),e.config&&s.length&&("mp3"===(e.timescale=e.samplerate,e.segmentCodec)&&(u.mpeg?(b="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3")),d.audio={id:"audio",container:b,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&u.mpeg?new Uint8Array(0):Yc.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(x=e.inputTimeScale,f&&x===f.timescale?g=!1:T=w=s[0].pts-Math.round(x*r))),t.sps&&t.pps&&o.length&&(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Yc.initSegment([t]),metadata:{width:t.width,height:t.height}},g))if(x=t.inputTimeScale,f&&x===f.timescale)g=!1;else{const k=this.getVideoStartPts(o),N=Math.round(x*r);w=Math.min(w,Ls(o[0].dts,k)-N),T=Math.min(T,k-N)}if(Object.keys(d).length)return this.ISGenerated=!0,g?(this._initPTS={baseTime:T,timescale:x},this._initDTS={baseTime:w,timescale:x}):T=x=void 0,{tracks:d,initPTS:T,timescale:x}}remuxVideo(e,t,r,i){const s=e.inputTimeScale,o=e.samples,u=[],d=o.length,f=this._initPTS;let w,x,g=this.nextAvcDts,b=8,T=this.videoSampleDuration,k=Number.POSITIVE_INFINITY,N=Number.NEGATIVE_INFINITY,z=!1;r&&null!==g||(g=t*s-(o[0].pts-Ls(o[0].dts,o[0].pts)));const X=f.baseTime*s/f.timescale;for(let He=0;He<d;He++){const ft=o[He];ft.pts=Ls(ft.pts-X,g),ft.dts=Ls(ft.dts-X,g),ft.dts<o[He>0?He-1:He].dts&&(z=!0)}z&&o.sort(function(He,ft){return He.dts-ft.dts||He.pts-ft.pts}),w=o[0].dts,x=o[o.length-1].dts;const K=x-w,ie=K?Math.round(K/(d-1)):T||e.inputTimeScale/30;if(r){const He=w-g,ft=He>ie,In=He<-1;if((ft||In)&&(de.warn(ft?`AVC: ${ly(He,!0)} ms (${He}dts) hole between fragments detected, filling it`:`AVC: ${ly(-He,!0)} ms (${He}dts) overlapping between fragments detected`),!In||g>=o[0].pts)){w=g;const Gn=o[0].pts-He;o[0].dts=w,o[0].pts=Gn,de.log(`Video: First PTS/DTS adjusted: ${ly(Gn,!0)}/${ly(w,!0)}, delta: ${ly(He,!0)} ms`)}}w=Math.max(0,w);let le=0,Me=0;for(let He=0;He<d;He++){const ft=o[He],In=ft.units,Gn=In.length;let Sn=0;for(let _r=0;_r<Gn;_r++)Sn+=In[_r].data.length;Me+=Sn,le+=Gn,ft.length=Sn,ft.dts=Math.max(ft.dts,w),k=Math.min(ft.pts,k),N=Math.max(ft.pts,N)}x=o[d-1].dts;const Ie=Me+4*le+8;let We;try{We=new Uint8Array(Ie)}catch(He){return void this.observer.emit(F.ERROR,F.ERROR,{type:ln.MUX_ERROR,details:Ne.REMUX_ALLOC_ERROR,fatal:!1,error:He,bytes:Ie,reason:`fail allocating video mdat ${Ie}`})}const ot=new DataView(We.buffer);ot.setUint32(0,Ie),We.set(Yc.types.mdat,4);let Fe=!1,Jt=Number.POSITIVE_INFINITY,bt=Number.POSITIVE_INFINITY,Bn=Number.NEGATIVE_INFINITY,Li=Number.NEGATIVE_INFINITY;for(let He=0;He<d;He++){const ft=o[He],In=ft.units;let Sn,Gn=0;for(let Hn=0,ea=In.length;Hn<ea;Hn++){const ta=In[Hn],ei=ta.data,lc=ta.data.byteLength;ot.setUint32(b,lc),b+=4,We.set(ei,b),b+=lc,Gn+=4+lc}if(He<d-1)T=o[He+1].dts-ft.dts,Sn=o[He+1].pts-ft.pts;else{const Hn=this.config,ea=He>0?ft.dts-o[He-1].dts:ie;if(Sn=He>0?ft.pts-o[He-1].pts:ie,Hn.stretchShortVideoTrack&&null!==this.nextAudioPts){const ta=Math.floor(Hn.maxBufferHole*s),ei=(i?k+i*s:this.nextAudioPts)-ft.pts;ei>ta?(T=ei-ea,T<0?T=ea:Fe=!0,de.log(`[mp4-remuxer]: It is approximately ${ei/90} ms to the next segment; using duration ${T/90} ms for the last video frame.`)):T=ea}else T=ea}const _r=Math.round(ft.pts-ft.dts);Jt=Math.min(Jt,T),Bn=Math.max(Bn,T),bt=Math.min(bt,Sn),Li=Math.max(Li,Sn),u.push(new yv(ft.key,T,Gn,_r))}if(u.length)if(Zl){if(Zl<70){const He=u[0].flags;He.dependsOn=2,He.isNonSync=0}}else if(mv&&Li-bt<Bn-Jt&&ie/Bn<.025&&0===u[0].cts){de.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let He=w;for(let ft=0,In=u.length;ft<In;ft++){const Gn=He+u[ft].duration;u[ft].duration=ft<In-1?Gn+u[ft+1].cts-(He+u[ft].cts):ft?u[ft-1].duration:ie,u[ft].cts=0,He=Gn}}T=Fe||!T?ie:T,this.nextAvcDts=g=x+T,this.videoSampleDuration=T,this.isVideoContiguous=!0;const yt={data1:Yc.moof(e.sequenceNumber++,w,di({},e,{samples:u})),data2:We,startPTS:k/s,endPTS:(N+T)/s,startDTS:w/s,endDTS:g/s,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,yt}remuxAudio(e,t,r,i,s){const o=e.inputTimeScale,d=o/(e.samplerate?e.samplerate:o),f="aac"===e.segmentCodec?1024:1152,g=f*d,b=this._initPTS,T="mp3"===e.segmentCodec&&this.typeSupported.mpeg,w=[],x=void 0!==s;let k=e.samples,N=T?0:8,z=this.nextAudioPts||-1;const X=t*o,K=b.baseTime*o/b.timescale;if(this.isAudioContiguous=r=r||k.length&&z>0&&(i&&Math.abs(X-z)<9e3||Math.abs(Ls(k[0].pts-K,X)-z)<20*g),k.forEach(function(dt){dt.pts=Ls(dt.pts-K,X)}),!r||z<0){if(k=k.filter(dt=>dt.pts>=0),!k.length)return;z=0===s?0:i&&!x?Math.max(0,X):k[0].pts}if("aac"===e.segmentCodec){const dt=this.config.maxAudioFramesDrift;for(let yt=0,He=z;yt<k.length;yt++){const ft=k[yt],In=ft.pts,Gn=In-He,Sn=Math.abs(1e3*Gn/o);if(Gn<=-dt*g&&x)0===yt&&(de.warn(`Audio frame @ ${(In/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*Gn/o)} ms.`),this.nextAudioPts=z=He=In);else if(Gn>=dt*g&&Sn<1e4&&x){let _r=Math.round(Gn/g);He=In-_r*g,He<0&&(_r--,He+=g),0===yt&&(this.nextAudioPts=z=He),de.warn(`[mp4-remuxer]: Injecting ${_r} audio frame @ ${(He/o).toFixed(3)}s due to ${Math.round(1e3*Gn/o)} ms gap.`);for(let Hn=0;Hn<_r;Hn++){const ea=Math.max(He,0);let ta=ad.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);ta||(de.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ta=ft.unit.subarray()),k.splice(yt,0,{unit:ta,pts:ea}),He+=g,yt++}}ft.pts=He,He+=g}}let Me,ie=null,le=null,Ie=0,We=k.length;for(;We--;)Ie+=k[We].unit.byteLength;for(let dt=0,yt=k.length;dt<yt;dt++){const He=k[dt],ft=He.unit;let In=He.pts;if(null!==le)w[dt-1].duration=Math.round((In-le)/d);else{if(r&&"aac"===e.segmentCodec&&(In=z),ie=In,!(Ie>0))return;Ie+=N;try{Me=new Uint8Array(Ie)}catch(Sn){return void this.observer.emit(F.ERROR,F.ERROR,{type:ln.MUX_ERROR,details:Ne.REMUX_ALLOC_ERROR,fatal:!1,error:Sn,bytes:Ie,reason:`fail allocating audio mdat ${Ie}`})}T||(new DataView(Me.buffer).setUint32(0,Ie),Me.set(Yc.types.mdat,4))}Me.set(ft,N);const Gn=ft.byteLength;N+=Gn,w.push(new yv(!0,f,Gn,0)),le=In}const ot=w.length;if(!ot)return;this.nextAudioPts=z=le+d*w[w.length-1].duration;const Jt=T?new Uint8Array(0):Yc.moof(e.sequenceNumber++,ie/d,di({},e,{samples:w}));e.samples=[];const bt=ie/o,Bn=z/o,gr={data1:Jt,data2:Me,startPTS:bt,endPTS:Bn,startDTS:bt,endDTS:Bn,type:"audio",hasAudio:!0,hasVideo:!1,nb:ot};return this.isAudioContiguous=!0,gr}remuxEmptyAudio(e,t,r,i){const s=e.inputTimeScale,d=this.nextAudioPts,f=this._initDTS,g=9e4*f.baseTime/f.timescale,b=(null!==d?d:i.startDTS*s)+g,w=s/(e.samplerate?e.samplerate:s)*1024,x=Math.ceil((i.endDTS*s+g-b)/w),k=ad.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(de.warn("[mp4-remuxer]: remux empty Audio"),!k)return void de.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const N=[];for(let z=0;z<x;z++){const X=b+z*w;N.push({unit:k,pts:X,dts:X})}return e.samples=N,this.remuxAudio(e,t,r,!1)}}function Ls(n,e){let t;if(null===e)return n;for(t=e<n?-8589934592:8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function Jx(n,e,t,r){const i=n.samples.length;if(!i)return;const s=n.inputTimeScale;for(let u=0;u<i;u++){const d=n.samples[u];d.pts=Ls(d.pts-t.baseTime*s/t.timescale,e*s)/s,d.dts=Ls(d.dts-r.baseTime*s/r.timescale,e*s)/s}const o=n.samples;return n.samples=[],{samples:o}}function gv(n,e,t){const r=n.samples.length;if(!r)return;const i=n.inputTimeScale;for(let o=0;o<r;o++){const u=n.samples[o];u.pts=Ls(u.pts-t.baseTime*i/t.timescale,e*i)/i}n.samples.sort((o,u)=>o.pts-u.pts);const s=n.samples;return n.samples=[],{samples:s}}class yv{constructor(e,t,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=i,this.flags=new eC(e)}}class eC{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}}function _v(n,e){const t=n?.codec;return t&&t.length>4?t:"hvc1"===t||"hev1"===t?"hvc1.1.6.L120.90":"av01"===t?"av01.0.04M.08":"avc1"===t||e===hr.VIDEO?"avc1.42e01e":"mp4a.40.5"}try{ul=self.performance.now.bind(self.performance)}catch{de.debug("Unable to use Performance API on this environment"),ul=typeof self<"u"&&self.Date.now}const vv=[{demux:class jx{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,i){const s=this.videoTrack=Ra("video",1),o=this.audioTrack=Ra("audio",1),u=this.txtTrack=Ra("text",1);if(this.id3Track=Ra("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const d=Vg(e);if(d.video){const{id:f,timescale:g,codec:b}=d.video;s.id=f,s.timescale=u.timescale=g,s.codec=b}if(d.audio){const{id:f,timescale:g,codec:b}=d.audio;o.id=f,o.timescale=g,o.codec=b}u.id=QT.text,s.sampleDuration=0,s.duration=o.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return Kn(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0}demux(e,t){this.timeOffset=t;let r=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Ju(this.remainderData,e));const u=function Ex(n){const e={valid:null,remainder:null},t=Kn(n,["moof"]);if(!t)return e;if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=al(n,0,r.byteOffset-8),e.remainder=al(n,r.byteOffset-8),e}(r);this.remainderData=u.remainder,i.samples=u.valid||new Uint8Array}else i.samples=r;const o=this.extractID3Track(i,t);return s.samples=tI(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return r.samples=tI(e,t),{videoTrack:t,audioTrack:Ra(),id3Track:i,textTrack:Ra()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const i=Kn(e.samples,["emsg"]);i&&i.forEach(s=>{const o=function sI(n){const e=n[0];let t="",r="",i=0,s=0,o=0,u=0,d=0,f=0;if(0===e){for(;"\0"!==Ki(n.subarray(f,f+1));)t+=Ki(n.subarray(f,f+1)),f+=1;for(t+=Ki(n.subarray(f,f+1)),f+=1;"\0"!==Ki(n.subarray(f,f+1));)r+=Ki(n.subarray(f,f+1)),f+=1;r+=Ki(n.subarray(f,f+1)),f+=1,i=yn(n,12),s=yn(n,16),u=yn(n,20),d=yn(n,24),f=28}else if(1===e){f+=4,i=yn(n,f),f+=4;const b=yn(n,f);f+=4;const T=yn(n,f);for(f+=4,o=2**32*b+T,Number.isSafeInteger(o)||(o=Number.MAX_SAFE_INTEGER,de.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=yn(n,f),f+=4,d=yn(n,f),f+=4;"\0"!==Ki(n.subarray(f,f+1));)t+=Ki(n.subarray(f,f+1)),f+=1;for(t+=Ki(n.subarray(f,f+1)),f+=1;"\0"!==Ki(n.subarray(f,f+1));)r+=Ki(n.subarray(f,f+1)),f+=1;r+=Ki(n.subarray(f,f+1)),f+=1}return{schemeIdUri:t,value:r,timeScale:i,presentationTime:o,presentationTimeDelta:s,eventDuration:u,id:d,payload:n.subarray(f,n.byteLength)}}(s);if(Hx.test(o.schemeIdUri)){const u=en(o.presentationTime)?o.presentationTime/o.timeScale:t+o.presentationTimeDelta/o.timeScale;let d=4294967295===o.eventDuration?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);const f=o.payload;r.samples.push({data:f,len:f.byteLength,dts:u,pts:u,type:Da_emsg,duration:d})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class jI{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function gx(n,e){if(!n||!e)return n;const t=e.keyId;return t&&e.isCommonEncryption&&Kn(n,["moov","trak"]).forEach(i=>{const o=Kn(i,["mdia","minf","stbl","stsd"])[0].subarray(8);let u=Kn(o,["enca"]);const d=u.length>0;d||(u=Kn(o,["encv"])),u.forEach(f=>{Kn(f.subarray(d?28:78),["sinf"]).forEach(T=>{const w=$g(T);if(w){const x=w.subarray(8,24);x.some(k=>0!==k)||(de.log(`[eme] Patching keyId in 'enc${d?"a":"v"}>sinf>>tenc' box: ${Ks_hexDump(x)} -> ${Ks_hexDump(t)}`),w.set(t,8))}})})}),n}(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const i=this.initData=Vg(e);t||(t=_v(i.audio,hr.AUDIO)),r||(r=_v(i.video,hr.VIDEO));const s={};i.audio&&i.video?s.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?s.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:de.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,r,i,s,o){var u,d;let{initPTS:f,lastEndTime:g}=this;const b={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};en(g)||(g=this.lastEndTime=s||0);const T=t.samples;if(null==T||!T.length)return b;const w={initPTS:void 0,timescale:1};let x=this.initData;if(null!=(u=x)&&u.length||(this.generateInitSegment(T),x=this.initData),null==(d=x)||!d.length)return de.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),b;this.emitInitSegment&&(w.tracks=this.initTracks,this.emitInitSegment=!1);const k=function _x(n,e){let t=0,r=0,i=0;const s=Kn(n,["moof","traf"]);for(let o=0;o<s.length;o++){const u=s[o],d=Kn(u,["tfhd"])[0],g=e[yn(d,4)];if(!g)continue;const b=g.default,T=yn(d,0)|b?.flags;let w=b?.duration;8&T&&(w=yn(d,2&T?12:8));const x=g.timescale||9e4,k=Kn(u,["trun"]);for(let N=0;N<k.length;N++)t=vx(k[N]),!t&&w&&(t=w*yn(k[N],4)),g.type===hr.VIDEO?r+=t/x:g.type===hr.AUDIO&&(i+=t/x)}if(0===r&&0===i){let o=0;const u=Kn(n,["sidx"]);for(let d=0;d<u.length;d++){const f=eI(u[d]);null!=f&&f.references&&(o+=f.references.reduce((g,b)=>g+b.info.duration||0,0))}return o}return r||i}(T,x),N=function yx(n,e){return Kn(e,["moof","traf"]).reduce((t,r)=>{const i=Kn(r,["tfdt"])[0],s=i[0],o=Kn(r,["tfhd"]).reduce((u,d)=>{const f=yn(d,4),g=n[f];if(g){let b=yn(i,4);if(1===s){if(b===Bg)return de.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),u;b*=Bg+1,b+=yn(i,8)}const w=b/(g.timescale||9e4);if(isFinite(w)&&(null===u||w<u))return w}return u},null);return null!==o&&isFinite(o)&&(null===t||o<t)?o:t},null)}(x,T),z=null===N?s:N;(function zI(n,e,t,r){if(null===n)return!0;const i=Math.max(r,1);return Math.abs(e-n.baseTime/n.timescale-t)>i}(f,z,s,k)||w.timescale!==f.timescale&&o)&&(w.initPTS=z-s,f&&1===f.timescale&&de.warn("Adjusting initPTS by "+(w.initPTS-f.baseTime)),this.initPTS=f={baseTime:w.initPTS,timescale:1});const X=e?z-f.baseTime/f.timescale:g,K=X+k;(function bx(n,e,t){Kn(e,["moof","traf"]).forEach(r=>{Kn(r,["tfhd"]).forEach(i=>{const s=yn(i,4),o=n[s];if(!o)return;const u=o.timescale||9e4;Kn(r,["tfdt"]).forEach(d=>{const f=d[0];let g=yn(d,4);if(0===f)g-=t*u,g=Math.max(g,0),V_(d,4,g);else{g*=Math.pow(2,32),g+=yn(d,8),g-=t*u,g=Math.max(g,0);const b=Math.floor(g/(Bg+1)),T=Math.floor(g%(Bg+1));V_(d,4,b),V_(d,8,T)}})})})})(x,T,f.baseTime/f.timescale),k>0?this.lastEndTime=K:(de.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const ie=!!x.audio,le=!!x.video;let Me="";ie&&(Me+="audio"),le&&(Me+="video");const Ie={data1:T,startPTS:X,startDTS:X,endPTS:K,endDTS:K,type:Me,hasAudio:ie,hasVideo:le,nb:1,dropped:0};return b.audio="audio"===Ie.type?Ie:void 0,b.video="audio"!==Ie.type?Ie:void 0,b.initSegment=w,b.id3=Jx(r,s,f,f),i.samples.length&&(b.text=gv(i,s,f)),b}}},{demux:Yl,remux:Kh},{demux:class Gx extends cv{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let r=(N_(e,0)||[]).length;for(let i=e.length;r<i;r++)if(Vx(e,r))return de.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function Bx(n,e){return function MI(n,e){return e+5<n.length}(n,e)&&uv(n,e)&&ry(n,e)<=n.length-e}(e,t)}appendFrame(e,t,r){kI(e,this.observer,t,r,e.manifestCodec);const i=PI(e,t,r,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}},remux:Kh},{demux:class Yx extends cv{resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let r=(N_(e,0)||[]).length;for(let i=e.length;r<i;r++)if(UI(e,r))return de.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function FI(n,e){return hv(n,e)&&4<=n.length-e}(e,t)}appendFrame(e,t,r){if(null!==this.basePTS)return OI(e,t,r,this.basePTS,this.frameIndex)}},remux:Kh}];class WI{constructor(e,t,r,i,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i,this.id=s}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,i){const s=r.transmuxing;s.executeStart=ul();let o=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:d}=this;i&&(this.currentTransmuxState=i);const{contiguous:f,discontinuity:g,trackSwitch:b,accurateTimeOffset:T,timeOffset:w,initSegmentChange:x}=i||u,{audioCodec:k,videoCodec:N,defaultInitPts:z,duration:X,initSegmentData:K}=d,ie=function tC(n,e){let t=null;return n.byteLength>0&&null!=e&&null!=e.key&&null!==e.iv&&null!=e.method&&(t=e),t}(o,t);if(ie&&"AES-128"===ie.method){const We=this.getDecrypter();if(!We.isSync())return this.decryptionPromise=We.webCryptoDecrypt(o,ie.key.buffer,ie.iv.buffer).then(ot=>{const Fe=this.push(ot,null,r);return this.decryptionPromise=null,Fe}),this.decryptionPromise;{let ot=We.softwareDecrypt(o,ie.key.buffer,ie.iv.buffer);if(r.part>-1&&(ot=We.flush()),!ot)return s.executeEnd=ul(),cd(r);o=new Uint8Array(ot)}}const le=this.needsProbing(g,b);if(le){const We=this.configureTransmuxer(o);if(We)return de.warn(`[transmuxer] ${We.message}`),this.observer.emit(F.ERROR,F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.FRAG_PARSING_ERROR,fatal:!1,error:We,reason:We.message}),s.executeEnd=ul(),cd(r)}(g||b||x||le)&&this.resetInitSegment(K,k,N,X,t),(g||x||le)&&this.resetInitialTimestamp(z),f||this.resetContiguity();const Me=this.transmux(o,ie,w,T,r),Ie=this.currentTransmuxState;return Ie.contiguous=!0,Ie.discontinuity=!1,Ie.trackSwitch=!1,s.executeEnd=ul(),Me}flush(e){const t=e.transmuxing;t.executeStart=ul();const{decrypter:r,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return s.then(()=>this.flush(e));const o=[],{timeOffset:u}=i;if(r){const b=r.flush();b&&o.push(this.push(b,null,e))}const{demuxer:d,remuxer:f}=this;if(!d||!f)return t.executeEnd=ul(),[cd(e)];const g=d.flush(u);return cy(g)?g.then(b=>(this.flushRemux(o,b,e),o)):(this.flushRemux(o,g,e),o)}flushRemux(e,t,r){const{audioTrack:i,videoTrack:s,id3Track:o,textTrack:u}=t,{accurateTimeOffset:d,timeOffset:f}=this.currentTransmuxState;de.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${r.part>-1?" p: "+r.part:""} of level ${r.level}`);const g=this.remuxer.remux(i,s,o,u,f,d,!0,this.id);e.push({remuxResult:g,chunkMeta:r}),r.transmuxing.executeEnd=ul()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,i,s){const{demuxer:o,remuxer:u}=this;!o||!u||(o.resetInitSegment(e,t,r,i),u.resetInitSegment(e,t,r,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,i,s){let o;return o=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,i,s):this.transmuxUnencrypted(e,r,i,s),o}transmuxUnencrypted(e,t,r,i){const{audioTrack:s,videoTrack:o,id3Track:u,textTrack:d}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,u,d,t,r,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,r,i,s){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:i,vendor:s}=this;let o;for(let b=0,T=vv.length;b<T;b++)if(vv[b].demux.probe(e)){o=vv[b];break}if(!o)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,d=this.remuxer,f=o.remux,g=o.demux;(!d||!(d instanceof f))&&(this.remuxer=new f(r,t,i,s)),(!u||!(u instanceof g))&&(this.demuxer=new g(r,t,i),this.probe=g.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new lv(this.config)),e}}const cd=n=>({remuxResult:{},chunkMeta:n});function cy(n){return"then"in n&&n.then instanceof Function}class nC{constructor(e,t,r,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=s||null}}class rC{constructor(e,t,r,i,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=o}}var em={exports:{}};!function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}function i(d,f,g){this.fn=d,this.context=f,this.once=g||!1}function s(d,f,g,b,T){if("function"!=typeof g)throw new TypeError("The listener must be a function");var w=new i(g,b||d,T),x=t?t+f:f;return d._events[x]?d._events[x].fn?d._events[x]=[d._events[x],w]:d._events[x].push(w):(d._events[x]=w,d._eventsCount++),d}function o(d,f){0==--d._eventsCount?d._events=new r:delete d._events[f]}function u(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(t=!1)),u.prototype.eventNames=function(){var g,b,f=[];if(0===this._eventsCount)return f;for(b in g=this._events)e.call(g,b)&&f.push(t?b.slice(1):b);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(g)):f},u.prototype.listeners=function(f){var b=this._events[t?t+f:f];if(!b)return[];if(b.fn)return[b.fn];for(var T=0,w=b.length,x=new Array(w);T<w;T++)x[T]=b[T].fn;return x},u.prototype.listenerCount=function(f){var b=this._events[t?t+f:f];return b?b.fn?1:b.length:0},u.prototype.emit=function(f,g,b,T,w,x){var k=t?t+f:f;if(!this._events[k])return!1;var X,K,N=this._events[k],z=arguments.length;if(N.fn){switch(N.once&&this.removeListener(f,N.fn,void 0,!0),z){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,g),!0;case 3:return N.fn.call(N.context,g,b),!0;case 4:return N.fn.call(N.context,g,b,T),!0;case 5:return N.fn.call(N.context,g,b,T,w),!0;case 6:return N.fn.call(N.context,g,b,T,w,x),!0}for(K=1,X=new Array(z-1);K<z;K++)X[K-1]=arguments[K];N.fn.apply(N.context,X)}else{var le,ie=N.length;for(K=0;K<ie;K++)switch(N[K].once&&this.removeListener(f,N[K].fn,void 0,!0),z){case 1:N[K].fn.call(N[K].context);break;case 2:N[K].fn.call(N[K].context,g);break;case 3:N[K].fn.call(N[K].context,g,b);break;case 4:N[K].fn.call(N[K].context,g,b,T);break;default:if(!X)for(le=1,X=new Array(z-1);le<z;le++)X[le-1]=arguments[le];N[K].fn.apply(N[K].context,X)}}return!0},u.prototype.on=function(f,g,b){return s(this,f,g,b,!1)},u.prototype.once=function(f,g,b){return s(this,f,g,b,!0)},u.prototype.removeListener=function(f,g,b,T){var w=t?t+f:f;if(!this._events[w])return this;if(!g)return o(this,w),this;var x=this._events[w];if(x.fn)x.fn===g&&(!T||x.once)&&(!b||x.context===b)&&o(this,w);else{for(var k=0,N=[],z=x.length;k<z;k++)(x[k].fn!==g||T&&!x[k].once||b&&x[k].context!==b)&&N.push(x[k]);N.length?this._events[w]=1===N.length?N[0]:N:o(this,w)}return this},u.prototype.removeAllListeners=function(f){var g;return f?this._events[g=t?t+f:f]&&o(this,g):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,n.exports=u}(em);var uy=Np(em.exports);const dy=Uh()||{isTypeSupported:()=>!1};class qI{constructor(e,t,r,i){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;const o=(f,g)=>{(g=g||{}).frag=this.frag,g.id=this.id,f===F.ERROR&&(this.error=g.error),this.hls.trigger(f,g)};this.observer=new uy,this.observer.on(F.FRAG_DECRYPTED,o),this.observer.on(F.ERROR,o);const u={mp4:dy.isTypeSupported("video/mp4"),mpeg:dy.isTypeSupported("audio/mpeg"),mp3:dy.isTypeSupported('audio/mp4; codecs="mp3"')},d=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(s.workerPath||function AI(){return"function"==typeof __HLS_WORKER_BUNDLE__}()))try{s.workerPath?(de.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=function ny(n){const e=new self.URL(n,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}(s.workerPath)):(de.log(`injecting Web Worker for "${t}"`),this.workerContext=function xI(){const n=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(n);return{worker:new self.Worker(e),objectURL:e}}()),this.onwmsg=b=>this.onWorkerMessage(b);const{worker:g}=this.workerContext;g.addEventListener("message",this.onwmsg),g.onerror=b=>{const T=new Error(`${b.message}  (${b.filename}:${b.lineno})`);s.enableWorker=!1,de.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(F.ERROR,{type:ln.OTHER_ERROR,details:Ne.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:T})},g.postMessage({cmd:"init",typeSupported:u,vendor:d,id:t,config:JSON.stringify(s)})}catch(g){de.warn(`Error setting up "${t}" Web Worker, fallback to inline`,g),this.resetWorker(),this.error=null,this.transmuxer=new WI(this.observer,u,s,d,t)}else this.transmuxer=new WI(this.observer,u,s,d,t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,r,i,s,o,u,d,f,g){var b,T;f.transmuxing.start=self.performance.now();const{transmuxer:w}=this,x=o?o.start:s.start,k=s.decryptdata,N=this.frag,z=!(N&&s.cc===N.cc),X=!(N&&f.level===N.level),K=N?f.sn-N.sn:-1,ie=this.part?f.part-this.part.index:-1,Me=!X&&(1===K||0===K&&(1===ie||0===K&&f.id>1&&f.id===N?.stats.chunkCount&&ie<=0)),Ie=self.performance.now();(X||K||0===s.stats.parsing.start)&&(s.stats.parsing.start=Ie),o&&(ie||!Me)&&(o.stats.parsing.start=Ie);const We=!(N&&(null==(b=s.initSegment)?void 0:b.url)===(null==(T=N.initSegment)?void 0:T.url)),ot=new rC(z,Me,d,X,x,We);if(!Me||z||We){de.log(`[transmuxer-interface, ${s.type}]: Starting new transmux session for sn: ${f.sn} p: ${f.part} level: ${f.level} id: ${f.id}\n        discontinuity: ${z}\n        trackSwitch: ${X}\n        contiguous: ${Me}\n        accurateTimeOffset: ${d}\n        timeOffset: ${x}\n        initSegmentChange: ${We}`);const Fe=new nC(r,i,t,u,g);this.configureTransmuxer(Fe)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:k,chunkMeta:f,state:ot},e instanceof ArrayBuffer?[e]:[]);else if(w){const Fe=w.push(e,k,f,ot);cy(Fe)?(w.async=!0,Fe.then(Jt=>{this.handleTransmuxComplete(Jt)}).catch(Jt=>{this.transmuxerError(Jt,f,"transmuxer-interface push error")})):(w.async=!1,this.handleTransmuxComplete(Fe))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let r=t.flush(e);cy(r)||t.async?(cy(r)||(r=Promise.resolve(r)),r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")})):this.handleFlushResult(r,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data,r=this.hls;switch(t.event){case"init":{var i;const s=null==(i=this.workerContext)?void 0:i.objectURL;s&&self.URL.revokeObjectURL(s);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":de[t.data.logType]&&de[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class oC{constructor(e,t,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:r,media:i,stalled:s}=this;if(null===i)return;const{currentTime:o,seeking:u}=i,d=this.seeking&&!u,f=!this.seeking&&u;if(this.seeking=u,o!==e){if(this.moved=!0,null!==s){if(this.stallReported){const z=self.performance.now()-s;de.warn(`playback not stuck anymore @${o}, after ${Math.round(z)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(f||d)return void(this.stalled=null);if(i.paused&&!u||i.ended||0===i.playbackRate||!pr.getBuffered(i).length)return;const g=pr.bufferInfo(i,o,0),T=g.nextStart||0;if(!(g.len>0||T))return;if(u){const z=g.len>2,X=!T||t&&t.start<=o||T-o>2&&!this.fragmentTracker.getPartialFragment(o);if(z||X)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var w;const z=Math.max(T,g.start||0)-o,X=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,ie=(null==X||null==(w=X.details)?void 0:w.live)?2*X.details.targetduration:2,le=this.fragmentTracker.getPartialFragment(o);if(z>0&&(z<=ie||le))return void this._trySkipBufferHole(le)}const x=self.performance.now();if(null===s)return void(this.stalled=x);const k=x-s;if(!u&&k>=250&&(this._reportStall(g),!this.media))return;const N=pr.bufferInfo(i,o,r.maxBufferHole);this._tryFixBufferStall(N,k)}_tryFixBufferStall(e,t){const{config:r,fragmentTracker:i,media:s}=this;if(null===s)return;const o=s.currentTime,u=i.getPartialFragment(o);u&&(this._trySkipBufferHole(u)||!this.media)||(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-o<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(de.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:r,stallReported:i}=this;if(!i&&r){this.stallReported=!0;const s=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${JSON.stringify(e)})`);de.warn(s.message),t.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:r,media:i}=this;if(null===i)return 0;const s=i.currentTime,o=pr.bufferInfo(i,s,0),u=s<o.start?o.start:o.nextStart;if(u){const g=u-s;if(g>0&&(o.len<=t.maxBufferHole||o.len>0&&o.len<1&&i.readyState<3)){if(g>t.maxBufferHole){const{fragmentTracker:T}=this;let w=!1;if(0===s){const x=T.getAppendedFrag(0,un.MAIN);x&&u<x.end&&(w=!0)}if(!w){const x=e||T.getAppendedFrag(s,un.MAIN);if(x){let k=!1,N=x.end;for(;N<u;){const z=T.getPartialFragment(N);if(!z){k=!0;break}N+=z.duration}if(k)return 0}}}const b=Math.max(u+.05,s+.1);if(de.warn(`skipping hole, adjusting currentTime from ${s} to ${b}`),this.moved=!0,this.stalled=null,i.currentTime=b,e&&!e.gap){const T=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${b}`);r.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:T,reason:T.message,frag:e})}return b}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:r,nudgeRetry:i}=this;if(null===r)return;const s=r.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){const o=s+(i+1)*e.nudgeOffset,u=new Error(`Nudging 'currentTime' from ${s} to ${o}`);de.warn(u.message),r.currentTime=o,t.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.BUFFER_NUDGE_ON_STALL,error:u,fatal:!1})}else{const o=new Error(`Playhead still not moving while enough data buffered @${s} after ${e.nudgeMaxRetry} nudges`);de.error(o.message),t.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.BUFFER_STALLED_ERROR,error:o,fatal:!0})}}}class ZI extends ty{constructor(e,t,r){super(e,t,r,"[stream-controller]",un.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.LEVEL_LOADING,this.onLevelLoading,this),e.on(F.LEVEL_LOADED,this.onLevelLoaded,this),e.on(F.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(F.ERROR,this.onError,this),e.on(F.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(F.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(F.BUFFER_CREATED,this.onBufferCreated,this),e.on(F.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(F.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(F.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.LEVEL_LOADED,this.onLevelLoaded,this),e.off(F.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(F.ERROR,this.onError,this),e.off(F.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(F.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(F.BUFFER_CREATED,this.onBufferCreated,this),e.off(F.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(F.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(F.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:r}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let i=r.startLevel;-1===i&&(r.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=r.nextAutoLevel),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state="IDLE",this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state="STOPPED"}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case"WAITING_LEVEL":{var e;const{levels:r,level:i}=this,s=null==r||null==(e=r[i])?void 0:e.details;if(s&&(!s.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(s))break;this.state="IDLE";break}if(this.hls.nextLoadLevel!==this.level){this.state="IDLE";break}break}case"FRAG_LOADING_WAITING_RETRY":{var t;const r=self.performance.now(),i=this.retryDate;(!i||r>=i||null!=(t=this.media)&&t.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state="IDLE")}}"IDLE"===this.state&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:i}=this,{config:s,nextLoadLevel:o}=e;if(null===t||!i&&(this.startFragRequested||!s.startFragPrefetch)||this.altAudio&&this.audioOnly||null==r||!r[o])return;const u=r[o],d=this.getMainFwdBufferInfo();if(null===d)return;const f=this.getLevelDetails();if(f&&this._streamEnded(d,f)){const N={};return this.altAudio&&(N.type="video"),this.hls.trigger(F.BUFFER_EOS,N),void(this.state="ENDED")}e.loadLevel!==o&&-1===e.manualLevel&&this.log(`Adapting to level ${o} from level ${this.level}`),this.level=e.nextLoadLevel=o;const g=u.details;if(!g||"WAITING_LEVEL"===this.state||g.live&&this.levelLastLoaded!==o)return this.level=o,void(this.state="WAITING_LEVEL");const b=d.len,T=this.getMaxBufferLength(u.maxBitrate);if(b>=T)return;this.backtrackFragment&&this.backtrackFragment.start>d.end&&(this.backtrackFragment=null);const w=this.backtrackFragment?this.backtrackFragment.start:d.end;let x=this.getNextFragment(w,g);if(this.couldBacktrack&&!this.fragPrevious&&x&&"initSegment"!==x.sn&&"OK"!==this.fragmentTracker.getState(x)){var k;const z=(null!=(k=this.backtrackFragment)?k:x).sn-g.startSN,X=g.fragments[z-1];X&&x.cc===X.cc&&(x=X,this.fragmentTracker.removeFragment(X))}else this.backtrackFragment&&d.len&&(this.backtrackFragment=null);if(x&&this.isLoopLoading(x,w)){if(!x.gap){const z=this.audioOnly&&!this.altAudio?hr.AUDIO:hr.VIDEO,X=(z===hr.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;X&&this.afterBufferFlushed(X,z,un.MAIN)}x=this.getNextFragmentLoopLoading(x,g,d,un.MAIN,T)}x&&(x.initSegment&&!x.initSegment.data&&!this.bitrateTest&&(x=x.initSegment),this.loadFragment(x,u,w))}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);this.fragCurrent=e,"NOT_LOADED"===i||"PARTIAL"===i?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,un.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let r;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(null!=s&&s.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<2*s.targetduration)return}if(!t.paused&&e){const f=this.fragLastKbps;r=f&&this.fragCurrent?this.fragCurrent.duration*e[this.hls.nextLoadLevel].maxBitrate/(1e3*f)+1:0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const u=this.followingBufferedFrag(o);if(u){this.abortCurrentFrag();const f=u.duration,g=Math.max(o.end,(u.maxStartPTS?u.maxStartPTS:u.start)+Math.min(Math.max(f-this.config.maxFragLookUpTolerance,.5*f),.75*f));this.flushMainBuffer(g,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case"KEY_LOADING":case"FRAG_LOADING":case"FRAG_LOADING_WAITING_RETRY":case"PARSING":case"PARSED":this.state="IDLE"}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new oC(this.config,r,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;en(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const r=this.getMainFwdBufferInfo();null!==r&&0!==r.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${r?r.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(F.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(e,t){let s,r=!1,i=!1;t.levels.forEach(o=>{s=o.audioCodec,s&&(-1!==s.indexOf("mp4a.40.2")&&(r=!0),-1!==s.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=r&&i&&!function DI(){var n;const e=Qp();return"function"==typeof(null==e||null==(n=e.prototype)?void 0:n.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||"IDLE"!==this.state)return;const i=r[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(i.details))&&(this.state="WAITING_LEVEL")}onLevelLoaded(e,t){var r;const{levels:i}=this,s=t.level,o=t.details,u=o.totalduration;if(!i)return void this.warn(`Levels were reset while loading level ${s}`);this.log(`Level ${s} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${u}`);const d=i[s],f=this.fragCurrent;f&&("FRAG_LOADING"===this.state||"FRAG_LOADING_WAITING_RETRY"===this.state)&&(f.level!==t.level||f.urlId!==d.urlId)&&f.loader&&this.abortCurrentFrag();let g=0;if(o.live||null!=(r=d.details)&&r.live){if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;g=this.alignPlaylists(o,d.details)}if(d.details=o,this.levelLastLoaded=s,this.hls.trigger(F.LEVEL_UPDATED,{details:o,level:s}),"WAITING_LEVEL"===this.state){if(this.waitForCdnTuneIn(o))return;this.state="IDLE"}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,g),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:i,payload:s}=e,{levels:o}=this;if(!o)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const u=o[r.level],d=u.details;if(!d)return this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),void this.fragmentTracker.removeFragment(r);const f=u.videoCodec,g=d.PTSKnown||!d.live,b=null==(t=r.initSegment)?void 0:t.data,T=this._getAudioCodec(u),w=this.transmuxer=this.transmuxer||new qI(this.hls,un.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),x=i?i.index:-1,N=new jo(r.level,r.sn,r.stats.chunkCount,s.byteLength,x,-1!==x);w.push(s,b,T,f,r,i,d.totalduration,g,N,this.initPTS[r.cc])}onAudioTrackSwitching(e,t){const r=this.altAudio;if(!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const s=this.hls;r&&(s.trigger(F.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),s.trigger(F.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=!!this.hls.audioTracks[t.id].url;if(i){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i,this.tick()}onBufferCreated(e,t){const r=t.tracks;let i,s,o=!1;for(const u in r){const d=r[u];if("main"===d.id){if(s=u,i=d,"video"===u){const f=r[u];f&&(this.videoBuffer=f.buffer)}}else o=!0}o&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r&&r.type!==un.MAIN)return;if(this.fragContextChanged(r))return this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),void("PARSED"===this.state&&(this.state="IDLE"));const s=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}onError(e,t){var r;if(t.fatal)this.state="ERROR";else switch(t.details){case Ne.FRAG_GAP:case Ne.FRAG_PARSING_ERROR:case Ne.FRAG_DECRYPT_ERROR:case Ne.FRAG_LOAD_ERROR:case Ne.FRAG_LOAD_TIMEOUT:case Ne.KEY_LOAD_ERROR:case Ne.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(un.MAIN,t);break;case Ne.LEVEL_LOAD_ERROR:case Ne.LEVEL_LOAD_TIMEOUT:case Ne.LEVEL_PARSING_ERROR:!t.levelRetry&&"WAITING_LEVEL"===this.state&&(null==(r=t.context)?void 0:r.type)===Zn.LEVEL&&(this.state="IDLE");break;case Ne.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case Ne.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}checkBuffer(){const{media:e,gapController:t}=this;e&&t&&e.readyState&&(!this.loadedmetadata&&pr.getBuffered(e).length||t.poll(this.lastCurrentTime,"IDLE"!==this.state?this.fragCurrent:null),this.lastCurrentTime=e.currentTime)}onFragLoadEmergencyAborted(){this.state="IDLE",this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){(t!==hr.AUDIO||this.audioOnly&&!this.altAudio)&&this.afterBufferFlushed((t===hr.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,t,un.MAIN)}onLevelsUpdated(e,t){this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void this.log(`could not seek to ${r}, already seeking at ${t}`);const i=pr.getBuffered(e),o=(i.length?i.start(0):0)-r;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${o} to match buffer start`),r+=o,this.startPosition=r),this.log(`seek to target start position ${r} from current time ${t}`),e.currentTime=r}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:i}=this;if(!r||this.fragContextChanged(e))return;t.fragmentError=0,this.state="IDLE",this.startFragRequested=!1,this.bitrateTest=!1;const s=e.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),i.trigger(F.FRAG_LOADED,r),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const r="main",{hls:i}=this,{remuxResult:s,chunkMeta:o}=e,u=this.getCurrentContext(o);if(!u)return void this.resetWhenMissingContext(o);const{frag:d,part:f,level:g}=u,{video:b,text:T,id3:w,initSegment:x}=s,{details:k}=g,N=this.altAudio?void 0:s.audio;if(this.fragContextChanged(d))this.fragmentTracker.removeFragment(d);else{if(this.state="PARSING",x){if(null!=x&&x.tracks){const K=d.initSegment||d;this._bufferInitSegment(g,x.tracks,K,o),i.trigger(F.FRAG_PARSING_INIT_SEGMENT,{frag:K,id:r,tracks:x.tracks})}const z=x.initPTS,X=x.timescale;en(z)&&(this.initPTS[d.cc]={baseTime:z,timescale:X},i.trigger(F.INIT_PTS_FOUND,{frag:d,id:r,initPTS:z,timescale:X}))}if(b&&k&&"initSegment"!==d.sn){const z=k.fragments[d.sn-1-k.startSN],X=d.sn===k.startSN,K=!z||d.cc>z.cc;if(!1!==s.independent){const{startPTS:ie,endPTS:le,startDTS:Me,endDTS:Ie}=b;if(f)f.elementaryStreams[b.type]={startPTS:ie,endPTS:le,startDTS:Me,endDTS:Ie};else if(b.firstKeyFrame&&b.independent&&1===o.id&&!K&&(this.couldBacktrack=!0),b.dropped&&b.independent){const We=this.getMainFwdBufferInfo(),ot=(We?We.end:this.getLoadPosition())+this.config.maxBufferHole;if(!X&&ot<(b.firstKeyFramePTS?b.firstKeyFramePTS:ie)-this.config.maxBufferHole&&!K)return void this.backtrack(d);K&&(d.gap=!0),d.setElementaryStreamInfo(b.type,d.start,le,d.start,Ie,!0)}d.setElementaryStreamInfo(b.type,ie,le,Me,Ie),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(b,d,f,o,X||K)}else{if(!X&&!K)return void this.backtrack(d);d.gap=!0}}if(N){const{startPTS:z,endPTS:X,startDTS:K,endDTS:ie}=N;f&&(f.elementaryStreams[hr.AUDIO]={startPTS:z,endPTS:X,startDTS:K,endDTS:ie}),d.setElementaryStreamInfo(hr.AUDIO,z,X,K,ie),this.bufferFragmentData(N,d,f,o)}k&&null!=w&&null!=(t=w.samples)&&t.length&&i.trigger(F.FRAG_PARSING_METADATA,{id:r,frag:d,details:k,samples:w.samples}),k&&T&&i.trigger(F.FRAG_PARSING_USERDATA,{id:r,frag:d,details:k,samples:T.samples})}}_bufferInitSegment(e,t,r,i){if("PARSING"!==this.state)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:s,video:o,audiovideo:u}=t;if(s){let d=e.audioCodec;const f=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(d&&(d=-1!==d.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==s.metadata.channelCount&&-1===f.indexOf("firefox")&&(d="mp4a.40.5")),-1!==f.indexOf("android")&&"audio/mpeg"!==s.container&&(d="mp4a.40.2",this.log(`Android: force audio codec to ${d}`)),e.audioCodec&&e.audioCodec!==d&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${d}"`),s.levelCodec=d,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${d||""}/${e.audioCodec||""}/${s.codec}]`)}o&&(o.levelCodec=e.videoCodec,o.id="main",this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${o.codec}]`)),u&&this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.attrs.CODECS||""}/${u.codec}]`),this.hls.trigger(F.BUFFER_CODECS,t),Object.keys(t).forEach(d=>{const g=t[d].initSegment;null!=g&&g.byteLength&&this.hls.trigger(F.BUFFER_APPENDING,{type:d,data:g,frag:r,part:null,chunkMeta:i,parent:r.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,un.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state="IDLE"}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const r=e.currentTime;if(pr.isBuffered(e,r)?t=this.getAppendedFrag(r):pr.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s||t.urlId!==i.urlId)&&(this.fragPlaying=t,this.hls.trigger(F.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(F.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,r=this.currentFrag;if(r&&en(t)&&en(r.programDateTime))return new Date(r.programDateTime+1e3*(t-r.start))}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class dd{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class aC{constructor(e,t,r,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new dd(e),this.fast_=new dd(t),this.defaultTTFB_=i,this.ttfb_=new dd(e)}update(e,t){const{slow_:r,fast_:i,ttfb_:s}=this;r.halfLife!==e&&(this.slow_=new dd(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new dd(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new dd(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){const i=(e=Math.max(e,this.minDelayMs_))/1e3,s=8*t/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class XI{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;return e.length?(r=1===e.length?e[0]:function lC(n,e){const t=new Uint8Array(e);let r=0;for(let i=0;i<n.length;i++){const s=n[i];t.set(s,r),r+=s.length}return t}(e,t),this.reset(),r):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function uC(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!JI(n[t].attrs,e[t].attrs))return!1;return!0}function JI(n,e){const t=n["STABLE-RENDITION-ID"];return t?t===e["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(r=>n[r]!==e[r])}class hC{constructor(e){this.buffered=void 0;const t=(r,i,s)=>{if((i>>>=0)>s-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][r]};this.buffered={get length(){return e.length},end:r=>t("end",r,e.length),start:r=>t("start",r,e.length)}}}function hd(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];("subtitles"===r.kind||"captions"===r.kind)&&r.label&&e.push(n[t])}return e}class fC{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t){const r=this.queues[t];r.push(e),1===r.length&&this.buffers[t]&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const r=new Promise(s=>{t=s});return this.append({execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}},e),r}executeNext(e){const{buffers:t,queues:r}=this,i=t[e],s=r[e];if(s.length){const o=s[0];try{o.execute()}catch(u){de.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),o.onError(u),null!=i&&i.updating||(s.shift(),this.executeNext(e))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const tw=Uh(),nw=/([ha]vc.)(?:\.[^.,]+)+/,mC={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},rw=function(e){let t=e;return mC.hasOwnProperty(e)&&(t=mC[e]),String.fromCharCode(t)},Ql=100,gC={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rm={17:2,18:4,21:6,22:8,23:10,19:13,20:15},yC={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},iw={25:2,26:4,29:6,30:8,31:10,27:13,28:15},_C=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class sw{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r="function"==typeof t?t():t;de.log(`${this.time} [${e}] ${r}`)}}}const fd=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class bv{constructor(e,t,r,i,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=i||"black",this.flash=s||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class vC{constructor(e,t,r,i,s,o){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new bv(t,r,i,s,o)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Ev{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let t=0;t<Ql;t++)this.chars.push(new vC);this.logger=e,this.pos=0,this.currPenState=new bv}equals(e){let t=!0;for(let r=0;r<Ql;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t}copy(e){for(let t=0;t<Ql;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Ql;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ql&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ql)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=rw(e);this.pos>=Ql?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<Ql;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<Ql;r++){const i=this.chars[r].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Tv{constructor(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let t=0;t<15;t++)this.rows.push(new Ev(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<15;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let r=0;r<15;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<15;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<15;u++)this.rows[u].clear();const s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const u=o.rows[s].cueStartTime,d=this.logger.time;if(u&&null!==d&&u<d)for(let f=0;f<this.nrRollUpRows;f++)this.rows[t-this.nrRollUpRows+f+1].copy(o.rows[s+f])}}this.currRow=t;const r=this.rows[this.currRow];if(null!==e.indent){const o=Math.max(e.indent-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}this.setPen({foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1})}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const t=this.rows.splice(this.currRow+1-this.nrRollUpRows,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",i=-1;for(let s=0;s<15;s++){const o=this.rows[s].getTextString();o&&(i=s+1,t.push(e?"Row "+i+": '"+o+"'":o.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}getTextAndFormat(){return this.rows}}class Iv{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Tv(r),this.nonDisplayedMemory=new Tv(r),this.lastOutputScreen=new Tv(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class wv{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const i=new sw;this.channels=[null,new Iv(e,t,i),new Iv(e+1,r,i)],this.cmdHistory={a:null,b:null},this.logger=i}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let r,i,s,o=!1;this.logger.time=e;for(let u=0;u<t.length;u+=2)if(i=127&t[u],s=127&t[u+1],0!==i||0!==s){if(this.logger.log(3,"["+fd([t[u],t[u+1]])+"] -> ("+fd([i,s])+")"),r=this.parseCmd(i,s),r||(r=this.parseMidrow(i,s)),r||(r=this.parsePAC(i,s)),r||(r=this.parseBackgroundAttributes(i,s)),!r&&(o=this.parseChars(i,s),o)){const d=this.currentChannel;d&&d>0?this.channels[d].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!r&&!o&&this.logger.log(2,"Couldn't parse cleaned data "+fd([i,s])+" orig: "+fd([t[u],t[u+1]]))}}parseCmd(e,t){const{cmdHistory:r}=this;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;if(ow(e,t,r))return qh(null,null,r),this.logger.log(3,"Repeated command ("+fd([e,t])+") is dropped"),!0;const o=20===e||21===e||23===e?1:2,u=this.channels[o];return 20===e||21===e||28===e||29===e?32===t?u.ccRCL():33===t?u.ccBS():34===t?u.ccAOF():35===t?u.ccAON():36===t?u.ccDER():37===t?u.ccRU(2):38===t?u.ccRU(3):39===t?u.ccRU(4):40===t?u.ccFON():41===t?u.ccRDC():42===t?u.ccTR():43===t?u.ccRTD():44===t?u.ccEDM():45===t?u.ccCR():46===t?u.ccENM():47===t&&u.ccEOC():u.ccTO(t-32),qh(e,t,r),this.currentChannel=o,!0}parseMidrow(e,t){let r=0;if((17===e||25===e)&&t>=32&&t<=47){if(r=17===e?1:2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[r];return!!i&&(i.ccMIDROW(t),this.logger.log(3,"MIDROW ("+fd([e,t])+")"),!0)}return!1}parsePAC(e,t){let r;const i=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;if(ow(e,t,i))return qh(null,null,i),!0;const u=e<=23?1:2;r=t>=64&&t<=95?1===u?gC[e]:yC[e]:1===u?rm[e]:iw[e];const d=this.channels[u];return!!d&&(d.setPAC(this.interpretPAC(r,t)),qh(e,t,i),this.currentChannel=u,!0)}interpretPAC(e,t){let r;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=1==(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i}parseChars(e,t){let r,i=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),s>=17&&s<=19){let o;o=17===s?t+80:18===s?t+112:t+144,this.logger.log(2,"Special char '"+rw(o)+"' in channel "+r),i=[o]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);if(i){const o=fd(i);this.logger.log(3,"Char codes =  "+o.join(",")),qh(e,t,this.cmdHistory)}return i}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;let s;const o={};return 16===e||24===e?(s=Math.floor((t-32)/2),o.background=_C[s],t%2==1&&(o.background=o.background+"_semi")):45===t?o.background="transparent":(o.foreground="black",47===t&&(o.underline=!0)),this.channels[e<=23?1:2].setBkgData(o),qh(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function qh(n,e,t){t.a=n,t.b=e}function ow(n,e,t){return t.a===n&&t.b===e}class Yh{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var Sv=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,d){if("string"!=typeof d||!Array.isArray(u))return!1;const f=d.toLowerCase();return!!~u.indexOf(f)&&f}function i(u){return t(e,u)}function s(u,...d){let f=1;for(;f<arguments.length;f++){const g=arguments[f];for(const b in g)u[b]=g[b]}return u}function o(u,d,f){const g=this,b={enumerable:!0};g.hasBeenReset=!1;let T="",w=!1,x=u,k=d,N=f,z=null,X="",K=!0,ie="auto",le="start",Me=50,Ie="middle",We=50,ot="middle";Object.defineProperty(g,"id",s({},b,{get:function(){return T},set:function(Fe){T=""+Fe}})),Object.defineProperty(g,"pauseOnExit",s({},b,{get:function(){return w},set:function(Fe){w=!!Fe}})),Object.defineProperty(g,"startTime",s({},b,{get:function(){return x},set:function(Fe){if("number"!=typeof Fe)throw new TypeError("Start time must be set to a number.");x=Fe,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",s({},b,{get:function(){return k},set:function(Fe){if("number"!=typeof Fe)throw new TypeError("End time must be set to a number.");k=Fe,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",s({},b,{get:function(){return N},set:function(Fe){N=""+Fe,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",s({},b,{get:function(){return z},set:function(Fe){z=Fe,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",s({},b,{get:function(){return X},set:function(Fe){const Jt=function r(u){return t(n,u)}(Fe);if(!1===Jt)throw new SyntaxError("An invalid or illegal string was specified.");X=Jt,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",s({},b,{get:function(){return K},set:function(Fe){K=!!Fe,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",s({},b,{get:function(){return ie},set:function(Fe){if("number"!=typeof Fe&&"auto"!==Fe)throw new SyntaxError("An invalid number or illegal string was specified.");ie=Fe,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",s({},b,{get:function(){return le},set:function(Fe){const Jt=i(Fe);if(!Jt)throw new SyntaxError("An invalid or illegal string was specified.");le=Jt,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",s({},b,{get:function(){return Me},set:function(Fe){if(Fe<0||Fe>100)throw new Error("Position must be between 0 and 100.");Me=Fe,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",s({},b,{get:function(){return Ie},set:function(Fe){const Jt=i(Fe);if(!Jt)throw new SyntaxError("An invalid or illegal string was specified.");Ie=Jt,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",s({},b,{get:function(){return We},set:function(Fe){if(Fe<0||Fe>100)throw new Error("Size must be between 0 and 100.");We=Fe,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",s({},b,{get:function(){return ot},set:function(Fe){const Jt=i(Fe);if(!Jt)throw new SyntaxError("An invalid or illegal string was specified.");ot=Jt,this.hasBeenReset=!0}})),g.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class lw{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function cw(n){function e(r,i,s,o){return 3600*(0|r)+60*(0|i)+(0|s)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class bC{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&""!==t&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function uw(n,e,t,r){const i=r?n.split(r):[n];for(const s in i){if("string"!=typeof i[s])continue;const o=i[s].split(t);2===o.length&&e(o[0],o[1])}}const Dv=new Sv(0,0,""),hy="middle"===Dv.align?"middle":"center";function EC(n,e,t){const r=n;function i(){const u=cw(n);if(null===u)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),u}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=i(),o(),"--\x3e"!==n.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);n=n.slice(3),o(),e.endTime=i(),o(),function s(u,d){const f=new bC;uw(u,function(T,w){let x;switch(T){case"region":for(let k=t.length-1;k>=0;k--)if(t[k].id===w){f.set(T,t[k].region);break}break;case"vertical":f.alt(T,w,["rl","lr"]);break;case"line":x=w.split(","),f.integer(T,x[0]),f.percent(T,x[0])&&f.set("snapToLines",!1),f.alt(T,x[0],["auto"]),2===x.length&&f.alt("lineAlign",x[1],["start",hy,"end"]);break;case"position":x=w.split(","),f.percent(T,x[0]),2===x.length&&f.alt("positionAlign",x[1],["start",hy,"end","line-left","line-right","auto"]);break;case"size":f.percent(T,w);break;case"align":f.alt(T,w,["start",hy,"end","left","right"])}},/:/,/\s/),d.region=f.get("region",null),d.vertical=f.get("vertical","");let g=f.get("line","auto");"auto"===g&&-1===Dv.line&&(g=-1),d.line=g,d.lineAlign=f.get("lineAlign","start"),d.snapToLines=f.get("snapToLines",!0),d.size=f.get("size",100),d.align=f.get("align",hy);let b=f.get("position","auto");"auto"===b&&50===Dv.position&&(b="start"===d.align||"left"===d.align?0:"end"===d.align||"right"===d.align?100:50),d.position=b}(n,e)}function dw(n){return n.replace(/<br(?: \/)?>/gi,"\n")}class TC{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new lw,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function r(){let s=t.buffer,o=0;for(s=dw(s);o<s.length&&"\r"!==s[o]&&"\n"!==s[o];)++o;const u=s.slice(0,o);return"\r"===s[o]&&++o,"\n"===s[o]&&++o,t.buffer=s.slice(o),u}function i(s){uw(s,function(o,u){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let s="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;s=r();const u=s.match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(null==u||!u[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:s=r(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new Sv(0,0,""),t.state="CUE",-1===s.indexOf("--\x3e")){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{EC(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=-1!==s.indexOf("--\x3e");if(!s||u&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const hw=/\r\n|\n\r|\n|\r/g,fy=function(e,t,r=0){return e.slice(r,r+t.length)===t},IC=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(en(t)&&en(r)&&en(i)&&en(s)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=6e4*i,t+=36e5*s,t},Av=function(e){let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()};function py(n,e,t){return Av(n.toString())+Av(e.toString())+Av(t)}const wC=function(e,t,r){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;null!=(o=s)&&o.new;){var o;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=r};const xv="stpp.ttml.im1t",my=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,gy=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,fw={left:"start",center:"center",right:"end",start:"start",end:"end"};function yy(n,e,t,r){const i=Kn(new Uint8Array(n),["mdat"]);if(0===i.length)return void r(new Error("Could not parse IMSC1 mdat"));const s=i.map(u=>wa(u)),o=function GI(n,e,t=1,r=!1){return ay(n,e,1/t,r)}(e.baseTime,1,e.timescale);try{s.forEach(u=>t(function DC(n,e){const i=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((b,T)=>(b[T]=i.getAttribute(`ttp:${T}`)||s[T],b),{}),u="preserve"!==i.getAttribute("xml:space"),d=_y(Cv(i,"styling","style")),f=_y(Cv(i,"layout","region")),g=Cv(i,"body","[begin]");return[].map.call(g,b=>{const T=pw(b,u);if(!T||!b.hasAttribute("begin"))return null;const w=Mv(b.getAttribute("begin"),o),x=Mv(b.getAttribute("dur"),o);let k=Mv(b.getAttribute("end"),o);if(null===w)throw Rv(b);if(null===k){if(null===x)throw Rv(b);k=w+x}const N=new Sv(w-e,k-e,T);N.id=py(N.startTime,N.endTime,N.text);const K=function mw(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let i=null;const o=null!=n&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(i=t[o]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((u,d)=>{const f=Zc(e,r,d)||Zc(n,r,d)||Zc(i,r,d);return f&&(u[d]=f),u},{})}(f[b.getAttribute("region")],d[b.getAttribute("style")],d),{textAlign:ie}=K;if(ie){const le=fw[ie];le&&(N.lineAlign=le),N.align=ie}return di(N,K),N}).filter(b=>null!==b)}(u,o)))}catch(u){r(u)}}function Cv(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function _y(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function pw(n,e){return[].slice.call(n.childNodes).reduce((t,r,i)=>{var s;return"br"===r.nodeName&&i?t+"\n":null!=(s=r.childNodes)&&s.length?pw(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function Zc(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function Rv(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Mv(n,e){if(!n)return null;let t=cw(n);return null===t&&(my.test(n)?t=function eL(n,e){const t=my.exec(n);return 3600*(0|t[1])+60*(0|t[2])+(0|t[3])+((0|t[4])+(0|t[5])/e.subFrameRate)/e.frameRate}(n,e):gy.test(n)&&(t=function gw(n,e){const t=gy.exec(n),r=Number(t[1]);switch(t[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}(n,e))),t}function AC(n,e){return!!n&&n.label===e.name&&!(n.textTrack1||n.textTrack2)}function Lv(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}class vy{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(F.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(F.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.BUFFER_CODECS,this.onBufferCodecs,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(F.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(F.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.BUFFER_CODECS,this.onBufferCodecs,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const e=this.hls.levels;if(e.length){const t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,vy.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(null==e||!e.length)return-1;const i=(o,u)=>!u||o.width!==u.width||o.height!==u.height;let s=e.length-1;for(let o=0;o<e.length;o+=1){const u=e[o];if((u.width>=t||u.height>=r)&&i(u,e[o+1])){s=o;break}}return s}}const im="[eme]";let _w=(()=>{class n{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=n.CDMCleanupPromise?[n.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=de.debug.bind(de,im),this.log=de.log.bind(de,im),this.warn=de.warn.bind(de,im),this.error=de.error.bind(de,im),this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(F.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(F.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(F.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(F.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(F.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(F.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(t){const{drmSystems:r,widevineLicenseUrl:i}=this.config,s=r[t];if(s)return s.licenseUrl;if(t===Or.WIDEVINE&&i)return i;throw new Error(`no license server URL configured for key-system "${t}"`)}getServerCertificateUrl(t){const{drmSystems:r}=this.config,i=r[t];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const r=this.hls.levels,i=(u,d,f)=>!!u&&f.indexOf(u)===d,s=r.map(u=>u.audioCodec).filter(i),o=r.map(u=>u.videoCodec).filter(i);return s.length+o.length===0&&o.push("avc1.42e01e"),new Promise((u,d)=>{const f=g=>{const b=g.shift();this.getMediaKeysPromise(b,s,o).then(T=>u({keySystem:b,mediaKeys:T})).catch(T=>{g.length?f(g):d(T instanceof _o?T:new _o({type:ln.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_NO_ACCESS,error:T,fatal:!0},T.message))})};f(t)})}requestMediaKeySystemAccess(t,r){const{requestMediaKeySystemAccessFunc:i}=this.config;if("function"!=typeof i){let s=`Configured requestMediaKeySystemAccess is not a function ${i}`;return null===WT&&"http:"===self.location.protocol&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return i(t,r)}getMediaKeysPromise(t,r,i){const s=function Pg(n,e,t,r){let i;switch(n){case Or.FAIRPLAY:i=["cenc","sinf"];break;case Or.WIDEVINE:case Or.PLAYREADY:i=["cenc"];break;case Or.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return function Og(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"not-allowed",distinctiveIdentifier:r.distinctiveIdentifier||"not-allowed",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs="${s}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs="${s}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}(i,e,t,r)}(t,r,i,this.config.drmSystemOptions),o=this.keySystemAccessPromises[t];let u=o?.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${t}" key-system access with config: ${JSON.stringify(s)}`),u=this.requestMediaKeySystemAccess(t,s);const d=this.keySystemAccessPromises[t]={keySystemAccess:u};return u.catch(f=>{this.log(`Failed to obtain access to key-system "${t}": ${f}`)}),u.then(f=>{this.log(`Access for key-system "${f.keySystem}" obtained`);const g=this.fetchServerCertificate(t);return this.log(`Create media-keys for "${t}"`),d.mediaKeys=f.createMediaKeys().then(b=>(this.log(`Media-keys created for "${t}"`),g.then(T=>T?this.setMediaKeysServerCertificate(b,t,T):b))),d.mediaKeys.catch(b=>{this.error(`Failed to create media-keys for "${t}"}: ${b}`)}),d.mediaKeys})}return u.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:r,mediaKeys:i}){this.log(`Creating key-system session "${r}" keyId: ${Ks_hexDump(t.keyId||[])}`);const s=i.createSession(),o={decryptdata:t,keySystem:r,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o}renewKeySession(t){const r=t.decryptdata;if(r.pssh){const i=this.createMediaKeySessionContext(t),s=this.getKeyIdString(r);this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,"cenc",r.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}getKeyIdString(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(null===t.keyId)throw new Error("keyId is null");return Ks_hexDump(t.keyId)}updateKeySession(t,r){var i;const s=t.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${Ks_hexDump((null==(i=t.decryptdata)?void 0:i.keyId)||[])}\n      } (data length: ${r&&r.byteLength})`),s.update(r)}selectKeySystemFormat(t){const r=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)),this.keyFormatPromise}getKeyFormatPromise(t){return new Promise((r,i)=>{const s=O_(this.config),o=t.map(jT).filter(u=>!!u&&-1!==s.indexOf(u));return this.getKeySystemSelectionPromise(o).then(({keySystem:u})=>{const d=Lg(u);d?r(d):i(new Error(`Unable to find format for key-system "${u}"`))}).catch(i)})}loadKey(t){const r=t.keyInfo.decryptdata,i=this.getKeyIdString(r),s=`(keyId: ${i} format: "${r.keyFormat}" method: ${r.method} uri: ${r.uri})`;this.log(`Starting session for key ${s}`);let o=this.keyIdToKeySessionPromise[i];return o||(o=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(r).then(({keySystem:u,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${s}`),this.attemptSetMediaKeys(u,d).then(()=>{this.throwIfDestroyed();const f=this.createMediaKeySessionContext({keySystem:u,mediaKeys:d,decryptdata:r});return this.generateRequestWithPreferredKeySession(f,"cenc",r.pssh,"playlist-key")}))),o.catch(u=>this.handleError(u))),o}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t){this.hls&&(this.error(t.message),this.hls.trigger(F.ERROR,t instanceof _o?t.data:{type:ln.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))}getKeySystemForKeyPromise(t){const r=this.getKeyIdString(t),i=this.keyIdToKeySessionPromise[r];if(!i){const s=jT(t.keyFormat),o=s?[s]:O_(this.config);return this.attemptKeySystemAccess(o)}return i}getKeySystemSelectionPromise(t){if(t.length||(t=O_(this.config)),0===t.length)throw new _o({type:ln.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}_onMediaEncrypted(t){const{initDataType:r,initData:i}=t;if(this.debug(`"${t.type}" event: init data type: "${r}"`),null===i)return;let s,o;if("sinf"===r&&this.config.drmSystems[Or.FAIRPLAY]){const b=Ki(new Uint8Array(i));try{const T=L_(JSON.parse(b).sinf),w=$g(new Uint8Array(T));if(!w)return;s=w.subarray(8,24),o=Or.FAIRPLAY}catch{return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{const b=function Ix(n){if(!(n instanceof ArrayBuffer)||n.byteLength<32)return null;const e={version:0,systemId:"",kids:null,data:null},t=new DataView(n),r=t.getUint32(0);if(n.byteLength!==r&&r>44||1886614376!==t.getUint32(4)||(e.version=t.getUint32(8)>>>24,e.version>1))return null;e.systemId=Ks_hexDump(new Uint8Array(n,12,16));const s=t.getUint32(28);if(0===e.version){if(r-32<s)return null;e.data=new Uint8Array(n,32,s)}else if(1===e.version){e.kids=[];for(let o=0;o<s;o++)e.kids.push(new Uint8Array(n,32+16*o,16))}return e}(i);if(null===b)return;0===b.version&&b.systemId===zT_WIDEVINE&&b.data&&(s=b.data.subarray(8,24)),o=function fx(n){if(n===zT_WIDEVINE)return Or.WIDEVINE}(b.systemId)}if(!o||!s)return;const u=Ks_hexDump(s),{keyIdToKeySessionPromise:d,mediaKeySessions:f}=this;let g=d[u];for(let b=0;b<f.length;b++){const T=f[b],w=T.decryptdata;if(w.pssh||!w.keyId)continue;const x=Ks_hexDump(w.keyId);if(u===x||-1!==w.uri.replace(/-/g,"").indexOf(u)){g=d[x],delete d[x],w.pssh=new Uint8Array(i),w.keyId=s,g=d[u]=g.then(()=>this.generateRequestWithPreferredKeySession(T,r,i,"encrypted-event-key-match"));break}}g||(g=d[u]=this.getKeySystemSelectionPromise([o]).then(({keySystem:b,mediaKeys:T})=>{var w;this.throwIfDestroyed();const x=new ed("ISO-23001-7",u,null!=(w=Lg(b))?w:"");return x.pssh=new Uint8Array(i),x.keyId=s,this.attemptSetMediaKeys(b,T).then(()=>{this.throwIfDestroyed();const k=this.createMediaKeySessionContext({decryptdata:x,keySystem:b,mediaKeys:T});return this.generateRequestWithPreferredKeySession(k,r,i,"encrypted-event-no-match")})})),g.catch(b=>this.handleError(b))}_onWaitingForKey(t){this.log(`"${t.type}" event`)}attemptSetMediaKeys(t,r){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const s=Promise.all(i).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(r)});return this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${t}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(o=>-1===i.indexOf(o))})}generateRequestWithPreferredKeySession(t,r,i,s){var o,u;const d=null==(o=this.config.drmSystems)||null==(u=o[t.keySystem])?void 0:u.generateRequest;if(d)try{const w=d.call(this.hls,r,i,t);if(!w)throw new Error("Invalid response from configured generateRequest filter");r=w.initDataType,i=t.decryptdata.pssh=w.initData?new Uint8Array(w.initData):null}catch(w){var f;if(this.warn(w.message),null!=(f=this.hls)&&f.config.debug)throw w}if(null===i)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(t);const g=this.getKeyIdString(t.decryptdata);this.log(`Generating key-session request for "${s}": ${g} (init data type: ${r} length: ${i?i.byteLength:null})`);const b=new uy;t.mediaKeysSession.onmessage=w=>{const x=t.mediaKeysSession;if(!x)return void b.emit("error",new Error("invalid state"));const{messageType:k,message:N}=w;this.log(`"${k}" message event for session "${x.sessionId}" message size: ${N.byteLength}`),"license-request"===k||"license-renewal"===k?this.renewLicense(t,N).catch(z=>{this.handleError(z),b.emit("error",z)}):"license-release"===k?t.keySystem===Or.FAIRPLAY&&(this.updateKeySession(t,HT("acknowledged")),this.removeSession(t)):this.warn(`unhandled media key message type "${k}"`)},t.mediaKeysSession.onkeystatuseschange=w=>{if(!t.mediaKeysSession)return void b.emit("error",new Error("invalid state"));this.onKeyStatusChange(t);const k=t.keyStatus;b.emit("keyStatus",k),"expired"===k&&(this.warn(`${t.keySystem} expired for key ${g}`),this.renewKeySession(t))};const T=new Promise((w,x)=>{b.on("error",x),b.on("keyStatus",k=>{k.startsWith("usable")?w():"output-restricted"===k?x(new _o({type:ln.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===k?x(new _o({type:ln.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${k}"`)):"expired"===k?x(new Error("key expired while generating request")):this.warn(`unhandled key status change "${k}"`)})});return t.mediaKeysSession.generateRequest(r,i).then(()=>{var w;this.log(`Request generated for key-session "${null==(w=t.mediaKeysSession)?void 0:w.sessionId}" keyId: ${g}`)}).catch(w=>{throw new _o({type:ln.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_NO_SESSION,error:w,fatal:!1},`Error generating key-session request: ${w}`)}).then(()=>T).catch(w=>{throw b.removeAllListeners(),this.removeSession(t),w}).then(()=>(b.removeAllListeners(),t))}onKeyStatusChange(t){t.mediaKeysSession.keyStatuses.forEach((r,i)=>{this.log(`key status change "${r}" for keyStatuses keyId: ${Ks_hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${Ks_hexDump(new Uint8Array(t.decryptdata.keyId||[]))} uri: ${t.decryptdata.uri}`),t.keyStatus=r})}fetchServerCertificate(t){const r=this.config,s=new(0,r.loader)(r),o=this.getServerCertificateUrl(t);return o?(this.log(`Fetching serverCertificate for "${t}"`),new Promise((u,d)=>{const f={responseType:"arraybuffer",url:o},g=r.certLoadPolicy.default;s.load(f,{loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},{onSuccess:(w,x,k,N)=>{u(w.data)},onError:(w,x,k,N)=>{d(new _o({type:ln.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:k,response:hs({url:f.url,data:void 0},w)},`"${t}" certificate request failed (${o}). Status: ${w.code} (${w.text})`))},onTimeout:(w,x,k)=>{d(new _o({type:ln.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:k,response:{url:f.url,data:void 0}},`"${t}" certificate request timed out (${o})`))},onAbort:(w,x,k)=>{d(new Error("aborted"))}})})):Promise.resolve()}setMediaKeysServerCertificate(t,r,i){return new Promise((s,o)=>{t.setServerCertificate(i).then(u=>{this.log(`setServerCertificate ${u?"success":"not supported by CDM"} (${i?.byteLength}) on "${r}"`),s(t)}).catch(u=>{o(new _o({type:ln.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:u,fatal:!0},u.message))})})}renewLicense(t,r){return this.requestLicense(t,new Uint8Array(r)).then(i=>this.updateKeySession(t,new Uint8Array(i)).catch(s=>{throw new _o({type:ln.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}setupLicenseXHR(t,r,i,s){const o=this.config.licenseXhrSetup;return o?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return o.call(this.hls,t,r,i,s)}).catch(u=>{if(!i.decryptdata)throw u;return t.open("POST",r,!0),o.call(this.hls,t,r,i,s)}).then(u=>(t.readyState||t.open("POST",r,!0),{xhr:t,licenseChallenge:u||s})):(t.open("POST",r,!0),Promise.resolve({xhr:t,licenseChallenge:s}))}requestLicense(t,r){const i=this.config.keyLoadPolicy.default;return new Promise((s,o)=>{const u=this.getLicenseServerUrl(t.keySystem);this.log(`Sending license request to URL: ${u}`);const d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return o(new Error("invalid state"));if(4===d.readyState)if(200===d.status){this._requestLicenseFailureCount=0;let f=d.response;this.log(`License received ${f instanceof ArrayBuffer?f.byteLength:f}`);const g=this.config.licenseResponseCallback;if(g)try{f=g.call(this.hls,d,u,t)}catch(b){this.error(b)}s(f)}else{const f=i.errorRetry,g=f?f.maxNumRetry:0;this._requestLicenseFailureCount++,this._requestLicenseFailureCount>g||d.status>=400&&d.status<500?o(new _o({type:ln.KEY_SYSTEM_ERROR,details:Ne.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:d,response:{url:u,data:void 0,code:d.status,text:d.statusText}},`License Request XHR failed (${u}). Status: ${d.status} (${d.statusText})`)):(this.warn(`Retrying license request, ${g-this._requestLicenseFailureCount+1} attempts left`),this.requestLicense(t,r).then(s,o))}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=d,this.setupLicenseXHR(d,u,t,r).then(({xhr:f,licenseChallenge:g})=>{f.send(g)})})}onMediaAttached(t,r){if(!this.config.emeEnabled)return;const i=r.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const t=this.media,r=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},ed.clearKeyUriToKeyIdMap();const i=r.length;n.CDMCleanupPromise=Promise.all(r.map(s=>this.removeSession(s)).concat(t?.setMediaKeys(null).catch(s=>{this.log(`Could not clear media keys: ${s}. media.src: ${t?.src}`)}))).then(()=>{i&&(this.log("finished closing key sessions and clearing media keys"),r.length=0)}).catch(s=>{this.log(`Could not close sessions and clear media keys: ${s}. media.src: ${t?.src}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(t,{sessionKeys:r}){if(r&&this.config.emeEnabled&&!this.keyFormatPromise){const i=r.reduce((s,o)=>(-1===s.indexOf(o.keyFormat)&&s.push(o.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(t){const{mediaKeysSession:r,licenseXhr:i}=t;if(r){this.log(`Remove licenses and keys and close session ${r.sessionId}`),r.onmessage=null,r.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(t);return s>-1&&this.mediaKeySessions.splice(s,1),r.remove().catch(o=>{this.log(`Could not remove session: ${o}`)}).then(()=>r.close()).catch(o=>{this.log(`Could not close session: ${o}`)})}}}return n.CDMCleanupPromise=void 0,n})();class _o extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class Qc{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:"m",su:!this.initialized})}catch(s){de.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const s=i.frag,o=this.hls.levels[s.level],u=this.getObjectType(s),d={d:1e3*s.duration,ot:u};("v"===u||"a"===u||"av"==u)&&(d.br=o.bitrate/1e3,d.tb=this.getTopBandwidth(u)/1e3,d.bl=this.getBufferLength(u)),this.apply(i,d)}catch(s){de.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;null!=r&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||Qc.uuid(),this.cid=r.contentId,this.useHeaders=!0===r.useHeaders,this.registerListeners())}registerListeners(){const e=this.hls;e.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.MEDIA_DETACHED,this.onMediaDetached,this),e.on(F.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.MEDIA_DETACHED,this.onMediaDetached,this),e.off(F.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,i;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}createData(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){if(di(t,this.createData()),this.starved&&("i"===t.ot||"v"===t.ot||"av"===t.ot)&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering),this.useHeaders){const i=Qc.toHeaders(t);if(!Object.keys(i).length)return;e.headers||(e.headers={}),di(e.headers,i)}else{const i=Qc.toQuery(t);if(!i)return;e.url=Qc.appendQueryToUri(e.url,i)}}getObjectType(e){const{type:t}=e;return"subtitle"===t?"tt":"initSegment"===e.sn?"i":"audio"===t?"a":"main"===t?this.hls.audioTracks.length?"v":"av":void 0}getTopBandwidth(e){let r,t=0;const i=this.hls;if("a"===e)r=i.audioTracks;else{const s=i.maxAutoLevel;r=i.levels.slice(0,s>-1?s+1:i.levels.length)}for(const s of r)s.bitrate>t&&(t=s.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,r="a"===e?this.audioBuffer:this.videoBuffer;return r&&t?1e3*pr.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,u){t(s),this.loader.load(s,o,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,u){t(s),this.loader.load(s,o,u)}}}static uuid(){const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}static serialize(e){const t=[],r=f=>!Number.isNaN(f)&&null!=f&&""!==f&&!1!==f,i=f=>Math.round(f),s=f=>100*i(f/100),u={br:i,d:i,bl:s,dl:s,mtp:s,nor:f=>encodeURIComponent(f),rtp:s,tb:i},d=Object.keys(e||{}).sort();for(const f of d){let g=e[f];if(!r(g)||"v"===f&&1===g||"pr"==f&&1===g)continue;const b=u[f];b&&(g=b(g));const T=typeof g;let w;w="ot"===f||"sf"===f||"st"===f?`${f}=${g}`:"boolean"===T?f:"number"===T?`${f}=${g}`:`${f}=${JSON.stringify(g)}`,t.push(w)}return t.join(",")}static toHeaders(e){const t=Object.keys(e),r={},i=["Object","Request","Session","Status"],s=[{},{},{},{}],o={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const u of t)s[null!=o[u]?o[u]:1][u]=e[u];for(let u=0;u<s.length;u++){const d=Qc.serialize(s[u]);d&&(r[`CMCD-${i[u]}`]=d)}return r}static toQuery(e){return`CMCD=${encodeURIComponent(Qc.serialize(e))}`}static appendQueryToUri(e,t){if(!t)return e;const r=e.includes("?")?"&":"?";return`${e}${r}${t}`}}function RC(n,e,t,r){n&&Object.keys(e).forEach(i=>{const s=n.filter(o=>o.groupId===i).map(o=>{const u=di({},o);return u.details=void 0,u.attrs=new Ar(u.attrs),u.url=u.attrs.URI=Ov(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[i],u.attrs["PATHWAY-ID"]=r,u});n.push(...s)})}function Ov(n,e,t,r){const{HOST:i,PARAMS:s,[t]:o}=r;let u;e&&(u=o?.[e],u&&(n=u));const d=new self.URL(n);return i&&!u&&(d.host=i),s&&Object.keys(s).sort().forEach(f=>{f&&d.searchParams.set(f,s[f])}),d.href}const MC=/^age:\s*[\d.]+\s*$/im;class Ew{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Up,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e)return;const r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!this.stats.aborted)return s(r,t.url)}).catch(o=>(r.open("GET",t.url,!0),s(r,t.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{this.callbacks.onError({code:r.status,text:o.message},t,r,i)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const i=this.context.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=r.loadPolicy;if(i)for(const u in i)e.setRequestHeader(u,i[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=s&&en(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!r.aborted&&i>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const o=t.status,u="text"!==t.responseType;if(o>=200&&o<300&&(u&&t.response||null!==t.responseText)){r.loading.end=Math.max(self.performance.now(),r.loading.first);const d=u?t.response:t.responseText;if(r.loaded=r.total="arraybuffer"===t.responseType?d.byteLength:d.length,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;const g=this.callbacks.onProgress;if(g&&g(r,e,d,t),!this.callbacks)return;this.callbacks.onSuccess({url:t.responseURL,data:d,code:o},r,e,t)}else{const d=s.loadPolicy.errorRetry;Aa(d,r.retry,!1,o)?this.retry(d):(de.error(`${o} while loading ${e.url}`),this.callbacks.onError({code:o,text:t.statusText},e,t,r))}}}loadtimeout(){var e;const t=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry;if(Aa(t,this.stats.retry,!0))this.retry(t);else{de.warn(`timeout while loading ${this.context.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=Qg(e,r.retry),r.retry++,de.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&MC.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const kC=/(\d+)-(\d+)\/(\d+)/;class Tw{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||OC,this.controller=new self.AbortController,this.stats=new Up}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=function Iw(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(di({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}(e,this.controller.signal),o=r.onProgress,u="arraybuffer"===e.responseType,d=u?"byteLength":"length",{maxTimeToFirstByteMs:f,maxLoadTimeMs:g}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=f&&en(f)?f:g,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(i,e,this.response)},t.timeout),self.fetch(this.request).then(b=>{this.response=this.loader=b;const T=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=g,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(i,e,this.response)},g-(T-i.loading.start)),!b.ok){const{status:w,statusText:x}=b;throw new NC(x||"fetch, bad network response",w,b)}return i.loading.first=T,i.total=function PC(n){const e=n.get("Content-Range");if(e){const r=function LC(n){const e=kC.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}(e);if(en(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}(b.headers)||i.total,o&&en(t.highWaterMark)?this.loadProgressively(b,i,e,t.highWaterMark,o):u?b.arrayBuffer():"json"===e.responseType?b.json():b.text()}).then(b=>{const{response:T}=this;self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const w=b[d];w&&(i.loaded=i.total=w);const x={url:T.url,data:b,code:T.status};o&&!en(t.highWaterMark)&&o(i,e,b,T),r.onSuccess(x,i,e,T)}).catch(b=>{self.clearTimeout(this.requestTimeout),i.aborted||r.onError({code:b&&b.code||0,text:b?b.message:null},e,b?b.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,i=0,s){const o=new XI,u=e.body.getReader(),d=()=>u.read().then(f=>{if(f.done)return o.dataLength&&s(t,r,o.flush(),e),Promise.resolve(new ArrayBuffer(0));const g=f.value,b=g.length;return t.loaded+=b,b<i||o.dataLength?(o.push(g),o.dataLength>=i&&s(t,r,o.flush(),e)):s(t,r,g,e),d()}).catch(()=>Promise.reject());return d()}}function OC(n,e){return new self.Request(n.url,e)}class NC extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const FC=/\s/,UC={newCue(n,e,t,r){const i=[];let s,o,u,d,f;const g=self.VTTCue||self.TextTrackCue;for(let T=0;T<r.rows.length;T++)if(s=r.rows[T],u=!0,d=0,f="",!s.isEmpty()){var b;for(let k=0;k<s.chars.length;k++)FC.test(s.chars[k].uchar)&&u?d++:(f+=s.chars[k].uchar,u=!1);s.cueStartTime=e,e===t&&(t+=1e-4),d>=16?d--:d++;const w=dw(f.trim()),x=py(e,t,w);null!=n&&null!=(b=n.cues)&&b.getCueById(x)||(o=new g(e,t,w),o.id=x,o.line=T+1,o.align="left",o.position=10+Math.min(80,10*Math.floor(8*d/32)),i.push(o))}return n&&i.length&&(i.sort((T,w)=>"auto"===T.line||"auto"===w.line?0:T.line>8&&w.line>8?w.line-T.line:T.line-w.line),i.forEach(T=>zg(n,T))),i}},VC=hs(hs({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ew,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class QI{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;const t=e.config;this.bwEstimator=new aC(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(F.FRAG_LOADING,this.onFragLoading,this),e.on(F.FRAG_LOADED,this.onFragLoaded,this),e.on(F.FRAG_BUFFERED,this.onFragBuffered,this),e.on(F.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(F.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:e}=this;e.off(F.FRAG_LOADING,this.onFragLoading,this),e.off(F.FRAG_LOADED,this.onFragLoaded,this),e.off(F.FRAG_BUFFERED,this.onFragBuffered,this),e.off(F.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(F.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,t){var r;const i=t.frag;this.ignoreFragment(i)||(this.fragCurrent=i,this.partCurrent=null!=(r=t.part)?r:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,t){this.clearTimer()}getTimeToLoadFrag(e,t,r,i){return e+r/t+(i?this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const r=this.hls.config,{total:i,bwEstimate:s}=t.stats;en(i)&&en(s)&&(this.lastLevelLoadSec=8*i/s),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{autoLevelEnabled:i,media:s}=r;if(!e||!s)return;const o=performance.now(),u=t?t.stats:e.stats,d=t?t.duration:e.duration,f=o-u.loading.start;if(u.aborted||u.loaded&&u.loaded===u.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!i||s.paused||!s.playbackRate||!s.readyState)return;const g=r.mainForwardBufferInfo;if(null===g)return;const b=this.bwEstimator.getEstimateTTFB(),T=Math.abs(s.playbackRate);if(f<=Math.max(b,d/(2*T)*1e3))return;const w=g.len/T;if(w>=2*d/T)return;const x=u.loading.first?u.loading.first-u.loading.start:-1,k=u.loaded&&x>-1,N=this.bwEstimator.getEstimate(),{levels:z,minAutoLevel:X}=r,ie=u.total||Math.max(u.loaded,Math.round(d*z[e.level].maxBitrate/8));let le=f-x;le<1&&k&&(le=Math.min(f,8*u.loaded/N));const Me=k?1e3*u.loaded/le:0,Ie=Me?(ie-u.loaded)/Me:8*ie/N+b/1e3;if(Ie<=w)return;const We=Me?8*Me:N;let Fe,ot=Number.POSITIVE_INFINITY;for(Fe=e.level-1;Fe>X&&(ot=this.getTimeToLoadFrag(b/1e3,We,d*z[Fe].maxBitrate,!z[Fe].details),!(ot<w));Fe--);ot>=Ie||ot>10*d||(r.nextLoadLevel=Fe,k?this.bwEstimator.sample(f-Math.min(b,x),u.loaded):this.bwEstimator.sampleTTFB(f),this.clearTimer(),de.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;\n      Time to underbuffer: ${w.toFixed(3)} s\n      Estimated load time for current fragment: ${Ie.toFixed(3)} s\n      Estimated load time for down switch fragment: ${ot.toFixed(3)} s\n      TTFB estimate: ${x}\n      Current BW estimate: ${en(N)?(N/1024).toFixed(3):"Unknown"} Kb/s\n      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s\n      Aborting and switching to level ${Fe}`),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),r.trigger(F.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:u}))}onFragLoaded(e,{frag:t,part:r}){const i=r?r.stats:t.stats;if(t.type===un.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const o=this.hls.levels[t.level],u=(o.loaded?o.loaded.bytes:0)+i.loaded,d=(o.loaded?o.loaded.duration:0)+(r?r.duration:t.duration);o.loaded={bytes:u,duration:d},o.realBitrate=Math.round(8*u/d)}t.bitrateTest&&(this.onFragBuffered(F.FRAG_BUFFERED,{stats:i,frag:t,part:r,id:t.type}),t.bitrateTest=!1)}}onFragBuffered(e,t){const{frag:r,part:i}=t,s=null!=i&&i.stats.loaded?i.stats:r.stats;if(s.aborted||this.ignoreFragment(r))return;const o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.bwEstimator.getEstimate(),this.bitrateTestDelay=r.bitrateTest?o/1e3:0}ignoreFragment(e){return e.type!==un.MAIN||"initSegment"===e.sn}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const e=this._nextAutoLevel;if(-1!==e&&!this.bwEstimator.canEstimate())return e;let r=this.getNextABRAutoLevel();if(-1!==e){const i=this.hls.levels;if(i.length>Math.max(e,r)&&i[e].loadError<=i[r].loadError)return e}return-1!==e&&(r=Math.min(e,r)),r}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{maxAutoLevel:i,config:s,minAutoLevel:o,media:u}=r,d=t?t.duration:e?e.duration:0,f=u&&0!==u.playbackRate?Math.abs(u.playbackRate):1,g=this.bwEstimator?this.bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,b=r.mainForwardBufferInfo,T=(b?b.len:0)/f;let w=this.findBestLevel(g,o,i,T,s.abrBandWidthFactor,s.abrBandWidthUpFactor);if(w>=0)return w;de.trace(`[abr] ${T?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let x=d?Math.min(d,s.maxStarvationDelay):s.maxStarvationDelay,k=s.abrBandWidthFactor,N=s.abrBandWidthUpFactor;if(!T){const z=this.bitrateTestDelay;z&&(x=(d?Math.min(d,s.maxLoadingDelay):s.maxLoadingDelay)-z,de.trace(`[abr] bitrate test took ${Math.round(1e3*z)}ms, set first fragment max fetchDuration to ${Math.round(1e3*x)} ms`),k=N=1)}return w=this.findBestLevel(g,o,i,T+x,k,N),Math.max(w,0)}findBestLevel(e,t,r,i,s,o){var u;const{fragCurrent:d,partCurrent:f,lastLoadedFragLevel:g}=this,{levels:b}=this.hls,T=b[g],w=!(null==T||null==(u=T.details)||!u.live),x=T?.codecSet,k=f?f.duration:d?d.duration:0,N=this.bwEstimator.getEstimateTTFB()/1e3;let z=t,X=-1;for(let K=r;K>=t;K--){const ie=b[K];if(!ie||x&&ie.codecSet!==x){ie&&(z=Math.min(K,z),X=Math.max(K,X));continue}-1!==X&&de.trace(`[abr] Skipped level(s) ${z}-${X} with CODECS:"${b[X].attrs.CODECS}"; not compatible with "${T.attrs.CODECS}"`);const le=ie.details,Me=(f?le?.partTarget:le?.averagetargetduration)||k;let Ie;Ie=K<=g?s*e:o*e;const We=b[K].maxBitrate,ot=this.getTimeToLoadFrag(N,Ie,We*Me,void 0===le);if(de.trace(`[abr] level:${K} adjustedbw-bitrate:${Math.round(Ie-We)} avgDuration:${Me.toFixed(1)} maxFetchDuration:${i.toFixed(1)} fetchDuration:${ot.toFixed(1)}`),Ie>We&&(0===ot||!en(ot)||w&&!this.bitrateTestDelay||ot<i))return K}return-1}set nextAutoLevel(e){this._nextAutoLevel=e}},bufferController:class pC{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:t,mediaSource:r}=this;de.log("[buffer-controller]: Media source opened"),t&&(t.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(F.MEDIA_ATTACHED,{media:t})),r&&r.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{de.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{de.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:t,_objectUrl:r}=this;t&&t.src!==r&&de.error(`Media element src was set while attaching MediaSource (${r} > ${t.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:e}=this;e.on(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.BUFFER_RESET,this.onBufferReset,this),e.on(F.BUFFER_APPENDING,this.onBufferAppending,this),e.on(F.BUFFER_CODECS,this.onBufferCodecs,this),e.on(F.BUFFER_EOS,this.onBufferEos,this),e.on(F.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(F.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(F.FRAG_PARSED,this.onFragParsed,this),e.on(F.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.BUFFER_RESET,this.onBufferReset,this),e.off(F.BUFFER_APPENDING,this.onBufferAppending,this),e.off(F.BUFFER_CODECS,this.onBufferCodecs,this),e.off(F.BUFFER_EOS,this.onBufferEos,this),e.off(F.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(F.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(F.FRAG_PARSED,this.onFragParsed,this),e.off(F.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new fC(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,de.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const r=this.media=t.media;if(r&&tw){const i=this.mediaSource=new tw;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(i),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:r}=this;if(t){if(de.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(i){de.warn(`[buffer-controller]: onMediaDetaching: ${i.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):de.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(F.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{const t=this.sourceBuffer[e];try{t&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(t),this.sourceBuffer[e]=void 0)}catch(r){de.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,r)}}),this._initSourceBuffer()}onBufferCodecs(e,t){const r=this.getSourceBufferTypes().length;Object.keys(t).forEach(i=>{if(r){const s=this.tracks[i];if(s&&"function"==typeof s.buffer.changeType){const{id:o,codec:u,levelCodec:d,container:f,metadata:g}=t[i],b=(s.levelCodec||s.codec).replace(nw,"$1"),T=(d||u).replace(nw,"$1");b!==T&&(this.appendChangeType(i,`${f};codecs=${d||u}`),de.log(`[buffer-controller]: switching codec ${b} to ${T}`),this.tracks[i]={buffer:s.buffer,codec:u,container:f,levelCodec:d,metadata:g,id:o})}}else this.pendingTracks[i]=t[i]}),!r&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())}appendChangeType(e,t){const{operationQueue:r}=this,i={execute:()=>{const s=this.sourceBuffer[e];s&&(de.log(`[buffer-controller]: changing ${e} sourceBuffer type to ${t}`),s.changeType(t)),r.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:s=>{de.warn(`[buffer-controller]: Failed to change ${e} SourceBuffer type`,s)}};r.append(i,e)}onBufferAppending(e,t){const{hls:r,operationQueue:i,tracks:s}=this,{data:o,type:u,frag:d,part:f,chunkMeta:g}=t,b=g.buffering[u],T=self.performance.now();b.start=T;const w=d.stats.buffering,x=f?f.stats.buffering:null;0===w.start&&(w.start=T),x&&0===x.start&&(x.start=T);let N=!1;"audio"===u&&"audio/mpeg"===s.audio?.container&&(N=!this.lastMpegAudioChunk||1===g.id||this.lastMpegAudioChunk.sn!==g.sn,this.lastMpegAudioChunk=g);const z=d.start;i.append({execute:()=>{if(b.executeStart=self.performance.now(),N){const K=this.sourceBuffer[u];if(K){const ie=z-K.timestampOffset;Math.abs(ie)>=.1&&(de.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${z} (delta: ${ie}) sn: ${d.sn})`),K.timestampOffset=z)}}this.appendExecutor(o,u)},onStart:()=>{},onComplete:()=>{const K=self.performance.now();b.executeEnd=b.end=K,0===w.first&&(w.first=K),x&&0===x.first&&(x.first=K);const{sourceBuffer:ie}=this,le={};for(const Me in ie)le[Me]=pr.getBuffered(ie[Me]);this.appendError=0,this.hls.trigger(F.BUFFER_APPENDED,{type:u,frag:d,part:f,chunkMeta:g,parent:d.type,timeRanges:le})},onError:K=>{de.error(`[buffer-controller]: Error encountered while trying to append to the ${u} SourceBuffer`,K);const ie={type:ln.MEDIA_ERROR,parent:d.type,details:Ne.BUFFER_APPEND_ERROR,frag:d,part:f,chunkMeta:g,error:K,err:K,fatal:!1};K.code===DOMException.QUOTA_EXCEEDED_ERR?ie.details=Ne.BUFFER_FULL_ERROR:(this.appendError++,ie.details=Ne.BUFFER_APPEND_ERROR,this.appendError>r.config.appendErrorMaxRetry&&(de.error(`[buffer-controller]: Failed ${r.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),ie.fatal=!0)),r.trigger(F.ERROR,ie)}},u)}onBufferFlushing(e,t){const{operationQueue:r}=this,i=s=>({execute:this.removeExecutor.bind(this,s,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(F.BUFFER_FLUSHED,{type:s})},onError:o=>{de.warn(`[buffer-controller]: Failed to remove from ${s} SourceBuffer`,o)}});t.type?r.append(i(t.type),t.type):this.getSourceBufferTypes().forEach(s=>{r.append(i(s),s)})}onFragParsed(e,t){const{frag:r,part:i}=t,s=[],o=i?i.elementaryStreams:r.elementaryStreams;o[hr.AUDIOVIDEO]?s.push("audiovideo"):(o[hr.AUDIO]&&s.push("audio"),o[hr.VIDEO]&&s.push("video")),0===s.length&&de.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(()=>{const d=self.performance.now();r.stats.buffering.end=d,i&&(i.stats.buffering.end=d),this.hls.trigger(F.FRAG_BUFFERED,{frag:r,part:i,stats:i?i.stats:r.stats,id:r.type})},s)}onFragChanged(e,t){this.flushBackBuffer()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((i,s)=>{const o=this.sourceBuffer[s];return o&&(!t.type||t.type===s)&&(o.ending=!0,o.ended||(o.ended=!0,de.log(`[buffer-controller]: ${s} sourceBuffer now EOS`))),i&&!(o&&!o.ended)},!0)&&(de.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(s=>{const o=this.sourceBuffer[s];o&&(o.ending=!1)});const{mediaSource:i}=this;i&&"open"===i.readyState?(de.log("[buffer-controller]: Calling mediaSource.endOfStream()"),i.endOfStream()):i&&de.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${i.readyState}`)}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:e,details:t,media:r,sourceBuffer:i}=this;if(!r||null===t)return;const s=this.getSourceBufferTypes();if(!s.length)return;const o=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(!en(o)||o<0)return;const u=r.currentTime,d=t.levelTargetDuration,f=Math.max(o,d),g=Math.floor(u/d)*d-f;s.forEach(b=>{const T=i[b];if(T){const w=pr.getBuffered(T);if(w.length>0&&g>w.start(0)){if(e.trigger(F.BACK_BUFFER_REACHED,{bufferEnd:g}),t.live)e.trigger(F.LIVE_BACK_BUFFER_REACHED,{bufferEnd:g});else if(T.ended&&w.end(w.length-1)-u<2*d)return void de.info(`[buffer-controller]: Cannot flush ${b} back buffer while SourceBuffer is in ended state`);e.trigger(F.BUFFER_FLUSHING,{startOffset:0,endOffset:g,type:b})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{details:e,hls:t,media:r,mediaSource:i}=this,s=e.fragments[0].start+e.totalduration,o=r.duration,u=en(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(de.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=1/0,this.updateSeekableRange(e)):(s>u&&s>o||!en(o))&&(de.log(`[buffer-controller]: Updating Media Source duration to ${s.toFixed(3)}`),i.duration=s)}updateSeekableRange(e){const t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&null!=t&&t.setLiveSeekableRange){const s=Math.max(0,r[0].start),o=Math.max(s,s+e.totalduration);t.setLiveSeekableRange(s,o)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:r}=this,i=Object.keys(r).length;if(i&&!e||2===i){this.createSourceBuffers(r),this.pendingTracks={};const s=this.getSourceBufferTypes();if(s.length)this.hls.trigger(F.BUFFER_CREATED,{tracks:this.tracks}),s.forEach(o=>{t.executeNext(o)});else{const o=new Error("could not create source buffer for media codec(s)");this.hls.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:o,reason:o.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(const i in e)if(!t[i]){const s=e[i];if(!s)throw Error(`source buffer exists for track ${i}, however track does not`);const o=s.levelCodec||s.codec,u=`${s.container};codecs=${o}`;de.log(`[buffer-controller]: creating sourceBuffer(${u})`);try{const d=t[i]=r.addSourceBuffer(u),f=i;this.addBufferListener(f,"updatestart",this._onSBUpdateStart),this.addBufferListener(f,"updateend",this._onSBUpdateEnd),this.addBufferListener(f,"error",this._onSBUpdateError),this.tracks[i]={buffer:d,codec:o,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id}}catch(d){de.error(`[buffer-controller]: error while trying to add sourceBuffer: ${d.message}`),this.hls.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:d,mimeType:u})}}}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){const{operationQueue:t}=this;t.current(e).onComplete(),t.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){const r=new Error(`${e} SourceBuffer error`);de.error(`[buffer-controller]: ${r}`,t),this.hls.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.BUFFER_APPENDING_ERROR,error:r,fatal:!1});const i=this.operationQueue.current(e);i&&i.onError(t)}removeExecutor(e,t,r){const{media:i,mediaSource:s,operationQueue:o,sourceBuffer:u}=this,d=u[e];if(!i||!s||!d)return de.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void o.shiftAndExecuteNext(e);const f=en(i.duration)?i.duration:1/0,g=en(s.duration)?s.duration:1/0,b=Math.max(0,t),T=Math.min(r,f,g);T>b&&!d.ending?(d.ended=!1,de.log(`[buffer-controller]: Removing [${b},${T}] from the ${e} SourceBuffer`),d.remove(b,T)):o.shiftAndExecuteNext(e)}appendExecutor(e,t){const{operationQueue:r,sourceBuffer:i}=this,s=i[t];if(!s)return de.warn(`[buffer-controller]: Attempting to append to the ${t} SourceBuffer, but it does not exist`),void r.shiftAndExecuteNext(t);s.ended=!1,s.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length)return de.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);const{operationQueue:r}=this,i=t.map(s=>r.appendBlocker(s));Promise.all(i).then(()=>{e(),t.forEach(s=>{const o=this.sourceBuffer[s];null!=o&&o.updating||r.shiftAndExecuteNext(s)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,r){const i=this.sourceBuffer[e];if(!i)return;const s=r.bind(this,e);this.listeners[e].push({event:t,listener:s}),i.addEventListener(t,s)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(r=>{t.removeEventListener(r.event,r.listener)})}},capLevelController:vy,errorController:class Rx{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=de.log.bind(de,"[info]:"),this.warn=de.warn.bind(de,"[warning]:"),this.error=de.error.bind(de,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(F.ERROR,this.onError,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(F.ERROR,this.onError,this),e.off(F.ERROR,this.onErrorOut,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return e?.type===un.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r,i;if(t.fatal)return;const s=this.hls,o=t.context;switch(t.details){case Ne.FRAG_LOAD_ERROR:case Ne.FRAG_LOAD_TIMEOUT:case Ne.KEY_LOAD_ERROR:case Ne.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case Ne.FRAG_PARSING_ERROR:if(null!=(r=t.frag)&&r.gap)return void(t.errorAction={action:0,flags:0});case Ne.FRAG_GAP:case Ne.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=2);case Ne.LEVEL_EMPTY_ERROR:case Ne.LEVEL_PARSING_ERROR:{var u,d;const f=t.parent===un.MAIN?t.level:s.loadLevel;t.details===Ne.LEVEL_EMPTY_ERROR&&null!=(u=t.context)&&null!=(d=u.levelDetails)&&d.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,f):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,f))}return;case Ne.LEVEL_LOAD_ERROR:case Ne.LEVEL_LOAD_TIMEOUT:return void("number"==typeof o?.level&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.level)));case Ne.AUDIO_TRACK_LOAD_ERROR:case Ne.AUDIO_TRACK_LOAD_TIMEOUT:case Ne.SUBTITLE_LOAD_ERROR:case Ne.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){const f=s.levels[s.loadLevel];if(f&&(o.type===Zn.AUDIO_TRACK&&o.groupId===f.audioGroupId||o.type===Zn.SUBTITLE_TRACK&&o.groupId===f.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=2,void(t.errorAction.flags=1)}return;case Ne.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const g=s.levels[s.loadLevel]?.attrs["HDCP-LEVEL"];g&&(t.errorAction={action:2,flags:2,hdcpLevel:g})}return;case Ne.BUFFER_ADD_CODEC_ERROR:case Ne.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(i=t.level)?i:s.loadLevel));case Ne.INTERNAL_EXCEPTION:case Ne.BUFFER_APPENDING_ERROR:case Ne.BUFFER_APPEND_ERROR:case Ne.BUFFER_FULL_ERROR:case Ne.LEVEL_SWITCH_ERROR:case Ne.BUFFER_STALLED_ERROR:case Ne.BUFFER_SEEK_OVER_HOLE:case Ne.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:0,flags:0})}if(t.type===ln.KEY_SYSTEM_ERROR){const f=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,f))}}getPlaylistRetryOrSwitchAction(e,t){var r;const s=nv(this.hls.config.playlistLoadPolicy,e),o=this.playlistError++,u=null==(r=e.response)?void 0:r.code;if(Aa(s,o,Wp(e),u))return{action:5,flags:0,retryConfig:s,retryCount:o};const f=this.getLevelSwitchAction(e,t);return s&&(f.retryConfig=s,f.retryCount=o),f}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],{fragLoadPolicy:s,keyLoadPolicy:o}=t.config,u=nv(e.details.startsWith("key")?o:s,e),d=t.levels.reduce((b,T)=>b+T.fragmentError,0);if(i){var f;e.details!==Ne.FRAG_GAP&&i.fragmentError++;const b=null==(f=e.response)?void 0:f.code;if(Aa(u,d,Wp(e),b))return{action:5,flags:0,retryConfig:u,retryCount:d}}const g=this.getLevelSwitchAction(e,r);return u&&(g.retryConfig=u,g.retryCount=d),g}getLevelSwitchAction(e,t){const r=this.hls;null==t&&(t=r.loadLevel);const i=this.hls.levels[t];if(i&&(i.loadError++,r.autoLevelEnabled)){var s,o;let u=-1;const{levels:d,loadLevel:f,minAutoLevel:g,maxAutoLevel:b}=r,T=null==(s=e.frag)?void 0:s.type,{type:w,groupId:x}=null!=(o=e.context)?o:{};for(let k=d.length;k--;){const N=(k+f)%d.length;if(N!==f&&N>=g&&N<=b&&0===d[N].loadError){const z=d[N];if(e.details===Ne.FRAG_GAP&&e.frag){const X=d[N].details;if(X){const K=xa(e.frag,X.fragments,e.frag.start);if(null!=K&&K.gap)continue}}else{if(w===Zn.AUDIO_TRACK&&x===z.audioGroupId||w===Zn.SUBTITLE_TRACK&&x===z.textGroupId)continue;if(T===un.AUDIO&&i.audioGroupId===z.audioGroupId||T===un.SUBTITLE&&i.textGroupId===z.textGroupId)continue}u=N;break}}if(u>-1&&r.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:2,flags:0,nextAutoLevel:u}}return{action:2,flags:1}}onErrorOut(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case 0:break;case 2:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Ne.FRAG_GAP&&(t.fatal=!0)}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:i,hdcpLevel:s,nextAutoLevel:o}=r;switch(i){case 0:this.switchLevel(e,o);break;case 1:r.resolved||(r.resolved=this.redundantFailover(e));break;case 2:s&&(t.maxHdcpLevel=zp[zp.indexOf(s)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}r.resolved||this.switchLevel(e,o)}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(e){const{hls:t,penalizedRenditions:r}=this,i=e.parent===un.MAIN?e.level:t.loadLevel,s=t.levels[i],o=s.url.length,u=e.frag?e.frag.urlId:s.urlId;s.urlId===u&&(!e.frag||s.details)&&this.penalizeRendition(s,e);for(let d=1;d<o;d++){const f=(u+d)%o,g=r[f];if(!g||gI(g,e,r[u]))return this.warn(`Switching to Redundant Stream ${f+1}/${o}: "${s.url[f]}" after ${e.details}`),this.playlistError=0,t.levels.forEach(b=>{b.urlId=f}),t.nextLoadLevel=i,!0}return!1}penalizeRendition(e,t){const{penalizedRenditions:r}=this,i=r[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};i.lastErrorPerfMs=performance.now(),i.errors.push(t),i.details=e.details,r[e.urlId]=i}},fpsController:class Pv{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(F.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(F.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&"function"==typeof i.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,r){const i=performance.now();if(t){if(this.lastTime){const o=r-this.lastDroppedFrames,u=t-this.lastDecodedFrames,d=1e3*o/(i-this.lastTime),f=this.hls;if(f.trigger(F.FPS_DROP,{currentDropped:o,currentDecoded:u,totalDroppedFrames:r}),d>0&&o>f.config.fpsDroppedMonitoringThreshold*u){let g=f.currentLevel;de.warn("drop FPS ratio greater than max allowed value for currentLevel: "+g),g>0&&(-1===f.autoLevelCapping||f.autoLevelCapping>=g)&&(g-=1,f.trigger(F.FPS_DROP_LEVEL_CAPPING,{level:g,droppedLevel:f.currentLevel}),f.autoLevelCapping=g,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:WT,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},function $C(){return{cueHandler:UC,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}()),{},{subtitleStreamController:class dC extends ty{constructor(e,t,r){super(e,t,r,"[subtitle-stream-controller]",un.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.LEVEL_LOADED,this.onLevelLoaded,this),e.on(F.ERROR,this.onError,this),e.on(F.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(F.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(F.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(F.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(F.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(F.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.LEVEL_LOADED,this.onLevelLoaded,this),e.off(F.ERROR,this.onError,this),e.off(F.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(F.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(F.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(F.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(F.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(F.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state="IDLE",this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:i}=t;if(this.fragPrevious=r,this.state="IDLE",!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o;const u=r.start;for(let f=0;f<s.length;f++)if(u>=s[f].start&&u<=s[f].end){o=s[f];break}const d=r.start+r.duration;o?o.end=d:(o={start:u,end:d},s.push(o)),this.fragmentTracker.fragBuffered(r)}onBufferFlushing(e,t){const{startOffset:r,endOffset:i}=t;if(0===r&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let u=0;u<o.length;)if(o[u].end<=s)o.shift();else{if(!(o[u].start<s))break;o[u].start=s,u++}}),this.fragmentTracker.removeFragmentsInRange(r,s,un.SUBTITLE)}}onFragBuffered(e,t){var r;this.loadedmetadata||t.frag.type!==un.MAIN||null!=(r=this.media)&&r.buffered.length&&(this.loadedmetadata=!0)}onError(e,t){t.frag?.type===un.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),"STOPPED"!==this.state&&(this.state="IDLE"))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){uC(this.levels,t)?this.levels=t.map(r=>new Wh(r)):(this.tracksBuffered=[],this.levels=t.map(r=>{const i=new Wh(r);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,un.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){if(this.currentTrackId=t.id,!this.levels.length||-1===this.currentTrackId)return void this.clearInterval();const r=this.levels[this.currentTrackId];this.mediaBuffer=null!=r&&r.details?this.mediaBufferTimeRanges:null,r&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var r;const{details:i,id:s}=t,{currentTrackId:o,levels:u}=this;if(!u.length)return;const d=u[o];if(s>=u.length||s!==o||!d)return;this.mediaBuffer=this.mediaBufferTimeRanges;let f=0;if(i.live||null!=(r=d.details)&&r.live){const g=this.mainDetails;if(i.deltaUpdateFailed||!g)return;const b=g.fragments[0];d.details?(f=this.alignPlaylists(i,d.details),0===f&&b&&(f=b.start,Zg(i,f))):i.hasProgramDateTime&&g.hasProgramDateTime?(wI(i,g),f=i.fragments[0].start):b&&(f=b.start,Zg(i,f))}d.details=i,this.levelLastLoaded=s,!this.startFragRequested&&(this.mainDetails||!i.live)&&this.setStartPosition(d.details,f),this.tick(),i.live&&!this.fragCurrent&&this.media&&"IDLE"===this.state&&(xa(null,i.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&i&&i.key&&i.iv&&"AES-128"===i.method){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer).catch(u=>{throw s.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const d=performance.now();s.trigger(F.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:o,tdecrypt:d}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state="IDLE"})}}doTick(){if(this.media){if("IDLE"===this.state){const{currentTrackId:e,levels:t}=this,r=t[e];if(!t.length||!r||!r.details)return;const{config:i}=this,s=this.getLoadPosition(),o=pr.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:u,len:d}=o,f=this.getFwdBufferInfo(this.media,un.MAIN),g=r.details;if(d>this.getMaxBufferLength(f?.len)+g.levelTargetDuration)return;const T=g.fragments,w=T.length,x=g.edge;let k=null;const N=this.fragPrevious;if(u<x){const z=i.maxFragLookUpTolerance,X=u>x-z?0:z;k=xa(N,T,Math.max(T[0].start,u),X),!k&&N&&N.start<T[0].start&&(k=T[0])}else k=T[w-1];if(!k)return;if(k=this.mapToInitFragWhenRequired(k),"initSegment"!==k.sn){const X=T[k.sn-g.startSN-1];X&&X.cc===k.cc&&"NOT_LOADED"===this.fragmentTracker.getState(X)&&(k=X)}"NOT_LOADED"===this.fragmentTracker.getState(k)&&this.loadFragment(k,r,u)}}else this.state="IDLE"}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,r){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,r))}get mediaBufferTimeRanges(){return new hC(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class ew extends sv{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:e}=this;e.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.LEVEL_LOADING,this.onLevelLoading,this),e.on(F.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(F.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(F.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.LEVEL_LOADING,this.onLevelLoading,this),e.off(F.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(F.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(F.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),hd(this.media.textTracks).forEach(t=>{Hh(t)}),this.subtitleTrack=-1,this.media=null)}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,details:i}=t,{trackId:s}=this,o=this.tracksInGroup[s];if(!o)return void this.warn(`Invalid subtitle track id ${r}`);const u=o.details;o.details=t.details,this.log(`subtitle track ${r} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.textGroupIds)return;const r=t.textGroupIds[t.urlId],i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==r){const s=this.tracks.filter(d=>!r||d.groupId===r);this.tracksInGroup=s;const o=this.findTrackId(i?.name)||this.findTrackId();this.groupId=r||null;const u={subtitleTracks:s};this.log(`Updating subtitle tracks, ${s.length} track(s) found in "${r}" group-id`),this.hls.trigger(F.SUBTITLE_TRACKS_UPDATED,u),-1!==o&&this.setSubtitleTrack(o,i)}else this.shouldReloadPlaylist(i)&&this.setSubtitleTrack(this.trackId,i)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if((!this.selectDefaultTrack||i.default)&&(!e||e===i.name))return i.id}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Zn.SUBTITLE_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e,this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0)}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const r=t.id,i=t.groupId;let s=t.url;if(e)try{s=e.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`Loading subtitle playlist for id ${r}`),this.hls.trigger(F.SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:e||null})}}toggleTrackModes(e){const{media:t,trackId:r}=this;if(!t)return;const i=hd(t.textTracks),s=i.filter(u=>u.groupId===this.groupId);if(-1===e)[].slice.call(i).forEach(u=>{u.mode="disabled"});else{const u=s[r];u&&(u.mode="disabled")}const o=s[e];o&&(o.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(e,t){var r;const i=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(this.trackId!==e&&this.toggleTrackModes(e),this.trackId===e&&(-1===e||null!=(r=i[e])&&r.details)||e<-1||e>=i.length)return;this.clearTimer();const s=i[e];if(this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:"")),this.trackId=e,s){const{id:o,groupId:u="",name:d,type:f,url:g}=s;this.hls.trigger(F.SUBTITLE_TRACK_SWITCH,{id:o,groupId:u,name:d,type:f,url:g});const b=this.switchParams(s.url,t?.details);this.loadPlaylist(b)}else this.hls.trigger(F.SUBTITLE_TRACK_SWITCH,{id:e})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=-1;const t=hd(this.media.textTracks);for(let r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},timelineController:class kv{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const t=new Yh(this,"textTrack1"),r=new Yh(this,"textTrack2"),i=new Yh(this,"textTrack3"),s=new Yh(this,"textTrack4");this.cea608Parser1=new wv(1,t,r),this.cea608Parser2=new wv(3,i,s)}e.on(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(F.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(F.FRAG_LOADING,this.onFragLoading,this),e.on(F.FRAG_LOADED,this.onFragLoaded,this),e.on(F.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(F.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(F.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(F.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(F.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(F.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(F.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(F.FRAG_LOADING,this.onFragLoading,this),e.off(F.FRAG_LOADED,this.onFragLoaded,this),e.off(F.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(F.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(F.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(F.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(F.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(e,t,r,i,s){let o=!1;for(let u=s.length;u--;){const d=s[u],f=Lv(d[0],d[1],t,r);if(f>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],r),o=!0,f/(r-t)>.5))return}if(o||s.push([t,r]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[e],t,r,i);else{const u=this.Cues.newCue(null,t,r,i);this.hls.trigger(F.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){const{unparsedVttFrags:o}=this;"main"===r&&(this.initPTS[t.cc]={baseTime:i,timescale:s}),o.length&&(this.unparsedVttFrags=[],o.forEach(u=>{this.onFragLoaded(F.FRAG_LOADED,u)}))}getExistingTrack(e){const{media:t}=this;if(t)for(let r=0;r<t.textTracks.length;r++){const i=t.textTracks[r];if(i[e])return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:i}=this,{label:s,languageCode:o}=t[e],u=this.getExistingTrack(e);if(u)r[e]=u,Hh(r[e]),jg(r[e],i);else{const d=this.createTextTrack("captions",s,o);d&&(d[e]=!0,r[e]=d)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(F.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,r){const i=this.media;if(i)return i.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{Hh(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Hh(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],i=r.some(s=>s.textCodec===xv);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(uC(this.tracks,r))return void(this.tracks=r);if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media?this.media.textTracks:null;this.tracks.forEach((u,d)=>{let f;if(o&&d<o.length){let g=null;for(let b=0;b<o.length;b++)if(AC(o[b],u)){g=o[b];break}g&&(f=g)}if(f)Hh(f);else{const g=this._captionsOrSubtitlesFromCharacteristics(u);f=this.createTextTrack(g,u.name,u.lang),f&&(f.mode="disabled")}f&&(f.groupId=u.groupId,this.textTracks.push(f))})}else if(this.tracks.length){const o=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(F.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){const t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&r)return"captions"}return"subtitles"}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const i=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!i)return;const o=this.captionsProperties[`textTrack${i[1]}`];o&&(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){return this.hls.levels[e.level]?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){const{cea608Parser1:r,cea608Parser2:i,lastSn:s,lastPartIndex:o}=this;if(this.enabled&&r&&i&&t.frag.type===un.MAIN){var u,d;const f=t.frag.sn,g=null!=(u=null==t||null==(d=t.part)?void 0:d.index)?u:-1;f===s+1||f===s&&g===o+1||(r.reset(),i.reset()),this.lastSn=f,this.lastPartIndex=g}}onFragLoaded(e,t){const{frag:r,payload:i}=t;if(r.type===un.SUBTITLE)if(i.byteLength){const s=r.decryptdata;if(null==s||!s.encrypted||"stats"in t){const u=this.tracks[r.level],d=this.vttCCs;d[r.cc]||(d[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),u&&u.textCodec===xv?this._parseIMSC1(r,i):this._parseVTTs(t)}}else this.hls.trigger(F.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;yy(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),r.trigger(F.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{de.log(`Failed to parse IMSC1: ${i}`),r.trigger(F.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:r,payload:i}=e,{initPTS:s,unparsedVttFrags:o}=this,u=s.length-1;if(!s[r.cc]&&-1===u)return void o.push(e);const d=this.hls;!function SC(n,e,t,r,i,s,o){const u=new TC,d=wa(new Uint8Array(n)).trim().replace(hw,"\n").split("\n"),f=[],g=e?function sn(n,e=1){return ay(n,Zx,1/e)}(e.baseTime,e.timescale):0;let x,b="00:00.000",T=0,w=0,k=!0;u.oncue=function(N){const z=t[r];let X=t.ccOffset;const K=(T-g)/9e4;if(null!=z&&z.new&&(void 0!==w?X=t.ccOffset=z.start:wC(t,r,K)),K){if(!e)return void(x=new Error("Missing initPTS for VTT MPEGTS"));X=K-t.presentationOffset}const ie=N.endTime-N.startTime,le=Ls(9e4*(N.startTime+X-w),9e4*i)/9e4;N.startTime=Math.max(le,0),N.endTime=Math.max(le+ie,0);const Me=N.text.trim();N.text=decodeURIComponent(encodeURIComponent(Me)),N.id||(N.id=py(N.startTime,N.endTime,Me)),N.endTime>0&&f.push(N)},u.onparsingerror=function(N){x=N},u.onflush=function(){x?o(x):s(f)},d.forEach(N=>{if(k){if(fy(N,"X-TIMESTAMP-MAP=")){k=!1,N.slice(16).split(",").forEach(z=>{fy(z,"LOCAL:")?b=z.slice(6):fy(z,"MPEGTS:")&&(T=parseInt(z.slice(7)))});try{w=IC(b)/1e3}catch(z){x=z}return}""===N&&(k=!1)}u.parse(N+"\n")}),u.flush()}(null!=(t=r.initSegment)&&t.data?Ju(r.initSegment.data,new Uint8Array(i)):i,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,g=>{this._appendCues(g,r.level),d.trigger(F.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},g=>{const b="Missing initPTS for VTT MPEGTS"===g.message;b?o.push(e):this._fallbackToIMSC1(r,i),de.log(`Failed to parse VTT cue: ${g}`),!(b&&u>r.cc)&&d.trigger(F.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:g})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||yy(t,this.initPTS[e.cc],()=>{r.textCodec=xv,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||"disabled"===i.mode)return;e.forEach(s=>zg(i,s))}else{const i=this.tracks[t];if(!i)return;r.trigger(F.CUES_PARSED,{type:"subtitles",cues:e,track:i.default?"default":"subtitles"+t})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===un.SUBTITLE&&this.onFragLoaded(F.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){const{cea608Parser1:r,cea608Parser2:i}=this;if(!this.enabled||!r||!i)return;const{frag:s,samples:o}=t;if(s.type!==un.MAIN||"NONE"!==this.closedCaptionsForLevel(s))for(let u=0;u<o.length;u++){const d=o[u].bytes;if(d){const f=this.extractCea608Data(d);r.addData(o[u].pts,f[0]),i.addData(o[u].pts,f[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:i,type:s}){const{media:o}=this;if(o&&!(o.currentTime<r)){if(!s||"video"===s){const{captionsTracks:u}=this;Object.keys(u).forEach(d=>jh(u[d],t,r))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==i){const{textTracks:u}=this;Object.keys(u).forEach(d=>jh(u[d],t,i))}}}extractCea608Data(e){const t=[[],[]],r=31&e[0];let i=2;for(let s=0;s<r;s++){const o=e[i++],u=127&e[i++],d=127&e[i++];if((0!==u||0!==d)&&0!=(4&o)){const g=3&o;(0===g||1===g)&&(t[g].push(u),t[g].push(d))}}return t}},audioStreamController:class Xk extends ty{constructor(e,t,r){super(e,t,r,"[audio-stream-controller]",un.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.LEVEL_LOADED,this.onLevelLoaded,this),e.on(F.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(F.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(F.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(F.ERROR,this.onError,this),e.on(F.BUFFER_RESET,this.onBufferReset,this),e.on(F.BUFFER_CREATED,this.onBufferCreated,this),e.on(F.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(F.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(F.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(F.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.LEVEL_LOADED,this.onLevelLoaded,this),e.off(F.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(F.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(F.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(F.ERROR,this.onError,this),e.off(F.BUFFER_RESET,this.onBufferReset,this),e.off(F.BUFFER_CREATED,this.onBufferCreated,this),e.off(F.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(F.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(F.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){if("main"===r){const o=t.cc;this.initPTS[t.cc]={baseTime:i,timescale:s},this.log(`InitPTS for cc: ${o} found from main: ${i}`),this.videoTrackCC=o,"WAITING_INIT_PTS"===this.state&&this.tick()}}startLoad(e){if(!this.levels)return this.startPosition=e,void(this.state="STOPPED");const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state="IDLE"):(this.loadedmetadata=!1,this.state="WAITING_TRACK"),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case"IDLE":this.doTickIdle();break;case"WAITING_TRACK":{var e;const{levels:r,trackId:i}=this,s=null==r||null==(e=r[i])?void 0:e.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state="WAITING_INIT_PTS"}break}case"FRAG_LOADING_WAITING_RETRY":{var t;const r=performance.now(),i=this.retryDate;(!i||r>=i||null!=(t=this.media)&&t.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state="IDLE");break}case"WAITING_INIT_PTS":{const r=this.waitingData;if(r){const{frag:i,part:s,cache:o,complete:u}=r;if(void 0!==this.initPTS[i.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state="FRAG_LOADING";const f={frag:i,part:s,payload:o.flush(),networkDetails:null};this._handleFragmentLoadProgress(f),u&&super._handleFragmentLoadComplete(f)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${i.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const d=this.getLoadPosition(),f=pr.bufferInfo(this.mediaBuffer,d,this.config.maxBufferHole);qp(f.end,this.config.maxFragLookUpTolerance,i)<0&&(this.log(`Waiting fragment cc (${i.cc}) @ ${i.start} cancelled because another fragment at ${f.end} is needed`),this.clearWaitingFragment())}}else this.state="IDLE"}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state="IDLE")}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:r,trackId:i}=this;if(null==t||!t[i]||!r&&(this.startFragRequested||!e.config.startFragPrefetch))return;const o=t[i],u=o.details;if(!u||u.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(u))return void(this.state="WAITING_TRACK");const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,hr.AUDIO,un.AUDIO));const f=this.getFwdBufferInfo(d,un.AUDIO);if(null===f)return;const{bufferedTrack:g,switchingTrack:b}=this;if(!b&&this._streamEnded(f,u))return e.trigger(F.BUFFER_EOS,{type:"audio"}),void(this.state="ENDED");const T=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,un.MAIN),w=f.len,x=this.getMaxBufferLength(T?.len);if(w>=x&&!b)return;const N=u.fragments[0].start;let z=f.end;if(b&&r){const le=this.getLoadPosition();g&&b.attrs!==g.attrs&&(z=le),u.PTSKnown&&le<N&&(f.end>N||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=N+.05)}let X=this.getNextFragment(z,u),K=!1;if(X&&this.isLoopLoading(X,z)&&(K=!!X.gap,X=this.getNextFragmentLoopLoading(X,u,f,un.MAIN,x)),!X)return void(this.bufferFlushed=!0);const ie=T&&X.start>T.end+u.targetduration;if(ie||(null==T||!T.len)&&f.len){const le=this.getAppendedFrag(X.start,un.MAIN);if(null===le||(K||(K=!!le.gap||!!ie&&0===T.len),ie&&!K||K&&f.nextStart&&f.nextStart<le.end))return}this.loadFragment(X,o,z)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Wh(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state="IDLE"):(this.switchingTrack=null,this.bufferedTrack=t,this.state="STOPPED"),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(F.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var r;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=t);const{levels:i}=this,{details:s,id:o}=t;if(!i)return void this.warn(`Audio tracks were reset while loading level ${o}`);this.log(`Track ${o} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const u=i[o];let d=0;if(s.live||null!=(r=u.details)&&r.live){this.checkLiveUpdate(s);const f=this.mainDetails;if(s.deltaUpdateFailed||!f)return;!u.details&&s.hasProgramDateTime&&f.hasProgramDateTime?(wI(s,f),d=s.fragments[0].start):d=this.alignPlaylists(s,u.details)}u.details=s,this.levelLastLoaded=o,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(u.details,d),"WAITING_TRACK"===this.state&&!this.waitForCdnTuneIn(s)&&(this.state="IDLE"),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:i,payload:s}=e,{config:o,trackId:u,levels:d}=this;if(!d)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const f=d[u];if(!f)return void this.warn("Audio track is undefined on fragment load progress");const g=f.details;if(!g)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(r.start);const b=o.defaultAudioCodec||f.audioCodec||"mp4a.40.2";let T=this.transmuxer;T||(T=this.transmuxer=new qI(this.hls,un.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const w=this.initPTS[r.cc],x=null==(t=r.initSegment)?void 0:t.data;if(void 0!==w){const N=i?i.index:-1,X=new jo(r.level,r.sn,r.stats.chunkCount,s.byteLength,N,-1!==N);T.push(s,x,b,"",r,i,g.totalduration,!1,X,w)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${g.startSN} ,${g.endSN}],track ${u}`);const{cache:k}=this.waitingData=this.waitingData||{frag:r,part:i,cache:new XI,complete:!1};k.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state="WAITING_INIT_PTS"}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r.type===un.AUDIO)if(this.fragContextChanged(r))this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==r.sn){this.fragPrevious=r;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(F.AUDIO_TRACK_SWITCHED,hs({},s)))}this.fragBufferedComplete(r,i)}else if(!this.loadedmetadata&&r.type===un.MAIN){const s=this.videoBuffer||this.media;s&&pr.getBuffered(s).length&&(this.loadedmetadata=!0)}}onError(e,t){var r;if(t.fatal)this.state="ERROR";else switch(t.details){case Ne.FRAG_GAP:case Ne.FRAG_PARSING_ERROR:case Ne.FRAG_DECRYPT_ERROR:case Ne.FRAG_LOAD_ERROR:case Ne.FRAG_LOAD_TIMEOUT:case Ne.KEY_LOAD_ERROR:case Ne.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(un.AUDIO,t);break;case Ne.AUDIO_TRACK_LOAD_ERROR:case Ne.AUDIO_TRACK_LOAD_TIMEOUT:case Ne.LEVEL_PARSING_ERROR:!t.levelRetry&&"WAITING_TRACK"===this.state&&(null==(r=t.context)?void 0:r.type)===Zn.AUDIO_TRACK&&(this.state="IDLE");break;case Ne.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Ne.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushed(e,{type:t}){t===hr.AUDIO&&(this.bufferFlushed=!0,"ENDED"===this.state&&(this.state="IDLE"))}_handleTransmuxComplete(e){var t;const r="audio",{hls:i}=this,{remuxResult:s,chunkMeta:o}=e,u=this.getCurrentContext(o);if(!u)return void this.resetWhenMissingContext(o);const{frag:d,part:f,level:g}=u,{details:b}=g,{audio:T,text:w,id3:x,initSegment:k}=s;if(!this.fragContextChanged(d)&&b){if(this.state="PARSING",this.switchingTrack&&T&&this.completeAudioSwitch(this.switchingTrack),null!=k&&k.tracks){const N=d.initSegment||d;this._bufferInitSegment(k.tracks,N,o),i.trigger(F.FRAG_PARSING_INIT_SEGMENT,{frag:N,id:r,tracks:k.tracks})}if(T){const{startPTS:N,endPTS:z,startDTS:X,endDTS:K}=T;f&&(f.elementaryStreams[hr.AUDIO]={startPTS:N,endPTS:z,startDTS:X,endDTS:K}),d.setElementaryStreamInfo(hr.AUDIO,N,z,X,K),this.bufferFragmentData(T,d,f,o)}if(null!=x&&null!=(t=x.samples)&&t.length){const N=di({id:r,frag:d,details:b},x);i.trigger(F.FRAG_PARSING_METADATA,N)}if(w){const N=di({id:r,frag:d,details:b},w);i.trigger(F.FRAG_PARSING_USERDATA,N)}}else this.fragmentTracker.removeFragment(d)}_bufferInitSegment(e,t,r){if("PARSING"!==this.state)return;e.video&&delete e.video;const i=e.audio;if(!i)return;i.levelCodec=i.codec,i.id="audio",this.log(`Init audio buffer, container:${i.container}, codecs[parsed]=[${i.codec}]`),this.hls.trigger(F.BUFFER_CODECS,e);const s=i.initSegment;null!=s&&s.byteLength&&this.hls.trigger(F.BUFFER_APPENDING,{type:"audio",frag:t,part:null,chunkMeta:r,parent:t.type,data:s}),this.tick()}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);var s;this.fragCurrent=e,this.switchingTrack||"NOT_LOADED"===i||"PARTIAL"===i?"initSegment"===e.sn?this._loadInitSegment(e,t):null!=(s=t.details)&&s.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state="WAITING_INIT_PTS"):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){const{hls:t,media:r,bufferedTrack:i}=this,s=i?.attrs,o=e.attrs;r&&s&&(s.CHANNELS!==o.CHANNELS||s.NAME!==o.NAME||s.LANGUAGE!==o.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(F.AUDIO_TRACK_SWITCHED,hs({},e))}},audioTrackController:class Jk extends sv{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.LEVEL_LOADING,this.onLevelLoading,this),e.on(F.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(F.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(F.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.LEVEL_LOADING,this.onLevelLoading,this),e.off(F.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(F.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(F.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==i)return void this.warn(`Track with id:${r} and group:${i} not found in active group ${o.groupId}`);const u=o.details;o.details=t.details,this.log(`audio-track ${r} "${o.name}" lang:${o.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.audioGroupIds)return;const r=t.audioGroupIds[t.urlId];if(this.groupId!==r){this.groupId=r||null;const i=this.tracks.filter(o=>!r||o.groupId===r);this.selectDefaultTrack&&!i.some(o=>o.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;const s={audioTracks:i};this.log(`Updating audio tracks, ${i.length} track(s) found in group:${r}`),this.hls.trigger(F.AUDIO_TRACKS_UPDATED,s),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===Zn.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid id passed to audio-track controller");this.clearTimer();const r=this.currentTrack,i=t[e],{groupId:s,name:o}=i;if(this.log(`Switching to audio-track ${e} "${o}" lang:${i.lang} group:${s}`),this.trackId=e,this.currentTrack=i,this.selectDefaultTrack=!1,this.hls.trigger(F.AUDIO_TRACK_SWITCHING,hs({},i)),i.details&&!i.details.live)return;const u=this.switchParams(i.url,r?.details);this.loadPlaylist(u)}selectInitialTrack(){const e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(-1!==t)this.setAudioTrack(t);else{const r=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${e.length}`);this.warn(r.message),this.hls.trigger(F.ERROR,{type:ln.MEDIA_ERROR,details:Ne.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:r})}}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if((!this.selectDefaultTrack||i.default)&&(!e||void 0!==e.attrs["STABLE-RENDITION-ID"]&&e.attrs["STABLE-RENDITION-ID"]===i.attrs["STABLE-RENDITION-ID"]||e.name===i.name&&e.lang===i.lang))return i.id}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const r=t.id,i=t.groupId;let s=t.url;if(e)try{s=e.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`loading audio-track playlist ${r} "${t.name}" lang:${t.lang} group:${i}`),this.clearTimer(),this.hls.trigger(F.AUDIO_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:e||null})}}},emeController:_w,cmcdController:Qc,contentSteeringController:class bw{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=de.log.bind(de,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(F.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(F.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(F.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(F.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if(2===r?.action&&1===r.flags){let i=this.pathwayPriority;const s=this.pathwayId;this.penalizedPathways[s]||(this.penalizedPathways[s]=performance.now()),!i&&this.levels&&(i=this.levels.reduce((o,u)=>(-1===o.indexOf(u.pathwayId)&&o.push(u.pathwayId),o),[])),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==s)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this.pathwayPriority=e;const r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(s=>{i-r[s]>3e5&&delete r[s]});for(let s=0;s<e.length;s++){const o=e[s];if(r[o])continue;if(o===this.pathwayId)return;const u=this.hls.nextLoadLevel,d=this.hls.levels[u];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,this.hls.trigger(F.LEVELS_UPDATED,{levels:t});const f=this.hls.levels[u];d&&f&&this.levels&&(f.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&f.bitrate!==d.bitrate&&this.log(`Unstable Pathways change from bitrate ${d.bitrate} to ${f.bitrate}`),this.hls.nextLoadLevel=u);break}}}clonePathways(e){const t=this.levels;if(!t)return;const r={},i={};e.forEach(s=>{const{ID:o,"BASE-ID":u,"URI-REPLACEMENT":d}=s;if(t.some(g=>g.pathwayId===o))return;const f=this.getLevelsForPathway(u).map(g=>{const b=di({},g);b.details=void 0,b.url=Ov(g.uri,g.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",d);const T=new Ar(g.attrs);T["PATHWAY-ID"]=o;const w=T.AUDIO&&`${T.AUDIO}_clone_${o}`,x=T.SUBTITLES&&`${T.SUBTITLES}_clone_${o}`;w&&(r[T.AUDIO]=w,T.AUDIO=w),x&&(i[T.SUBTITLES]=x,T.SUBTITLES=x),b.attrs=T;const k=new Wh(b);return Xg(k,"audio",w),Xg(k,"text",x),k});t.push(...f),RC(this.audioTracks,r,d,o),RC(this.subtitleTracks,i,d,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;let i;this.loader&&this.loader.destroy(),this.loader=new r(t);try{i=new self.URL(e)}catch{return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==i.protocol){const g=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+g)}const s={responseType:"json",url:i.href},o=t.steeringManifestLoadPolicy.default,u=o.errorRetry||o.timeoutRetry||{},d={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},f={onSuccess:(g,b,T,w)=>{this.log(`Loaded steering manifest: "${i}"`);const x=g.data;if(1!==x.VERSION)return void this.log(`Steering VERSION ${x.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=x.TTL;const{"RELOAD-URI":k,"PATHWAY-CLONES":N,"PATHWAY-PRIORITY":z}=x;if(k)try{this.uri=new self.URL(k,i).href}catch{return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${k}`)}this.scheduleRefresh(this.uri||T.url),N&&this.clonePathways(N),z&&this.updatePathwayPriority(z)},onError:(g,b,T,w)=>{if(this.log(`Error loading steering manifest: ${g.code} ${g.text} (${b.url})`),this.stopLoad(),410===g.code)return this.enabled=!1,void this.log(`Steering manifest ${b.url} no longer available`);let x=1e3*this.timeToLoad;if(429!==g.code)this.scheduleRefresh(this.uri||b.url,x);else{const k=this.loader;if("function"==typeof k?.getResponseHeader){const N=k.getResponseHeader("Retry-After");N&&(x=1e3*parseFloat(N))}this.log(`Steering manifest ${b.url} rate limited`)}},onTimeout:(g,b,T)=>{this.log(`Timeout loading steering manifest (${b.url})`),this.scheduleRefresh(this.uri||b.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,d,f)}scheduleRefresh(e,t=1e3*this.timeToLoad){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(e)},t)}}});function by(n){return n&&"object"==typeof n?Array.isArray(n)?n.map(by):Object.keys(n).reduce((e,t)=>(e[t]=by(n[t]),e),{}):n}let Ey=(()=>{class n{static get version(){return"1.4.12"}static isSupported(){return function Ux(){const n=Uh();if(!n)return!1;const e=Qp();return!(!n||"function"!=typeof n.isTypeSupported||!n.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')||e&&(!e.prototype||"function"!=typeof e.prototype.appendBuffer||"function"!=typeof e.prototype.remove))}()}static get Events(){return F}static get ErrorTypes(){return ln}static get ErrorDetails(){return Ne}static get DefaultConfig(){return n.defaultConfig?n.defaultConfig:VC}static set DefaultConfig(t){n.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new uy,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,function ox(n,e){if(self.console&&!0===n||"object"==typeof n){!function yo(n,...e){e.forEach(function(t){Fp[t]=n[t]?n[t].bind(n):function sx(n){const e=self.console[n];return e?e.bind(self.console,`[${n}] >`):Kc}(t)})}(n,"debug","log","info","warn","error");try{Fp.log(`Debug logs enabled for "${e}" in hls.js version 1.4.12`)}catch{Fp=Mg}}else Fp=Mg}(t.debug||!1,"Hls instance");const r=this.config=function sm(n,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=by(n),i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(s=>{const o=`${"level"===s?"playlist":s}LoadPolicy`,u=void 0===e[o],d=[];i.forEach(f=>{const g=`${s}Loading${f}`,b=e[g];if(void 0!==b&&u){d.push(g);const T=t[o].default;switch(e[o]={default:T},f){case"TimeOut":T.maxLoadTimeMs=b,T.maxTimeToFirstByteMs=b;break;case"MaxRetry":T.errorRetry.maxNumRetry=b,T.timeoutRetry.maxNumRetry=b;break;case"RetryDelay":T.errorRetry.retryDelayMs=b,T.timeoutRetry.retryDelayMs=b;break;case"MaxRetryTimeout":T.errorRetry.maxRetryDelayMs=b,T.timeoutRetry.maxRetryDelayMs=b}}}),d.length&&de.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${o}": ${JSON.stringify(e[o])}`)}),hs(hs({},t),e)}(n.DefaultConfig,t);this.userConfig=t,this._autoLevelCapping=-1,r.progressive&&function ww(n){const e=n.loader;e!==Tw&&e!==Ew?(de.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):function tL(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(n.loader=Tw,n.progressive=!0,n.enableSoftwareAES=!0,de.log("[config]: Progressive streaming enabled, using FetchLoader"))}(r);const{abrController:i,bufferController:s,capLevelController:o,errorController:u,fpsController:d}=r,f=new u(this),g=this.abrController=new i(this),b=this.bufferController=new s(this),T=this.capLevelController=new o(this),w=new d(this),x=new Sx(this),k=new lI(this),N=r.contentSteeringController,z=N?new N(this):null,X=this.levelController=new yI(this,z),K=new Mx(this),ie=new bI(this.config),le=this.streamController=new ZI(this,K,ie);T.setStreamController(le),w.setStreamController(le);const Me=[x,X,le];z&&Me.splice(1,0,z),this.networkControllers=Me;const Ie=[g,b,T,w,k,K];this.audioTrackController=this.createController(r.audioTrackController,Me);const We=r.audioStreamController;We&&Me.push(new We(this,K,ie)),this.subtitleTrackController=this.createController(r.subtitleTrackController,Me);const ot=r.subtitleStreamController;ot&&Me.push(new ot(this,K,ie)),this.createController(r.timelineController,Ie),ie.emeController=this.emeController=this.createController(r.emeController,Ie),this.cmcdController=this.createController(r.cmcdController,Ie),this.latencyController=this.createController(cI,Ie),this.coreComponents=Ie,Me.push(f);const Fe=f.onErrorOut;"function"==typeof Fe&&this.on(F.ERROR,Fe,f)}createController(t,r){if(t){const i=new t(this);return r&&r.push(i),i}return null}on(t,r,i=this){this._emitter.on(t,r,i)}once(t,r,i=this){this._emitter.once(t,r,i)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,r,i=this,s){this._emitter.off(t,r,i,s)}listeners(t){return this._emitter.listeners(t)}emit(t,r,i){return this._emitter.emit(t,r,i)}trigger(t,r){if(this.config.debug)return this.emit(t,t,r);try{return this.emit(t,t,r)}catch(i){de.error("An internal error happened while handling event "+t+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.trigger(F.ERROR,{type:ln.OTHER_ERROR,details:Ne.INTERNAL_EXCEPTION,fatal:!1,event:t,error:i})}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){de.log("destroy"),this.trigger(F.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(r=>r.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(r=>r.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){de.log("attachMedia"),this._media=t,this.trigger(F.MEDIA_ATTACHING,{media:t})}detachMedia(){de.log("detachMedia"),this.trigger(F.MEDIA_DETACHING,void 0),this._media=null}loadSource(t){this.stopLoad();const r=this.media,i=this.url,s=this.url=Nh.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});de.log(`loadSource:${s}`),r&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(r)),this.trigger(F.MANIFEST_LOADING,{url:t})}startLoad(t=-1){de.log(`startLoad(${t})`),this.networkControllers.forEach(r=>{r.startLoad(t)})}stopLoad(){de.log("stopLoad"),this.networkControllers.forEach(t=>{t.stopLoad()})}swapAudioCodec(){de.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){de.log("recoverMediaError");const t=this._media;this.detachMedia(),t&&this.attachMedia(t)}removeLevel(t,r=0){this.levelController.removeLevel(t,r)}get levels(){return this.levelController.levels||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){de.log(`set currentLevel:${t}`),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){de.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){de.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){de.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){return this.levelController.startLevel}set startLevel(t){de.log(`set startLevel:${t}`),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const r=!!t;r!==this.config.capLevelToPlayerSize&&(r?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=r)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(de.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){zp.indexOf(t)>-1&&(this._maxHdcpLevel=t)}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:r}}=this;if(!t)return 0;const i=t.length;for(let s=0;s<i;s++)if(t[s].maxBitrate>=r)return s;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:r,maxHdcpLevel:i}=this;let s;if(s=-1===r&&t&&t.length?t.length-1:r,i)for(let o=s;o--;){const u=t[o].attrs["HDCP-LEVEL"];if(u&&u<=i)return o}return s}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const r=this.audioTrackController;r&&(r.audioTrack=t)}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const r=this.subtitleTrackController;r&&(r.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return!!t&&t.subtitleDisplay}set subtitleDisplay(t){const r=this.subtitleTrackController;r&&(r.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}return n.defaultConfig=void 0,n})();var _t,xe=W(5861),fi=W(6881),Zh=W(4859),Xc=W(1877),Rn=W(2090),GC=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ma={},Nv=Nv||{},En=GC||self;function Jc(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function om(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var qo="closure_uid_"+(1e9*Math.random()>>>0),HC=0;function Uv(n,e,t){return n.call.apply(n.bind,arguments)}function am(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function fs(n,e,t){return(fs=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Uv:am).apply(null,arguments)}function Ty(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Ui(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),u=2;u<arguments.length;u++)o[u-2]=arguments[u];return e.prototype[i].apply(r,o)}}function ka(){this.s=this.s,this.o=this.o}ka.prototype.s=!1,ka.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function Fv(n){Object.prototype.hasOwnProperty.call(n,qo)&&n[qo]||(n[qo]=++HC)}(this)},ka.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Sw=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Bv(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Vv(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(Jc(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function Yi(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Yi.prototype.h=function(){this.defaultPrevented=!0};var $v=function(){if(!En.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{En.addEventListener("test",()=>{},e),En.removeEventListener("test",()=>{},e)}catch{}return n}();function Qh(n){return/^[\s\xa0]*$/.test(n)}function Xh(){var n=En.navigator;return n&&(n=n.userAgent)?n:""}function Yo(n){return-1!=Xh().indexOf(n)}function wy(n){return wy[" "](n),n}wy[" "]=function(){};var Dy,n,Hv=Yo("Opera"),Jh=Yo("Trident")||Yo("MSIE"),Dw=Yo("Edge"),jv=Dw||Jh,Aw=Yo("Gecko")&&!(-1!=Xh().toLowerCase().indexOf("webkit")&&!Yo("Edge"))&&!(Yo("Trident")||Yo("MSIE"))&&!Yo("Edge"),xw=-1!=Xh().toLowerCase().indexOf("webkit")&&!Yo("Edge");function Sy(){var n=En.document;return n?n.documentMode:void 0}e:{var Ay="",xy=(n=Xh(),Aw?/rv:([^\);]+)(\)|;)/.exec(n):Dw?/Edge\/([\d\.]+)/.exec(n):Jh?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):xw?/WebKit\/(\S+)/.exec(n):Hv?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(xy&&(Ay=xy?xy[1]:""),Jh){var Cy=Sy();if(null!=Cy&&Cy>parseFloat(Ay)){Dy=String(Cy);break e}}Dy=Ay}var Cw=En.document&&Jh&&(Sy()||parseInt(Dy,10))||void 0;function lm(n,e){if(Yi.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Aw){e:{try{wy(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Rw[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&lm.$.h.call(this)}}Ui(lm,Yi);var Rw={2:"touch",3:"pen",4:"mouse"};lm.prototype.h=function(){lm.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var cm="closure_listenable_"+(1e6*Math.random()|0),Ps=0;function ef(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++Ps,this.fa=this.ia=!1}function Ry(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Kv(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function jC(n){const e={};for(const t in n)e[t]=n[t];return e}const qv="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function My(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<qv.length;s++)t=qv[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function eu(n){this.src=n,this.g={},this.h=0}function Yv(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=Sw(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Ry(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function um(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}eu.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=um(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new ef(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var Zv="closure_lm_"+(1e6*Math.random()|0),ky={};function Mw(n,e,t,r,i){if(r&&r.once)return Ly(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Mw(n,e[s],t,r,i);return null}return t=Jv(t),n&&n[cm]?n.O(e,t,om(r)?!!r.capture:!!r,i):kw(n,e,t,!1,r,i)}function kw(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=om(i)?!!i.capture:!!i,u=Lw(n);if(u||(n[Zv]=u=new eu(n)),(t=u.add(e,t,r,o,s)).proxy)return t;if(r=function zC(){const e=Xv;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)$v||(i=o),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(dm(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Ly(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Ly(n,e[s],t,r,i);return null}return t=Jv(t),n&&n[cm]?n.P(e,t,om(r)?!!r.capture:!!r,i):kw(n,e,t,!0,r,i)}function Qv(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Qv(n,e[s],t,r,i);else r=om(r)?!!r.capture:!!r,t=Jv(t),n&&n[cm]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=um(s=n.g[e],t,r,i))&&(Ry(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=Lw(n))&&(e=n.g[e.toString()],n=-1,e&&(n=um(e,t,r,i)),(t=-1<n?e[n]:null)&&Py(t))}function Py(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[cm])Yv(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(dm(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Lw(e))?(Yv(t,n),0==t.h&&(t.src=null,e[Zv]=null)):Ry(n)}}}function dm(n){return n in ky?ky[n]:ky[n]="on"+n}function Xv(n,e){if(n.fa)n=!0;else{e=new lm(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Py(n),n=t.call(r,e)}return n}function Lw(n){return(n=n[Zv])instanceof eu?n:null}var Oy="__closure_events_fn_"+(1e9*Math.random()>>>0);function Jv(n){return"function"==typeof n?n:(n[Oy]||(n[Oy]=function(e){return n.handleEvent(e)}),n[Oy])}function Ci(){ka.call(this),this.i=new eu(this),this.S=this,this.J=null}function Zr(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new Yi(e,n);else if(e instanceof Yi)e.target=e.target||n;else{var i=e;My(e=new Yi(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=Ny(o,r,!0,e)&&i}if(i=Ny(o=e.g=n,r,!0,e)&&i,i=Ny(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=Ny(o=e.g=t[s],r,!1,e)&&i}function Ny(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var u=o.listener,d=o.la||o.src;o.ia&&Yv(n.i,o),i=!1!==u.call(d,r)&&i}}return i&&!r.defaultPrevented}Ui(Ci,ka),Ci.prototype[cm]=!0,Ci.prototype.removeEventListener=function(n,e,t,r){Qv(this,n,e,t,r)},Ci.prototype.N=function(){if(Ci.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Ry(t[r]);delete n.g[e],n.h--}}this.J=null},Ci.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},Ci.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Fy=En.JSON.stringify;function rL(){var n=tb;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var KC=new class eb{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new qC,n=>n.reset());class qC{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function YC(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function ZC(n){En.setTimeout(()=>{throw n},0)}let tf,nf=!1,tb=new class WC{constructor(){this.h=this.g=null}add(e,t){const r=KC.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},nb=()=>{const n=En.Promise.resolve(void 0);tf=()=>{n.then(Pw)}};var Pw=()=>{for(var n;n=rL();){try{n.h.call(n.g)}catch(t){ZC(t)}var e=KC;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}nf=!1};function Uy(n,e){Ci.call(this),this.h=n||1,this.g=e||En,this.j=fs(this.qb,this),this.l=Date.now()}function rb(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function By(n,e,t){if("function"==typeof n)t&&(n=fs(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=fs(n.handleEvent,n)}return 2147483647<Number(e)?-1:En.setTimeout(n,e||0)}function Ow(n){n.g=By(()=>{n.g=null,n.i&&(n.i=!1,Ow(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}Ui(Uy,Ci),(_t=Uy.prototype).ga=!1,_t.T=null,_t.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Zr(this,"tick"),this.ga&&(rb(this),this.start()))}},_t.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},_t.N=function(){Uy.$.N.call(this),rb(this),delete this.g};class Nw extends ka{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Ow(this)}N(){super.N(),this.g&&(En.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function rf(n){ka.call(this),this.h=n,this.g={}}Ui(rf,ka);var ib=[];function sb(n,e,t,r){Array.isArray(t)||(t&&(ib[0]=t.toString()),t=ib);for(var i=0;i<t.length;i++){var s=Mw(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Fw(n){Kv(n.g,function(e,t){this.g.hasOwnProperty(t)&&Py(e)},n),n.g={}}function Vy(){this.g=!0}function hm(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function oL(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Fy(t)}catch{return e}}(n,t)+(r?" "+r:"")})}rf.prototype.N=function(){rf.$.N.call(this),Fw(this)},rf.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Vy.prototype.Ea=function(){this.g=!1},Vy.prototype.info=function(){};var sf={},QC=null;function ob(){return QC=QC||new Ci}function XC(n){Yi.call(this,sf.Ta,n)}function $y(n){const e=ob();Zr(e,new XC(e))}function fm(n,e){Yi.call(this,sf.STAT_EVENT,n),this.stat=e}function Ys(n){const e=ob();Zr(e,new fm(e,n))}function ab(n,e){Yi.call(this,sf.Ua,n),this.size=e}function tu(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return En.setTimeout(function(){n()},e)}sf.Ta="serverreachability",Ui(XC,Yi),sf.STAT_EVENT="statevent",Ui(fm,Yi),sf.Ua="timingevent",Ui(ab,Yi);var pm={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},lb={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Bw(){}function cb(){}Bw.prototype.h=null;var db,mm={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Vw(){Yi.call(this,"d")}function ub(){Yi.call(this,"c")}function Hy(){}function nu(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new rf(this),this.P=aL,this.V=new Uy(n=jv?125:void 0),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new $w}function $w(){this.i=null,this.g="",this.h=!1}Ui(Vw,Yi),Ui(ub,Yi),Ui(Hy,Bw),Hy.prototype.g=function(){return new XMLHttpRequest},Hy.prototype.i=function(){return{}},db=new Hy;var aL=45e3,Gw={},hb={};function fb(n,e,t){n.L=1,n.v=_m(Xl(e)),n.s=t,n.S=!0,Hw(n,null)}function Hw(n,e){n.G=Date.now(),af(n),n.A=Xl(n.v);var t=n.A,r=n.W;Array.isArray(r)||(r=[String(r)]),Zw(t.i,"t",r),n.C=0,t=n.l.J,n.h=new $w,n.g=uS(n.l,t?e:null,!n.s),0<n.O&&(n.M=new Nw(fs(n.Pa,n,n.g),n.O)),sb(n.U,n.g,"readystatechange",n.nb),e=n.I?jC(n.I):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.A,n.u,n.s,e)):(n.u="GET",n.g.ha(n.A,n.u,null,e)),$y(),function iL(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",u=s.split("&"),d=0;d<u.length;d++){var f=u[d].split("=");if(1<f.length){var g=f[0];f=f[1];var b=g.split("_");o=2<=b.length&&"type"==b[1]?o+(g+"=")+f+"&":o+(g+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.W,n.s)}function jw(n){return!!n.g&&"GET"==n.u&&2!=n.L&&n.l.Ha}function JC(n,e,t){let i,r=!0;for(;!n.J&&n.C<t.length;){if(i=eR(n,t),i==hb){4==e&&(n.o=4,Ys(14),r=!1),hm(n.j,n.m,null,"[Incomplete Response]");break}if(i==Gw){n.o=4,Ys(15),hm(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}hm(n.j,n.m,i,null),gm(n,i)}jw(n)&&i!=hb&&i!=Gw&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Ys(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Sb(e),e.M=!0,Ys(11))):(hm(n.j,n.m,t,"[Invalid Chunked Response]"),pd(n),Os(n))}function eR(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?hb:(t=Number(e.substring(t,r)),isNaN(t)?Gw:(r+=1)+t>e.length?hb:(e=e.slice(r,r+t),n.C=r+t,e))}function af(n){n.Y=Date.now()+n.P,pb(n,n.P)}function pb(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=tu(fs(n.lb,n),e)}function mb(n){n.B&&(En.clearTimeout(n.B),n.B=null)}function Os(n){0==n.l.H||n.J||lS(n.l,n)}function pd(n){mb(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,rb(n.V),Fw(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function gm(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||jy(t.i,n)))if(!n.K&&jy(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;e0(t),Yy(t)}Jy(t),Ys(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=tu(fs(t.ib,t),6e3));if(1>=Qw(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else su(t,11)}else if((n.K||t.g==n)&&e0(t),!Qh(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let f=i[e];if(t.V=f[0],f=f[1],2==t.H)if("c"==f[0]){t.K=f[1],t.pa=f[2];const g=f[3];null!=g&&(t.ra=g,t.l.info("VER="+t.ra));const b=f[4];null!=b&&(t.Ga=b,t.l.info("SVER="+t.Ga));const T=f[5];null!=T&&"number"==typeof T&&0<T&&(t.L=r=1.5*T,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const w=n.g;if(w){const x=w.g?w.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(x){var s=r.i;s.g||-1==x.indexOf("spdy")&&-1==x.indexOf("quic")&&-1==x.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Xw(s,s.h),s.h=null))}if(r.F){const k=w.g?w.g.getResponseHeader("X-HTTP-Session-Id"):null;k&&(r.Da=k,Tr(r.I,r.F,k))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=cS(r,r.J?r.pa:null,r.Y),o.K){zy(r.i,o);var u=o,d=r.L;d&&u.setTimeout(d),u.B&&(mb(u),af(u)),r.g=o}else fR(r);0<t.j.length&&hf(t)}else"stop"!=f[0]&&"close"!=f[0]||su(t,7);else 3==t.H&&("stop"==f[0]||"close"==f[0]?"stop"==f[0]?su(t,7):Em(t):"noop"!=f[0]&&t.h&&t.h.Aa(f),t.A=0)}$y()}catch{}}function vo(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Jc(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function lL(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Jc(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function tR(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(Jc(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(_t=nu.prototype).setTimeout=function(n){this.P=n},_t.nb=function(n){n=n.target;const e=this.M;e&&3==bo(n)?e.l():this.Pa(n)},_t.Pa=function(n){try{if(n==this.g)e:{const g=bo(this.g);var e=this.g.Ia();if(this.g.da(),!(3>g)&&(3!=g||jv||this.g&&(this.h.h||this.g.ja()||oS(this.g)))){this.J||4!=g||7==e||$y(),mb(this);var t=this.g.da();this.ca=t;t:if(jw(this)){var r=oS(this.g);n="";var i=r.length,s=4==bo(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){pd(this),Os(this);var o="";break t}this.h.i=new En.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function Uw(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.W,g,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var u,d=this.g;if((u=d.g?d.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Qh(u)){var f=u;break t}}f=null}if(!(t=f)){this.i=!1,this.o=3,Ys(12),pd(this),Os(this);break e}hm(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,gm(this,t)}this.S?(JC(this,g,o),jv&&this.i&&3==g&&(sb(this.U,this.V,"tick",this.mb),this.V.start())):(hm(this.j,this.m,o,null),gm(this,o)),4==g&&pd(this),this.i&&!this.J&&(4==g?lS(this.l,this):(this.i=!1,af(this)))}else(function uR(n){const e={};n=(n.g&&2<=bo(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(Qh(n[r]))continue;var t=YC(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function nL(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.o=3,Ys(12)):(this.o=0,Ys(13)),pd(this),Os(this)}}}catch{}},_t.mb=function(){if(this.g){var n=bo(this.g),e=this.g.ja();this.C<e.length&&(mb(this),JC(this,n,e),this.i&&4!=n&&af(this))}},_t.cancel=function(){this.J=!0,pd(this)},_t.lb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function sL(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.L&&($y(),Ys(17)),pd(this),this.o=2,Os(this)):pb(this,this.Y-n)};var zw=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function md(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof md){this.h=n.h,lf(this,n.j),this.s=n.s,this.g=n.g,ym(this,n.m),this.l=n.l;var e=n.i,t=new gd;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),yb(this,t),this.o=n.o}else n&&(e=String(n).match(zw))?(this.h=!1,lf(this,e[1]||"",!0),this.s=cf(e[2]||""),this.g=cf(e[3]||"",!0),ym(this,e[4]),this.l=cf(e[5]||"",!0),yb(this,e[6]||"",!0),this.o=cf(e[7]||"")):(this.h=!1,this.i=new gd(null,this.h))}function Xl(n){return new md(n)}function lf(n,e,t){n.j=t?cf(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function ym(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function yb(n,e,t){e instanceof gd?(n.i=e,function rR(n,e){e&&!n.j&&(ec(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Yw(this,r),Zw(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=vm(e,ru)),n.i=new gd(e,n.h))}function Tr(n,e,t){n.i.set(e,t)}function _m(n){return Tr(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function cf(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function vm(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Ww),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Ww(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}md.prototype.toString=function(){var n=[],e=this.j;e&&n.push(vm(e,Kw,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(vm(e,Kw,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(vm(t,"/"==t.charAt(0)?Jl:_b,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",vm(t,qw)),n.join("")};var Kw=/[#\/\?@]/g,_b=/[#\?:]/g,Jl=/[#\?]/g,ru=/[#\?@]/g,qw=/#/g;function gd(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function ec(n){n.g||(n.g=new Map,n.h=0,n.i&&function gb(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Yw(n,e){ec(n),e=uf(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function nR(n,e){return ec(n),e=uf(n,e),n.g.has(e)}function Zw(n,e,t){Yw(n,e),0<t.length&&(n.i=null,n.g.set(uf(n,e),Bv(t)),n.h+=t.length)}function uf(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function vb(n){this.l=n||cL,n=En.PerformanceNavigationTiming?0<(n=En.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(En.g&&En.g.Ka&&En.g.Ka()&&En.g.Ka().ec),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(_t=gd.prototype).add=function(n,e){ec(this),this.i=null,n=uf(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},_t.forEach=function(n,e){ec(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},_t.ta=function(){ec(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},_t.Z=function(n){ec(this);let e=[];if("string"==typeof n)nR(this,n)&&(e=e.concat(this.g.get(uf(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},_t.set=function(n,e){return ec(this),this.i=null,nR(this,n=uf(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},_t.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},_t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var cL=10;function bb(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Qw(n){return n.h?1:n.g?n.g.size:0}function jy(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Xw(n,e){n.g?n.g.add(e):n.h=e}function zy(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Eb(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return Bv(n.i)}vb.prototype.cancel=function(){if(this.i=Eb(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var Jw=class{stringify(n){return En.JSON.stringify(n,void 0)}parse(n){return En.JSON.parse(n,void 0)}};function eS(){this.g=new Jw}function tS(n,e,t){const r=t||"";try{vo(n,function(i,s){let o=i;om(i)&&(o=Fy(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function yd(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function iu(n){this.l=n.fc||null,this.j=n.ob||!1}function bm(n,e){Ci.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Tb,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ui(iu,Bw),iu.prototype.g=function(){return new bm(this.l,this.j)},iu.prototype.i=function(n){return function(){return n}}({}),Ui(bm,Ci);var Tb=0;function rS(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function Wy(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Ky(n)}function Ky(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(_t=bm.prototype).open=function(n,e){if(this.readyState!=Tb)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Ky(this)},_t.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||En).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},_t.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Wy(this)),this.readyState=Tb},_t.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Ky(this)),this.g&&(this.readyState=3,Ky(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof En.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;rS(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},_t.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Wy(this):Ky(this),3==this.readyState&&rS(this)}},_t.Za=function(n){this.g&&(this.response=this.responseText=n,Wy(this))},_t.Ya=function(n){this.g&&(this.response=n,Wy(this))},_t.ka=function(){this.g&&Wy(this)},_t.setRequestHeader=function(n,e){this.v.append(n,e)},_t.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},_t.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(bm.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var uL=En.JSON.parse;function Nr(n){Ci.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=iS,this.L=this.M=!1}Ui(Nr,Ci);var iS="",sR=/^https?$/i,oR=["POST","PUT"];function aR(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,lR(n),Ib(n)}function lR(n){n.F||(n.F=!0,Zr(n,"complete"),Zr(n,"error"))}function cR(n){if(n.h&&typeof Nv<"u"&&(!n.C[1]||4!=bo(n)||2!=n.da()))if(n.v&&4==bo(n))By(n.La,0,n);else if(Zr(n,"readystatechange"),4==bo(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var i=String(n.I).match(zw)[1]||null;!i&&En.self&&En.self.location&&(i=En.self.location.protocol.slice(0,-1)),r=!sR.test(i?i.toLowerCase():"")}t=r}if(t)Zr(n,"complete"),Zr(n,"success");else{n.m=6;try{var s=2<bo(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",lR(n)}}finally{Ib(n)}}}function Ib(n,e){if(n.g){sS(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Zr(n,"ready");try{t.onreadystatechange=r}catch{}}}function sS(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(En.clearTimeout(n.A),n.A=null)}function bo(n){return n.g?n.g.readyState:0}function oS(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case iS:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function wb(n){let e="";return Kv(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function tc(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=wb(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):Tr(n,e,t))}function df(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function qy(n){this.Ga=0,this.j=[],this.l=new Vy,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=df("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=df("baseRetryDelayMs",5e3,n),this.hb=df("retryDelaySeedMs",1e4,n),this.eb=df("forwardChannelMaxRetries",2,n),this.xa=df("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.dc||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new vb(n&&n.concurrentRequestLimit),this.Ja=new eS,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Em(n){if(Zy(n),3==n.H){var e=n.W++,t=Xl(n.I);if(Tr(t,"SID",n.K),Tr(t,"RID",e),Tr(t,"TYPE","terminate"),Xy(n,t),(e=new nu(n,n.l,e)).L=2,e.v=_m(Xl(t)),t=!1,En.navigator&&En.navigator.sendBeacon)try{t=En.navigator.sendBeacon(e.v.toString(),"")}catch{}!t&&En.Image&&((new Image).src=e.v,t=!0),t||(e.g=uS(e.l,null),e.g.ha(e.v)),e.G=Date.now(),af(e)}Ab(n)}function Yy(n){n.g&&(Sb(n),n.g.cancel(),n.g=null)}function Zy(n){Yy(n),n.u&&(En.clearTimeout(n.u),n.u=null),e0(n),n.i.cancel(),n.m&&("number"==typeof n.m&&En.clearTimeout(n.m),n.m=null)}function hf(n){if(!bb(n.i)&&!n.m){n.m=!0;var e=n.Na;tf||nb(),nf||(tf(),nf=!0),tb.add(e,n),n.C=0}}function dR(n,e){var t;t=e?e.m:n.W++;const r=Xl(n.I);Tr(r,"SID",n.K),Tr(r,"RID",t),Tr(r,"AID",n.V),Xy(n,r),n.o&&n.s&&tc(r,n.o,n.s),t=new nu(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=hR(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Xw(n.i,t),fb(t,r,e)}function Xy(n,e){n.na&&Kv(n.na,function(t,r){Tr(e,r,t)}),n.h&&vo({},function(t,r){Tr(e,r,t)})}function hR(n,e,t){t=Math.min(n.j.length,t);var r=n.h?fs(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let u=!0;for(let d=0;d<t;d++){let f=i[d].g;const g=i[d].map;if(f-=s,0>f)s=Math.max(0,i[d].g-100),u=!1;else try{tS(g,o,"req"+f+"_")}catch{r&&r(g)}}if(u){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function fR(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;tf||nb(),nf||(tf(),nf=!0),tb.add(e,n),n.A=0}}function Jy(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=tu(fs(n.Ma,n),Db(n,n.A)),n.A++,0))}function Sb(n){null!=n.B&&(En.clearTimeout(n.B),n.B=null)}function aS(n){n.g=new nu(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=Xl(n.wa);Tr(e,"RID","rpc"),Tr(e,"SID",n.K),Tr(e,"AID",n.V),Tr(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&Tr(e,"TO",n.qa),Tr(e,"TYPE","xmlhttp"),Xy(n,e),n.o&&n.s&&tc(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.v=_m(Xl(e)),t.s=null,t.S=!0,Hw(t,n)}function e0(n){null!=n.v&&(En.clearTimeout(n.v),n.v=null)}function lS(n,e){var t=null;if(n.g==e){e0(n),Sb(n),n.g=null;var r=2}else{if(!jy(n.i,e))return;t=e.F,zy(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.G;var i=n.C;Zr(r=ob(),new ab(r,t)),hf(n)}else fR(n);else if(3==(i=e.o)||0==i&&0<e.ca||!(1==r&&function Qy(n,e){return!(Qw(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=tu(fs(n.Na,n,e),Db(n,n.C)),n.C++,0)))}(n,e)||2==r&&Jy(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:su(n,5);break;case 4:su(n,10);break;case 3:su(n,6);break;default:su(n,2)}}function Db(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function su(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=fs(n.pb,n);t||(t=new md("//www.google.com/images/cleardot.gif"),En.location&&"http"==En.location.protocol||lf(t,"https"),_m(t)),function nS(n,e){const t=new Vy;if(En.Image){const r=new Image;r.onload=Ty(yd,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ty(yd,t,r,"TestLoadImage: error",!1,e),r.onabort=Ty(yd,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ty(yd,t,r,"TestLoadImage: timeout",!1,e),En.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Ys(2);n.H=0,n.h&&n.h.za(e),Ab(n),Zy(n)}function Ab(n){if(n.H=0,n.ma=[],n.h){const e=Eb(n.i);(0!=e.length||0!=n.j.length)&&(Vv(n.ma,e),Vv(n.ma,n.j),n.i.i.length=0,Bv(n.j),n.j.length=0),n.h.ya()}}function cS(n,e,t){var r=t instanceof md?Xl(t):new md(t);if(""!=r.g)e&&(r.g=e+"."+r.g),ym(r,r.m);else{var i=En.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new md(null);r&&lf(s,r),e&&(s.g=e),i&&ym(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&Tr(r,t,e),Tr(r,"VER",n.ra),Xy(n,r),r}function uS(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Nr(t&&n.Ha&&!n.va?new iu({ob:!0}):n.va)).Oa(n.J),e}function xb(){}function ff(){if(Jh&&!(10<=Number(Cw)))throw Error("Environmental error: no available transport.")}function Zo(n,e){Ci.call(this),this.g=new qy(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Qh(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Qh(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new pf(this)}function Cb(n){Vw.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function t0(){ub.call(this),this.status=1}function pf(n){this.g=n}function dl(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function dS(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],o=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=t+((o=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function lr(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(_t=Nr.prototype).Oa=function(n){this.M=n},_t.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():db.g(),this.C=function Gy(n){return n.h||(n.h=n.i())}(this.u?this.u:db),this.g.onreadystatechange=fs(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void aR(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=En.FormData&&n instanceof En.FormData,!(0<=Sw(oR,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{sS(this),0<this.B&&((this.L=function dL(n){return Jh&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=fs(this.ua,this)):this.A=By(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){aR(this,s)}},_t.ua=function(){typeof Nv<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Zr(this,"timeout"),this.abort(8))},_t.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Zr(this,"complete"),Zr(this,"abort"),Ib(this))},_t.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ib(this,!0)),Nr.$.N.call(this)},_t.La=function(){this.s||(this.G||this.v||this.l?cR(this):this.kb())},_t.kb=function(){cR(this)},_t.isActive=function(){return!!this.g},_t.da=function(){try{return 2<bo(this)?this.g.status:-1}catch{return-1}},_t.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},_t.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),uL(e)}},_t.Ia=function(){return this.m},_t.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(_t=qy.prototype).ra=8,_t.H=1,_t.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new nu(this,this.l,n);let s=this.s;if(this.U&&(s?(s=jC(s),My(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=hR(this,i,e),Tr(t=Xl(this.I),"RID",n),Tr(t,"CVER",22),this.F&&Tr(t,"X-HTTP-Session-Id",this.F),Xy(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(wb(s)))+"&"+e:this.o&&tc(t,this.o,s)),Xw(this.i,i),this.bb&&Tr(t,"TYPE","init"),this.P?(Tr(t,"$req",e),Tr(t,"SID","null"),i.aa=!0,fb(i,t,null)):fb(i,t,e),this.H=2}}else 3==this.H&&(n?dR(this,n):0==this.j.length||bb(this.i)||dR(this))},_t.Ma=function(){if(this.u=null,aS(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=tu(fs(this.jb,this),n)}},_t.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ys(10),Yy(this),aS(this))},_t.ib=function(){null!=this.v&&(this.v=null,Yy(this),Jy(this),Ys(19))},_t.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Ys(2)):(this.l.info("Failed to ping google.com"),Ys(1))},_t.isActive=function(){return!!this.h&&this.h.isActive(this)},(_t=xb.prototype).Ba=function(){},_t.Aa=function(){},_t.za=function(){},_t.ya=function(){},_t.isActive=function(){return!0},_t.Va=function(){},ff.prototype.g=function(n,e){return new Zo(n,e)},Ui(Zo,Ci),Zo.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Ys(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=cS(n,null,n.Y),hf(n)},Zo.prototype.close=function(){Em(this.g)},Zo.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Fy(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&hf(e)},Zo.prototype.N=function(){this.g.h=null,delete this.j,Em(this.g),delete this.g,Zo.$.N.call(this)},Ui(Cb,Vw),Ui(t0,ub),Ui(pf,xb),pf.prototype.Ba=function(){Zr(this.g,"a")},pf.prototype.Aa=function(n){Zr(this.g,new Cb(n))},pf.prototype.za=function(n){Zr(this.g,new t0)},pf.prototype.ya=function(){Zr(this.g,"b")},Ui(dl,function pR(){this.blockSize=-1}),dl.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},dl.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)dS(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){dS(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){dS(this,r),i=0;break}}this.h=i,this.i+=e},dl.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var mR={};function Rb(n){return-128<=n&&128>n?function Gv(n,e){var t=mR;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new lr([0|e],0>e?-1:0)}):new lr([0|n],0>n?-1:0)}function nc(n){if(isNaN(n)||!isFinite(n))return Tm;if(0>n)return ps(nc(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=hS;return new lr(e,0)}var hS=4294967296,Tm=Rb(0),Mb=Rb(1),yR=Rb(16777216);function ou(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function La(n){return-1==n.h}function ps(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new lr(t,~n.h).add(Mb)}function kb(n,e){return n.add(ps(e))}function Lb(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function a(n,e){this.g=n,this.h=e}function l(n,e){if(ou(e))throw Error("division by zero");if(ou(n))return new a(Tm,Tm);if(La(n))return e=l(ps(n),e),new a(ps(e.g),ps(e.h));if(La(e))return e=l(n,ps(e)),new a(ps(e.g),e.h);if(30<n.g.length){if(La(n)||La(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Mb,r=e;0>=r.X(n);)t=c(t),r=c(r);var i=h(t,1),s=h(r,1);for(r=h(r,2),t=h(t,2);!ou(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=h(r,1),t=h(t,1)}return e=kb(n,i.R(e)),new a(i,e)}for(i=Tm;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(s=nc(t)).R(e);La(o)||0<o.X(n);)o=(s=nc(t-=r)).R(e);ou(s)&&(s=Mb),i=i.add(s),n=kb(n,o)}return new a(i,n)}function c(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new lr(t,n.h)}function h(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new lr(i,n.h)}(_t=lr.prototype).ea=function(){if(La(this))return-ps(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:hS+r)*e,e*=hS}return n},_t.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(ou(this))return"0";if(La(this))return"-"+ps(this).toString(n);for(var e=nc(Math.pow(n,6)),t=this,r="";;){var i=l(t,e).g,s=((0<(t=kb(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(ou(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},_t.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},_t.X=function(n){return La(n=kb(this,n))?-1:ou(n)?0:1},_t.abs=function(){return La(this)?ps(this):this},_t.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,t[i]=(o&=65535)<<16|(s&=65535)}return new lr(t,-2147483648&t[t.length-1]?-1:0)},_t.R=function(n){if(ou(this)||ou(n))return Tm;if(La(this))return La(n)?ps(this).R(ps(n)):ps(ps(this).R(n));if(La(n))return ps(this.R(ps(n)));if(0>this.X(yR)&&0>n.X(yR))return nc(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),u=n.D(i)>>>16,d=65535&n.D(i);t[2*r+2*i]+=o*d,Lb(t,2*r+2*i),t[2*r+2*i+1]+=s*d,Lb(t,2*r+2*i+1),t[2*r+2*i+1]+=o*u,Lb(t,2*r+2*i+1),t[2*r+2*i+2]+=s*u,Lb(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new lr(t,0)},_t.gb=function(n){return l(this,n).h},_t.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new lr(t,this.h&n.h)},_t.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new lr(t,this.h|n.h)},_t.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new lr(t,this.h^n.h)},ff.prototype.createWebChannel=ff.prototype.g,Zo.prototype.send=Zo.prototype.u,Zo.prototype.open=Zo.prototype.m,Zo.prototype.close=Zo.prototype.close,pm.NO_ERROR=0,pm.TIMEOUT=8,pm.HTTP_ERROR=6,lb.COMPLETE="complete",cb.EventType=mm,mm.OPEN="a",mm.CLOSE="b",mm.ERROR="c",mm.MESSAGE="d",Ci.prototype.listen=Ci.prototype.O,Nr.prototype.listenOnce=Nr.prototype.P,Nr.prototype.getLastError=Nr.prototype.Sa,Nr.prototype.getLastErrorCode=Nr.prototype.Ia,Nr.prototype.getStatus=Nr.prototype.da,Nr.prototype.getResponseJson=Nr.prototype.Wa,Nr.prototype.getResponseText=Nr.prototype.ja,Nr.prototype.send=Nr.prototype.ha,Nr.prototype.setWithCredentials=Nr.prototype.Oa,dl.prototype.digest=dl.prototype.l,dl.prototype.reset=dl.prototype.reset,dl.prototype.update=dl.prototype.j,lr.prototype.add=lr.prototype.add,lr.prototype.multiply=lr.prototype.R,lr.prototype.modulo=lr.prototype.gb,lr.prototype.compare=lr.prototype.X,lr.prototype.toNumber=lr.prototype.ea,lr.prototype.toString=lr.prototype.toString,lr.prototype.getBits=lr.prototype.D,lr.fromNumber=nc,lr.fromString=function gR(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return ps(gR(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=nc(Math.pow(e,8)),r=Tm,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=nc(Math.pow(e,s)),r=r.R(s).add(nc(o))):r=(r=r.R(t)).add(nc(o))}return r};var lt,mt,Pt,on,Ye,Ir,Qr,_R,hL,fL,pL,mL,gL,yL,_L,vL,bL,EL,TL,IL,wL,SL,DL,AL,xL,CL,RL,ML,kL,LL,PL,OL,NL,FL,UL,BL,VL,$L,GL,HL,jL,zL,WL,p=Ma.createWebChannelTransport=function(){return new ff},y=Ma.getStatEventTarget=function(){return ob()},E=Ma.ErrorCode=pm,S=Ma.EventType=lb,D=Ma.Event=sf,L=Ma.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},B=Ma.FetchXmlHttpFactory=iu,q=Ma.WebChannel=cb,ae=Ma.XhrIo=Nr,he=Ma.Md5=dl,Pe=Ma.Integer=lr;const KL="@firebase/firestore";class ms{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ms.UNAUTHENTICATED=new ms(null),ms.GOOGLE_CREDENTIALS=new ms("google-credentials-uid"),ms.FIRST_PARTY=new ms("first-party-uid"),ms.MOCK_USER=new ms("mock-user");let n0="9.23.0";const mf=new Xc.Yd("@firebase/firestore");function vR(){return mf.logLevel}function it(n,...e){if(mf.logLevel<=Xc.in.DEBUG){const t=e.map(bR);mf.debug(`Firestore (${n0}): ${n}`,...t)}}function Ri(n,...e){if(mf.logLevel<=Xc.in.ERROR){const t=e.map(bR);mf.error(`Firestore (${n0}): ${n}`,...t)}}function hl(n,...e){if(mf.logLevel<=Xc.in.WARN){const t=e.map(bR);mf.warn(`Firestore (${n0}): ${n}`,...t)}}function bR(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function kt(n="Unexpected state"){const e=`FIRESTORE (${n0}) INTERNAL ASSERTION FAILED: `+n;throw Ri(e),new Error(e)}function Yt(n,e){n||kt()}function vt(n,e){return n}const Te={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ge extends Rn.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Zi{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class qL{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class wV{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ms.UNAUTHENTICATED))}shutdown(){}}class SV{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class DV{constructor(e){this.t=e,this.currentUser=ms.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=f=>this.i!==i?(i=this.i,t(f)):Promise.resolve();let o=new Zi;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Zi,e.enqueueRetryable(()=>s(this.currentUser))};const u=()=>{const f=o;e.enqueueRetryable((0,xe.Z)(function*(){yield f.promise,yield s(r.currentUser)}))},d=f=>{it("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.auth.addAuthTokenListener(this.o),u()};this.t.onInit(f=>d(f)),setTimeout(()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?d(f):(it("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Zi)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(it("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Yt("string"==typeof r.accessToken),new qL(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Yt(null===e||"string"==typeof e),new ms(e)}}class AV{constructor(e,t,r){this.h=e,this.l=t,this.m=r,this.type="FirstParty",this.user=ms.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class xV{constructor(e,t,r){this.h=e,this.l=t,this.m=r}getToken(){return Promise.resolve(new AV(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(ms.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class YL{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class CV{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const r=s=>{null!=s.error&&it("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.T;return this.T=s.token,it("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{it("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.I.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.I.getImmediate({optional:!0});s?i(s):it("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Yt("string"==typeof t.token),this.T=t.token,new YL(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function RV(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class ZL{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=RV(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function Tn(n,e){return n<e?-1:n>e?1:0}function r0(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function QL(n){return n+"\0"}class Xr{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ge(Te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ge(Te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Ge(Te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ge(Te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Xr.fromMillis(Date.now())}static fromDate(e){return Xr.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Xr(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Tn(this.nanoseconds,e.nanoseconds):Tn(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Zt{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Zt(e)}static min(){return new Zt(new Xr(0,0))}static max(){return new Zt(new Xr(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Pb{constructor(e,t,r){void 0===t?t=0:t>e.length&&kt(),void 0===r?r=e.length-t:r>e.length-t&&kt(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Pb.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Pb?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Qn extends Pb{construct(e,t,r){return new Qn(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Ge(Te.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new Qn(t)}static emptyPath(){return new Qn([])}}const MV=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class bi extends Pb{construct(e,t,r){return new bi(e,t,r)}static isValidIdentifier(e){return MV.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),bi.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new bi(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new Ge(Te.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const u=e[i];if("\\"===u){if(i+1===e.length)throw new Ge(Te.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if("\\"!==d&&"."!==d&&"`"!==d)throw new Ge(Te.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else"`"===u?(o=!o,i++):"."!==u||o?(r+=u,i++):(s(),i++)}if(s(),o)throw new Ge(Te.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new bi(t)}static emptyPath(){return new bi([])}}class gt{constructor(e){this.path=e}static fromPath(e){return new gt(Qn.fromString(e))}static fromName(e){return new gt(Qn.fromString(e).popFirst(5))}static empty(){return new gt(Qn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Qn.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Qn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new gt(new Qn(e.slice()))}}class fS{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function ER(n){return n.fields.find(e=>2===e.kind)}function Im(n){return n.fields.filter(e=>2!==e.kind)}fS.UNKNOWN_ID=-1;class pS{constructor(e,t){this.fieldPath=e,this.kind=t}}class Ob{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Ob(0,Pa.min())}}function XL(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=Zt.fromTimestamp(1e9===r?new Xr(t+1,0):new Xr(t,r));return new Pa(i,gt.empty(),e)}function JL(n){return new Pa(n.readTime,n.key,-1)}class Pa{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Pa(Zt.min(),gt.empty(),-1)}static max(){return new Pa(Zt.max(),gt.empty(),-1)}}function TR(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=gt.comparator(n.documentKey,e.documentKey),0!==t?t:Tn(n.largestBatchId,e.largestBatchId))}const eP="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class tP{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function gf(n){return(lt=lt||(0,xe.Z)(function*(e){if(e.code!==Te.FAILED_PRECONDITION||e.message!==eP)throw e;it("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class _e{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&kt(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new _e((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof _e?t:_e.resolve(t)}catch(t){return _e.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):_e.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):_e.reject(t)}static resolve(e){return new _e((t,r)=>{t(e)})}static reject(e){return new _e((t,r)=>{r(e)})}static waitFor(e){return new _e((t,r)=>{let i=0,s=0,o=!1;e.forEach(u=>{++i,u.next(()=>{++s,o&&s===i&&t()},d=>r(d))}),o=!0,s===i&&t()})}static or(e){let t=_e.resolve(!1);for(const r of e)t=t.next(i=>i?_e.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new _e((r,i)=>{const s=e.length,o=new Array(s);let u=0;for(let d=0;d<s;d++){const f=d;t(e[f]).next(g=>{o[f]=g,++u,u===s&&r(o)},g=>i(g))}})}static doWhile(e,t){return new _e((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class mS{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new Zi,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new Nb(e,t.error)):this.v.resolve()},this.transaction.onerror=r=>{const i=IR(r.target.error);this.v.reject(new Nb(e,i))}}static open(e,t,r,i){try{return new mS(t,e.transaction(i,r))}catch(s){throw new Nb(t,s)}}get R(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(it("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new OV(t)}}class rc{constructor(e,t,r){this.name=e,this.version=t,this.V=r,12.2===rc.S((0,Rn.z$)())&&Ri("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return it("SimpleDb","Removing database:",e),wm(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,Rn.hl)())return!1;if(rc.C())return!0;const e=(0,Rn.z$)(),t=rc.S(e),r=0<t&&t<10,i=rc.N(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static N(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}$(e){var t=this;return(0,xe.Z)(function*(){return t.db||(it("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{r(o.target.result)},s.onblocked=()=>{i(new Nb(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const u=o.target.error;i("VersionError"===u.name?new Ge(Te.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===u.name?new Ge(Te.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u):new Nb(e,u))},s.onupgradeneeded=o=>{it("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.V.O(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{it("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.F&&(t.db.onversionchange=r=>t.F(r)),t.db})()}B(e){this.F=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,xe.Z)(function*(){const o="readonly"===t;let u=0;for(;;){++u;try{s.db=yield s.$(e);const d=mS.open(s.db,e,o?"readonly":"readwrite",r),f=i(d).next(g=>(d.P(),g)).catch(g=>(d.abort(g),_e.reject(g))).toPromise();return f.catch(()=>{}),yield d.R,f}catch(d){const f=d,g="FirebaseError"!==f.name&&u<3;if(it("SimpleDb","Transaction failed with error:",f.message,"Retrying:",g),s.close(),!g)return Promise.reject(f)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class PV{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return wm(this.L.delete())}}class Nb extends Ge{constructor(e,t){super(Te.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function yf(n){return"IndexedDbTransactionError"===n.name}class OV{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(it("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(it("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),wm(r)}add(e){return it("SimpleDb","ADD",this.store.name,e,e),wm(this.store.add(e))}get(e){return wm(this.store.get(e)).next(t=>(void 0===t&&(t=null),it("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return it("SimpleDb","DELETE",this.store.name,e),wm(this.store.delete(e))}count(){return it("SimpleDb","COUNT",this.store.name),wm(this.store.count())}j(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),s=[];return this.W(i,(o,u)=>{s.push(u)}).next(()=>s)}{const i=this.store.getAll(r.range);return new _e((s,o)=>{i.onerror=u=>{o(u.target.error)},i.onsuccess=u=>{s(u.target.result)}})}}H(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new _e((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}J(e,t){it("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.Y=!1;const i=this.cursor(r);return this.W(i,(s,o,u)=>u.delete())}X(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.W(i,t)}Z(e){const t=this.cursor({});return new _e((r,i)=>{t.onerror=s=>{const o=IR(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(u=>{u?o.continue():r()}):r()}})}W(e,t){const r=[];return new _e((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const u=o.target.result;if(!u)return void i();const d=new PV(u),f=t(u.primaryKey,u.value,d);if(f instanceof _e){const g=f.catch(b=>(d.done(),_e.reject(b)));r.push(g)}d.isDone?i():null===d.K?u.continue():u.continue(d.K)}}).next(()=>_e.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function wm(n){return new _e((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=IR(r.target.error);t(i)}})}let nP=!1;function IR(n){const e=rc.S((0,Rn.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new Ge("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nP||(nP=!0,setTimeout(()=>{throw r},0)),r}}return n}class NV{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){var t=this;it("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,xe.Z)(function*(){t.task=null;try{it("IndexBackiller",`Documents written: ${yield t.tt.nt()}`)}catch(r){yf(r)?it("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield gf(r)}yield t.et(6e4)}))}}class FV{constructor(e,t){this.localStore=e,this.persistence=t}nt(e=50){var t=this;return(0,xe.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.st(r,e))})()}st(e,t){const r=new Set;let i=t,s=!0;return _e.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return it("IndexBackiller",`Processing collection: ${o}`),this.it(e,o,i).next(u=>{i-=u,r.add(o)});s=!1})).next(()=>t-i)}it(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.rt(i,s)).next(u=>(it("IndexBackiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>o.size)}))}rt(e,t){let r=e;return t.changes.forEach((i,s)=>{const o=JL(s);TR(o,r)>0&&(r=o)}),new Pa(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Oa=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ot(i),this.ut=i=>r.writeSequenceNumber(i))}ot(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ut&&this.ut(t),t}}return n.ct=-1,n})();function Fb(n){return null==n}function Ub(n){return 0===n&&1/n==-1/0}function rP(n){return"number"==typeof n&&Number.isInteger(n)&&!Ub(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Zs(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=iP(e)),e=UV(n.get(t),e);return iP(e)}function UV(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function iP(n){return n+"\x01\x01"}function au(n){const e=n.length;if(Yt(e>=2),2===e)return Yt("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),Qn.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const o=n.indexOf("\x01",s);switch((o<0||o>t)&&kt(),n.charAt(o+1)){case"\x01":const u=n.substring(s,o);let d;0===i.length?d=u:(i+=u,d=i,i=""),r.push(d);break;case"\x10":i+=n.substring(s,o),i+="\0";break;case"\x11":i+=n.substring(s,o+1);break;default:kt()}s=o+2}return new Qn(r)}const sP=["userId","batchId"];function gS(n,e){return[n,Zs(e)]}function oP(n,e,t){return[n,Zs(e),t]}const BV={},VV=["prefixPath","collectionGroup","readTime","documentId"],$V=["prefixPath","collectionGroup","documentId"],GV=["collectionGroup","readTime","prefixPath","documentId"],HV=["canonicalId","targetId"],jV=["targetId","path"],zV=["path","targetId"],WV=["collectionId","parent"],KV=["indexId","uid"],qV=["uid","sequenceNumber"],YV=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ZV=["indexId","uid","orderedDocumentKey"],QV=["userId","collectionPath","documentId"],XV=["userId","collectionPath","largestBatchId"],JV=["userId","collectionGroup","largestBatchId"],aP=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],e$=[...aP,"documentOverlays"],lP=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],cP=lP,t$=[...cP,"indexConfiguration","indexState","indexEntries"];class wR extends tP{constructor(e,t){super(),this.ht=e,this.currentSequenceNumber=t}}function gs(n,e){const t=vt(n);return rc.M(t.ht,e)}function uP(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function _f(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function dP(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class xr{constructor(e,t){this.comparator=e,this.root=t||Ns.EMPTY}insert(e,t){return new xr(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ns.BLACK,null,null))}remove(e){return new xr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ns.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new yS(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new yS(this.root,e,this.comparator,!1)}getReverseIterator(){return new yS(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new yS(this.root,e,this.comparator,!0)}}class yS{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ns{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??Ns.RED,this.left=i??Ns.EMPTY,this.right=s??Ns.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Ns(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ns.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Ns.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ns.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ns.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw kt();const e=this.left.check();if(e!==this.right.check())throw kt();return e+(this.isRed()?0:1)}}Ns.EMPTY=null,Ns.RED=!0,Ns.BLACK=!1,Ns.EMPTY=new class{constructor(){this.size=0}get key(){throw kt()}get value(){throw kt()}get color(){throw kt()}get left(){throw kt()}get right(){throw kt()}copy(n,e,t,r,i){return this}insert(n,e,t){return new Ns(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Fr{constructor(e){this.comparator=e,this.data=new xr(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new hP(this.data.getIterator())}getIteratorFrom(e){return new hP(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Fr)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Fr(this.comparator);return t.data=e,t}}class hP{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function s0(n){return n.hasNext()?n.getNext():void 0}class Qo{constructor(e){this.fields=e,e.sort(bi.comparator)}static empty(){return new Qo([])}unionWith(e){let t=new Fr(bi.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Qo(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return r0(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class fP extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Qi{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new fP("Invalid base64 string: "+i):i}}(e);return new Qi(t)}static fromUint8Array(e){const t=function(r){let i="";for(let s=0;s<r.length;++s)i+=String.fromCharCode(r[s]);return i}(e);return new Qi(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Tn(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qi.EMPTY_BYTE_STRING=new Qi("");const r$=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vf(n){if(Yt(!!n),"string"==typeof n){let e=0;const t=r$.exec(n);if(Yt(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ei(n.seconds),nanos:Ei(n.nanos)}}function Ei(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function _d(n){return"string"==typeof n?Qi.fromBase64String(n):Qi.fromUint8Array(n)}function _S(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function vS(n){const e=n.mapValue.fields.__previous_value__;return _S(e)?vS(e):e}function Bb(n){const e=vf(n.mapValue.fields.__local_write_time__.timestampValue);return new Xr(e.seconds,e.nanos)}class i${constructor(e,t,r,i,s,o,u,d,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=d,this.useFetchStreams=f}}class bf{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new bf("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof bf&&e.projectId===this.projectId&&e.database===this.database}}const Ef={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},bS={nullValue:"NULL_VALUE"};function Tf(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?_S(n)?4:yP(n)?9007199254740991:10:kt()}function lu(n,e){if(n===e)return!0;const t=Tf(n);if(t!==Tf(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Bb(n).isEqual(Bb(e));case 3:return function(r,i){if("string"==typeof r.timestampValue&&"string"==typeof i.timestampValue&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const s=vf(r.timestampValue),o=vf(i.timestampValue);return s.seconds===o.seconds&&s.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,i){return _d(r.bytesValue).isEqual(_d(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return Ei(r.geoPointValue.latitude)===Ei(i.geoPointValue.latitude)&&Ei(r.geoPointValue.longitude)===Ei(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return Ei(r.integerValue)===Ei(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const s=Ei(r.doubleValue),o=Ei(i.doubleValue);return s===o?Ub(s)===Ub(o):isNaN(s)&&isNaN(o)}return!1}(n,e);case 9:return r0(n.arrayValue.values||[],e.arrayValue.values||[],lu);case 10:return function(r,i){const s=r.mapValue.fields||{},o=i.mapValue.fields||{};if(uP(s)!==uP(o))return!1;for(const u in s)if(s.hasOwnProperty(u)&&(void 0===o[u]||!lu(s[u],o[u])))return!1;return!0}(n,e);default:return kt()}}function Vb(n,e){return void 0!==(n.values||[]).find(t=>lu(t,e))}function If(n,e){if(n===e)return 0;const t=Tf(n),r=Tf(e);if(t!==r)return Tn(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Tn(n.booleanValue,e.booleanValue);case 2:return function(i,s){const o=Ei(i.integerValue||i.doubleValue),u=Ei(s.integerValue||s.doubleValue);return o<u?-1:o>u?1:o===u?0:isNaN(o)?isNaN(u)?0:-1:1}(n,e);case 3:return pP(n.timestampValue,e.timestampValue);case 4:return pP(Bb(n),Bb(e));case 5:return Tn(n.stringValue,e.stringValue);case 6:return function(i,s){const o=_d(i),u=_d(s);return o.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(i,s){const o=i.split("/"),u=s.split("/");for(let d=0;d<o.length&&d<u.length;d++){const f=Tn(o[d],u[d]);if(0!==f)return f}return Tn(o.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,s){const o=Tn(Ei(i.latitude),Ei(s.latitude));return 0!==o?o:Tn(Ei(i.longitude),Ei(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(i,s){const o=i.values||[],u=s.values||[];for(let d=0;d<o.length&&d<u.length;++d){const f=If(o[d],u[d]);if(f)return f}return Tn(o.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(i,s){if(i===Ef.mapValue&&s===Ef.mapValue)return 0;if(i===Ef.mapValue)return 1;if(s===Ef.mapValue)return-1;const o=i.fields||{},u=Object.keys(o),d=s.fields||{},f=Object.keys(d);u.sort(),f.sort();for(let g=0;g<u.length&&g<f.length;++g){const b=Tn(u[g],f[g]);if(0!==b)return b;const T=If(o[u[g]],d[f[g]]);if(0!==T)return T}return Tn(u.length,f.length)}(n.mapValue,e.mapValue);default:throw kt()}}function pP(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return Tn(n,e);const t=vf(n),r=vf(e),i=Tn(t.seconds,r.seconds);return 0!==i?i:Tn(t.nanos,r.nanos)}function o0(n){return SR(n)}function SR(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const i=vf(r);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?_d(n.bytesValue).toBase64():"referenceValue"in n?gt.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let i="[",s=!0;for(const o of r.values||[])s?s=!1:i+=",",i+=SR(o);return i+"]"}(n.arrayValue):"mapValue"in n?function(r){const i=Object.keys(r.fields||{}).sort();let s="{",o=!0;for(const u of i)o?o=!1:s+=",",s+=`${u}:${SR(r.fields[u])}`;return s+"}"}(n.mapValue):kt();var e}function Sm(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function DR(n){return!!n&&"integerValue"in n}function $b(n){return!!n&&"arrayValue"in n}function mP(n){return!!n&&"nullValue"in n}function gP(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function TS(n){return!!n&&"mapValue"in n}function Gb(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return _f(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Gb(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Gb(n.arrayValue.values[t]);return e}return Object.assign({},n)}function yP(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function s$(n){return"nullValue"in n?bS:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Sm(bf.empty(),gt.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:kt()}function o$(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Sm(bf.empty(),gt.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Ef:kt()}function _P(n,e){const t=If(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function vP(n,e){const t=If(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class Fs{constructor(e){this.value=e}static empty(){return new Fs({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!TS(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gb(t)}setAll(e){let t=bi.emptyPath(),r={},i=[];e.forEach((o,u)=>{if(!t.isImmediateParentOf(u)){const d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=u.popLast()}o?r[u.lastSegment()]=Gb(o):i.push(u.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());TS(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return lu(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];TS(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){_f(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Fs(Gb(this.value))}}function bP(n){const e=[];return _f(n.fields,(t,r)=>{const i=new bi([t]);if(TS(r)){const s=bP(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Qo(e)}class Ur{constructor(e,t,r,i,s,o,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=u}static newInvalidDocument(e){return new Ur(e,0,Zt.min(),Zt.min(),Zt.min(),Fs.empty(),0)}static newFoundDocument(e,t,r,i){return new Ur(e,1,t,Zt.min(),r,i,0)}static newNoDocument(e,t){return new Ur(e,2,t,Zt.min(),Zt.min(),Fs.empty(),0)}static newUnknownDocument(e,t){return new Ur(e,3,t,Zt.min(),Zt.min(),Fs.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Zt.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Fs.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Fs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Zt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ur&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ur(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class wf{constructor(e,t){this.position=e,this.inclusive=t}}function EP(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?gt.comparator(gt.fromName(o.referenceValue),t.key):If(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function TP(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!lu(n.position[t],e.position[t]))return!1;return!0}class a0{constructor(e,t="asc"){this.field=e,this.dir=t}}function a$(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class IP{}class Vn extends IP{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new l$(e,t,r):"array-contains"===t?new d$(e,r):"in"===t?new CP(e,r):"not-in"===t?new h$(e,r):"array-contains-any"===t?new f$(e,r):new Vn(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new c$(e,r):new u$(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(If(t,this.value)):null!==t&&Tf(this.value)===Tf(t)&&this.matchesComparison(If(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return kt()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class mr extends IP{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new mr(e,t)}matches(e){return l0(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft(t=>t.isInequality());return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function l0(n){return"and"===n.op}function AR(n){return"or"===n.op}function xR(n){return wP(n)&&l0(n)}function wP(n){for(const e of n.filters)if(e instanceof mr)return!1;return!0}function CR(n){if(n instanceof Vn)return n.field.canonicalString()+n.op.toString()+o0(n.value);if(xR(n))return n.filters.map(e=>CR(e)).join(",");{const e=n.filters.map(t=>CR(t)).join(",");return`${n.op}(${e})`}}function SP(n,e){return n instanceof Vn?function(t,r){return r instanceof Vn&&t.op===r.op&&t.field.isEqual(r.field)&&lu(t.value,r.value)}(n,e):n instanceof mr?function(t,r){return r instanceof mr&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((i,s,o)=>i&&SP(s,r.filters[o]),!0)}(n,e):void kt()}function DP(n,e){const t=n.filters.concat(e);return mr.create(t,n.op)}function AP(n){return n instanceof Vn?`${(e=n).field.canonicalString()} ${e.op} ${o0(e.value)}`:n instanceof mr?function(e){return e.op.toString()+" {"+e.getFilters().map(AP).join(" ,")+"}"}(n):"Filter";var e}class l$ extends Vn{constructor(e,t,r){super(e,t,r),this.key=gt.fromName(r.referenceValue)}matches(e){const t=gt.comparator(e.key,this.key);return this.matchesComparison(t)}}class c$ extends Vn{constructor(e,t){super(e,"in",t),this.keys=xP(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class u$ extends Vn{constructor(e,t){super(e,"not-in",t),this.keys=xP(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function xP(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>gt.fromName(r.referenceValue))}class d$ extends Vn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return $b(t)&&Vb(t.arrayValue,this.value)}}class CP extends Vn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Vb(this.value.arrayValue,t)}}class h$ extends Vn{constructor(e,t){super(e,"not-in",t)}matches(e){if(Vb(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Vb(this.value.arrayValue,t)}}class f$ extends Vn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!$b(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Vb(this.value.arrayValue,r))}}class p${constructor(e,t=null,r=[],i=[],s=null,o=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=u,this.dt=null}}function RR(n,e=null,t=[],r=[],i=null,s=null,o=null){return new p$(n,e,t,r,i,s,o)}function Dm(n){const e=vt(n);if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>CR(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Fb(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>o0(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>o0(r)).join(",")),e.dt=t}return e.dt}function Hb(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!a$(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!SP(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!TP(n.startAt,e.startAt)&&TP(n.endAt,e.endAt)}function IS(n){return gt.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function wS(n,e){return n.filters.filter(t=>t instanceof Vn&&t.field.isEqual(e))}function RP(n,e,t){let r=bS,i=!0;for(const s of wS(n,e)){let o=bS,u=!0;switch(s.op){case"<":case"<=":o=s$(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,u=!1;break;case"!=":case"not-in":o=bS}_P({value:r,inclusive:i},{value:o,inclusive:u})<0&&(r=o,i=u)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];_P({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}function MP(n,e,t){let r=Ef,i=!0;for(const s of wS(n,e)){let o=Ef,u=!0;switch(s.op){case">=":case">":o=o$(s.value),u=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,u=!1;break;case"!=":case"not-in":o=Ef}vP({value:r,inclusive:i},{value:o,inclusive:u})>0&&(r=o,i=u)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];vP({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}class vd{constructor(e,t=null,r=[],i=[],s=null,o="F",u=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=u,this.endAt=d,this.wt=null,this._t=null}}function kP(n,e,t,r,i,s,o,u){return new vd(n,e,t,r,i,s,o,u)}function c0(n){return new vd(n)}function LP(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function MR(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function SS(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function kR(n){return null!==n.collectionGroup}function Am(n){const e=vt(n);if(null===e.wt){e.wt=[];const t=SS(e),r=MR(e);if(null!==t&&null===r)t.isKeyField()||e.wt.push(new a0(t)),e.wt.push(new a0(bi.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e.wt.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new a0(bi.keyField(),s))}}}return e.wt}function Eo(n){const e=vt(n);if(!e._t)if("F"===e.limitType)e._t=RR(e.path,e.collectionGroup,Am(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of Am(e))t.push(new a0(s.field,"desc"===s.dir?"asc":"desc"));const r=e.endAt?new wf(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new wf(e.startAt.position,e.startAt.inclusive):null;e._t=RR(e.path,e.collectionGroup,t,e.filters,e.limit,r,i)}return e._t}function LR(n,e){e.getFirstInequalityField(),SS(n);const t=n.filters.concat([e]);return new vd(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function DS(n,e,t){return new vd(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function jb(n,e){return Hb(Eo(n),Eo(e))&&n.limitType===e.limitType}function PP(n){return`${Dm(Eo(n))}|lt:${n.limitType}`}function PR(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(r=>AP(r)).join(", ")}]`),Fb(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(r=>function(i){return`${i.field.canonicalString()} (${i.dir})`}(r)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>o0(r)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>o0(r)).join(",")),`Target(${t})`}(Eo(n))}; limitType=${n.limitType})`}function zb(n,e){return e.isFoundDocument()&&function(t,r){const i=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(i):gt.isDocumentKey(t.path)?t.path.isEqual(i):t.path.isImmediateParentOf(i)}(n,e)&&function(t,r){for(const i of Am(t))if(!i.field.isKeyField()&&null===r.data.field(i.field))return!1;return!0}(n,e)&&function(t,r){for(const i of t.filters)if(!i.matches(r))return!1;return!0}(n,e)&&function(t,r){return!(t.startAt&&!function(i,s,o){const u=EP(i,s,o);return i.inclusive?u<=0:u<0}(t.startAt,Am(t),r)||t.endAt&&!function(i,s,o){const u=EP(i,s,o);return i.inclusive?u>=0:u>0}(t.endAt,Am(t),r))}(n,e)}function OP(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function NP(n){return(e,t)=>{let r=!1;for(const i of Am(n)){const s=m$(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function m$(n,e,t){const r=n.field.isKeyField()?gt.comparator(e.key,t.key):function(i,s,o){const u=s.data.field(i),d=o.data.field(i);return null!==u&&null!==d?If(u,d):kt()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return kt()}}class bd{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){_f(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return dP(this.inner)}size(){return this.innerSize}}const g$=new xr(gt.comparator);function Xo(){return g$}const FP=new xr(gt.comparator);function Wb(...n){let e=FP;for(const t of n)e=e.insert(t.key,t);return e}function UP(n){let e=FP;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function cu(){return Kb()}function BP(){return Kb()}function Kb(){return new bd(n=>n.toString(),(n,e)=>n.isEqual(e))}const y$=new xr(gt.comparator),_$=new Fr(gt.comparator);function xn(...n){let e=_$;for(const t of n)e=e.add(t);return e}const v$=new Fr(Tn);function OR(){return v$}function VP(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ub(e)?"-0":e}}function $P(n){return{integerValue:""+n}}function GP(n,e){return rP(e)?$P(e):VP(n,e)}class AS{constructor(){this._=void 0}}function b$(n,e,t){return n instanceof u0?function(r,i){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&_S(i)&&(i=vS(i)),i&&(s.fields.__previous_value__=i),{mapValue:s}}(t,e):n instanceof xm?jP(n,e):n instanceof Cm?zP(n,e):function(r,i){const s=HP(r,i),o=WP(s)+WP(r.gt);return DR(s)&&DR(r.gt)?$P(o):VP(r.serializer,o)}(n,e)}function E$(n,e,t){return n instanceof xm?jP(n,e):n instanceof Cm?zP(n,e):t}function HP(n,e){return n instanceof d0?DR(t=e)||function(r){return!!r&&"doubleValue"in r}(t)?e:{integerValue:0}:null;var t}class u0 extends AS{}class xm extends AS{constructor(e){super(),this.elements=e}}function jP(n,e){const t=KP(e);for(const r of n.elements)t.some(i=>lu(i,r))||t.push(r);return{arrayValue:{values:t}}}class Cm extends AS{constructor(e){super(),this.elements=e}}function zP(n,e){let t=KP(e);for(const r of n.elements)t=t.filter(i=>!lu(i,r));return{arrayValue:{values:t}}}class d0 extends AS{constructor(e,t){super(),this.serializer=e,this.gt=t}}function WP(n){return Ei(n.integerValue||n.doubleValue)}function KP(n){return $b(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class qb{constructor(e,t){this.field=e,this.transform=t}}class I${constructor(e,t){this.version=e,this.transformResults=t}}class Jr{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Jr}static exists(e){return new Jr(void 0,e)}static updateTime(e){return new Jr(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function xS(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class CS{}function qP(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new f0(n.key,Jr.none()):new h0(n.key,n.data,Jr.none());{const t=n.data,r=Fs.empty();let i=new Fr(bi.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new Ed(n.key,r,new Qo(i.toArray()),Jr.none())}}function w$(n,e,t){n instanceof h0?function(r,i,s){const o=r.value.clone(),u=QP(r.fieldTransforms,i,s.transformResults);o.setAll(u),i.convertToFoundDocument(s.version,o).setHasCommittedMutations()}(n,e,t):n instanceof Ed?function(r,i,s){if(!xS(r.precondition,i))return void i.convertToUnknownDocument(s.version);const o=QP(r.fieldTransforms,i,s.transformResults),u=i.data;u.setAll(ZP(r)),u.setAll(o),i.convertToFoundDocument(s.version,u).setHasCommittedMutations()}(n,e,t):function(r,i,s){i.convertToNoDocument(s.version).setHasCommittedMutations()}(0,e,t)}function Yb(n,e,t,r){return n instanceof h0?function(i,s,o,u){if(!xS(i.precondition,s))return o;const d=i.value.clone(),f=XP(i.fieldTransforms,u,s);return d.setAll(f),s.convertToFoundDocument(s.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ed?function(i,s,o,u){if(!xS(i.precondition,s))return o;const d=XP(i.fieldTransforms,u,s),f=s.data;return f.setAll(ZP(i)),f.setAll(d),s.convertToFoundDocument(s.version,f).setHasLocalMutations(),null===o?null:o.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(g=>g.field))}(n,e,t,r):function(i,s,o){return xS(i.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):o}(n,e,t)}function S$(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=HP(r.transform,i||null);null!=s&&(null===t&&(t=Fs.empty()),t.set(r.field,s))}return t||null}function YP(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(t,r){return void 0===t&&void 0===r||!(!t||!r)&&r0(t,r,(i,s)=>function T$(n,e){return n.field.isEqual(e.field)&&function(t,r){return t instanceof xm&&r instanceof xm||t instanceof Cm&&r instanceof Cm?r0(t.elements,r.elements,lu):t instanceof d0&&r instanceof d0?lu(t.gt,r.gt):t instanceof u0&&r instanceof u0}(n.transform,e.transform)}(i,s))}(n.fieldTransforms,e.fieldTransforms)&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class h0 extends CS{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ed extends CS{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function ZP(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function QP(n,e,t){const r=new Map;Yt(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,u=e.data.field(s.field);r.set(s.field,E$(o,u,t[i]))}return r}function XP(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,b$(s,o,e))}return r}class f0 extends CS{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class NR extends CS{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class FR{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&w$(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Yb(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Yb(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=BP();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let u=this.applyToLocalView(o,s.mutatedFields);u=t.has(i.key)?null:u;const d=qP(o,u);null!==d&&r.set(i.key,d),o.isValidDocument()||o.convertToNoDocument(Zt.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),xn())}isEqual(e){return this.batchId===e.batchId&&r0(this.mutations,e.mutations,(t,r)=>YP(t,r))&&r0(this.baseMutations,e.baseMutations,(t,r)=>YP(t,r))}}class UR{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Yt(e.mutations.length===r.length);let i=y$;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new UR(e,t,r,i)}}class BR{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class A${constructor(e,t){this.count=e,this.unchangedNames=t}}var Bi,Xn;function JP(n){switch(n){default:return kt();case Te.CANCELLED:case Te.UNKNOWN:case Te.DEADLINE_EXCEEDED:case Te.RESOURCE_EXHAUSTED:case Te.INTERNAL:case Te.UNAVAILABLE:case Te.UNAUTHENTICATED:return!1;case Te.INVALID_ARGUMENT:case Te.NOT_FOUND:case Te.ALREADY_EXISTS:case Te.PERMISSION_DENIED:case Te.FAILED_PRECONDITION:case Te.ABORTED:case Te.OUT_OF_RANGE:case Te.UNIMPLEMENTED:case Te.DATA_LOSS:return!0}}function eO(n){if(void 0===n)return Ri("GRPC error has no .code"),Te.UNKNOWN;switch(n){case Bi.OK:return Te.OK;case Bi.CANCELLED:return Te.CANCELLED;case Bi.UNKNOWN:return Te.UNKNOWN;case Bi.DEADLINE_EXCEEDED:return Te.DEADLINE_EXCEEDED;case Bi.RESOURCE_EXHAUSTED:return Te.RESOURCE_EXHAUSTED;case Bi.INTERNAL:return Te.INTERNAL;case Bi.UNAVAILABLE:return Te.UNAVAILABLE;case Bi.UNAUTHENTICATED:return Te.UNAUTHENTICATED;case Bi.INVALID_ARGUMENT:return Te.INVALID_ARGUMENT;case Bi.NOT_FOUND:return Te.NOT_FOUND;case Bi.ALREADY_EXISTS:return Te.ALREADY_EXISTS;case Bi.PERMISSION_DENIED:return Te.PERMISSION_DENIED;case Bi.FAILED_PRECONDITION:return Te.FAILED_PRECONDITION;case Bi.ABORTED:return Te.ABORTED;case Bi.OUT_OF_RANGE:return Te.OUT_OF_RANGE;case Bi.UNIMPLEMENTED:return Te.UNIMPLEMENTED;case Bi.DATA_LOSS:return Te.DATA_LOSS;default:return kt()}}(Xn=Bi||(Bi={}))[Xn.OK=0]="OK",Xn[Xn.CANCELLED=1]="CANCELLED",Xn[Xn.UNKNOWN=2]="UNKNOWN",Xn[Xn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Xn[Xn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Xn[Xn.NOT_FOUND=5]="NOT_FOUND",Xn[Xn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Xn[Xn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Xn[Xn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Xn[Xn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Xn[Xn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Xn[Xn.ABORTED=10]="ABORTED",Xn[Xn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Xn[Xn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Xn[Xn.INTERNAL=13]="INTERNAL",Xn[Xn.UNAVAILABLE=14]="UNAVAILABLE",Xn[Xn.DATA_LOSS=15]="DATA_LOSS";class VR{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return RS}static getOrCreateInstance(){return null===RS&&(RS=new VR),RS}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let RS=null;function tO(){return new TextEncoder}const x$=new Pe([4294967295,4294967295],0);function nO(n){const e=tO().encode(n),t=new he;return t.update(e),new Uint8Array(t.digest())}function rO(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Pe([t,r],0),new Pe([i,s],0)]}class $R{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Zb(`Invalid padding: ${t}`);if(r<0)throw new Zb(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new Zb(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new Zb(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=Pe.fromNumber(this.It)}Et(e,t,r){let i=e.add(t.multiply(Pe.fromNumber(r)));return 1===i.compare(x$)&&(i=new Pe([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=nO(e),[r,i]=rO(t);for(let s=0;s<this.hashCount;s++){const o=this.Et(r,i,s);if(!this.At(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new $R(s,i,t);return r.forEach(u=>o.insert(u)),o}insert(e){if(0===this.It)return;const t=nO(e),[r,i]=rO(t);for(let s=0;s<this.hashCount;s++){const o=this.Et(r,i,s);this.Rt(o)}}Rt(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Zb extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Qb{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Xb.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Qb(Zt.min(),i,new xr(Tn),Xo(),xn())}}class Xb{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Xb(r,t,xn(),xn(),xn())}}class MS{constructor(e,t,r,i){this.Pt=e,this.removedTargetIds=t,this.key=r,this.bt=i}}class iO{constructor(e,t){this.targetId=e,this.Vt=t}}class sO{constructor(e,t,r=Qi.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class oO{constructor(){this.St=0,this.Dt=lO(),this.Ct=Qi.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=xn(),t=xn(),r=xn();return this.Dt.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:kt()}}),new Xb(this.Ct,this.xt,e,t,r)}Ft(){this.Nt=!1,this.Dt=lO()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class C${constructor(e){this.Gt=e,this.Qt=new Map,this.jt=Xo(),this.zt=aO(),this.Wt=new xr(Tn)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,t=>{const r=this.Zt(t);switch(e.state){case 0:this.te(t)&&r.$t(e.resumeToken);break;case 1:r.Ut(),r.kt||r.Ft(),r.$t(e.resumeToken);break;case 2:r.Ut(),r.kt||this.removeTarget(t);break;case 3:this.te(t)&&(r.Kt(),r.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),r.$t(e.resumeToken));break;default:kt()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach((r,i)=>{this.te(i)&&t(i)})}ne(e){var t;const r=e.targetId,i=e.Vt.count,s=this.se(r);if(s){const o=s.target;if(IS(o))if(0===i){const u=new gt(o.path);this.Yt(r,u,Ur.newNoDocument(u,Zt.min()))}else Yt(1===i);else{const u=this.ie(r);if(u!==i){const d=this.re(e,u);0!==d&&(this.ee(r),this.Wt=this.Wt.insert(r,2===d?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null===(t=VR.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(f,g,b){var T,w,x,k,N,z;const X={localCacheCount:g,existenceFilterCount:b.count},K=b.unchangedNames;return K&&(X.bloomFilter={applied:0===f,hashCount:null!==(T=K?.hashCount)&&void 0!==T?T:0,bitmapLength:null!==(k=null===(x=null===(w=K?.bits)||void 0===w?void 0:w.bitmap)||void 0===x?void 0:x.length)&&void 0!==k?k:0,padding:null!==(z=null===(N=K?.bits)||void 0===N?void 0:N.padding)&&void 0!==z?z:0}),X}(d,u,e.Vt))}}}}re(e,t){const{unchangedNames:r,count:i}=e.Vt;if(!r||!r.bits)return 1;const{bits:{bitmap:s="",padding:o=0},hashCount:u=0}=r;let d,f;try{d=_d(s).toUint8Array()}catch(g){if(g instanceof fP)return hl("Decoding the base64 bloom filter in existence filter failed ("+g.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw g}try{f=new $R(d,o,u)}catch(g){return hl(g instanceof Zb?"BloomFilter error: ":"Applying bloom filter failed: ",g),1}return 0===f.It?1:i!==t-this.oe(e.targetId,f)?2:0}oe(e,t){const r=this.Gt.getRemoteKeysForTarget(e);let i=0;return r.forEach(s=>{const o=this.Gt.ue(),u=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;t.vt(u)||(this.Yt(e,s,null),i++)}),i}ce(e){const t=new Map;this.Qt.forEach((s,o)=>{const u=this.se(o);if(u){if(s.current&&IS(u.target)){const d=new gt(u.target.path);null!==this.jt.get(d)||this.ae(o,d)||this.Yt(o,d,Ur.newNoDocument(d,e))}s.Mt&&(t.set(o,s.Ot()),s.Ft())}});let r=xn();this.zt.forEach((s,o)=>{let u=!0;o.forEachWhile(d=>{const f=this.se(d);return!f||"TargetPurposeLimboResolution"===f.purpose||(u=!1,!1)}),u&&(r=r.add(s))}),this.jt.forEach((s,o)=>o.setReadTime(e));const i=new Qb(e,t,this.Wt,this.jt,r);return this.jt=Xo(),this.zt=aO(),this.Wt=new xr(Tn),i}Jt(e,t){if(!this.te(e))return;const r=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,r),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,r){if(!this.te(e))return;const i=this.Zt(e);this.ae(e,t)?i.Bt(t,1):i.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),r&&(this.jt=this.jt.insert(t,r))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new oO,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new Fr(Tn),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||it("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new oO),this.Gt.getRemoteKeysForTarget(e).forEach(t=>{this.Yt(e,t,null)})}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function aO(){return new xr(gt.comparator)}function lO(){return new xr(gt.comparator)}const R$={asc:"ASCENDING",desc:"DESCENDING"},M$={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},k$={and:"AND",or:"OR"};class L${constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function GR(n,e){return n.useProto3Json||Fb(e)?e:{value:e}}function p0(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cO(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function P$(n,e){return p0(n,e.toTimestamp())}function Mi(n){return Yt(!!n),Zt.fromTimestamp(function(e){const t=vf(e);return new Xr(t.seconds,t.nanos)}(n))}function HR(n,e){return(t=n,new Qn(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function uO(n){const e=Qn.fromString(n);return Yt(vO(e)),e}function Jb(n,e){return HR(n.databaseId,e.path)}function uu(n,e){const t=uO(e);if(t.get(1)!==n.databaseId.projectId)throw new Ge(Te.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Ge(Te.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new gt(hO(t))}function jR(n,e){return HR(n.databaseId,e)}function dO(n){const e=uO(n);return 4===e.length?Qn.emptyPath():hO(e)}function eE(n){return new Qn(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function hO(n){return Yt(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function fO(n,e,t){return{name:Jb(n,e),fields:t.value.mapValue.fields}}function pO(n,e,t){const r=uu(n,e.name),i=Mi(e.updateTime),s=e.createTime?Mi(e.createTime):Zt.min(),o=new Fs({mapValue:{fields:e.fields}}),u=Ur.newFoundDocument(r,i,s,o);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function tE(n,e){let t;if(e instanceof h0)t={update:fO(n,e.key,e.value)};else if(e instanceof f0)t={delete:Jb(n,e.key)};else if(e instanceof Ed)t={update:fO(n,e.key,e.data),updateMask:G$(e.fieldMask)};else{if(!(e instanceof NR))return kt();t={verify:Jb(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,s){const o=s.transform;if(o instanceof u0)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof xm)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Cm)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof d0)return{fieldPath:s.field.canonicalString(),increment:o.gt};throw kt()}(0,r))),e.precondition.isNone||(t.currentDocument=function(r,i){return void 0!==i.updateTime?{updateTime:P$(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:kt()}(n,e.precondition)),t}function zR(n,e){const t=e.currentDocument?function(i){return void 0!==i.updateTime?Jr.updateTime(Mi(i.updateTime)):void 0!==i.exists?Jr.exists(i.exists):Jr.none()}(e.currentDocument):Jr.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(s,o){let u=null;"setToServerValue"in o?(Yt("REQUEST_TIME"===o.setToServerValue),u=new u0):"appendMissingElements"in o?u=new xm(o.appendMissingElements.values||[]):"removeAllFromArray"in o?u=new Cm(o.removeAllFromArray.values||[]):"increment"in o?u=new d0(s,o.increment):kt();const d=bi.fromServerFormat(o.fieldPath);return new qb(d,u)}(n,i)):[];if(e.update){const i=uu(n,e.update.name),s=new Fs({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(u){return new Qo((u.fieldPaths||[]).map(f=>bi.fromServerFormat(f)))}(e.updateMask);return new Ed(i,s,o,t,r)}return new h0(i,s,t,r)}if(e.delete){const i=uu(n,e.delete);return new f0(i,t)}if(e.verify){const i=uu(n,e.verify);return new NR(i,t)}return kt()}function mO(n,e){return{documents:[jR(n,e.path)]}}function WR(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=jR(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=jR(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(d){if(0!==d.length)return _O(mr.create(d,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(d){if(0!==d.length)return d.map(f=>{return{field:Sf((g=f).field),direction:B$(g.dir)};var g})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const o=GR(n,e.limit);var u,d;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(u=e.startAt).inclusive,values:u.position}),e.endAt&&(t.structuredQuery.endAt={before:!(d=e.endAt).inclusive,values:d.position}),t}function gO(n){let e=dO(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){Yt(1===r);const g=t.from[0];g.allDescendants?i=g.collectionId:e=e.child(g.collectionId)}let s=[];t.where&&(s=function(g){const b=yO(g);return b instanceof mr&&xR(b)?b.getFilters():[b]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(g=>{return new a0(m0((b=g).field),function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(b.direction));var b}));let u=null;t.limit&&(u=function(g){let b;return b="object"==typeof g?g.value:g,Fb(b)?null:b}(t.limit));let d=null;var g;t.startAt&&(d=new wf((g=t.startAt).values||[],!!g.before));let f=null;return t.endAt&&(f=function(g){return new wf(g.values||[],!g.before)}(t.endAt)),kP(e,i,o,s,u,"F",d,f)}function yO(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=m0(e.unaryFilter.field);return Vn.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=m0(e.unaryFilter.field);return Vn.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=m0(e.unaryFilter.field);return Vn.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=m0(e.unaryFilter.field);return Vn.create(s,"!=",{nullValue:"NULL_VALUE"});default:return kt()}}(n):void 0!==n.fieldFilter?Vn.create(m0((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return kt()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return mr.create(e.compositeFilter.filters.map(t=>yO(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return kt()}}(e.compositeFilter.op))}(n):kt();var e}function B$(n){return R$[n]}function V$(n){return M$[n]}function $$(n){return k$[n]}function Sf(n){return{fieldPath:n.canonicalString()}}function m0(n){return bi.fromServerFormat(n.fieldPath)}function _O(n){return n instanceof Vn?function(e){if("=="===e.op){if(gP(e.value))return{unaryFilter:{field:Sf(e.field),op:"IS_NAN"}};if(mP(e.value))return{unaryFilter:{field:Sf(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(gP(e.value))return{unaryFilter:{field:Sf(e.field),op:"IS_NOT_NAN"}};if(mP(e.value))return{unaryFilter:{field:Sf(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Sf(e.field),op:V$(e.op),value:e.value}}}(n):n instanceof mr?function(e){const t=e.getFilters().map(r=>_O(r));return 1===t.length?t[0]:{compositeFilter:{op:$$(e.op),filters:t}}}(n):kt()}function G$(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function vO(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class Td{constructor(e,t,r,i,s=Zt.min(),o=Zt.min(),u=Qi.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=d}withSequenceNumber(e){return new Td(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Td(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Td(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Td(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class bO{constructor(e){this.fe=e}}function EO(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:kS(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,s){return{name:Jb(i,s.key),fields:s.data.value.mapValue.fields,updateTime:p0(i,s.version.toTimestamp()),createTime:p0(i,s.createTime.toTimestamp())}}(n.fe,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Rm(e.version)};else{if(!e.isUnknownDocument())return kt();r.unknownDocument={path:t.path.toArray(),version:Rm(e.version)}}return r}function kS(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Rm(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Mm(n){const e=new Xr(n.seconds,n.nanoseconds);return Zt.fromTimestamp(e)}function km(n,e){const t=(e.baseMutations||[]).map(s=>zR(n.fe,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>zR(n.fe,s)),i=Xr.fromMillis(e.localWriteTimeMs);return new FR(e.batchId,i,t,r)}function nE(n){const e=Mm(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Mm(n.lastLimboFreeSnapshotVersion):Zt.min();let r;var i;return void 0!==n.query.documents?(Yt(1===(i=n.query).documents.length),r=Eo(c0(dO(i.documents[0])))):r=function(s){return Eo(gO(s))}(n.query),new Td(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Qi.fromBase64String(n.resumeToken))}function TO(n,e){const t=Rm(e.snapshotVersion),r=Rm(e.lastLimboFreeSnapshotVersion);let i;i=IS(e.target)?mO(n.fe,e.target):WR(n.fe,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Dm(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function KR(n){const e=gO({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?DS(e,e.limit,"L"):e}function qR(n,e){return new BR(e.largestBatchId,zR(n.fe,e.overlayMutation))}function IO(n,e){const t=e.path.lastSegment();return[n,Zs(e.path.popLast()),t]}function wO(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Rm(r.readTime),documentKey:Zs(r.documentKey.path),largestBatchId:r.largestBatchId}}class j${getBundleMetadata(e,t){return SO(e).get(t).next(r=>{if(r)return{id:(i=r).bundleId,createTime:Mm(i.createTime),version:i.version};var i})}saveBundleMetadata(e,t){return SO(e).put({bundleId:(r=t).id,createTime:Rm(Mi(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return DO(e).get(t).next(r=>{if(r)return{name:(i=r).name,query:KR(i.bundledQuery),readTime:Mm(i.readTime)};var i})}saveNamedQuery(e,t){return DO(e).put(function(r){return{name:r.name,readTime:Rm(Mi(r.readTime)),bundledQuery:r.bundledQuery}}(t))}}function SO(n){return gs(n,"bundles")}function DO(n){return gs(n,"namedQueries")}class LS{constructor(e,t){this.serializer=e,this.userId=t}static de(e,t){return new LS(e,t.uid||"")}getOverlay(e,t){return rE(e).get(IO(this.userId,t)).next(r=>r?qR(this.serializer,r):null)}getOverlays(e,t){const r=cu();return _e.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,o)=>{const u=new BR(t,o);i.push(this.we(e,u))}),_e.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(o=>i.add(Zs(o.getCollectionPath())));const s=[];return i.forEach(o=>{const u=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(rE(e).J("collectionPathOverlayIndex",u))}),_e.waitFor(s)}getOverlaysForCollection(e,t,r){const i=cu(),s=Zs(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return rE(e).j("collectionPathOverlayIndex",o).next(u=>{for(const d of u){const f=qR(this.serializer,d);i.set(f.getKey(),f)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=cu();let o;const u=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return rE(e).X({index:"collectionGroupOverlayIndex",range:u},(d,f,g)=>{const b=qR(this.serializer,f);s.size()<i||b.largestBatchId===o?(s.set(b.getKey(),b),o=b.largestBatchId):g.done()}).next(()=>s)}we(e,t){return rE(e).put(function(r,i,s){const[o,u,d]=IO(i,s.mutation.key);return{userId:i,collectionPath:u,documentId:d,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:tE(r.fe,s.mutation)}}(this.serializer,this.userId,t))}}function rE(n){return gs(n,"documentOverlays")}class Lm{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(Ei(e.integerValue));else if("doubleValue"in e){const r=Ei(e.doubleValue);isNaN(r)?this.ye(t,13):(this.ye(t,15),Ub(r)?t.pe(0):t.pe(r))}else if("timestampValue"in e){const r=e.timestampValue;this.ye(t,20),"string"==typeof r?t.Ie(r):(t.Ie(`${r.seconds||""}`),t.pe(r.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(_d(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.ye(t,45),t.pe(r.latitude||0),t.pe(r.longitude||0)}else"mapValue"in e?yP(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):kt()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const r=e.fields||{};this.ye(t,55);for(const i of Object.keys(r))this.Te(i,t),this.me(r[i],t)}Pe(e,t){const r=e.values||[];this.ye(t,50);for(const i of r)this.me(i,t)}ve(e,t){this.ye(t,37),gt.fromName(e).path.forEach(r=>{this.ye(t,60),this.be(r,t)})}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}function z$(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function AO(n){const e=64-function(t){let r=0;for(let i=0;i<8;++i){const s=z$(255&t[i]);if(r+=s,8!==s)break}return r}(n);return Math.ceil(e/8)}Lm.Ve=new Lm;class W${constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.De(r.value),r=t.next();this.Ce()}xe(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ne(r.value),r=t.next();this.ke()}Me(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.De(r);else if(r<2048)this.De(960|r>>>6),this.De(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.De(480|r>>>12),this.De(128|63&r>>>6),this.De(128|63&r);else{const i=t.codePointAt(0);this.De(240|i>>>18),this.De(128|63&i>>>12),this.De(128|63&i>>>6),this.De(128|63&i)}}this.Ce()}$e(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ne(r);else if(r<2048)this.Ne(960|r>>>6),this.Ne(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ne(480|r>>>12),this.Ne(128|63&r>>>6),this.Ne(128|63&r);else{const i=t.codePointAt(0);this.Ne(240|i>>>18),this.Ne(128|63&i>>>12),this.Ne(128|63&i>>>6),this.Ne(128|63&i)}}this.ke()}Oe(e){const t=this.Fe(e),r=AO(t);this.Be(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Le(e){const t=this.Fe(e),r=AO(t);this.Be(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(e){this.Be(e.length),this.buffer.set(e,this.position),this.position+=e.length}Qe(){return this.buffer.slice(0,this.position)}Fe(e){const t=function(i){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,i,!1),new Uint8Array(s.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}De(e){const t=255&e;0===t?(this.Ue(0),this.Ue(255)):255===t?(this.Ue(255),this.Ue(0)):this.Ue(t)}Ne(e){const t=255&e;0===t?(this.Ge(0),this.Ge(255)):255===t?(this.Ge(255),this.Ge(0)):this.Ge(e)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(e){this.Be(1),this.buffer[this.position++]=e}Ge(e){this.Be(1),this.buffer[this.position++]=~e}Be(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class K${constructor(e){this.je=e}Ae(e){this.je.Se(e)}Ie(e){this.je.Me(e)}pe(e){this.je.Oe(e)}ge(){this.je.qe()}}class q${constructor(e){this.je=e}Ae(e){this.je.xe(e)}Ie(e){this.je.$e(e)}pe(e){this.je.Le(e)}ge(){this.je.Ke()}}class iE{constructor(){this.je=new W$,this.ze=new K$(this.je),this.We=new q$(this.je)}seed(e){this.je.seed(e)}He(e){return 0===e?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class Pm{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Je(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Pm(this.indexId,this.documentKey,this.arrayValue,r)}}function Df(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=xO(n.arrayValue,e.arrayValue),0!==t?t:(t=xO(n.directionalValue,e.directionalValue),0!==t?t:gt.comparator(n.documentKey,e.documentKey)))}function xO(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Y${constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ye=e.orderBy,this.Xe=[];for(const t of e.filters){const r=t;r.isInequality()?this.Ze=r:this.Xe.push(r)}}tn(e){Yt(e.collectionGroup===this.collectionId);const t=ER(e);if(void 0!==t&&!this.en(t))return!1;const r=Im(e);let i=new Set,s=0,o=0;for(;s<r.length&&this.en(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(void 0!==this.Ze){if(!i.has(this.Ze.field.canonicalString())){const u=r[s];if(!this.nn(this.Ze,u)||!this.sn(this.Ye[o++],u))return!1}++s}for(;s<r.length;++s)if(o>=this.Ye.length||!this.sn(this.Ye[o++],r[s]))return!1;return!0}en(e){for(const t of this.Xe)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function CO(n){var e,t;if(Yt(n instanceof Vn||n instanceof mr),n instanceof Vn){if(n instanceof CP){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>Vn.create(n.field,"==",s)))||[];return mr.create(i,"or")}return n}const r=n.filters.map(i=>CO(i));return mr.create(r,n.op)}function Z$(n){if(0===n.getFilters().length)return[];const e=QR(CO(n));return Yt(RO(e)),YR(e)||ZR(e)?[e]:e.getFilters()}function YR(n){return n instanceof Vn}function ZR(n){return n instanceof mr&&xR(n)}function RO(n){return YR(n)||ZR(n)||function(e){if(e instanceof mr&&AR(e)){for(const t of e.getFilters())if(!YR(t)&&!ZR(t))return!1;return!0}return!1}(n)}function QR(n){if(Yt(n instanceof Vn||n instanceof mr),n instanceof Vn)return n;if(1===n.filters.length)return QR(n.filters[0]);const e=n.filters.map(r=>QR(r));let t=mr.create(e,n.op);return t=PS(t),RO(t)?t:(Yt(t instanceof mr),Yt(l0(t)),Yt(t.filters.length>1),t.filters.reduce((r,i)=>XR(r,i)))}function XR(n,e){let t;return Yt(n instanceof Vn||n instanceof mr),Yt(e instanceof Vn||e instanceof mr),t=n instanceof Vn?e instanceof Vn?function(r,i){return mr.create([r,i],"and")}(n,e):MO(n,e):e instanceof Vn?MO(e,n):function(r,i){if(Yt(r.filters.length>0&&i.filters.length>0),l0(r)&&l0(i))return DP(r,i.getFilters());const s=AR(r)?r:i,o=AR(r)?i:r,u=s.filters.map(d=>XR(d,o));return mr.create(u,"or")}(n,e),PS(t)}function MO(n,e){if(l0(e))return DP(e,n.getFilters());{const t=e.filters.map(r=>XR(n,r));return mr.create(t,"or")}}function PS(n){if(Yt(n instanceof Vn||n instanceof mr),n instanceof Vn)return n;const e=n.getFilters();if(1===e.length)return PS(e[0]);if(wP(n))return n;const t=e.map(i=>PS(i)),r=[];return t.forEach(i=>{i instanceof Vn?r.push(i):i instanceof mr&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:mr.create(r,n.op)}class Q${constructor(){this.rn=new JR}addToCollectionParentIndex(e,t){return this.rn.add(t),_e.resolve()}getCollectionParents(e,t){return _e.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return _e.resolve()}deleteFieldIndex(e,t){return _e.resolve()}getDocumentsMatchingTarget(e,t){return _e.resolve(null)}getIndexType(e,t){return _e.resolve(0)}getFieldIndexes(e,t){return _e.resolve([])}getNextCollectionGroupToUpdate(e){return _e.resolve(null)}getMinOffset(e,t){return _e.resolve(Pa.min())}getMinOffsetFromCollectionGroup(e,t){return _e.resolve(Pa.min())}updateCollectionGroup(e,t,r){return _e.resolve()}updateIndexEntries(e,t){return _e.resolve()}}class JR{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Fr(Qn.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Fr(Qn.comparator)).toArray()}}const OS=new Uint8Array(0);class X${constructor(e,t){this.user=e,this.databaseId=t,this.on=new JR,this.un=new bd(r=>Dm(r),(r,i)=>Hb(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.on.add(t)});const s={collectionId:r,parent:Zs(i)};return kO(e).put(s)}return _e.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[QL(t),""],!1,!0);return kO(e).j(i).next(s=>{for(const o of s){if(o.collectionId!==t)break;r.push(au(o.parent))}return r})}addFieldIndex(e,t){const r=NS(e),i=function(o){return{indexId:o.indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;const s=r.add(i);if(t.indexState){const o=oE(e);return s.next(u=>{o.put(wO(u,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=NS(e),i=oE(e),s=sE(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=sE(e);let i=!0;const s=new Map;return _e.forEach(this.cn(t),o=>this.an(e,o).next(u=>{i&&(i=!!u),s.set(o,u)})).next(()=>{if(i){let o=xn();const u=[];return _e.forEach(s,(d,f)=>{var g;it("IndexedDbIndexManager",`Using index ${g=d,`id=${g.indexId}|cg=${g.collectionGroup}|f=${g.fields.map(K=>`${K.fieldPath}:${K.kind}`).join(",")}`} to execute ${Dm(t)}`);const b=function(K,ie){const le=ER(ie);if(void 0===le)return null;for(const Me of wS(K,le.fieldPath))switch(Me.op){case"array-contains-any":return Me.value.arrayValue.values||[];case"array-contains":return[Me.value]}return null}(f,d),T=function(K,ie){const le=new Map;for(const Me of Im(ie))for(const Ie of wS(K,Me.fieldPath))switch(Ie.op){case"==":case"in":le.set(Me.fieldPath.canonicalString(),Ie.value);break;case"not-in":case"!=":return le.set(Me.fieldPath.canonicalString(),Ie.value),Array.from(le.values())}return null}(f,d),w=function(K,ie){const le=[];let Me=!0;for(const Ie of Im(ie)){const We=0===Ie.kind?RP(K,Ie.fieldPath,K.startAt):MP(K,Ie.fieldPath,K.startAt);le.push(We.value),Me&&(Me=We.inclusive)}return new wf(le,Me)}(f,d),x=function(K,ie){const le=[];let Me=!0;for(const Ie of Im(ie)){const We=0===Ie.kind?MP(K,Ie.fieldPath,K.endAt):RP(K,Ie.fieldPath,K.endAt);le.push(We.value),Me&&(Me=We.inclusive)}return new wf(le,Me)}(f,d),k=this.hn(d,f,w),N=this.hn(d,f,x),z=this.ln(d,f,T),X=this.fn(d.indexId,b,k,w.inclusive,N,x.inclusive,z);return _e.forEach(X,K=>r.H(K,t.limit).next(ie=>{ie.forEach(le=>{const Me=gt.fromSegments(le.documentKey);o.has(Me)||(o=o.add(Me),u.push(Me))})}))}).next(()=>u)}return _e.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:Z$(mr.create(e.filters,"and")).map(r=>RR(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}fn(e,t,r,i,s,o,u){const d=(null!=t?t.length:1)*Math.max(r.length,s.length),f=d/(null!=t?t.length:1),g=[];for(let b=0;b<d;++b){const T=t?this.dn(t[b/f]):OS,w=this.wn(e,T,r[b%f],i),x=this._n(e,T,s[b%f],o),k=u.map(N=>this.wn(e,T,N,!0));g.push(...this.createRange(w,x,k))}return g}wn(e,t,r,i){const s=new Pm(e,gt.empty(),t,r);return i?s:s.Je()}_n(e,t,r,i){const s=new Pm(e,gt.empty(),t,r);return i?s.Je():s}an(e,t){const r=new Y$(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const u of s)r.tn(u)&&(!o||u.fields.length>o.fields.length)&&(o=u);return o})}getIndexType(e,t){let r=2;const i=this.cn(t);return _e.forEach(i,s=>this.an(e,s).next(o=>{o?0!==r&&o.fields.length<function(u){let d=new Fr(bi.comparator),f=!1;for(const g of u.filters)for(const b of g.getFlattenedFilters())b.field.isKeyField()||("array-contains"===b.op||"array-contains-any"===b.op?f=!0:d=d.add(b.field));for(const g of u.orderBy)g.field.isKeyField()||(d=d.add(g.field));return d.size+(f?1:0)}(s)&&(r=1):r=0})).next(()=>function(s){return null!==s.limit}(t)&&i.length>1&&2===r?1:r)}mn(e,t){const r=new iE;for(const i of Im(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const o=r.He(i.kind);Lm.Ve._e(s,o)}return r.Qe()}dn(e){const t=new iE;return Lm.Ve._e(e,t.He(0)),t.Qe()}gn(e,t){const r=new iE;return Lm.Ve._e(Sm(this.databaseId,t),r.He(function(i){const s=Im(i);return 0===s.length?0:s[s.length-1].kind}(e))),r.Qe()}ln(e,t,r){if(null===r)return[];let i=[];i.push(new iE);let s=0;for(const o of Im(e)){const u=r[s++];for(const d of i)if(this.yn(t,o.fieldPath)&&$b(u))i=this.pn(i,o,u);else{const f=d.He(o.kind);Lm.Ve._e(u,f)}}return this.In(i)}hn(e,t,r){return this.ln(e,t,r.position)}In(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Qe();return t}pn(e,t,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const u of i){const d=new iE;d.seed(u.Qe()),Lm.Ve._e(o,d.He(t.kind)),s.push(d)}return s}yn(e,t){return!!e.filters.find(r=>r instanceof Vn&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=NS(e),i=oE(e);return(t?r.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.j()).next(s=>{const o=[];return _e.forEach(s,u=>i.get([u.indexId,this.uid]).next(d=>{o.push(function(f,g){const b=g?new Ob(g.sequenceNumber,new Pa(Mm(g.readTime),new gt(au(g.documentKey)),g.largestBatchId)):Ob.empty(),T=f.fields.map(([w,x])=>new pS(bi.fromServerFormat(w),x));return new fS(f.indexId,f.collectionGroup,T,b)}(u,d))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:Tn(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=NS(e),s=oE(e);return this.Tn(e).next(o=>i.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>_e.forEach(u,d=>s.put(wO(d.indexId,this.user,o,r)))))}updateIndexEntries(e,t){const r=new Map;return _e.forEach(t,(i,s)=>{const o=r.get(i.collectionGroup);return(o?_e.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(r.set(i.collectionGroup,u),_e.forEach(u,d=>this.En(e,i,d).next(f=>{const g=this.An(s,d);return f.isEqual(g)?_e.resolve():this.vn(e,s,d,f,g)}))))})}Rn(e,t,r,i){return sE(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.gn(r,t.key),documentKey:t.key.path.toArray()})}Pn(e,t,r,i){return sE(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.gn(r,t.key),t.key.path.toArray()])}En(e,t,r){const i=sE(e);let s=new Fr(Df);return i.X({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.gn(r,t)])},(o,u)=>{s=s.add(new Pm(r.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}An(e,t){let r=new Fr(Df);const i=this.mn(t,e);if(null==i)return r;const s=ER(t);if(null!=s){const o=e.data.field(s.fieldPath);if($b(o))for(const u of o.arrayValue.values||[])r=r.add(new Pm(t.indexId,e.key,this.dn(u),i))}else r=r.add(new Pm(t.indexId,e.key,OS,i));return r}vn(e,t,r,i,s){it("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(u,d,f,g,b){const T=u.getIterator(),w=d.getIterator();let x=s0(T),k=s0(w);for(;x||k;){let N=!1,z=!1;if(x&&k){const X=f(x,k);X<0?z=!0:X>0&&(N=!0)}else null!=x?z=!0:N=!0;N?(g(k),k=s0(w)):z?(b(x),x=s0(T)):(x=s0(T),k=s0(w))}}(i,s,Df,u=>{o.push(this.Rn(e,t,r,u))},u=>{o.push(this.Pn(e,t,r,u))}),_e.waitFor(o)}Tn(e){let t=1;return oE(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,u)=>Df(o,u)).filter((o,u,d)=>!u||0!==Df(o,d[u-1]));const i=[];i.push(e);for(const o of r){const u=Df(o,e),d=Df(o,t);if(0===u)i[0]=e.Je();else if(u>0&&d<0)i.push(o),i.push(o.Je());else if(d>0)break}i.push(t);const s=[];for(let o=0;o<i.length;o+=2){if(this.bn(i[o],i[o+1]))return[];s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,OS,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,OS,[]]))}return s}bn(e,t){return Df(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(LO)}getMinOffset(e,t){return _e.mapArray(this.cn(t),r=>this.an(e,r).next(i=>i||kt())).next(LO)}}function kO(n){return gs(n,"collectionParents")}function sE(n){return gs(n,"indexEntries")}function NS(n){return gs(n,"indexConfiguration")}function oE(n){return gs(n,"indexState")}function LO(n){Yt(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;TR(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Pa(e.readTime,e.documentKey,t)}const PO={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Qs{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Qs(e,Qs.DEFAULT_COLLECTION_PERCENTILE,Qs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function OO(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let u=0;const d=r.X({range:o},(g,b,T)=>(u++,T.delete()));s.push(d.next(()=>{Yt(1===u)}));const f=[];for(const g of t.mutations){const b=oP(e,g.key.path,t.batchId);s.push(i.delete(b)),f.push(g.key)}return _e.waitFor(s).next(()=>f)}function FS(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw kt();e=n.noDocument}return JSON.stringify(e).length}Qs.DEFAULT_COLLECTION_PERCENTILE=10,Qs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qs.DEFAULT=new Qs(41943040,Qs.DEFAULT_COLLECTION_PERCENTILE,Qs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qs.DISABLED=new Qs(-1,0,0);class US{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Vn={}}static de(e,t,r,i){Yt(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new US(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Af(e).X({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=g0(e),o=Af(e);return o.add({}).next(u=>{Yt("number"==typeof u);const d=new FR(u,t,r,i),f=function(T,w,x){const k=x.baseMutations.map(z=>tE(T.fe,z)),N=x.mutations.map(z=>tE(T.fe,z));return{userId:w,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:k,mutations:N}}(this.serializer,this.userId,d),g=[];let b=new Fr((T,w)=>Tn(T.canonicalString(),w.canonicalString()));for(const T of i){const w=oP(this.userId,T.key.path,u);b=b.add(T.key.path.popLast()),g.push(o.put(f)),g.push(s.put(w,BV))}return b.forEach(T=>{g.push(this.indexManager.addToCollectionParentIndex(e,T))}),e.addOnCommittedListener(()=>{this.Vn[u]=d.keys()}),_e.waitFor(g).next(()=>d)})}lookupMutationBatch(e,t){return Af(e).get(t).next(r=>r?(Yt(r.userId===this.userId),km(this.serializer,r)):null)}Sn(e,t){return this.Vn[t]?_e.resolve(this.Vn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Vn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Af(e).X({index:"userMutationsIndex",range:i},(o,u,d)=>{u.userId===this.userId&&(Yt(u.batchId>=r),s=km(this.serializer,u)),d.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Af(e).X({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Af(e).j("userMutationsIndex",t).next(r=>r.map(i=>km(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=gS(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return g0(e).X({range:i},(o,u,d)=>{const[f,g,b]=o,T=au(g);if(f===this.userId&&t.path.isEqual(T))return Af(e).get(b).next(w=>{if(!w)throw kt();Yt(w.userId===this.userId),s.push(km(this.serializer,w))});d.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Fr(Tn);const i=[];return t.forEach(s=>{const o=gS(this.userId,s.path),u=IDBKeyRange.lowerBound(o),d=g0(e).X({range:u},(f,g,b)=>{const[T,w,x]=f,k=au(w);T===this.userId&&s.path.isEqual(k)?r=r.add(x):b.done()});i.push(d)}),_e.waitFor(i).next(()=>this.Dn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=gS(this.userId,r),o=IDBKeyRange.lowerBound(s);let u=new Fr(Tn);return g0(e).X({range:o},(d,f,g)=>{const[b,T,w]=d,x=au(T);b===this.userId&&r.isPrefixOf(x)?x.length===i&&(u=u.add(w)):g.done()}).next(()=>this.Dn(e,u))}Dn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(Af(e).get(s).next(o=>{if(null===o)throw kt();Yt(o.userId===this.userId),r.push(km(this.serializer,o))}))}),_e.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return OO(e.ht,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Cn(t.batchId)}),_e.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Cn(e){delete this.Vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return _e.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return g0(e).X({range:r},(s,o,u)=>{if(s[0]===this.userId){const d=au(s[1]);i.push(d)}else u.done()}).next(()=>{Yt(0===i.length)})})}containsKey(e,t){return NO(e,this.userId,t)}xn(e){return FO(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function NO(n,e,t){const r=gS(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return g0(n).X({range:s,Y:!0},(u,d,f)=>{const[g,b,T]=u;g===e&&b===i&&(o=!0),f.done()}).next(()=>o)}function Af(n){return gs(n,"mutations")}function g0(n){return gs(n,"documentMutations")}function FO(n){return gs(n,"mutationQueues")}class Om{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new Om(0)}static Mn(){return new Om(-1)}}class J${constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.$n(e).next(t=>{const r=new Om(t.highestTargetId);return t.highestTargetId=r.next(),this.On(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.$n(e).next(t=>Zt.fromTimestamp(new Xr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.$n(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.$n(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.On(e,i)))}addTargetData(e,t){return this.Fn(e,t).next(()=>this.$n(e).next(r=>(r.targetCount+=1,this.Bn(t,r),this.On(e,r))))}updateTargetData(e,t){return this.Fn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>y0(e).delete(t.targetId)).next(()=>this.$n(e)).next(r=>(Yt(r.targetCount>0),r.targetCount-=1,this.On(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return y0(e).X((o,u)=>{const d=nE(u);d.sequenceNumber<=t&&null===r.get(d.targetId)&&(i++,s.push(this.removeTargetData(e,d)))}).next(()=>_e.waitFor(s)).next(()=>i)}forEachTarget(e,t){return y0(e).X((r,i)=>{const s=nE(i);t(s)})}$n(e){return UO(e).get("targetGlobalKey").next(t=>(Yt(null!==t),t))}On(e,t){return UO(e).put("targetGlobalKey",t)}Fn(e,t){return y0(e).put(TO(this.serializer,t))}Bn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.$n(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Dm(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return y0(e).X({range:i,index:"queryTargetsIndex"},(o,u,d)=>{const f=nE(u);Hb(t,f.target)&&(s=f,d.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=xf(e);return t.forEach(o=>{const u=Zs(o.path);i.push(s.put({targetId:r,path:u})),i.push(this.referenceDelegate.addReference(e,r,o))}),_e.waitFor(i)}removeMatchingKeys(e,t,r){const i=xf(e);return _e.forEach(t,s=>{const o=Zs(s.path);return _e.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=xf(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=xf(e);let s=xn();return i.X({range:r,Y:!0},(o,u,d)=>{const f=au(o[1]),g=new gt(f);s=s.add(g)}).next(()=>s)}containsKey(e,t){const r=Zs(t.path),i=IDBKeyRange.bound([r],[QL(r)],!1,!0);let s=0;return xf(e).X({index:"documentTargetsIndex",Y:!0,range:i},([o,u],d,f)=>{0!==o&&(s++,f.done())}).next(()=>s>0)}le(e,t){return y0(e).get(t).next(r=>r?nE(r):null)}}function y0(n){return gs(n,"targets")}function UO(n){return gs(n,"targetGlobal")}function xf(n){return gs(n,"targetDocuments")}function BO([n,e],[t,r]){const i=Tn(n,t);return 0===i?Tn(e,r):i}class eG{constructor(e){this.Ln=e,this.buffer=new Fr(BO),this.qn=0}Un(){return++this.qn}Kn(e){const t=[e,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();BO(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class VO{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(e){var t=this;it("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,xe.Z)(function*(){t.Gn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){yf(r)?it("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield gf(r)}yield t.Qn(3e5)}))}}class tG{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.zn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return _e.resolve(Oa.ct);const r=new eG(t);return this.jn.forEachTarget(e,i=>r.Kn(i.sequenceNumber)).next(()=>this.jn.Wn(e,i=>r.Kn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(it("LruGarbageCollector","Garbage collection skipped; disabled"),_e.resolve(PO)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(it("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),PO):this.Hn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Hn(e,t){let r,i,s,o,u,d,f;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(b=>(b>this.params.maximumSequenceNumbersToCollect?(it("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),i=this.params.maximumSequenceNumbersToCollect):i=b,o=Date.now(),this.nthSequenceNumber(e,i))).next(b=>(r=b,u=Date.now(),this.removeTargets(e,r,t))).next(b=>(s=b,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(b=>(f=Date.now(),vR()<=Xc.in.DEBUG&&it("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-g}ms\n\tDetermined least recently used ${i} in `+(u-o)+`ms\n\tRemoved ${s} targets in `+(d-u)+`ms\n\tRemoved ${b} documents in `+(f-d)+`ms\nTotal Duration: ${f-g}ms`),_e.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:b})))}}class nG{constructor(e,t){this.db=e,this.garbageCollector=function $O(n,e){return new tG(n,e)}(this,t)}zn(e){const t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Jn(e){let t=0;return this.Wn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Wn(e,t){return this.Yn(e,(r,i)=>t(i))}addReference(e,t,r){return BS(e,r)}removeReference(e,t,r){return BS(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return BS(e,t)}Xn(e,t){return function(r,i){let s=!1;return FO(r).Z(o=>NO(r,o,i).next(u=>(u&&(s=!0),_e.resolve(!u)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Yn(e,(o,u)=>{if(u<=t){const d=this.Xn(e,o).next(f=>{if(!f)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Zt.min()),xf(e).delete([0,Zs(o.path)])))});i.push(d)}}).next(()=>_e.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return BS(e,t)}Yn(e,t){const r=xf(e);let i,s=Oa.ct;return r.X({index:"documentTargetsIndex"},([o,u],{path:d,sequenceNumber:f})=>{0===o?(s!==Oa.ct&&t(new gt(au(i)),s),s=f,i=d):s=Oa.ct}).next(()=>{s!==Oa.ct&&t(new gt(au(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function BS(n,e){return xf(n).put(function(t,r){return{targetId:0,path:Zs(t.path),sequenceNumber:r}}(e,n.currentSequenceNumber))}class GO{constructor(){this.changes=new bd(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ur.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?_e.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class rG{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Nm(e).put(r)}removeEntry(e,t,r){return Nm(e).delete(function(i,s){const o=i.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],kS(s),o[o.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Zn(e,r)))}getEntry(e,t){let r=Ur.newInvalidDocument(t);return Nm(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(aE(t))},(i,s)=>{r=this.ts(t,s)}).next(()=>r)}es(e,t){let r={size:0,document:Ur.newInvalidDocument(t)};return Nm(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(aE(t))},(i,s)=>{r={document:this.ts(t,s),size:FS(s)}}).next(()=>r)}getEntries(e,t){let r=Xo();return this.ns(e,t,(i,s)=>{const o=this.ts(i,s);r=r.insert(i,o)}).next(()=>r)}ss(e,t){let r=Xo(),i=new xr(gt.comparator);return this.ns(e,t,(s,o)=>{const u=this.ts(s,o);r=r.insert(s,u),i=i.insert(s,FS(o))}).next(()=>({documents:r,rs:i}))}ns(e,t,r){if(t.isEmpty())return _e.resolve();let i=new Fr(WO);t.forEach(d=>i=i.add(d));const s=IDBKeyRange.bound(aE(i.first()),aE(i.last())),o=i.getIterator();let u=o.getNext();return Nm(e).X({index:"documentKeyIndex",range:s},(d,f,g)=>{const b=gt.fromSegments([...f.prefixPath,f.collectionGroup,f.documentId]);for(;u&&WO(u,b)<0;)r(u,null),u=o.getNext();u&&u.isEqual(b)&&(r(u,f),u=o.hasNext()?o.getNext():null),u?g.G(aE(u)):g.done()}).next(()=>{for(;u;)r(u,null),u=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),kS(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Nm(e).j(IDBKeyRange.bound(o,u,!0)).next(d=>{let f=Xo();for(const g of d){const b=this.ts(gt.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);b.isFoundDocument()&&(zb(t,b)||i.has(b.key))&&(f=f.insert(b.key,b))}return f})}getAllFromCollectionGroup(e,t,r,i){let s=Xo();const o=zO(t,r),u=zO(t,Pa.max());return Nm(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,u,!0)},(d,f,g)=>{const b=this.ts(gt.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);s=s.insert(b.key,b),s.size===i&&g.done()}).next(()=>s)}newChangeBuffer(e){return new iG(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return jO(e).get("remoteDocumentGlobalKey").next(t=>(Yt(!!t),t))}Zn(e,t){return jO(e).put("remoteDocumentGlobalKey",t)}ts(e,t){if(t){const r=function H$(n,e){let t;if(e.document)t=pO(n.fe,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=gt.fromSegments(e.noDocument.path),i=Mm(e.noDocument.readTime);t=Ur.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return kt();{const r=gt.fromSegments(e.unknownDocument.path),i=Mm(e.unknownDocument.version);t=Ur.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(r){const i=new Xr(r[0],r[1]);return Zt.fromTimestamp(i)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(Zt.min()))return r}return Ur.newInvalidDocument(e)}}function HO(n){return new rG(n)}class iG extends GO{constructor(e,t){super(),this.os=e,this.trackRemovals=t,this.us=new bd(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new Fr((s,o)=>Tn(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const u=this.us.get(s);if(t.push(this.os.removeEntry(e,s,u.readTime)),o.isValidDocument()){const d=EO(this.os.serializer,o);i=i.add(s.path.popLast());const f=FS(d);r+=f-u.size,t.push(this.os.addEntry(e,s,d))}else if(r-=u.size,this.trackRemovals){const d=EO(this.os.serializer,o.convertToNoDocument(Zt.min()));t.push(this.os.addEntry(e,s,d))}}),i.forEach(s=>{t.push(this.os.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.os.updateMetadata(e,r)),_e.waitFor(t)}getFromCache(e,t){return this.os.es(e,t).next(r=>(this.us.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.os.ss(e,t).next(({documents:r,rs:i})=>(i.forEach((s,o)=>{this.us.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function jO(n){return gs(n,"remoteDocumentGlobal")}function Nm(n){return gs(n,"remoteDocumentsV14")}function aE(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function zO(n,e){const t=e.documentKey.path.toArray();return[n,kS(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function WO(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=Tn(t[s],r[s]),i)return i;return i=Tn(t.length,r.length),i||(i=Tn(t[t.length-2],r[r.length-2]),i||Tn(t[t.length-1],r[r.length-1]))}class sG{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class KO{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&Yb(r.mutation,i,Qo.empty(),Xr.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,xn()).next(()=>r))}getLocalViewOfDocuments(e,t,r=xn()){const i=cu();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Wb();return s.forEach((u,d)=>{o=o.insert(u,d.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=cu();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,xn()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,u)=>{t.set(o,u)})})}computeViews(e,t,r,i){let s=Xo();const o=Kb(),u=Kb();return t.forEach((d,f)=>{const g=r.get(f.key);i.has(f.key)&&(void 0===g||g.mutation instanceof Ed)?s=s.insert(f.key,f):void 0!==g?(o.set(f.key,g.mutation.getFieldMask()),Yb(g.mutation,f,g.mutation.getFieldMask(),Xr.now())):o.set(f.key,Qo.empty())}),this.recalculateAndSaveOverlays(e,s).next(d=>(d.forEach((f,g)=>o.set(f,g)),t.forEach((f,g)=>{var b;return u.set(f,new sG(g,null!==(b=o.get(f))&&void 0!==b?b:null))}),u))}recalculateAndSaveOverlays(e,t){const r=Kb();let i=new xr((o,u)=>o-u),s=xn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const u of o)u.keys().forEach(d=>{const f=t.get(d);if(null===f)return;let g=r.get(d)||Qo.empty();g=u.applyToLocalView(f,g),r.set(d,g);const b=(i.get(u.batchId)||xn()).add(d);i=i.insert(u.batchId,b)})}).next(()=>{const o=[],u=i.getReverseIterator();for(;u.hasNext();){const d=u.getNext(),f=d.key,g=d.value,b=BP();g.forEach(T=>{if(!s.has(T)){const w=qP(t.get(T),r.get(T));null!==w&&b.set(T,w),s=s.add(T)}}),o.push(this.documentOverlayCache.saveOverlays(e,f,b))}return _e.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return function(i){return gt.isDocumentKey(i.path)&&null===i.collectionGroup&&0===i.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):kR(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):_e.resolve(cu());let u=-1,d=s;return o.next(f=>_e.forEach(f,(g,b)=>(u<b.largestBatchId&&(u=b.largestBatchId),s.get(g)?_e.resolve():this.remoteDocumentCache.getEntry(e,g).next(T=>{d=d.insert(g,T)}))).next(()=>this.populateOverlays(e,f,s)).next(()=>this.computeViews(e,d,f,xn())).next(g=>({batchId:u,changes:UP(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new gt(t)).next(r=>{let i=Wb();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const i=t.collectionGroup;let s=Wb();return this.indexManager.getCollectionParents(e,i).next(o=>_e.forEach(o,u=>{const d=(f=t,g=u.child(i),new vd(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt));var f,g;return this.getDocumentsMatchingCollectionQuery(e,d,r).next(f=>{f.forEach((g,b)=>{s=s.insert(g,b)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i))).next(s=>{i.forEach((u,d)=>{const f=d.getKey();null===s.get(f)&&(s=s.insert(f,Ur.newInvalidDocument(f)))});let o=Wb();return s.forEach((u,d)=>{const f=i.get(u);void 0!==f&&Yb(f.mutation,d,Qo.empty(),Xr.now()),zb(t,d)&&(o=o.insert(u,d))}),o})}}class oG{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return _e.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var r;return this.cs.set(t.id,{id:(r=t).id,version:r.version,createTime:Mi(r.createTime)}),_e.resolve()}getNamedQuery(e,t){return _e.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,function(r){return{name:r.name,query:KR(r.bundledQuery),readTime:Mi(r.readTime)}}(t)),_e.resolve()}}class aG{constructor(){this.overlays=new xr(gt.comparator),this.ls=new Map}getOverlay(e,t){return _e.resolve(this.overlays.get(t))}getOverlays(e,t){const r=cu();return _e.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.we(e,t,s)}),_e.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.ls.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.ls.delete(r)),_e.resolve()}getOverlaysForCollection(e,t,r){const i=cu(),s=t.length+1,o=new gt(t.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){const d=u.getNext().value,f=d.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return _e.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new xr((f,g)=>f-g);const o=this.overlays.getIterator();for(;o.hasNext();){const f=o.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let g=s.get(f.largestBatchId);null===g&&(g=cu(),s=s.insert(f.largestBatchId,g)),g.set(f.getKey(),f)}}const u=cu(),d=s.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((f,g)=>u.set(f,g)),!(u.size()>=i)););return _e.resolve(u)}we(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.ls.get(i.largestBatchId).delete(r.key);this.ls.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new BR(t,r));let s=this.ls.get(t);void 0===s&&(s=xn(),this.ls.set(t,s)),this.ls.set(t,s.add(r.key))}}class eM{constructor(){this.fs=new Fr(ys.ds),this.ws=new Fr(ys._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const r=new ys(e,t);this.fs=this.fs.add(r),this.ws=this.ws.add(r)}gs(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.ys(new ys(e,t))}ps(e,t){e.forEach(r=>this.removeReference(r,t))}Is(e){const t=new gt(new Qn([])),r=new ys(t,e),i=new ys(t,e+1),s=[];return this.ws.forEachInRange([r,i],o=>{this.ys(o),s.push(o.key)}),s}Ts(){this.fs.forEach(e=>this.ys(e))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new gt(new Qn([])),r=new ys(t,e),i=new ys(t,e+1);let s=xn();return this.ws.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new ys(e,0),r=this.fs.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class ys{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return gt.comparator(e.key,t.key)||Tn(e.As,t.As)}static _s(e,t){return Tn(e.As,t.As)||gt.comparator(e.key,t.key)}}class lG{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new Fr(ys.ds)}checkEmpty(e){return _e.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.vs;this.vs++;const o=new FR(s,t,r,i);this.mutationQueue.push(o);for(const u of i)this.Rs=this.Rs.add(new ys(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return _e.resolve(o)}lookupMutationBatch(e,t){return _e.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.bs(t+1),s=i<0?0:i;return _e.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return _e.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return _e.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new ys(t,0),i=new ys(t,Number.POSITIVE_INFINITY),s=[];return this.Rs.forEachInRange([r,i],o=>{const u=this.Ps(o.As);s.push(u)}),_e.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Fr(Tn);return t.forEach(i=>{const s=new ys(i,0),o=new ys(i,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([s,o],u=>{r=r.add(u.As)})}),_e.resolve(this.Vs(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;gt.isDocumentKey(s)||(s=s.child(""));const o=new ys(new gt(s),0);let u=new Fr(Tn);return this.Rs.forEachWhile(d=>{const f=d.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(u=u.add(d.As)),!0)},o),_e.resolve(this.Vs(u))}Vs(e){const t=[];return e.forEach(r=>{const i=this.Ps(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){Yt(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let r=this.Rs;return _e.forEach(t.mutations,i=>{const s=new ys(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Rs=r})}Cn(e){}containsKey(e,t){const r=new ys(t,0),i=this.Rs.firstAfterOrEqual(r);return _e.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return _e.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class cG{constructor(e){this.Ds=e,this.docs=new xr(gt.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Ds(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return _e.resolve(r?r.document.mutableCopy():Ur.newInvalidDocument(t))}getEntries(e,t){let r=Xo();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ur.newInvalidDocument(i))}),_e.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Xo();const o=t.path,u=new gt(o.child("")),d=this.docs.getIteratorFrom(u);for(;d.hasNext();){const{key:f,value:{document:g}}=d.getNext();if(!o.isPrefixOf(f.path))break;f.path.length>o.length+1||TR(JL(g),r)<=0||(i.has(g.key)||zb(t,g))&&(s=s.insert(g.key,g.mutableCopy()))}return _e.resolve(s)}getAllFromCollectionGroup(e,t,r,i){kt()}Cs(e,t){return _e.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new uG(this)}getSize(e){return _e.resolve(this.size)}}class uG extends GO{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.os.addEntry(e,i)):this.os.removeEntry(r)}),_e.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class dG{constructor(e){this.persistence=e,this.xs=new bd(t=>Dm(t),Hb),this.lastRemoteSnapshotVersion=Zt.min(),this.highestTargetId=0,this.Ns=0,this.ks=new eM,this.targetCount=0,this.Ms=Om.kn()}forEachTarget(e,t){return this.xs.forEach((r,i)=>t(i)),_e.resolve()}getLastRemoteSnapshotVersion(e){return _e.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return _e.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),_e.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Ns&&(this.Ns=t),_e.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new Om(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,_e.resolve()}updateTargetData(e,t){return this.Fn(t),_e.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,_e.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.xs.forEach((o,u)=>{u.sequenceNumber<=t&&null===r.get(u.targetId)&&(this.xs.delete(o),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),_e.waitFor(s).next(()=>i)}getTargetCount(e){return _e.resolve(this.targetCount)}getTargetData(e,t){const r=this.xs.get(t)||null;return _e.resolve(r)}addMatchingKeys(e,t,r){return this.ks.gs(t,r),_e.resolve()}removeMatchingKeys(e,t,r){this.ks.ps(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),_e.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),_e.resolve()}getMatchingKeysForTargetId(e,t){const r=this.ks.Es(t);return _e.resolve(r)}containsKey(e,t){return _e.resolve(this.ks.containsKey(t))}}class tM{constructor(e,t){this.$s={},this.overlays={},this.Os=new Oa(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new dG(this),this.indexManager=new Q$,this.remoteDocumentCache=function(r){return new cG(r)}(r=>this.referenceDelegate.Ls(r)),this.serializer=new bO(t),this.qs=new oG(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new aG,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.$s[e.toKey()];return r||(r=new lG(t,this.referenceDelegate),this.$s[e.toKey()]=r),r}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,r){it("MemoryPersistence","Starting transaction:",e);const i=new hG(this.Os.next());return this.referenceDelegate.Us(),r(i).next(s=>this.referenceDelegate.Ks(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gs(e,t){return _e.or(Object.values(this.$s).map(r=>()=>r.containsKey(e,t)))}}class hG extends tP{constructor(e){super(),this.currentSequenceNumber=e}}class VS{constructor(e){this.persistence=e,this.Qs=new eM,this.js=null}static zs(e){return new VS(e)}get Ws(){if(this.js)return this.js;throw kt()}addReference(e,t,r){return this.Qs.addReference(r,t),this.Ws.delete(r.toString()),_e.resolve()}removeReference(e,t,r){return this.Qs.removeReference(r,t),this.Ws.add(r.toString()),_e.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),_e.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach(i=>this.Ws.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Ws.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _e.forEach(this.Ws,r=>{const i=gt.fromPath(r);return this.Hs(e,i).next(s=>{s||t.removeEntry(i,Zt.min())})}).next(()=>(this.js=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hs(e,t).next(r=>{r?this.Ws.delete(t.toString()):this.Ws.add(t.toString())})}Ls(e){return 0}Hs(e,t){return _e.or([()=>_e.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class fG{constructor(e){this.serializer=e}O(e,t,r,i){const s=new mS("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",sP,{unique:!0}),u.createObjectStore("documentMutations")}(e),qO(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=_e.resolve();return r<3&&i>=3&&(0!==r&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),qO(e)),o=o.next(()=>function(u){const d=u.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Zt.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",f)}(s))),r<4&&i>=4&&(0!==r&&(o=o.next(()=>function(u,d){return d.store("mutations").j().next(f=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",sP,{unique:!0});const g=d.store("mutations"),b=f.map(T=>g.put(T));return _e.waitFor(b)})}(e,s))),o=o.next(()=>{!function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(o=o.next(()=>this.Ys(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.Xs(s)))),r<7&&i>=7&&(o=o.next(()=>this.Zs(s))),r<8&&i>=8&&(o=o.next(()=>this.ti(e,s))),r<9&&i>=9&&(o=o.next(()=>{!function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(o=o.next(()=>this.ei(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{!function(u){const d=u.createObjectStore("documentOverlays",{keyPath:QV});d.createIndex("collectionPathOverlayIndex",XV,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",JV,{unique:!1})}(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){const d=u.createObjectStore("remoteDocumentsV14",{keyPath:VV});d.createIndex("documentKeyIndex",$V),d.createIndex("collectionGroupIndex",GV)}(e)).next(()=>this.ni(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.si(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:KV}).createIndex("sequenceNumberIndex",qV,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:YV}).createIndex("documentKeyIndex",ZV,{unique:!1})}(e))),o}Xs(e){let t=0;return e.store("remoteDocuments").X((r,i)=>{t+=FS(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Ys(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.j().next(i=>_e.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.j("userMutationsIndex",o).next(u=>_e.forEach(u,d=>{Yt(d.userId===s.userId);const f=km(this.serializer,d);return OO(e,s.userId,f).next(()=>{})}))}))}Zs(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.X((o,u)=>{const d=new Qn(o),f=[0,Zs(d)];s.push(t.get(f).next(g=>g?_e.resolve():t.put({targetId:0,path:Zs(d),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>_e.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:WV});const r=t.store("collectionParents"),i=new JR,s=o=>{if(i.add(o)){const u=o.lastSegment(),d=o.popLast();return r.put({collectionId:u,parent:Zs(d)})}};return t.store("remoteDocuments").X({Y:!0},(o,u)=>{const d=new Qn(o);return s(d.popLast())}).next(()=>t.store("documentMutations").X({Y:!0},([o,u,d],f)=>{const g=au(u);return s(g.popLast())}))}ei(e){const t=e.store("targets");return t.X((r,i)=>{const s=nE(i),o=TO(this.serializer,s);return t.put(o)})}ni(e,t){const r=t.store("remoteDocuments"),i=[];return r.X((s,o)=>{const u=t.store("remoteDocumentsV14"),d=(f=o,f.document?new gt(Qn.fromString(f.document.name).popFirst(5)):f.noDocument?gt.fromSegments(f.noDocument.path):f.unknownDocument?gt.fromSegments(f.unknownDocument.path):kt()).path.toArray();var f;const g={prefixPath:d.slice(0,d.length-2),collectionGroup:d[d.length-2],documentId:d[d.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(u.put(g))}).next(()=>_e.waitFor(i))}si(e,t){const r=t.store("mutations"),i=HO(this.serializer),s=new tM(VS.zs,this.serializer.fe);return r.j().next(o=>{const u=new Map;return o.forEach(d=>{var f;let g=null!==(f=u.get(d.userId))&&void 0!==f?f:xn();km(this.serializer,d).keys().forEach(b=>g=g.add(b)),u.set(d.userId,g)}),_e.forEach(u,(d,f)=>{const g=new ms(f),b=LS.de(this.serializer,g),T=s.getIndexManager(g),w=US.de(g,this.serializer,T,s.referenceDelegate);return new KO(i,w,b,T).recalculateAndSaveOverlaysForDocumentKeys(new wR(t,Oa.ct),d).next()})})}}function qO(n){n.createObjectStore("targetDocuments",{keyPath:jV}).createIndex("documentTargetsIndex",zV,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",HV,{unique:!0}),n.createObjectStore("targetGlobal")}const nM="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class rM{constructor(e,t,r,i,s,o,u,d,f,g,b=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ii=s,this.window=o,this.document=u,this.ri=f,this.oi=g,this.ui=b,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=T=>Promise.resolve(),!rM.D())throw new Ge(Te.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new nG(this,i),this.di=t+"main",this.serializer=new bO(d),this.wi=new rc(this.di,this.ui,new fG(this.serializer)),this.Bs=new J$(this.referenceDelegate,this.serializer),this.remoteDocumentCache=HO(this.serializer),this.qs=new j$,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===g&&Ri("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Ge(Te.FAILED_PRECONDITION,nM);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Bs.getHighestSequenceNumber(e))}).then(e=>{this.Os=new Oa(e,this.ri)}).then(()=>{this.Fs=!0}).catch(e=>(this.wi&&this.wi.close(),Promise.reject(e)))}Ii(e){var r,t=this;return this.fi=function(i){return(r=r||(0,xe.Z)(function*(s){if(t.started)return e(s)})).apply(this,arguments)},e(this.isPrimary)}setDatabaseDeletedListener(e){var t;this.wi.B(function(r){return(t=t||(0,xe.Z)(function*(i){null===i.newVersion&&(yield e())})).apply(this,arguments)})}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget((0,xe.Z)(function*(){t.started&&(yield t.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>GS(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ti(e).next(t=>{t||(this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.fi(!1)))})}).next(()=>this.Ei(e)).next(t=>this.isPrimary&&!t?this.Ai(e).next(()=>!1):!!t&&this.vi(e).next(()=>!0))).catch(e=>{if(yf(e))return it("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return it("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ii.enqueueRetryable(()=>this.fi(e)),this.isPrimary=e})}Ti(e){return lE(e).get("owner").next(t=>_e.resolve(this.Ri(t)))}Pi(e){return GS(e).delete(this.clientId)}bi(){var e=this;return(0,xe.Z)(function*(){if(e.isPrimary&&!e.Vi(e.li,18e5)){e.li=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=gs(r,"clientMetadata");return i.j().next(s=>{const o=e.Si(s,18e5),u=s.filter(d=>-1===o.indexOf(d));return _e.forEach(u,d=>i.delete(d.clientId)).next(()=>u)})}).catch(()=>[]);if(e._i)for(const r of t)e._i.removeItem(e.Di(r.clientId))}})()}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.bi()).then(()=>this.pi()))}Ri(e){return!!e&&e.ownerId===this.clientId}Ei(e){return this.oi?_e.resolve(!0):lE(e).get("owner").next(t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.Ri(t)&&this.networkEnabled)return!0;if(!this.Ri(t)){if(!t.allowTabSynchronization)throw new Ge(Te.FAILED_PRECONDITION,nM);return!1}}return!(!this.networkEnabled||!this.inForeground)||GS(e).j().next(r=>void 0===this.Si(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&it("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,xe.Z)(function*(){e.Fs=!1,e.xi(),e.hi&&(e.hi.cancel(),e.hi=null),e.Ni(),e.ki(),yield e.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new wR(t,Oa.ct);return e.Ai(r).next(()=>e.Pi(r))}),e.wi.close(),e.Mi()})()}Si(e,t){return e.filter(r=>this.Vi(r.updateTimeMs,t)&&!this.Ci(r.clientId))}$i(){return this.runTransaction("getActiveClients","readonly",e=>GS(e).j().next(t=>this.Si(t,18e5).map(r=>r.clientId)))}get started(){return this.Fs}getMutationQueue(e,t){return US.de(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new X$(e,this.serializer.fe.databaseId)}getDocumentOverlayCache(e){return LS.de(this.serializer,e)}getBundleCache(){return this.qs}runTransaction(e,t,r){it("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(o=this.ui)?t$:14===o?cP:13===o?lP:12===o?e$:11===o?aP:void kt();var o;let u;return this.wi.runTransaction(e,i,s,d=>(u=new wR(d,this.Os?this.Os.next():Oa.ct),"readwrite-primary"===t?this.Ti(u).next(f=>!!f||this.Ei(u)).next(f=>{if(!f)throw Ri(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.fi(!1)),new Ge(Te.FAILED_PRECONDITION,eP);return r(u)}).next(f=>this.vi(u).next(()=>f)):this.Oi(u).next(()=>r(u)))).then(d=>(u.raiseOnCommittedEvent(),d))}Oi(e){return lE(e).get("owner").next(t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)&&!this.Ri(t)&&!(this.oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Ge(Te.FAILED_PRECONDITION,nM)})}vi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return lE(e).put("owner",t)}static D(){return rc.D()}Ai(e){const t=lE(e);return t.get("owner").next(r=>this.Ri(r)?(it("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):_e.resolve())}Vi(e,t){const r=Date.now();return!(e<r-t||e>r&&(Ri(`Detected an update time that is in the future: ${e} > ${r}`),1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const t=/(?:Version|Mobile)\/1[456]/;(0,Rn.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(e){var t;try{const r=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Di(e)));return it("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ri("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(e){Ri("Failed to set zombie client id.",e)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch{}}Di(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function lE(n){return gs(n,"owner")}function GS(n){return gs(n,"clientMetadata")}function iM(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class sM{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Fi=r,this.Bi=i}static Li(e,t){let r=xn(),i=xn();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new sM(e,t.fromCache,r,i)}}class YO{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,r,i){return this.Ki(e,t).next(s=>s||this.Gi(e,t,i,r)).next(s=>s||this.Qi(e,t))}Ki(e,t){if(LP(t))return _e.resolve(null);let r=Eo(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=DS(t,null,"F"),r=Eo(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=xn(...s);return this.Ui.getDocuments(e,o).next(u=>this.indexManager.getMinOffset(e,r).next(d=>{const f=this.ji(t,u);return this.zi(t,f,o,d.readTime)?this.Ki(e,DS(t,null,"F")):this.Wi(e,f,t,d)}))})))}Gi(e,t,r,i){return LP(t)||i.isEqual(Zt.min())?this.Qi(e,t):this.Ui.getDocuments(e,r).next(s=>{const o=this.ji(t,s);return this.zi(t,o,r,i)?this.Qi(e,t):(vR()<=Xc.in.DEBUG&&it("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),PR(t)),this.Wi(e,o,t,XL(i,-1)))})}ji(e,t){let r=new Fr(NP(e));return t.forEach((i,s)=>{zb(e,s)&&(r=r.add(s))}),r}zi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Qi(e,t){return vR()<=Xc.in.DEBUG&&it("QueryEngine","Using full collection scan to execute query:",PR(t)),this.Ui.getDocumentsMatchingQuery(e,t,Pa.min())}Wi(e,t,r,i){return this.Ui.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class pG{constructor(e,t,r,i){this.persistence=e,this.Hi=t,this.serializer=i,this.Ji=new xr(Tn),this.Yi=new bd(s=>Dm(s),Hb),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(r)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new KO(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}function ZO(n,e,t,r){return new pG(n,e,t,r)}function QO(n,e){return(mt=mt||(0,xe.Z)(function*(t,r){const i=vt(t);return yield i.persistence.runTransaction("Handle user change","readonly",s=>{let o;return i.mutationQueue.getAllMutationBatches(s).next(u=>(o=u,i.tr(r),i.mutationQueue.getAllMutationBatches(s))).next(u=>{const d=[],f=[];let g=xn();for(const b of o){d.push(b.batchId);for(const T of b.mutations)g=g.add(T.key)}for(const b of u){f.push(b.batchId);for(const T of b.mutations)g=g.add(T.key)}return i.localDocuments.getDocuments(s,g).next(b=>({er:b,removedBatchIds:d,addedBatchIds:f}))})})})).apply(this,arguments)}function XO(n){const e=vt(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Bs.getLastRemoteSnapshotVersion(t))}function JO(n,e,t){let r=xn(),i=xn();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Xo();return t.forEach((u,d)=>{const f=s.get(u);d.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(u)),d.isNoDocument()&&d.version.isEqual(Zt.min())?(e.removeEntry(u,d.readTime),o=o.insert(u,d)):!f.isValidDocument()||d.version.compareTo(f.version)>0||0===d.version.compareTo(f.version)&&f.hasPendingWrites?(e.addEntry(d),o=o.insert(u,d)):it("LocalStore","Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",d.version)}),{nr:o,sr:i}})}function yG(n,e){const t=vt(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function _0(n,e){const t=vt(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Bs.getTargetData(r,e).next(s=>s?(i=s,_e.resolve(i)):t.Bs.allocateTargetId(r).next(o=>(i=new Td(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Bs.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.Ji.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ji=t.Ji.insert(r.targetId,r),t.Yi.set(e,r.targetId)),r})}function v0(n,e,t){return(Pt=Pt||(0,xe.Z)(function*(r,i,s){const o=vt(r),u=o.Ji.get(i),d=s?"readwrite":"readwrite-primary";try{s||(yield o.persistence.runTransaction("Release target",d,f=>o.persistence.referenceDelegate.removeTarget(f,u)))}catch(f){if(!yf(f))throw f;it("LocalStore",`Failed to update sequence numbers for target ${i}: ${f}`)}o.Ji=o.Ji.remove(i),o.Yi.delete(u.target)})).apply(this,arguments)}function HS(n,e,t){const r=vt(n);let i=Zt.min(),s=xn();return r.persistence.runTransaction("Execute query","readonly",o=>function(u,d,f){const g=vt(u),b=g.Yi.get(f);return void 0!==b?_e.resolve(g.Ji.get(b)):g.Bs.getTargetData(d,f)}(r,o,Eo(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(o,u.targetId).next(d=>{s=d})}).next(()=>r.Hi.getDocumentsMatchingQuery(o,e,t?i:Zt.min(),t?s:xn())).next(u=>(nN(r,OP(e),u),{documents:u,ir:s})))}function eN(n,e){const t=vt(n),r=vt(t.Bs),i=t.Ji.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.le(s,e).next(o=>o?o.target:null))}function tN(n,e){const t=vt(n),r=t.Xi.get(e)||Zt.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Zi.getAllFromCollectionGroup(i,e,XL(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(nN(t,e,i),i))}function nN(n,e,t){let r=n.Xi.get(e)||Zt.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.Xi.set(e,r)}function vG(n,e){return(Ye=Ye||(0,xe.Z)(function*(t,r,i=xn()){const s=yield _0(t,Eo(KR(r.bundledQuery))),o=vt(t);return o.persistence.runTransaction("Save named query","readwrite",u=>{const d=Mi(r.readTime);if(s.snapshotVersion.compareTo(d)>=0)return o.qs.saveNamedQuery(u,r);const f=s.withResumeToken(Qi.EMPTY_BYTE_STRING,d);return o.Ji=o.Ji.insert(f.targetId,f),o.Bs.updateTargetData(u,f).next(()=>o.Bs.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>o.Bs.addMatchingKeys(u,i,s.targetId)).next(()=>o.qs.saveNamedQuery(u,r))})})).apply(this,arguments)}function rN(n,e){return`firestore_clients_${n}_${e}`}function iN(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function oM(n,e){return`firestore_targets_${n}_${e}`}class jS{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static ar(e,t,r){const i=JSON.parse(r);let s,o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code,o&&(s=new Ge(i.error.code,i.error.message))),o?new jS(e,t,i.state,s):(Ri("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class cE{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static ar(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new Ge(r.error.code,r.error.message))),s?new cE(e,r.state,i):(Ri("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class zS{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static ar(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=OR();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=rP(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new zS(e,s):(Ri("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class aM{constructor(e,t){this.clientId=e,this.onlineState=t}static ar(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new aM(t.clientId,t.onlineState):(Ri("SharedClientState",`Failed to parse online state: ${e}`),null)}}class lM{constructor(){this.activeTargetIds=OR()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class cM{constructor(e,t,r,i,s){this.window=e,this.ii=t,this.persistenceKey=r,this.wr=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this._r=this.mr.bind(this),this.gr=new xr(Tn),this.started=!1,this.yr=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.pr=rN(this.persistenceKey,this.wr),this.Ir=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.gr=this.gr.insert(this.wr,new lM),this.Tr=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Er=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ar=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vr=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Rr=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this._r)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,xe.Z)(function*(){const t=yield e.syncEngine.$i();for(const i of t){if(i===e.wr)continue;const s=e.getItem(rN(e.persistenceKey,i));if(s){const o=zS.ar(i,s);o&&(e.gr=e.gr.insert(o.clientId,o))}}e.Pr();const r=e.storage.getItem(e.vr);if(r){const i=e.br(r);i&&e.Vr(i)}for(const i of e.yr)e.mr(i);e.yr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ir,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Sr(this.gr)}isActiveQueryTarget(e){let t=!1;return this.gr.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Dr(e,"pending")}updateMutationState(e,t,r){this.Dr(e,t,r),this.Cr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(oM(this.persistenceKey,e));if(r){const i=cE.ar(e,r);i&&(t=i.state)}}return this.Nr.lr(e),this.Pr(),t}removeLocalQueryTarget(e){this.Nr.dr(e),this.Pr()}isLocalQueryTarget(e){return this.Nr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(oM(this.persistenceKey,e))}updateQueryState(e,t,r){this.kr(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Cr(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Mr(e)}notifyBundleLoaded(e){this.$r(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this._r),this.removeItem(this.pr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return it("SharedClientState","READ",e,t),t}setItem(e,t){it("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){it("SharedClientState","REMOVE",e),this.storage.removeItem(e)}mr(e){var t=this;const r=e;if(r.storageArea===this.storage){if(it("SharedClientState","EVENT",r.key,r.newValue),r.key===this.pr)return void Ri("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ii.enqueueRetryable((0,xe.Z)(function*(){if(t.started){if(null!==r.key)if(t.Tr.test(r.key)){if(null==r.newValue){const i=t.Or(r.key);return t.Fr(i,null)}{const i=t.Br(r.key,r.newValue);if(i)return t.Fr(i.clientId,i)}}else if(t.Er.test(r.key)){if(null!==r.newValue){const i=t.Lr(r.key,r.newValue);if(i)return t.qr(i)}}else if(t.Ar.test(r.key)){if(null!==r.newValue){const i=t.Ur(r.key,r.newValue);if(i)return t.Kr(i)}}else if(r.key===t.vr){if(null!==r.newValue){const i=t.br(r.newValue);if(i)return t.Vr(i)}}else if(r.key===t.Ir){const i=function(s){let o=Oa.ct;if(null!=s)try{const u=JSON.parse(s);Yt("number"==typeof u),o=u}catch(u){Ri("SharedClientState","Failed to read sequence number from WebStorage",u)}return o}(r.newValue);i!==Oa.ct&&t.sequenceNumberHandler(i)}else if(r.key===t.Rr){const i=t.Gr(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Qr(s)))}}else t.yr.push(r)}))}}get Nr(){return this.gr.get(this.wr)}Pr(){this.setItem(this.pr,this.Nr.hr())}Dr(e,t,r){const i=new jS(this.currentUser,e,t,r),s=iN(this.persistenceKey,this.currentUser,e);this.setItem(s,i.hr())}Cr(e){const t=iN(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Mr(e){this.storage.setItem(this.vr,JSON.stringify({clientId:this.wr,onlineState:e}))}kr(e,t,r){const i=oM(this.persistenceKey,e),s=new cE(e,t,r);this.setItem(i,s.hr())}$r(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Rr,t)}Or(e){const t=this.Tr.exec(e);return t?t[1]:null}Br(e,t){const r=this.Or(e);return zS.ar(r,t)}Lr(e,t){const r=this.Er.exec(e),i=Number(r[1]);return jS.ar(new ms(void 0!==r[2]?r[2]:null),i,t)}Ur(e,t){const r=this.Ar.exec(e),i=Number(r[1]);return cE.ar(i,t)}br(e){return aM.ar(e)}Gr(e){return JSON.parse(e)}qr(e){var t=this;return(0,xe.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.jr(e.batchId,e.state,e.error);it("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Kr(e){return this.syncEngine.zr(e.targetId,e.state,e.error)}Fr(e,t){const r=t?this.gr.insert(e,t):this.gr.remove(e),i=this.Sr(this.gr),s=this.Sr(r),o=[],u=[];return s.forEach(d=>{i.has(d)||o.push(d)}),i.forEach(d=>{s.has(d)||u.push(d)}),this.syncEngine.Wr(o,u).then(()=>{this.gr=r})}Vr(e){this.gr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Sr(e){let t=OR();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class sN{constructor(){this.Hr=new lM,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,r){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new lM,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class bG{Yr(e){}shutdown(){}}class oN{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){it("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){it("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let WS=null;function uM(){return null===WS?WS=268435456+Math.round(2147483648*Math.random()):WS++,"0x"+WS.toString(16)}const EG={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class TG{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const Xs="WebChannelConnection";class IG extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.mo=(e.ssl?"https":"http")+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,r,i,s){const o=uM(),u=this.To(e,t);it("RestConnection",`Sending RPC '${e}' ${o}:`,u,r);const d={};return this.Eo(d,i,s),this.Ao(e,u,d,r).then(f=>(it("RestConnection",`Received RPC '${e}' ${o}: `,f),f),f=>{throw hl("RestConnection",`RPC '${e}' ${o} failed with error: `,f,"url: ",u,"request:",r),f})}vo(e,t,r,i,s,o){return this.Io(e,t,r,i,s)}Eo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+n0,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}To(e,t){return`${this.mo}/v1/${t}:${EG[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,r,i){const s=uM();return new Promise((o,u)=>{const d=new ae;d.setWithCredentials(!0),d.listenOnce(S.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case E.NO_ERROR:const g=d.getResponseJson();it(Xs,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(g)),o(g);break;case E.TIMEOUT:it(Xs,`RPC '${e}' ${s} timed out`),u(new Ge(Te.DEADLINE_EXCEEDED,"Request time out"));break;case E.HTTP_ERROR:const b=d.getStatus();if(it(Xs,`RPC '${e}' ${s} failed with status:`,b,"response text:",d.getResponseText()),b>0){let T=d.getResponseJson();Array.isArray(T)&&(T=T[0]);const w=T?.error;if(w&&w.status&&w.message){const x=function(k){const N=k.toLowerCase().replace(/_/g,"-");return Object.values(Te).indexOf(N)>=0?N:Te.UNKNOWN}(w.status);u(new Ge(x,w.message))}else u(new Ge(Te.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new Ge(Te.UNAVAILABLE,"Connection failed."));break;default:kt()}}finally{it(Xs,`RPC '${e}' ${s} completed.`)}});const f=JSON.stringify(i);it(Xs,`RPC '${e}' ${s} sending request:`,i),d.send(t,"POST",f,r,15)})}Ro(e,t,r){const i=uM(),s=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=p(),u=y(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;void 0!==f&&(d.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(d.xmlHttpFactory=new B({})),this.Eo(d.initMessageHeaders,t,r),d.encodeInitMessageHeaders=!0;const g=s.join("");it(Xs,`Creating RPC '${e}' stream ${i}: ${g}`,d);const b=o.createWebChannel(g,d);let T=!1,w=!1;const x=new TG({ro:N=>{w?it(Xs,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(T||(it(Xs,`Opening RPC '${e}' stream ${i} transport.`),b.open(),T=!0),it(Xs,`RPC '${e}' stream ${i} sending:`,N),b.send(N))},oo:()=>b.close()}),k=(N,z,X)=>{N.listen(z,K=>{try{X(K)}catch(ie){setTimeout(()=>{throw ie},0)}})};return k(b,q.EventType.OPEN,()=>{w||it(Xs,`RPC '${e}' stream ${i} transport opened.`)}),k(b,q.EventType.CLOSE,()=>{w||(w=!0,it(Xs,`RPC '${e}' stream ${i} transport closed`),x.wo())}),k(b,q.EventType.ERROR,N=>{w||(w=!0,hl(Xs,`RPC '${e}' stream ${i} transport errored:`,N),x.wo(new Ge(Te.UNAVAILABLE,"The operation could not be completed")))}),k(b,q.EventType.MESSAGE,N=>{var z;if(!w){const X=N.data[0];Yt(!!X);const ie=X.error||(null===(z=X[0])||void 0===z?void 0:z.error);if(ie){it(Xs,`RPC '${e}' stream ${i} received error:`,ie);const le=ie.status;let Me=function(We){const ot=Bi[We];if(void 0!==ot)return eO(ot)}(le),Ie=ie.message;void 0===Me&&(Me=Te.INTERNAL,Ie="Unknown error status: "+le+" with message "+ie.message),w=!0,x.wo(new Ge(Me,Ie)),b.close()}else it(Xs,`RPC '${e}' stream ${i} received:`,X),x._o(X)}}),k(u,D.STAT_EVENT,N=>{N.stat===L.PROXY?it(Xs,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===L.NOPROXY&&it(Xs,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.fo()},0),x}}function aN(){return typeof window<"u"?window:null}function KS(){return typeof document<"u"?document:null}function uE(n){return new L$(n,!0)}class dM{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ii=e,this.timerId=t,this.Po=r,this.bo=i,this.Vo=s,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),r=Math.max(0,Date.now()-this.Co),i=Math.max(0,t-r);i>0&&it("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,i,()=>(this.Co=Date.now(),e())),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class lN{constructor(e,t,r,i,s,o,u,d){this.ii=e,this.$o=r,this.Oo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=d,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new dM(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}stop(){var e=this;return(0,xe.Z)(function*(){e.Uo()&&(yield e.close(0))})()}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,()=>this.zo()))}Wo(e){this.Ho(),this.stream.send(e)}zo(){var e=this;return(0,xe.Z)(function*(){if(e.Ko())return e.close(0)})()}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}close(e,t){var r=this;return(0,xe.Z)(function*(){r.Ho(),r.Jo(),r.qo.cancel(),r.Fo++,4!==e?r.qo.reset():t&&t.code===Te.RESOURCE_EXHAUSTED?(Ri(t.toString()),Ri("Using maximum backoff delay to prevent overloading the backend."),r.qo.xo()):t&&t.code===Te.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Yo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.ao(t)})()}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Fo===t&&this.Zo(r,i)},r=>{e(()=>{const i=new Ge(Te.UNKNOWN,"Fetching auth token failed: "+r.message);return this.tu(i)})})}Zo(e,t){const r=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo(()=>{r(()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,()=>(this.Ko()&&(this.state=3),Promise.resolve())),this.listener.uo()))}),this.stream.ao(i=>{r(()=>this.tu(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Go(){var e=this;this.state=5,this.qo.No((0,xe.Z)(function*(){e.state=0,e.start()}))}tu(e){return it("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget(()=>this.Fo===e?t():(it("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class wG extends lN{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function N$(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(d=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===d?1:"REMOVE"===d?2:"CURRENT"===d?3:"RESET"===d?4:kt(),i=e.targetChange.targetIds||[],s=function(d,f){return d.useProto3Json?(Yt(void 0===f||"string"==typeof f),Qi.fromBase64String(f||"")):(Yt(void 0===f||f instanceof Uint8Array),Qi.fromUint8Array(f||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&function(d){const f=void 0===d.code?Te.UNKNOWN:eO(d.code);return new Ge(f,d.message||"")}(o);t=new sO(r,i,s,u||null)}else if("documentChange"in e){const r=e.documentChange,i=uu(n,r.document.name),s=Mi(r.document.updateTime),o=r.document.createTime?Mi(r.document.createTime):Zt.min(),u=new Fs({mapValue:{fields:r.document.fields}}),d=Ur.newFoundDocument(i,s,o,u);t=new MS(r.targetIds||[],r.removedTargetIds||[],d.key,d)}else if("documentDelete"in e){const r=e.documentDelete,i=uu(n,r.document),s=r.readTime?Mi(r.readTime):Zt.min(),o=Ur.newNoDocument(i,s);t=new MS([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=uu(n,r.document);t=new MS([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return kt();{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new A$(i,s);t=new iO(r.targetId,o)}}var d;return t}(this.serializer,e),r=function(i){if(!("targetChange"in i))return Zt.min();const s=i.targetChange;return s.targetIds&&s.targetIds.length?Zt.min():s.readTime?Mi(s.readTime):Zt.min()}(e);return this.listener.nu(t,r)}su(e){const t={};t.database=eE(this.serializer),t.addTarget=function(i,s){let o;const u=s.target;if(o=IS(u)?{documents:mO(i,u)}:{query:WR(i,u)},o.targetId=s.targetId,s.resumeToken.approximateByteSize()>0){o.resumeToken=cO(i,s.resumeToken);const d=GR(i,s.expectedCount);null!==d&&(o.expectedCount=d)}else if(s.snapshotVersion.compareTo(Zt.min())>0){o.readTime=p0(i,s.snapshotVersion.toTimestamp());const d=GR(i,s.expectedCount);null!==d&&(o.expectedCount=d)}return o}(this.serializer,e);const r=function U$(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return kt()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Wo(t)}iu(e){const t={};t.database=eE(this.serializer),t.removeTarget=e,this.Wo(t)}}class SG extends lN{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(Yt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function F$(n,e){return n&&n.length>0?(Yt(void 0!==e),n.map(t=>function(r,i){let s=Mi(r.updateTime?r.updateTime:i);return s.isEqual(Zt.min())&&(s=Mi(i)),new I$(s,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=Mi(e.commitTime);return this.listener.cu(r,t)}return Yt(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=eE(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>tE(this.serializer,r))};this.Wo(t)}}class DG extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.lu=!1}fu(){if(this.lu)throw new Ge(Te.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Io(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===Te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Ge(Te.UNKNOWN,i.toString())})}vo(e,t,r,i){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.vo(e,t,r,s,o,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===Te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Ge(Te.UNKNOWN,s.toString())})}terminate(){this.lu=!0}}class xG{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve())))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(Ri(t),this.mu=!1):it("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class CG{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=s,this.Pu.Yr(u=>{r.enqueueAndForget((0,xe.Z)(function*(){var d;Cf(o)&&(it("RemoteStore","Restarting streams for network reachability change."),yield function(f){return(d=d||(0,xe.Z)(function*(g){const b=vt(g);b.vu.add(4),yield b0(b),b.bu.set("Unknown"),b.vu.delete(4),yield dE(b)})).apply(this,arguments)}(o))}))}),this.bu=new xG(r,i)}}function dE(n){return(Ir=Ir||(0,xe.Z)(function*(e){if(Cf(e))for(const t of e.Ru)yield t(!0)})).apply(this,arguments)}function b0(n){return(Qr=Qr||(0,xe.Z)(function*(e){for(const t of e.Ru)yield t(!1)})).apply(this,arguments)}function qS(n,e){const t=vt(n);t.Au.has(e.targetId)||(t.Au.set(e.targetId,e),pM(t)?fM(t):T0(t).Ko()&&hM(t,e))}function hE(n,e){const t=vt(n),r=T0(t);t.Au.delete(e),r.Ko()&&cN(t,e),0===t.Au.size&&(r.Ko()?r.jo():Cf(t)&&t.bu.set("Unknown"))}function hM(n,e){if(n.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Zt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}T0(n).su(e)}function cN(n,e){n.Vu.qt(e),T0(n).iu(e)}function fM(n){n.Vu=new C$({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),le:e=>n.Au.get(e)||null,ue:()=>n.datastore.serializer.databaseId}),T0(n).start(),n.bu.gu()}function pM(n){return Cf(n)&&!T0(n).Uo()&&n.Au.size>0}function Cf(n){return 0===vt(n).vu.size}function uN(n){n.Vu=void 0}function RG(n){return(_R=_R||(0,xe.Z)(function*(e){e.Au.forEach((t,r)=>{hM(e,t)})})).apply(this,arguments)}function MG(n,e){return(hL=hL||(0,xe.Z)(function*(t,r){uN(t),pM(t)?(t.bu.Iu(r),fM(t)):t.bu.set("Unknown")})).apply(this,arguments)}function kG(n,e,t){return(fL=fL||(0,xe.Z)(function*(r,i,s){if(r.bu.set("Online"),i instanceof sO&&2===i.state&&i.cause)try{var o;yield function(u,d){return(o=o||(0,xe.Z)(function*(f,g){const b=g.cause;for(const T of g.targetIds)f.Au.has(T)&&(yield f.remoteSyncer.rejectListen(T,b),f.Au.delete(T),f.Vu.removeTarget(T))})).apply(this,arguments)}(r,i)}catch(u){it("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),u),yield YS(r,u)}else if(i instanceof MS?r.Vu.Ht(i):i instanceof iO?r.Vu.ne(i):r.Vu.Xt(i),!s.isEqual(Zt.min()))try{const u=yield XO(r.localStore);s.compareTo(u)>=0&&(yield function(d,f){const g=d.Vu.ce(f);return g.targetChanges.forEach((b,T)=>{if(b.resumeToken.approximateByteSize()>0){const w=d.Au.get(T);w&&d.Au.set(T,w.withResumeToken(b.resumeToken,f))}}),g.targetMismatches.forEach((b,T)=>{const w=d.Au.get(b);if(!w)return;d.Au.set(b,w.withResumeToken(Qi.EMPTY_BYTE_STRING,w.snapshotVersion)),cN(d,b);const x=new Td(w.target,b,T,w.sequenceNumber);hM(d,x)}),d.remoteSyncer.applyRemoteEvent(g)}(r,s))}catch(u){it("RemoteStore","Failed to raise snapshot:",u),yield YS(r,u)}})).apply(this,arguments)}function YS(n,e,t){return(pL=pL||(0,xe.Z)(function*(r,i,s){if(!yf(i))throw i;r.vu.add(1),yield b0(r),r.bu.set("Offline"),s||(s=()=>XO(r.localStore)),r.asyncQueue.enqueueRetryable((0,xe.Z)(function*(){it("RemoteStore","Retrying IndexedDB access"),yield s(),r.vu.delete(1),yield dE(r)}))})).apply(this,arguments)}function dN(n,e){return e().catch(t=>YS(n,t,e))}function E0(n){return(mL=mL||(0,xe.Z)(function*(e){const t=vt(e),r=Rf(t);let i=t.Eu.length>0?t.Eu[t.Eu.length-1].batchId:-1;for(;LG(t);)try{const s=yield yG(t.localStore,i);if(null===s){0===t.Eu.length&&r.jo();break}i=s.batchId,PG(t,s)}catch(s){yield YS(t,s)}hN(t)&&fN(t)})).apply(this,arguments)}function LG(n){return Cf(n)&&n.Eu.length<10}function PG(n,e){n.Eu.push(e);const t=Rf(n);t.Ko()&&t.ou&&t.uu(e.mutations)}function hN(n){return Cf(n)&&!Rf(n).Uo()&&n.Eu.length>0}function fN(n){Rf(n).start()}function OG(n){return(gL=gL||(0,xe.Z)(function*(e){Rf(e).hu()})).apply(this,arguments)}function NG(n){return(yL=yL||(0,xe.Z)(function*(e){const t=Rf(e);for(const r of e.Eu)t.uu(r.mutations)})).apply(this,arguments)}function FG(n,e,t){return(_L=_L||(0,xe.Z)(function*(r,i,s){const o=r.Eu.shift(),u=UR.from(o,i,s);yield dN(r,()=>r.remoteSyncer.applySuccessfulWrite(u)),yield E0(r)})).apply(this,arguments)}function UG(n,e){return(vL=vL||(0,xe.Z)(function*(t,r){var i;r&&Rf(t).ou&&(yield function(s,o){return(i=i||(0,xe.Z)(function*(u,d){if(JP(f=d.code)&&f!==Te.ABORTED){const g=u.Eu.shift();Rf(u).Qo(),yield dN(u,()=>u.remoteSyncer.rejectFailedWrite(g.batchId,d)),yield E0(u)}var f})).apply(this,arguments)}(t,r)),hN(t)&&fN(t)})).apply(this,arguments)}function pN(n,e){return(bL=bL||(0,xe.Z)(function*(t,r){const i=vt(t);i.asyncQueue.verifyOperationInProgress(),it("RemoteStore","RemoteStore received new credentials");const s=Cf(i);i.vu.add(3),yield b0(i),s&&i.bu.set("Unknown"),yield i.remoteSyncer.handleCredentialChange(r),i.vu.delete(3),yield dE(i)})).apply(this,arguments)}function mM(n,e){return(EL=EL||(0,xe.Z)(function*(t,r){const i=vt(t);r?(i.vu.delete(2),yield dE(i)):r||(i.vu.add(2),yield b0(i),i.bu.set("Unknown"))})).apply(this,arguments)}function T0(n){var e;return n.Su||(n.Su=function(t,r,i){const s=vt(t);return s.fu(),new wG(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{uo:RG.bind(null,n),ao:MG.bind(null,n),nu:kG.bind(null,n)}),n.Ru.push(function(t){return(e=e||(0,xe.Z)(function*(r){r?(n.Su.Qo(),pM(n)?fM(n):n.bu.set("Unknown")):(yield n.Su.stop(),uN(n))})).apply(this,arguments)})),n.Su}function Rf(n){var e;return n.Du||(n.Du=function(t,r,i){const s=vt(t);return s.fu(),new SG(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{uo:OG.bind(null,n),ao:UG.bind(null,n),au:NG.bind(null,n),cu:FG.bind(null,n)}),n.Ru.push(function(t){return(e=e||(0,xe.Z)(function*(r){r?(n.Du.Qo(),yield E0(n)):(yield n.Du.stop(),n.Eu.length>0&&(it("RemoteStore",`Stopping write stream with ${n.Eu.length} pending writes`),n.Eu=[]))})).apply(this,arguments)})),n.Du}class gM{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Zi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,u=new gM(e,t,o,i,s);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ge(Te.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function I0(n,e){if(Ri("AsyncQueue",`${e}: ${n}`),yf(n))return new Ge(Te.UNAVAILABLE,`${e}: ${n}`);throw n}class w0{constructor(e){this.comparator=e?(t,r)=>e(t,r)||gt.comparator(t.key,r.key):(t,r)=>gt.comparator(t.key,r.key),this.keyedMap=Wb(),this.sortedSet=new xr(this.comparator)}static emptySet(e){return new w0(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof w0)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new w0;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class mN{constructor(){this.Cu=new xr(gt.comparator)}track(e){const t=e.doc.key,r=this.Cu.get(t);r?0!==e.type&&3===r.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==r.type?this.Cu=this.Cu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Cu=this.Cu.remove(t):1===e.type&&2===r.type?this.Cu=this.Cu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):kt():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal((t,r)=>{e.push(r)}),e}}class S0{constructor(e,t,r,i,s,o,u,d,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=d,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(u=>{o.push({type:0,doc:u})}),new S0(e,t,w0.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&jb(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class BG{constructor(){this.Nu=void 0,this.listeners=[]}}class VG{constructor(){this.queries=new bd(e=>PP(e),jb),this.onlineState="Unknown",this.ku=new Set}}function yM(n,e){return(TL=TL||(0,xe.Z)(function*(t,r){const i=vt(t),s=r.query;let o=!1,u=i.queries.get(s);if(u||(o=!0,u=new BG),o)try{u.Nu=yield i.onListen(s)}catch(d){const f=I0(d,`Initialization of query '${PR(r.query)}' failed`);return void r.onError(f)}i.queries.set(s,u),u.listeners.push(r),r.Mu(i.onlineState),u.Nu&&r.$u(u.Nu)&&vM(i)})).apply(this,arguments)}function _M(n,e){return(IL=IL||(0,xe.Z)(function*(t,r){const i=vt(t),s=r.query;let o=!1;const u=i.queries.get(s);if(u){const d=u.listeners.indexOf(r);d>=0&&(u.listeners.splice(d,1),o=0===u.listeners.length)}if(o)return i.queries.delete(s),i.onUnlisten(s)})).apply(this,arguments)}function $G(n,e){const t=vt(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const u of o.listeners)u.$u(i)&&(r=!0);o.Nu=i}}r&&vM(t)}function GG(n,e,t){const r=vt(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function vM(n){n.ku.forEach(e=>{e.next()})}class bM{constructor(e,t,r){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=r||{}}$u(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new S0(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){return!e.fromCache||(!this.options.Ku||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Uu(e){e=S0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class HG{constructor(e,t){this.Gu=e,this.byteLength=t}Qu(){return"metadata"in this.Gu}}class gN{constructor(e){this.serializer=e}rr(e){return uu(this.serializer,e)}ur(e){return e.metadata.exists?pO(this.serializer,e.document,!1):Ur.newNoDocument(this.rr(e.metadata.name),this.cr(e.metadata.readTime))}cr(e){return Mi(e)}}class jG{constructor(e,t,r){this.ju=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=yN(e)}zu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Gu.namedQuery)this.queries.push(e.Gu.namedQuery);else if(e.Gu.documentMetadata){this.documents.push({metadata:e.Gu.documentMetadata}),e.Gu.documentMetadata.exists||++t;const r=Qn.fromString(e.Gu.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Gu.document&&(this.documents[this.documents.length-1].document=e.Gu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Wu(e){const t=new Map,r=new gN(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.rr(i.metadata.name);for(const o of i.metadata.queries){const u=(t.get(o)||xn()).add(s);t.set(o,u)}}return t}complete(){var e=this;return(0,xe.Z)(function*(){const t=yield function _G(n,e,t,r){return(on=on||(0,xe.Z)(function*(i,s,o,u){const d=vt(i);let f=xn(),g=Xo();for(const w of o){const x=s.rr(w.metadata.name);w.document&&(f=f.add(x));const k=s.ur(w);k.setReadTime(s.cr(w.metadata.readTime)),g=g.insert(x,k)}const b=d.Zi.newChangeBuffer({trackRemovals:!0}),T=yield _0(d,(w=u,Eo(c0(Qn.fromString(`__bundle__/docs/${w}`)))));var w;return d.persistence.runTransaction("Apply bundle documents","readwrite",w=>JO(w,b,g).next(x=>(b.apply(w),x)).next(x=>d.Bs.removeMatchingKeysForTargetId(w,T.targetId).next(()=>d.Bs.addMatchingKeys(w,f,T.targetId)).next(()=>d.localDocuments.getLocalViewOfDocuments(w,x.nr,x.sr)).next(()=>x.nr)))})).apply(this,arguments)}(e.localStore,new gN(e.serializer),e.documents,e.ju.id),r=e.Wu(e.documents);for(const i of e.queries)yield vG(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Hu:e.collectionGroups,Ju:t}})()}}function yN(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class _N{constructor(e){this.key=e}}class vN{constructor(e){this.key=e}}class bN{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=xn(),this.mutatedKeys=xn(),this.tc=NP(e),this.ec=new w0(this.tc)}get nc(){return this.Yu}sc(e,t){const r=t?t.ic:new mN,i=t?t.ec:this.ec;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,u=!1;const d="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,f="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((g,b)=>{const T=i.get(g),w=zb(this.query,b)?b:null,x=!!T&&this.mutatedKeys.has(T.key),k=!!w&&(w.hasLocalMutations||this.mutatedKeys.has(w.key)&&w.hasCommittedMutations);let N=!1;T&&w?T.data.isEqual(w.data)?x!==k&&(r.track({type:3,doc:w}),N=!0):this.rc(T,w)||(r.track({type:2,doc:w}),N=!0,(d&&this.tc(w,d)>0||f&&this.tc(w,f)<0)&&(u=!0)):!T&&w?(r.track({type:0,doc:w}),N=!0):T&&!w&&(r.track({type:1,doc:T}),N=!0,(d||f)&&(u=!0)),N&&(w?(o=o.add(w),s=k?s.add(g):s.delete(g)):(o=o.delete(g),s=s.delete(g)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const g="F"===this.query.limitType?o.last():o.first();o=o.delete(g.key),s=s.delete(g.key),r.track({type:1,doc:g})}return{ec:o,ic:r,zi:u,mutatedKeys:s}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const s=e.ic.xu();s.sort((f,g)=>function(b,T){const w=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return kt()}};return w(b)-w(T)}(f.type,g.type)||this.tc(f.doc,g.doc)),this.oc(r);const o=t?this.uc():[],u=0===this.Zu.size&&this.current?1:0,d=u!==this.Xu;return this.Xu=u,0!==s.length||d?{snapshot:new S0(this.query,e.ec,i,s,e.mutatedKeys,0===u,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),cc:o}:{cc:o}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new mN,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach(t=>this.Yu=this.Yu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Yu=this.Yu.delete(t)),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=xn(),this.ec.forEach(r=>{this.ac(r.key)&&(this.Zu=this.Zu.add(r.key))});const t=[];return e.forEach(r=>{this.Zu.has(r)||t.push(new vN(r))}),this.Zu.forEach(r=>{e.has(r)||t.push(new _N(r))}),t}hc(e){this.Yu=e.ir,this.Zu=xn();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return S0.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class zG{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class WG{constructor(e){this.key=e,this.fc=!1}}class KG{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.dc={},this.wc=new bd(u=>PP(u),jb),this._c=new Map,this.mc=new Set,this.gc=new xr(gt.comparator),this.yc=new Map,this.Ic=new eM,this.Tc={},this.Ec=new Map,this.Ac=Om.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}function qG(n,e){return(wL=wL||(0,xe.Z)(function*(t,r){const i=DM(t);let s,o;const u=i.wc.get(r);if(u)s=u.targetId,i.sharedClientState.addLocalQueryTarget(s),o=u.view.lc();else{const d=yield _0(i.localStore,Eo(r)),f=i.sharedClientState.addLocalQueryTarget(d.targetId);s=d.targetId,o=yield EM(i,r,s,"current"===f,d.resumeToken),i.isPrimaryClient&&qS(i.remoteStore,d)}return o})).apply(this,arguments)}function EM(n,e,t,r,i){return(SL=SL||(0,xe.Z)(function*(s,o,u,d,f){s.Rc=(N,z,X)=>{var K;return function(ie,le,Me,Ie){return(K=K||(0,xe.Z)(function*(We,ot,Fe,Jt){let bt=ot.view.sc(Fe);bt.zi&&(bt=yield HS(We.localStore,ot.query,!1).then(({documents:gr})=>ot.view.sc(gr,bt)));const Bn=Jt&&Jt.targetChanges.get(ot.targetId),Li=ot.view.applyChanges(bt,We.isPrimaryClient,Bn);return wM(We,ot.targetId,Li.cc),Li.snapshot})).apply(this,arguments)}(s,N,z,X)};const g=yield HS(s.localStore,o,!0),b=new bN(o,g.ir),T=b.sc(g.documents),w=Xb.createSynthesizedTargetChangeForCurrentChange(u,d&&"Offline"!==s.onlineState,f),x=b.applyChanges(T,s.isPrimaryClient,w);wM(s,u,x.cc);const k=new zG(o,u,b);return s.wc.set(o,k),s._c.has(u)?s._c.get(u).push(o):s._c.set(u,[o]),x.snapshot})).apply(this,arguments)}function YG(n,e){return(DL=DL||(0,xe.Z)(function*(t,r){const i=vt(t),s=i.wc.get(r),o=i._c.get(s.targetId);if(o.length>1)return i._c.set(s.targetId,o.filter(u=>!jb(u,r))),void i.wc.delete(r);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(s.targetId),i.sharedClientState.isActiveQueryTarget(s.targetId)||(yield v0(i.localStore,s.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(s.targetId),hE(i.remoteStore,s.targetId),D0(i,s.targetId)}).catch(gf))):(D0(i,s.targetId),yield v0(i.localStore,s.targetId,!0))})).apply(this,arguments)}function EN(n,e){return(xL=xL||(0,xe.Z)(function*(t,r){const i=vt(t);try{const s=yield function gG(n,e){const t=vt(n),r=e.snapshotVersion;let i=t.Ji;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.Zi.newChangeBuffer({trackRemovals:!0});i=t.Ji;const u=[];e.targetChanges.forEach((g,b)=>{const T=i.get(b);if(!T)return;u.push(t.Bs.removeMatchingKeys(s,g.removedDocuments,b).next(()=>t.Bs.addMatchingKeys(s,g.addedDocuments,b)));let w=T.withSequenceNumber(s.currentSequenceNumber);var x,k,N;null!==e.targetMismatches.get(b)?w=w.withResumeToken(Qi.EMPTY_BYTE_STRING,Zt.min()).withLastLimboFreeSnapshotVersion(Zt.min()):g.resumeToken.approximateByteSize()>0&&(w=w.withResumeToken(g.resumeToken,r)),i=i.insert(b,w),k=w,N=g,(0===(x=T).resumeToken.approximateByteSize()||k.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8||N.addedDocuments.size+N.modifiedDocuments.size+N.removedDocuments.size>0)&&u.push(t.Bs.updateTargetData(s,w))});let d=Xo(),f=xn();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,g))}),u.push(JO(s,o,e.documentUpdates).next(g=>{d=g.nr,f=g.sr})),!r.isEqual(Zt.min())){const g=t.Bs.getLastRemoteSnapshotVersion(s).next(b=>t.Bs.setTargetsMetadata(s,s.currentSequenceNumber,r));u.push(g)}return _e.waitFor(u).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,d,f)).next(()=>d)}).then(s=>(t.Ji=i,s))}(i.localStore,r);r.targetChanges.forEach((o,u)=>{const d=i.yc.get(u);d&&(Yt(o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size<=1),o.addedDocuments.size>0?d.fc=!0:o.modifiedDocuments.size>0?Yt(d.fc):o.removedDocuments.size>0&&(Yt(d.fc),d.fc=!1))}),yield Id(i,s,r)}catch(s){yield gf(s)}})).apply(this,arguments)}function TN(n,e,t){const r=vt(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.wc.forEach((s,o)=>{const u=o.view.Mu(e);u.snapshot&&i.push(u.snapshot)}),function(s,o){const u=vt(s);u.onlineState=o;let d=!1;u.queries.forEach((f,g)=>{for(const b of g.listeners)b.Mu(o)&&(d=!0)}),d&&vM(u)}(r.eventManager,e),i.length&&r.dc.nu(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function QG(n,e,t){return(CL=CL||(0,xe.Z)(function*(r,i,s){const o=vt(r);o.sharedClientState.updateQueryState(i,"rejected",s);const u=o.yc.get(i),d=u&&u.key;if(d){let f=new xr(gt.comparator);f=f.insert(d,Ur.newNoDocument(d,Zt.min()));const g=xn().add(d),b=new Qb(Zt.min(),new Map,new xr(Tn),f,g);yield EN(o,b),o.gc=o.gc.remove(d),o.yc.delete(i),SM(o)}else yield v0(o.localStore,i,!1).then(()=>D0(o,i,s)).catch(gf)})).apply(this,arguments)}function XG(n,e){return(RL=RL||(0,xe.Z)(function*(t,r){const i=vt(t),s=r.batch.batchId;try{const o=yield function mG(n,e){const t=vt(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.Zi.newChangeBuffer({trackRemovals:!0});return function(o,u,d,f){const g=d.batch,b=g.keys();let T=_e.resolve();return b.forEach(w=>{T=T.next(()=>f.getEntry(u,w)).next(x=>{const k=d.docVersions.get(w);Yt(null!==k),x.version.compareTo(k)<0&&(g.applyToRemoteDocument(x,d),x.isValidDocument()&&(x.setReadTime(d.commitVersion),f.addEntry(x)))})}),T.next(()=>o.mutationQueue.removeMutationBatch(u,g))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let u=xn();for(let d=0;d<o.mutationResults.length;++d)o.mutationResults[d].transformResults.length>0&&(u=u.add(o.batch.mutations[d].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(i.localStore,r);IM(i,s,null),TM(i,s),i.sharedClientState.updateMutationState(s,"acknowledged"),yield Id(i,o)}catch(o){yield gf(o)}})).apply(this,arguments)}function JG(n,e,t){return(ML=ML||(0,xe.Z)(function*(r,i,s){const o=vt(r);try{const u=yield function(d,f){const g=vt(d);return g.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let T;return g.mutationQueue.lookupMutationBatch(b,f).next(w=>(Yt(null!==w),T=w.keys(),g.mutationQueue.removeMutationBatch(b,w))).next(()=>g.mutationQueue.performConsistencyCheck(b)).next(()=>g.documentOverlayCache.removeOverlaysForBatchId(b,T,f)).next(()=>g.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,T)).next(()=>g.localDocuments.getDocuments(b,T))})}(o.localStore,i);IM(o,i,s),TM(o,i),o.sharedClientState.updateMutationState(i,"rejected",s),yield Id(o,u)}catch(u){yield gf(u)}})).apply(this,arguments)}function TM(n,e){(n.Ec.get(e)||[]).forEach(t=>{t.resolve()}),n.Ec.delete(e)}function IM(n,e,t){const r=vt(n);let i=r.Tc[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Tc[r.currentUser.toKey()]=i}}function D0(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n._c.get(e))n.wc.delete(r),t&&n.dc.Pc(r,t);n._c.delete(e),n.isPrimaryClient&&n.Ic.Is(e).forEach(r=>{n.Ic.containsKey(r)||IN(n,r)})}function IN(n,e){n.mc.delete(e.path.canonicalString());const t=n.gc.get(e);null!==t&&(hE(n.remoteStore,t),n.gc=n.gc.remove(e),n.yc.delete(t),SM(n))}function wM(n,e,t){for(const r of t)r instanceof _N?(n.Ic.addReference(r.key,e),tH(n,r)):r instanceof vN?(it("SyncEngine","Document no longer in limbo: "+r.key),n.Ic.removeReference(r.key,e),n.Ic.containsKey(r.key)||IN(n,r.key)):kt()}function tH(n,e){const t=e.key,r=t.path.canonicalString();n.gc.get(t)||n.mc.has(r)||(it("SyncEngine","New document in limbo: "+t),n.mc.add(r),SM(n))}function SM(n){for(;n.mc.size>0&&n.gc.size<n.maxConcurrentLimboResolutions;){const e=n.mc.values().next().value;n.mc.delete(e);const t=new gt(Qn.fromString(e)),r=n.Ac.next();n.yc.set(r,new WG(t)),n.gc=n.gc.insert(t,r),qS(n.remoteStore,new Td(Eo(c0(t.path)),r,"TargetPurposeLimboResolution",Oa.ct))}}function Id(n,e,t){return(LL=LL||(0,xe.Z)(function*(r,i,s){var o;const u=vt(r),d=[],f=[],g=[];u.wc.isEmpty()||(u.wc.forEach((b,T)=>{g.push(u.Rc(T,i,s).then(w=>{if((w||s)&&u.isPrimaryClient&&u.sharedClientState.updateQueryState(T.targetId,w?.fromCache?"not-current":"current"),w){d.push(w);const x=sM.Li(T.targetId,w);f.push(x)}}))}),yield Promise.all(g),u.dc.nu(d),yield function(b,T){return(o=o||(0,xe.Z)(function*(w,x){const k=vt(w);try{yield k.persistence.runTransaction("notifyLocalViewChanges","readwrite",N=>_e.forEach(x,z=>_e.forEach(z.Fi,X=>k.persistence.referenceDelegate.addReference(N,z.targetId,X)).next(()=>_e.forEach(z.Bi,X=>k.persistence.referenceDelegate.removeReference(N,z.targetId,X)))))}catch(N){if(!yf(N))throw N;it("LocalStore","Failed to update sequence numbers: "+N)}for(const N of x){const z=N.targetId;if(!N.fromCache){const X=k.Ji.get(z),ie=X.withLastLimboFreeSnapshotVersion(X.snapshotVersion);k.Ji=k.Ji.insert(z,ie)}}})).apply(this,arguments)}(u.localStore,f))})).apply(this,arguments)}function nH(n,e){return(PL=PL||(0,xe.Z)(function*(t,r){const i=vt(t);if(!i.currentUser.isEqual(r)){it("SyncEngine","User change. New user:",r.toKey());const s=yield QO(i.localStore,r);i.currentUser=r,function(o,u){o.Ec.forEach(d=>{d.forEach(f=>{f.reject(new Ge(Te.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),o.Ec.clear()}(i),i.sharedClientState.handleUserChange(r,s.removedBatchIds,s.addedBatchIds),yield Id(i,s.er)}})).apply(this,arguments)}function rH(n,e){const t=vt(n),r=t.yc.get(e);if(r&&r.fc)return xn().add(r.key);{let i=xn();const s=t._c.get(e);if(!s)return i;for(const o of s){const u=t.wc.get(o);i=i.unionWith(u.view.nc)}return i}}function iH(n,e){return(OL=OL||(0,xe.Z)(function*(t,r){const i=vt(t),s=yield HS(i.localStore,r.query,!0),o=r.view.hc(s);return i.isPrimaryClient&&wM(i,r.targetId,o.cc),o})).apply(this,arguments)}function sH(n,e){return(NL=NL||(0,xe.Z)(function*(t,r){const i=vt(t);return tN(i.localStore,r).then(s=>Id(i,s))})).apply(this,arguments)}function oH(n,e,t,r){return(FL=FL||(0,xe.Z)(function*(i,s,o,u){const d=vt(i),f=yield function(g,b){const T=vt(g),w=vt(T.mutationQueue);return T.persistence.runTransaction("Lookup mutation documents","readonly",x=>w.Sn(x,b).next(k=>k?T.localDocuments.getDocuments(x,k):_e.resolve(null)))}(d.localStore,s);var b;null!==f?("pending"===o?yield E0(d.remoteStore):"acknowledged"===o||"rejected"===o?(IM(d,s,u||null),TM(d,s),b=s,vt(vt(d.localStore).mutationQueue).Cn(b)):kt(),yield Id(d,f)):it("SyncEngine","Cannot apply mutation batch with id: "+s)})).apply(this,arguments)}function wN(n,e,t){return(BL=BL||(0,xe.Z)(function*(r,i,s){const o=vt(r),u=[],d=[];for(const f of i){let g;const b=o._c.get(f);if(b&&0!==b.length){g=yield _0(o.localStore,Eo(b[0]));for(const T of b){const w=o.wc.get(T),x=yield iH(o,w);x.snapshot&&d.push(x.snapshot)}}else{const T=yield eN(o.localStore,f);g=yield _0(o.localStore,T),yield EM(o,SN(T),f,!1,g.resumeToken)}u.push(g)}return o.dc.nu(d),u})).apply(this,arguments)}function SN(n){return kP(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function lH(n){const e=vt(n);return vt(vt(e.localStore).persistence).$i()}function cH(n,e,t,r){return(VL=VL||(0,xe.Z)(function*(i,s,o,u){const d=vt(i);if(d.vc)return void it("SyncEngine","Ignoring unexpected query state notification.");const f=d._c.get(s);if(f&&f.length>0)switch(o){case"current":case"not-current":{const g=yield tN(d.localStore,OP(f[0])),b=Qb.createSynthesizedRemoteEventForCurrentChange(s,"current"===o,Qi.EMPTY_BYTE_STRING);yield Id(d,g,b);break}case"rejected":yield v0(d.localStore,s,!0),D0(d,s,u);break;default:kt()}})).apply(this,arguments)}function uH(n,e,t){return($L=$L||(0,xe.Z)(function*(r,i,s){const o=DM(r);if(o.vc){for(const u of i){if(o._c.has(u)){it("SyncEngine","Adding an already active target "+u);continue}const d=yield eN(o.localStore,u),f=yield _0(o.localStore,d);yield EM(o,SN(d),f.targetId,!1,f.resumeToken),qS(o.remoteStore,f)}for(const u of s)o._c.has(u)&&(yield v0(o.localStore,u,!1).then(()=>{hE(o.remoteStore,u),D0(o,u)}).catch(gf))}})).apply(this,arguments)}function DM(n){const e=vt(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=EN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=rH.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=QG.bind(null,e),e.dc.nu=$G.bind(null,e.eventManager),e.dc.Pc=GG.bind(null,e.eventManager),e}function AM(n){const e=vt(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=XG.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=JG.bind(null,e),e}class fE{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,xe.Z)(function*(){t.serializer=uE(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return ZO(this.persistence,new YO,e.initialUser,this.serializer)}createPersistence(e){return new tM(VS.zs,this.serializer)}createSharedClientState(e){return new sN}terminate(){var e=this;return(0,xe.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class xM extends fE{constructor(e,t,r){super(),this.Vc=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,xe.Z)(function*(){yield t().call(r,e),yield r.Vc.initialize(r,e),yield AM(r.Vc.syncEngine),yield E0(r.Vc.remoteStore),yield r.persistence.Ii(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return ZO(this.persistence,new YO,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new VO(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new FV(t,this.persistence);return new NV(e.asyncQueue,r)}createPersistence(e){const t=iM(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Qs.withCacheSize(this.cacheSizeBytes):Qs.DEFAULT;return new rM(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,aN(),KS(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new sN}}class DN extends xM{constructor(e,t){super(e,t,!1),this.Vc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,xe.Z)(function*(){var i;yield t().call(r,e);const s=r.Vc.syncEngine;r.sharedClientState instanceof cM&&(r.sharedClientState.syncEngine={jr:oH.bind(null,s),zr:cH.bind(null,s),Wr:uH.bind(null,s),$i:lH.bind(null,s),Qr:sH.bind(null,s)},yield r.sharedClientState.start()),yield r.persistence.Ii(function(o){return(i=i||(0,xe.Z)(function*(u){yield function aH(n,e){return(UL=UL||(0,xe.Z)(function*(t,r){const i=vt(t);if(DM(i),AM(i),!0===r&&!0!==i.vc){const s=i.sharedClientState.getAllActiveQueryTargets(),o=yield wN(i,s.toArray());i.vc=!0,yield mM(i.remoteStore,!0);for(const u of o)qS(i.remoteStore,u)}else if(!1===r&&!1!==i.vc){const s=[];let o=Promise.resolve();i._c.forEach((u,d)=>{i.sharedClientState.isLocalQueryTarget(d)?s.push(d):o=o.then(()=>(D0(i,d),v0(i.localStore,d,!0))),hE(i.remoteStore,d)}),yield o,yield wN(i,s),function(u){const d=vt(u);d.yc.forEach((f,g)=>{hE(d.remoteStore,g)}),d.Ic.Ts(),d.yc=new Map,d.gc=new xr(gt.comparator)}(i),i.vc=!1,yield mM(i.remoteStore,!1)}})).apply(this,arguments)}(r.Vc.syncEngine,u),r.gcScheduler&&(u&&!r.gcScheduler.started?r.gcScheduler.start():u||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(u&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():u||r.indexBackfillerScheduler.stop())})).apply(this,arguments)})})()}createSharedClientState(e){const t=aN();if(!cM.D(t))throw new Ge(Te.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=iM(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new cM(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class A0{initialize(e,t){var r=this;return(0,xe.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>TN(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=nH.bind(null,r.syncEngine),yield mM(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new VG}createDatastore(e){const t=uE(e.databaseInfo.databaseId),r=new IG(e.databaseInfo);return function(s,o,u,d){return new DG(s,o,u,d)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,i=e.asyncQueue,s=u=>TN(this.syncEngine,u,0),o=oN.D()?new oN:new bG,new CG(t,r,i,s,o);var t,r,i,s,o}createSyncEngine(e,t){return function(r,i,s,o,u,d,f){const g=new KG(r,i,s,o,u,d);return f&&(g.vc=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e;return function(t){return(e=e||(0,xe.Z)(function*(r){const i=vt(r);it("RemoteStore","RemoteStore shutting down."),i.vu.add(5),yield b0(i),i.Pu.shutdown(),i.bu.set("Unknown")})).apply(this,arguments)}(this.remoteStore)}}function AN(n,e=10240){let t=0;return{read:()=>(0,xe.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,xe.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class ZS{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):Ri("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class fH{constructor(e,t){this.Cc=e,this.serializer=t,this.metadata=new Zi,this.buffer=new Uint8Array,this.xc=new TextDecoder("utf-8"),this.Nc().then(r=>{r&&r.Qu()?this.metadata.resolve(r.Gu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.Gu)}`))},r=>this.metadata.reject(r))}close(){return this.Cc.cancel()}getMetadata(){var e=this;return(0,xe.Z)(function*(){return e.metadata.promise})()}bc(){var e=this;return(0,xe.Z)(function*(){return yield e.getMetadata(),e.Nc()})()}Nc(){var e=this;return(0,xe.Z)(function*(){const t=yield e.kc();if(null===t)return null;const r=e.xc.decode(t),i=Number(r);isNaN(i)&&e.Mc(`length string (${r}) is not valid number`);const s=yield e.$c(i);return new HG(JSON.parse(s),t.length+i)})()}Oc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}kc(){var e=this;return(0,xe.Z)(function*(){for(;e.Oc()<0&&!(yield e.Fc()););if(0===e.buffer.length)return null;const t=e.Oc();t<0&&e.Mc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}$c(e){var t=this;return(0,xe.Z)(function*(){for(;t.buffer.length<e;)(yield t.Fc())&&t.Mc("Reached the end of bundle when more is expected.");const r=t.xc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Mc(e){throw this.Cc.cancel(),new Error(`Invalid bundle format: ${e}`)}Fc(){var e=this;return(0,xe.Z)(function*(){const t=yield e.Cc.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class pH{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,xe.Z)(function*(){var r;if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new Ge(Te.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const i=yield function(s,o){return(r=r||(0,xe.Z)(function*(u,d){const f=vt(u),g=eE(f.serializer)+"/documents",b={documents:d.map(k=>Jb(f.serializer,k))},T=yield f.vo("BatchGetDocuments",g,b,d.length),w=new Map;T.forEach(k=>{const N=function O$(n,e){return"found"in e?function(t,r){Yt(!!r.found);const i=uu(t,r.found.name),s=Mi(r.found.updateTime),o=r.found.createTime?Mi(r.found.createTime):Zt.min(),u=new Fs({mapValue:{fields:r.found.fields}});return Ur.newFoundDocument(i,s,o,u)}(n,e):"missing"in e?function(t,r){Yt(!!r.missing),Yt(!!r.readTime);const i=uu(t,r.missing),s=Mi(r.readTime);return Ur.newNoDocument(i,s)}(n,e):kt()}(f.serializer,k);w.set(N.key.toString(),N)});const x=[];return d.forEach(k=>{const N=w.get(k.toString());Yt(!!N),x.push(N)}),x})).apply(this,arguments)}(t.datastore,e);return i.forEach(s=>t.recordVersion(s)),i})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new f0(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,xe.Z)(function*(){var t;if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const r=e.readVersions;e.mutations.forEach(i=>{r.delete(i.key.toString())}),r.forEach((i,s)=>{const o=gt.fromPath(s);e.mutations.push(new NR(o,e.precondition(o)))}),yield function(i,s){return(t=t||(0,xe.Z)(function*(o,u){const d=vt(o),f=eE(d.serializer)+"/documents",g={writes:u.map(b=>tE(d.serializer,b))};yield d.Io("Commit",f,g)})).apply(this,arguments)}(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw kt();t=Zt.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new Ge(Te.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Zt.min())?Jr.exists(!1):Jr.updateTime(t):Jr.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Zt.min()))throw new Ge(Te.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Jr.updateTime(t)}return Jr.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class mH{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Bc=r.maxAttempts,this.qo=new dM(this.asyncQueue,"transaction_retry")}run(){this.Bc-=1,this.Lc()}Lc(){var e=this;this.qo.No((0,xe.Z)(function*(){const t=new pH(e.datastore),r=e.qc(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.Uc(s)}))}).catch(i=>{e.Uc(i)})}))}qc(e){try{const t=this.updateFunction(e);return!Fb(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Uc(e){this.Bc>0&&this.Kc(e)?(this.Bc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Lc(),Promise.resolve()))):this.deferred.reject(e)}Kc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!JP(t)}return!1}}class gH{constructor(e,t,r,i){var o,s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ms.UNAUTHENTICATED,this.clientId=ZL.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(u){return(o=o||(0,xe.Z)(function*(d){it("FirestoreClient","Received user=",d.uid),yield s.authCredentialListener(d),s.user=d})).apply(this,arguments)}),this.appCheckCredentials.start(r,u=>(it("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}getConfiguration(){var e=this;return(0,xe.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ge(Te.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Zi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,xe.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=I0(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function QS(n,e){return(GL=GL||(0,xe.Z)(function*(t,r){var i;t.asyncQueue.verifyOperationInProgress(),it("FirestoreClient","Initializing OfflineComponentProvider");const s=yield t.getConfiguration();yield r.initialize(s);let o=s.initialUser;t.setCredentialChangeListener(function(u){return(i=i||(0,xe.Z)(function*(d){o.isEqual(d)||(yield QO(r.localStore,d),o=d)})).apply(this,arguments)}),r.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=r})).apply(this,arguments)}function CM(n,e){return(HL=HL||(0,xe.Z)(function*(t,r){t.asyncQueue.verifyOperationInProgress();const i=yield RM(t);it("FirestoreClient","Initializing OnlineComponentProvider");const s=yield t.getConfiguration();yield r.initialize(i,s),t.setCredentialChangeListener(o=>pN(r.remoteStore,o)),t.setAppCheckTokenChangeListener((o,u)=>pN(r.remoteStore,u)),t._onlineComponents=r})).apply(this,arguments)}function xN(n){return"FirebaseError"===n.name?n.code===Te.FAILED_PRECONDITION||n.code===Te.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function RM(n){return(jL=jL||(0,xe.Z)(function*(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){it("FirestoreClient","Using user provided OfflineComponentProvider");try{yield QS(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!xN(r))throw r;hl("Error using user provided cache. Falling back to memory cache: "+r),yield QS(e,new fE)}}else it("FirestoreClient","Using default OfflineComponentProvider"),yield QS(e,new fE);return e._offlineComponents})).apply(this,arguments)}function XS(n){return(zL=zL||(0,xe.Z)(function*(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(it("FirestoreClient","Using user provided OnlineComponentProvider"),yield CM(e,e._uninitializedComponentsProvider._online)):(it("FirestoreClient","Using default OnlineComponentProvider"),yield CM(e,new A0))),e._onlineComponents})).apply(this,arguments)}function CN(n){return RM(n).then(e=>e.persistence)}function JS(n){return RM(n).then(e=>e.localStore)}function RN(n){return XS(n).then(e=>e.remoteStore)}function MM(n){return XS(n).then(e=>e.syncEngine)}function x0(n){return(WL=WL||(0,xe.Z)(function*(e){const t=yield XS(e),r=t.eventManager;return r.onListen=qG.bind(null,t.syncEngine),r.onUnlisten=YG.bind(null,t.syncEngine),r})).apply(this,arguments)}function kN(n,e,t={}){const r=new Zi;return n.asyncQueue.enqueueAndForget((0,xe.Z)(function*(){return function(i,s,o,u,d){const f=new ZS({next:b=>{s.enqueueAndForget(()=>_M(i,g));const T=b.docs.has(o);!T&&b.fromCache?d.reject(new Ge(Te.UNAVAILABLE,"Failed to get document because the client is offline.")):T&&b.fromCache&&u&&"server"===u.source?d.reject(new Ge(Te.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(b)},error:b=>d.reject(b)}),g=new bM(c0(o.path),f,{includeMetadataChanges:!0,Ku:!0});return yM(i,g)}(yield x0(n),n.asyncQueue,e,t,r)})),r.promise}function LN(n,e,t={}){const r=new Zi;return n.asyncQueue.enqueueAndForget((0,xe.Z)(function*(){return function(i,s,o,u,d){const f=new ZS({next:b=>{s.enqueueAndForget(()=>_M(i,g)),b.fromCache&&"server"===u.source?d.reject(new Ge(Te.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(b)},error:b=>d.reject(b)}),g=new bM(o,f,{includeMetadataChanges:!0,Ku:!0});return yM(i,g)}(yield x0(n),n.asyncQueue,e,t,r)})),r.promise}function PN(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const ON=new Map;function kM(n,e,t){if(!t)throw new Ge(Te.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function NN(n,e,t,r){if(!0===e&&!0===r)throw new Ge(Te.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function FN(n){if(!gt.isDocumentKey(n))throw new Ge(Te.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function UN(n){if(gt.isDocumentKey(n))throw new Ge(Te.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function eD(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":kt()}function $n(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Ge(Te.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=eD(n);throw new Ge(Te.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function BN(n,e){if(e<=0)throw new Ge(Te.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class VN{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new Ge(Te.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Ge(Te.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}NN("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=PN(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(i){if(void 0!==i.timeoutSeconds){if(isNaN(i.timeoutSeconds))throw new Ge(Te.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Ge(Te.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Ge(Te.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class pE{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new VN({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Ge(Te.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Ge(Te.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new VN(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new wV;switch(t.type){case"firstParty":return new xV(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Ge(Te.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ON.get(e);t&&(it("ComponentProvider","Removing Datastore"),ON.delete(e),t.terminate())}(this),Promise.resolve()}}function $N(n,e,t,r={}){var i;const s=(n=$n(n,pE))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&hl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let u,d;if("string"==typeof r.mockUserToken)u=r.mockUserToken,d=ms.MOCK_USER;else{u=(0,Rn.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new Ge(Te.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new ms(f)}n._authCredentials=new SV(new qL(u,d))}}class Br{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new du(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Br(this.firestore,e,this._key)}}class Us{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Us(this.firestore,e,this._query)}}class du extends Us{constructor(e,t,r){super(e,t,c0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Br(this.firestore,null,new gt(e))}withConverter(e){return new du(this.firestore,e,this._path)}}function GN(n,e,...t){if(n=(0,Rn.m9)(n),kM("collection","path",e),n instanceof pE){const r=Qn.fromString(e,...t);return UN(r),new du(n,null,r)}{if(!(n instanceof Br||n instanceof du))throw new Ge(Te.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Qn.fromString(e,...t));return UN(r),new du(n.firestore,null,r)}}function tD(n,e,...t){if(n=(0,Rn.m9)(n),1===arguments.length&&(e=ZL.A()),kM("doc","path",e),n instanceof pE){const r=Qn.fromString(e,...t);return FN(r),new Br(n,null,new gt(r))}{if(!(n instanceof Br||n instanceof du))throw new Ge(Te.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Qn.fromString(e,...t));return FN(r),new Br(n.firestore,n instanceof du?n.converter:null,new gt(r))}}function HN(n,e){return n=(0,Rn.m9)(n),e=(0,Rn.m9)(e),(n instanceof Br||n instanceof du)&&(e instanceof Br||e instanceof du)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function LM(n,e){return n=(0,Rn.m9)(n),e=(0,Rn.m9)(e),n instanceof Us&&e instanceof Us&&n.firestore===e.firestore&&jb(n._query,e._query)&&n.converter===e.converter}class DH{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new dM(this,"async_queue_retry"),this.Xc=()=>{const t=KS();t&&it("AsyncQueue","Visibility state changed to "+t.visibilityState),this.qo.Mo()};const e=KS();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=KS();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise(()=>{});const t=new Zi;return this.ta(()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qc.push(e),this.ea()))}ea(){var e=this;return(0,xe.Z)(function*(){if(0!==e.Qc.length){try{yield e.Qc[0](),e.Qc.shift(),e.qo.reset()}catch(t){if(!yf(t))throw t;it("AsyncQueue","Operation failed with retryable error: "+t)}e.Qc.length>0&&e.qo.No(()=>e.ea())}})()}ta(e){const t=this.Gc.then(()=>(this.Hc=!0,e().catch(r=>{this.Wc=r,this.Hc=!1;const i=function(s){let o=s.message||"";return s.stack&&(o=s.stack.includes(s.message)?s.stack:s.message+"\n"+s.stack),o}(r);throw Ri("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.Hc=!1,r))));return this.Gc=t,t}enqueueAfterDelay(e,t,r){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const i=gM.createAndSchedule(this,e,t,r,s=>this.na(s));return this.zc.push(i),i}Zc(){this.Wc&&kt()}verifyOperationInProgress(){}sa(){var e=this;return(0,xe.Z)(function*(){let t;do{t=e.Gc,yield t}while(t!==e.Gc)})()}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then(()=>{this.zc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()})}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}function PM(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const i of["next","error","complete"])if(i in r&&"function"==typeof r[i])return!0;return!1}(n)}class AH{constructor(){this._progressObserver={},this._taskCompletionResolver=new Zi,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Vr extends pE{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new DH,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||jN(this),this._firestoreClient.terminate()}}function CH(n,e){const t="object"==typeof n?n:(0,fi.getApp)(),r="string"==typeof n?n:e||"(default)",i=(0,fi._getProvider)(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=(0,Rn.P0)("firestore");s&&$N(i,...s)}return i}function ki(n){return n._firestoreClient||jN(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function jN(n){var e,t,r;const i=n._freezeSettings(),s=function(o,u,d,f){return new i$(o,u,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,PN(f.experimentalLongPollingOptions),f.useFetchStreams)}(n._databaseId,(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new gH(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.cache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.cache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}function zN(n,e,t){const r=new Zi;return n.asyncQueue.enqueue((0,xe.Z)(function*(){try{yield QS(n,t),yield CM(n,e),r.resolve()}catch(i){const s=i;if(!xN(s))throw s;hl("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function WN(n){if(n._initialized||n._terminated)throw new Ge(Te.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class hu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new hu(Qi.fromBase64String(e))}catch(t){throw new Ge(Te.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new hu(Qi.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class wd{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Ge(Te.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new bi(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Fm{constructor(e){this._methodName=e}}class nD{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ge(Te.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ge(Te.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Tn(this._lat,e._lat)||Tn(this._long,e._long)}}const BH=/^__.*__$/;class VH{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new Ed(e,this.data,this.fieldMask,t,this.fieldTransforms):new h0(e,this.data,t,this.fieldTransforms)}}class KN{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ed(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function qN(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw kt()}}class rD{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.ua(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new rD(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.aa({path:r,la:!1});return i.fa(e),i}da(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.aa({path:r,la:!1});return i.ua(),i}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return oD(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(qN(this.ca)&&BH.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class $H{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||uE(e)}ya(e,t,r,i=!1){return new rD({ca:e,methodName:t,ga:r,path:bi.emptyPath(),la:!1,ma:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Um(n){const e=n._freezeSettings(),t=uE(n._databaseId);return new $H(n._databaseId,!!e.ignoreUndefinedProperties,t)}function iD(n,e,t,r,i,s={}){const o=n.ya(s.merge||s.mergeFields?2:0,e,t,i);UM("Data must be an object, but it was:",o,r);const u=QN(r,o);let d,f;if(s.merge)d=new Qo(o.fieldMask),f=o.fieldTransforms;else if(s.mergeFields){const g=[];for(const b of s.mergeFields){const T=yE(e,b,t);if(!o.contains(T))throw new Ge(Te.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);JN(g,T)||g.push(T)}d=new Qo(g),f=o.fieldTransforms.filter(b=>d.covers(b.field))}else d=null,f=o.fieldTransforms;return new VH(new Fs(u),d,f)}class gE extends Fm{_toFieldTransform(e){if(2!==e.ca)throw e._a(1===e.ca?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof gE}}function YN(n,e,t){return new rD({ca:3,ga:e.settings.ga,methodName:n._methodName,la:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class OM extends Fm{_toFieldTransform(e){return new qb(e.path,new u0)}isEqual(e){return e instanceof OM}}class GH extends Fm{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=YN(this,e,!0),r=this.pa.map(s=>Bm(s,t)),i=new xm(r);return new qb(e.path,i)}isEqual(e){return this===e}}class HH extends Fm{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=YN(this,e,!0),r=this.pa.map(s=>Bm(s,t)),i=new Cm(r);return new qb(e.path,i)}isEqual(e){return this===e}}class jH extends Fm{constructor(e,t){super(e),this.Ia=t}_toFieldTransform(e){const t=new d0(e.serializer,GP(e.serializer,this.Ia));return new qb(e.path,t)}isEqual(e){return this===e}}function NM(n,e,t,r){const i=n.ya(1,e,t);UM("Data must be an object, but it was:",i,r);const s=[],o=Fs.empty();_f(r,(d,f)=>{const g=sD(e,d,t);f=(0,Rn.m9)(f);const b=i.da(g);if(f instanceof gE)s.push(g);else{const T=Bm(f,b);null!=T&&(s.push(g),o.set(g,T))}});const u=new Qo(s);return new KN(o,u,i.fieldTransforms)}function FM(n,e,t,r,i,s){const o=n.ya(1,e,t),u=[yE(e,r,t)],d=[i];if(s.length%2!=0)throw new Ge(Te.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let T=0;T<s.length;T+=2)u.push(yE(e,s[T])),d.push(s[T+1]);const f=[],g=Fs.empty();for(let T=u.length-1;T>=0;--T)if(!JN(f,u[T])){const w=u[T];let x=d[T];x=(0,Rn.m9)(x);const k=o.da(w);if(x instanceof gE)f.push(w);else{const N=Bm(x,k);null!=N&&(f.push(w),g.set(w,N))}}const b=new Qo(f);return new KN(g,b,o.fieldTransforms)}function ZN(n,e,t,r=!1){return Bm(t,n.ya(r?4:3,e))}function Bm(n,e){if(XN(n=(0,Rn.m9)(n)))return UM("Unsupported field value:",e,n),QN(n,e);if(n instanceof Fm)return function(t,r){if(!qN(r.ca))throw r._a(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r._a(`${t._methodName}() is not currently supported inside arrays`);const i=t._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.la&&4!==e.ca)throw e._a("Nested arrays are not supported");return function(t,r){const i=[];let s=0;for(const o of t){let u=Bm(o,r.wa(s));null==u&&(u={nullValue:"NULL_VALUE"}),i.push(u),s++}return{arrayValue:{values:i}}}(n,e)}return function(t,r){if(null===(t=(0,Rn.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return GP(r.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const i=Xr.fromDate(t);return{timestampValue:p0(r.serializer,i)}}if(t instanceof Xr){const i=new Xr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:p0(r.serializer,i)}}if(t instanceof nD)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof hu)return{bytesValue:cO(r.serializer,t._byteString)};if(t instanceof Br){const i=r.databaseId,s=t.firestore._databaseId;if(!s.isEqual(i))throw r._a(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:HR(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r._a(`Unsupported field value: ${eD(t)}`)}(n,e)}function QN(n,e){const t={};return dP(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):_f(n,(r,i)=>{const s=Bm(i,e.ha(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function XN(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Xr||n instanceof nD||n instanceof hu||n instanceof Br||n instanceof Fm)}function UM(n,e,t){if(!XN(t)||!function(r){return"object"==typeof r&&null!==r&&(Object.getPrototypeOf(r)===Object.prototype||null===Object.getPrototypeOf(r))}(t)){const r=eD(t);throw e._a("an object"===r?n+" a custom object":n+" "+r)}}function yE(n,e,t){if((e=(0,Rn.m9)(e))instanceof wd)return e._internalPath;if("string"==typeof e)return sD(n,e);throw oD("Field path arguments must be of type string or ",n,!1,void 0,t)}const zH=new RegExp("[~\\*/\\[\\]]");function sD(n,e,t){if(e.search(zH)>=0)throw oD(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new wd(...e.split("."))._internalPath}catch{throw oD(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function oD(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let d="";return(s||o)&&(d+=" (found",s&&(d+=` in field ${r}`),o&&(d+=` in document ${i}`),d+=")"),new Ge(Te.INVALID_ARGUMENT,u+n+d)}function JN(n,e){return n.some(t=>t.isEqual(e))}class _E{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Br(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new WH(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(aD("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class WH extends _E{data(){return super.data()}}function aD(n,e){return"string"==typeof e?sD(n,e):e instanceof wd?e._internalPath:e._delegate._internalPath}function eF(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new Ge(Te.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class BM{}class vE extends BM{}function Mf(n,e,...t){let r=[];e instanceof BM&&r.push(e),r=r.concat(t),function(i){const s=i.filter(u=>u instanceof C0).length,o=i.filter(u=>u instanceof bE).length;if(s>1||s>0&&o>0)throw new Ge(Te.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class bE extends vE{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new bE(e,t,r)}_apply(e){const t=this._parse(e);return iF(e._query,t),new Us(e.firestore,e.converter,LR(e._query,t))}_parse(e){const t=Um(e.firestore);return function(i,s,o,u,d,f,g){let b;if(d.isKeyField()){if("array-contains"===f||"array-contains-any"===f)throw new Ge(Te.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if("in"===f||"not-in"===f){rF(g,f);const T=[];for(const w of g)T.push(nF(u,i,w));b={arrayValue:{values:T}}}else b=nF(u,i,g)}else"in"!==f&&"not-in"!==f&&"array-contains-any"!==f||rF(g,f),b=ZN(o,"where",g,"in"===f||"not-in"===f);return Vn.create(d,f,b)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class C0 extends BM{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new C0(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:mr.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(r,i){let s=r;const o=i.getFlattenedFilters();for(const u of o)iF(s,u),s=LR(s,u)}(e._query,t),new Us(e.firestore,e.converter,LR(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class VM extends vE{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new VM(e,t)}_apply(e){const t=function(r,i,s){if(null!==r.startAt)throw new Ge(Te.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new Ge(Te.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new a0(i,s);return function(u,d){if(null===MR(u)){const f=SS(u);null!==f&&sF(0,f,d.field)}}(r,o),o}(e._query,this._field,this._direction);return new Us(e.firestore,e.converter,function(r,i){const s=r.explicitOrderBy.concat([i]);return new vd(r.path,r.collectionGroup,s,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class lD extends vE{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new lD(e,t,r)}_apply(e){return new Us(e.firestore,e.converter,DS(e._query,this._limit,this._limitType))}}class cD extends vE{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new cD(e,t,r)}_apply(e){const t=tF(e,this.type,this._docOrFields,this._inclusive);return new Us(e.firestore,e.converter,function(r,i){return new vd(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,i,r.endAt)}(e._query,t))}}class uD extends vE{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new uD(e,t,r)}_apply(e){const t=tF(e,this.type,this._docOrFields,this._inclusive);return new Us(e.firestore,e.converter,function(r,i){return new vd(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,i)}(e._query,t))}}function tF(n,e,t,r){if(t[0]=(0,Rn.m9)(t[0]),t[0]instanceof _E)return function(i,s,o,u,d){if(!u)throw new Ge(Te.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const f=[];for(const g of Am(i))if(g.field.isKeyField())f.push(Sm(s,u.key));else{const b=u.data.field(g.field);if(_S(b))throw new Ge(Te.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===b){const T=g.field.canonicalString();throw new Ge(Te.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${T}' (used as the orderBy) does not exist.`)}f.push(b)}return new wf(f,d)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=Um(n.firestore);return function(s,o,u,d,f,g){const b=s.explicitOrderBy;if(f.length>b.length)throw new Ge(Te.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const T=[];for(let w=0;w<f.length;w++){const x=f[w];if(b[w].field.isKeyField()){if("string"!=typeof x)throw new Ge(Te.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof x}`);if(!kR(s)&&-1!==x.indexOf("/"))throw new Ge(Te.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${x}' contains a slash.`);const k=s.path.child(Qn.fromString(x));if(!gt.isDocumentKey(k))throw new Ge(Te.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);const N=new gt(k);T.push(Sm(o,N))}else{const k=ZN(u,d,x);T.push(k)}}return new wf(T,g)}(n._query,n.firestore._databaseId,i,e,t,r)}}function nF(n,e,t){if("string"==typeof(t=(0,Rn.m9)(t))){if(""===t)throw new Ge(Te.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!kR(e)&&-1!==t.indexOf("/"))throw new Ge(Te.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Qn.fromString(t));if(!gt.isDocumentKey(r))throw new Ge(Te.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Sm(n,new gt(r))}if(t instanceof Br)return Sm(n,t._key);throw new Ge(Te.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${eD(t)}.`)}function rF(n,e){if(!Array.isArray(n)||0===n.length)throw new Ge(Te.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function iF(n,e){if(e.isInequality()){const r=SS(n),i=e.field;if(null!==r&&!r.isEqual(i))throw new Ge(Te.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);const s=MR(n);null!==s&&sF(0,i,s)}const t=function(r,i){for(const s of r)for(const o of s.getFlattenedFilters())if(i.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new Ge(Te.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function sF(n,e,t){if(!t.isEqual(e))throw new Ge(Te.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class $M{convertValue(e,t="none"){switch(Tf(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ei(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_d(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw kt()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return _f(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new nD(Ei(e.latitude),Ei(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=vS(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Bb(e));default:return null}}convertTimestamp(e){const t=vf(e);return new Xr(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Qn.fromString(e);Yt(vO(r));const i=new bf(r.get(1),r.get(3)),s=new gt(r.popFirst(5));return i.isEqual(t)||Ri(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function dD(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class t3 extends $M{constructor(e){super(),this.firestore=e}convertBytes(e){return new hu(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Br(this.firestore,null,t)}}class Vm{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Sd extends _E{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new EE(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(aD("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class EE extends Sd{data(e={}){return super.data(e)}}class kf{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Vm(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new EE(this._firestore,this._userDataWriter,r.key,r,new Vm(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ge(Te.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let s=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new EE(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Vm(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:s++}))}{let s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>i||3!==o.type).map(o=>{const u=new EE(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Vm(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let d=-1,f=-1;return 0!==o.type&&(d=s.indexOf(o.doc.key),s=s.delete(o.doc.key)),1!==o.type&&(s=s.add(o.doc),f=s.indexOf(o.doc.key)),{type:r3(o.type),doc:u,oldIndex:d,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function r3(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return kt()}}function aF(n,e){return n instanceof Sd&&e instanceof Sd?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof kf&&e instanceof kf&&n._firestore===e._firestore&&LM(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class Lf extends $M{constructor(e){super(),this.firestore=e}convertBytes(e){return new hu(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Br(this.firestore,null,t)}}function lF(n,e,t){n=$n(n,Br);const r=$n(n.firestore,Vr),i=dD(n.converter,e,t);return R0(r,[iD(Um(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,Jr.none())])}function cF(n,e,t,...r){n=$n(n,Br);const i=$n(n.firestore,Vr),s=Um(i);let o;return o="string"==typeof(e=(0,Rn.m9)(e))||e instanceof wd?FM(s,"updateDoc",n._key,e,t,r):NM(s,"updateDoc",n._key,e),R0(i,[o.toMutation(n._key,Jr.exists(!0))])}function GM(n,...e){var t,r,i;n=(0,Rn.m9)(n);let s={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||PM(e[o])||(s=e[o],o++);const u={includeMetadataChanges:s.includeMetadataChanges};if(PM(e[o])){const b=e[o];e[o]=null===(t=b.next)||void 0===t?void 0:t.bind(b),e[o+1]=null===(r=b.error)||void 0===r?void 0:r.bind(b),e[o+2]=null===(i=b.complete)||void 0===i?void 0:i.bind(b)}let d,f,g;if(n instanceof Br)f=$n(n.firestore,Vr),g=c0(n._key.path),d={next:b=>{e[o]&&e[o](HM(f,n,b))},error:e[o+1],complete:e[o+2]};else{const b=$n(n,Us);f=$n(b.firestore,Vr),g=b._query;const T=new Lf(f);d={next:w=>{e[o]&&e[o](new kf(f,T,b,w))},error:e[o+1],complete:e[o+2]},eF(n._query)}return function(b,T,w,x){const k=new ZS(x),N=new bM(T,k,w);return b.asyncQueue.enqueueAndForget((0,xe.Z)(function*(){return yM(yield x0(b),N)})),()=>{k.Dc(),b.asyncQueue.enqueueAndForget((0,xe.Z)(function*(){return _M(yield x0(b),N)}))}}(ki(f),g,u,d)}function R0(n,e){return function(t,r){const i=new Zi;return t.asyncQueue.enqueueAndForget((0,xe.Z)(function*(){return function ZG(n,e,t){return(AL=AL||(0,xe.Z)(function*(r,i,s){const o=AM(r);try{const u=yield function(d,f){const g=vt(d),b=Xr.now(),T=f.reduce((k,N)=>k.add(N.key),xn());let w,x;return g.persistence.runTransaction("Locally write mutations","readwrite",k=>{let N=Xo(),z=xn();return g.Zi.getEntries(k,T).next(X=>{N=X,N.forEach((K,ie)=>{ie.isValidDocument()||(z=z.add(K))})}).next(()=>g.localDocuments.getOverlayedDocuments(k,N)).next(X=>{w=X;const K=[];for(const ie of f){const le=S$(ie,w.get(ie.key).overlayedDocument);null!=le&&K.push(new Ed(ie.key,le,bP(le.value.mapValue),Jr.exists(!0)))}return g.mutationQueue.addMutationBatch(k,b,K,f)}).next(X=>{x=X;const K=X.applyToLocalDocumentSet(w,z);return g.documentOverlayCache.saveOverlays(k,X.batchId,K)})}).then(()=>({batchId:x.batchId,changes:UP(w)}))}(o.localStore,i);o.sharedClientState.addPendingMutation(u.batchId),function(d,f,g){let b=d.Tc[d.currentUser.toKey()];b||(b=new xr(Tn)),b=b.insert(f,g),d.Tc[d.currentUser.toKey()]=b}(o,u.batchId,s),yield Id(o,u.changes),yield E0(o.remoteStore)}catch(u){const d=I0(u,"Failed to persist write");s.reject(d)}})).apply(this,arguments)}(yield MM(t),r,i)})),i.promise}(ki(n),e)}function HM(n,e,t){const r=t.docs.get(e._key),i=new Lf(n);return new Sd(n,i,e._key,r,new Vm(t.hasPendingWrites,t.fromCache),e.converter)}const T3={maxAttempts:5};class uF{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Um(e)}set(e,t,r){this._verifyNotCommitted();const i=Pf(e,this._firestore),s=dD(i.converter,t,r),o=iD(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(o.toMutation(i._key,Jr.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=Pf(e,this._firestore);let o;return o="string"==typeof(t=(0,Rn.m9)(t))||t instanceof wd?FM(this._dataReader,"WriteBatch.update",s._key,t,r,i):NM(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Jr.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Pf(e,this._firestore);return this._mutations=this._mutations.concat(new f0(t._key,Jr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Ge(Te.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Pf(n,e){if((n=(0,Rn.m9)(n)).firestore!==e)throw new Ge(Te.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class I3 extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Um(e)}get(e){const t=Pf(e,this._firestore),r=new t3(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||1!==i.length)return kt();const s=i[0];if(s.isFoundDocument())return new _E(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new _E(this._firestore,r,t._key,null,t.converter);throw kt()})}set(e,t,r){const i=Pf(e,this._firestore),s=dD(i.converter,t,r),o=iD(this._dataReader,"Transaction.set",i._key,s,null!==i.converter,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){const s=Pf(e,this._firestore);let o;return o="string"==typeof(t=(0,Rn.m9)(t))||t instanceof wd?FM(this._dataReader,"Transaction.update",s._key,t,r,i):NM(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){const t=Pf(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Pf(e,this._firestore),r=new Lf(this._firestore);return super.get(e).then(i=>new Sd(this._firestore,r,t._key,i._document,new Vm(!1,!1),t.converter))}}!function(n,e=!0){n0=fi.SDK_VERSION,(0,fi._registerComponent)(new Zh.wA("firestore",(t,{instanceIdentifier:r,options:i})=>{const s=t.getProvider("app").getImmediate(),o=new Vr(new DV(t.getProvider("auth-internal")),new CV(t.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new Ge(Te.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new bf(u.options.projectId,d)}(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),(0,fi.registerVersion)(KL,"3.13.0",n),(0,fi.registerVersion)(KL,"3.13.0","esm2017")}();let R3=(()=>{var n;class e{constructor(){this.localChannels=[{name:"PNN",url:"http://203.176.130.123:8989/live/pnn_480k.stream/playlist.m3u8"},{name:"TVK1",url:"https://live.kh.malimarcdn.com/live/tvk.stream/playlist.m3u8"},{name:"TVK2",url:"https://live.kh.malimarcdn.com/live/tvk2.stream/playlist.m3u8"},{name:"TV5",url:"http://203.176.130.123:8989/live/tv5_480k.stream/playlist.m3u8"},{name:"Bayonv TV",url:"  http://203.176.130.123:8989/live/bayontv_480k.stream/playlist.m3u8"},{name:"BTV",url:"  http://203.176.130.123:8989/live/bayontv1_480k.stream/playlist.m3u8"},{name:"SEA TV",url:"http://203.176.130.123:8989/live/seatv_480k.stream/playlist.m3u8"},{name:"WIKI TV",url:"http://206.189.93.160:1935/live/myStream_720p/playlist.m3u8"},{name:"CTV9",url:"http://203.176.130.123:8989/live/ctv9hd.stream/playlist.m3u8"},{name:"Fresh News",url:"https://streaming.freshnewsasia.com/live/ngrp:myStream_all/chunklist_w1992010384_b1496608.m3u8"},{name:"Apsara TV",url:"http://203.176.130.123:8989/live/apsaratv_480k.stream/playlist.m3u8"},{name:"Hang Meas TV",url:"http://167.99.72.244:1935/hm_hdtv/_definst_/smil:HMHDTV.smil/chunklist_w422093947_b800000_sleng.m3u8"},{name:"Raksmey Hang Mease",url:"http://malisresidencess.com:1934/rhm_hdtv/smil:RHMHDTV.smil/chunklist_w616528546_b1800000_sleng.m3u8"},{name:"TeaTv",url:"https://livefta.malimarcdn.com/ftaedge00/teatv2.sdp/playlist.m3u8"},{name:"KHMERTV",url:"https://livefta.malimarcdn.com/ftaedge00/khmertv2020.stream/chunklist.m3u8"},{name:"MSJ TV",url:"http://124.248.165.18:1935/live/myStream.smil/chunklist_w1860765658_b2260000_sleng.m3u8"},{name:"Netlink TV",url:"https://netlink.netlinkbroadcaster.com/hls/test.m3u8"}],this.globalChannels=[{name:"LOKAL",url:"http://andriant.my.id"},{name:"CH2 STARMAX",url:"http://stream.rs.co.th/ch2-hi/index.m3u8"},{name:"CH3 HD",url:"http://27.254.130.64/feed/ch3hd/playlist.m3u8"},{name:"CH5",url:"http://27.254.130.64/feed/ch5hd/playlist.m3u8"},{name:"CH7 HD",url:"http://27.254.130.64/feed/ch7hd/playlist.m3u8"},{name:"CH8",url:"http://stream.rs.co.th/ch8-hi/index.m3u8"},{name:"MCOT-HD",url:"http://27.254.130.64/feed/chmcothd/playlist.m3u8"},{name:"CH11 NBT",url:"http://27.254.130.64/live01/ch14.m3u8?p=m3u8"},{name:"CH11 NBT",url:"http://122.155.92.8:1935/live/ch1_L.sdp/chunklist.m3u8"},{name:"Workpoint",url:"https://gcorigin.wisdomcloud.net/live/master/playlist.m3u8_500.m3u8"}]}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var hF=W(1389),M3=W(6451),hD=W(5363),k3=W(6063);class L3 extends ls.x{constructor(e=1/0,t=1/0,r=k3.l){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:r,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:o}=this;t||(r.push(e),!i&&r.push(s.now()+o)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:i}=this,s=i.slice();for(let o=0;o<s.length&&!e.closed;o+=r?1:2)e.next(s[o]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:i}=this,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){const o=t.now();let u=0;for(let d=1;d<r.length&&r[d]<=o;d+=2)u=d;u&&r.splice(0,u+1)}}}var P3=W(3099);function fF(n,e,t){let r,i=!1;return n&&"object"==typeof n?({bufferSize:r=1/0,windowTime:e=1/0,refCount:i=!1,scheduler:t}=n):r=n??1/0,(0,P3.B)({connector:()=>new L3(r,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}function pF(n,e){return(0,Hu.m)(e)?Dr(()=>n,e):Dr(()=>n)}var jM=W(9468),Mn=W(4976),ic=W(2011),sc=W(259);class Of{constructor(e){return e}}class TE{constructor(){return(0,sc.C6)()}}const zM=new m.OlP("angularfire2._apps"),N3={provide:Of,useFactory:function O3(n){return n&&1===n.length?n[0]:new Of((0,sc.Mq)())},deps:[[new m.FiY,zM]]},F3={provide:TE,deps:[[new m.FiY,zM]]};function U3(n){return(e,t)=>{const r=e.runOutsideAngular(()=>n(t));return new Of(r)}}let B3=(()=>{class n{constructor(t){(0,sc.KN)("angularfire",Mn.q4.full,"core"),(0,sc.KN)("angularfire",Mn.q4.full,"app"),(0,sc.KN)("angular",m.q4F.full,t.toString())}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(m.Lbi))},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({providers:[N3,F3]}),n})();function V3(n,...e){return{ngModule:B3,providers:[{provide:zM,useFactory:U3(n),multi:!0,deps:[m.R0b,m.zs3,Mn.HU,...e]}]}}const $3=(0,Mn.u3)(sc.Mq,!0),G3=(0,Mn.u3)(sc.ZF,!0);var mF,gF,bF,EF,TF;const WM=new Map,SF={activated:!1,tokenObservers:[]},H3={initialized:!1,enabled:!1};function Ti(n){return WM.get(n)||Object.assign({},SF)}function fD(){return H3}const KM="https://content-firebaseappcheck.googleapis.com/v1",K3="exchangeDebugToken",DF={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class Y3{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return(0,xe.Z)(function*(){t.stop();try{t.pending=new Rn.BH,yield function Z3(n){return new Promise(e=>{setTimeout(e,n)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new Rn.BH,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(r){t.retryPolicy(r)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}const Bs=new Rn.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function qM(n){if(!Ti(n).activated)throw Bs.create("use-before-activation",{appName:n.name})}function gD(n,e){return(mF=mF||(0,xe.Z)(function*({url:t,body:r},i){const s={"Content-Type":"application/json"},o=i.getImmediate({optional:!0});if(o){const w=yield o.getHeartbeatsHeader();w&&(s["X-Firebase-Client"]=w)}const u={method:"POST",body:JSON.stringify(r),headers:s};let d,f;try{d=yield fetch(t,u)}catch(w){throw Bs.create("fetch-network-error",{originalErrorMessage:w?.message})}if(200!==d.status)throw Bs.create("fetch-status-error",{httpStatus:d.status});try{f=yield d.json()}catch(w){throw Bs.create("fetch-parse-error",{originalErrorMessage:w?.message})}const g=f.ttl.match(/^([\d.]+)(s)$/);if(!g||!g[2]||isNaN(Number(g[1])))throw Bs.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${f.ttl}`});const b=1e3*Number(g[1]),T=Date.now();return{token:f.token,expireTimeMillis:T+b,issuedAtTimeMillis:T}})).apply(this,arguments)}function AF(n,e){const{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${KM}/projects/${t}/apps/${r}:${K3}?key=${i}`,body:{debug_token:e}}}const ej="firebase-app-check-database",tj=1,IE="firebase-app-check-store";let yD=null;function RF(n,e){return(gF=gF||(0,xe.Z)(function*(t,r){const s=(yield function CF(){return yD||(yD=new Promise((n,e)=>{try{const t=indexedDB.open(ej,tj);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Bs.create("storage-open",{originalErrorMessage:null===(i=r.target.error)||void 0===i?void 0:i.message}))},t.onupgradeneeded=r=>{0===r.oldVersion&&r.target.result.createObjectStore(IE,{keyPath:"compositeKey"})}}catch(t){e(Bs.create("storage-open",{originalErrorMessage:t?.message}))}}),yD)}()).transaction(IE,"readwrite"),u=s.objectStore(IE).put({compositeKey:t,value:r});return new Promise((d,f)=>{u.onsuccess=g=>{d()},s.onerror=g=>{var b;f(Bs.create("storage-set",{originalErrorMessage:null===(b=g.target.error)||void 0===b?void 0:b.message}))}})})).apply(this,arguments)}const wE=new Xc.Yd("@firebase/app-check");function ZM(n,e){return(0,Rn.hl)()?function rj(n,e){return RF(function kF(n){return`${n.options.appId}-${n.name}`}(n),e)}(n,e).catch(t=>{wE.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function QM(){return fD().enabled}function XM(){return(bF=bF||(0,xe.Z)(function*(){const n=fD();if(n.enabled&&n.token)return n.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const cj={error:"UNKNOWN_ERROR"};function uj(n){return Rn.US.encodeString(JSON.stringify(n),!1)}function _D(n){return(EF=EF||(0,xe.Z)(function*(e,t=!1){const r=e.app;qM(r);const i=Ti(r);let o,s=i.token;if(s&&!M0(s)&&(i.token=void 0,s=void 0),!s){const f=yield i.cachedTokenPromise;f&&(M0(f)?s=f:yield ZM(r,void 0))}if(!t&&s&&M0(s))return{token:s.token};let d,u=!1;if(QM()){i.exchangeTokenPromise||(i.exchangeTokenPromise=gD(AF(r,yield XM()),e.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),u=!0);const f=yield i.exchangeTokenPromise;return yield ZM(r,f),i.token=f,{token:f.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),u=!0),s=yield Ti(r).exchangeTokenPromise}catch(f){"appCheck/throttled"===f.code?wE.warn(f.message):wE.error(f),o=f}return s?o?d=M0(s)?{token:s.token,internalError:o}:NF(o):(d={token:s.token},i.token=s,yield ZM(r,s)):d=NF(o),u&&function OF(n,e){const t=Ti(n).tokenObservers;for(const r of t)try{"EXTERNAL"===r.type&&null!=e.error?r.error(e.error):r.next(e)}catch{}}(r,d),d})).apply(this,arguments)}function e1(n,e){const t=Ti(n),r=t.tokenObservers.filter(i=>i.next!==e);0===r.length&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function PF(n){const{app:e}=n,t=Ti(e);let r=t.tokenRefresher;r||(r=function dj(n){const{app:e}=n;return new Y3((0,xe.Z)(function*(){let r;if(r=Ti(e).token?yield _D(n,!0):yield _D(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{const t=Ti(e);if(t.token){let r=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5;return r=Math.min(r,t.token.expireTimeMillis-3e5),Math.max(0,r-Date.now())}return 0},DF.RETRIAL_MIN_WAIT,DF.RETRIAL_MAX_WAIT)}(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function M0(n){return n.expireTimeMillis-Date.now()>0}function NF(n){return{token:uj(cj),error:n}}class hj{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=Ti(this.app);for(const t of e)e1(this.app,t.next);return Promise.resolve()}}const jF="app-check-internal";!function Dj(){(0,fi._registerComponent)(new Zh.wA("app-check",n=>function fj(n,e){return new hj(n,e)}(n.getProvider("app").getImmediate(),n.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(jF).initialize()})),(0,fi._registerComponent)(new Zh.wA(jF,n=>function pj(n){return{getToken:e=>_D(n,e),getLimitedUseToken:()=>function LF(n){return(TF=TF||(0,xe.Z)(function*(e){const t=e.app;qM(t);const{provider:r}=Ti(t);if(QM()){const i=yield XM(),{token:s}=yield gD(AF(t,i),e.heartbeatServiceProvider);return{token:s}}{const{token:i}=yield r.getToken();return{token:i}}})).apply(this,arguments)}(n),addTokenListener:e=>function JM(n,e,t,r){const{app:i}=n,s=Ti(i);if(s.tokenObservers=[...s.tokenObservers,{next:t,error:r,type:e}],s.token&&M0(s.token)){const u=s.token;Promise.resolve().then(()=>{t({token:u.token}),PF(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>PF(n))}(n,"INTERNAL",e),removeTokenListener:e=>e1(n.app,e)}}(n.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,fi.registerVersion)("@firebase/app-check","0.8.0")}();class $m{constructor(){return(0,Mn.vb)("app-check")}}typeof window<"u"&&window,W(9260);const WF=new m.OlP("angularfire2.auth.use-emulator"),KF=new m.OlP("angularfire2.auth.settings"),qF=new m.OlP("angularfire2.auth.tenant-id"),YF=new m.OlP("angularfire2.auth.langugage-code"),ZF=new m.OlP("angularfire2.auth.use-device-language"),QF=new m.OlP("angularfire.auth.persistence"),XF=(n,e,t,r,i,s,o,u)=>(0,ic.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const d=e.runOutsideAngular(()=>n.auth());if(t&&d.useEmulator(...t),r&&(d.tenantId=r),d.languageCode=i,s&&d.useDeviceLanguage(),o)for(const[f,g]of Object.entries(o))d.settings[f]=g;return u&&d.setPersistence(u),d},[t,r,i,s,o,u]);let r1=(()=>{class n{constructor(t,r,i,s,o,u,d,f,g,b,T,w){const x=new ls.x,k=Bt(void 0).pipe((0,hD.Q)(o.outsideAngular),Dr(()=>s.runOutsideAngular(()=>Promise.resolve().then(W.bind(W,9568)))),(0,Ht.U)(()=>(0,ic.on)(t,s,r)),(0,Ht.U)(N=>XF(N,s,u,f,g,b,d,T)),fF({bufferSize:1,refCount:!1}));if(Wf(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Bt(null);else{k.pipe(As()).subscribe();const z=k.pipe(Dr(ie=>ie.getRedirectResult().then(le=>le,()=>null)),Mn.iC,fF({bufferSize:1,refCount:!1})),X=k.pipe(Dr(ie=>new us.y(le=>({unsubscribe:s.runOutsideAngular(()=>ie.onAuthStateChanged(Me=>le.next(Me),Me=>le.error(Me),()=>le.complete()))})))),K=k.pipe(Dr(ie=>new us.y(le=>({unsubscribe:s.runOutsideAngular(()=>ie.onIdTokenChanged(Me=>le.next(Me),Me=>le.error(Me),()=>le.complete()))}))));this.authState=z.pipe(pF(X),(0,jM.R)(o.outsideAngular),(0,hD.Q)(o.insideAngular)),this.user=z.pipe(pF(K),(0,jM.R)(o.outsideAngular),(0,hD.Q)(o.insideAngular)),this.idToken=this.user.pipe(Dr(ie=>ie?(0,Wn.D)(ie.getIdToken()):Bt(null))),this.idTokenResult=this.user.pipe(Dr(ie=>ie?(0,Wn.D)(ie.getIdTokenResult()):Bt(null))),this.credential=(0,M3.T)(z,x,this.authState.pipe(Wi(ie=>!ie))).pipe((0,Ht.U)(ie=>ie?.user?ie:null),(0,jM.R)(o.outsideAngular),(0,hD.Q)(o.insideAngular))}return(0,ic.pX)(this,k,s,{spy:{apply:(N,z,X)=>{(N.startsWith("signIn")||N.startsWith("createUser"))&&X.then(K=>x.next(K))}}})}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(ic.Dh),m.LFG(ic.xv,8),m.LFG(m.Lbi),m.LFG(m.R0b),m.LFG(Mn.HU),m.LFG(WF,8),m.LFG(KF,8),m.LFG(qF,8),m.LFG(YF,8),m.LFG(ZF,8),m.LFG(QF,8),m.LFG($m,8))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),kj=(()=>{var n;class e{constructor(r){this.afAuth=r}loginWithGoogle(){const r=new hF.V;this.afAuth.signInWithPopup(r)}logout(){return this.afAuth.signOut()}get loggedIn(){return!!this.afAuth.currentUser}}return(n=e).\u0275fac=function(r){return new(r||n)(m.LFG(r1))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var JF=W(4986);function s1(){return(0,Wr.e)((n,e)=>{let t,r=!1;n.subscribe((0,zr.x)(e,i=>{const s=t;t=i,r&&e.next([s,i]),r=!0}))})}function e2(n,e=Nl.y){return n=n??Lj,(0,Wr.e)((t,r)=>{let i,s=!0;t.subscribe((0,zr.x)(r,o=>{const u=e(o);(s||!n(i,u))&&(s=!1,i=u,r.next(o))}))})}function Lj(n,e){return n===e}W(9568);var Pj=W(3942);function o1(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Ge("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function t2(){if(typeof Uint8Array>"u")throw new Ge("unimplemented","Uint8Arrays are not available in this environment.")}function n2(){if(!function n$(){return typeof atob<"u"}())throw new Ge("unimplemented","Blobs are unavailable in Firestore in this environment.")}class SE{constructor(e){this._delegate=e}static fromBase64String(e){return n2(),new SE(hu.fromBase64String(e))}static fromUint8Array(e){return t2(),new SE(hu.fromUint8Array(e))}toBase64(){return n2(),this._delegate.toBase64()}toUint8Array(){return t2(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function a1(n){return function Fj(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class Uj{enableIndexedDbPersistence(e,t){return function RH(n,e){WN(n=$n(n,Vr));const t=ki(n);if(t._uninitializedComponentsProvider)throw new Ge(Te.FAILED_PRECONDITION,"SDK cache is already specified.");hl("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new A0;return zN(t,i,new xM(i,r.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function MH(n){WN(n=$n(n,Vr));const e=ki(n);if(e._uninitializedComponentsProvider)throw new Ge(Te.FAILED_PRECONDITION,"SDK cache is already specified.");hl("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new A0;return zN(e,r,new DN(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function kH(n){if(n._initialized&&!n._terminated)throw new Ge(Te.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Zi;return n._queue.enqueueAndForgetEvenWhileRestricted((0,xe.Z)(function*(){try{var t;yield function(r){return(t=t||(0,xe.Z)(function*(i){if(!rc.D())return Promise.resolve();const s=i+"main";yield rc.delete(s)})).apply(this,arguments)}(iM(n._databaseId,n._persistenceKey)),e.resolve()}catch(r){e.reject(r)}})),e.promise}(e._delegate)}}class r2{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof bf||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&hl("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){$N(this._delegate,e,t,r)}enableNetwork(){return function PH(n){return function yH(n){return n.asyncQueue.enqueue((0,xe.Z)(function*(){const e=yield CN(n),t=yield RN(n);return e.setNetworkEnabled(!0),function(r){const i=vt(r);return i.vu.delete(0),dE(i)}(t)}))}(ki(n=$n(n,Vr)))}(this._delegate)}disableNetwork(){return function OH(n){return function _H(n){return n.asyncQueue.enqueue((0,xe.Z)(function*(){var e;const t=yield CN(n),r=yield RN(n);return t.setNetworkEnabled(!1),function(i){return(e=e||(0,xe.Z)(function*(s){const o=vt(s);o.vu.add(0),yield b0(o),o.bu.set("Offline")})).apply(this,arguments)}(r)}))}(ki(n=$n(n,Vr)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,NN("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function LH(n){return function(e){const t=new Zi;return e.asyncQueue.enqueueAndForget((0,xe.Z)(function*(){return function eH(n,e){return(kL=kL||(0,xe.Z)(function*(t,r){const i=vt(t);Cf(i.remoteStore)||it("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const s=yield function(u){const d=vt(u);return d.persistence.runTransaction("Get highest unacknowledged batch id","readonly",f=>d.mutationQueue.getHighestUnacknowledgedBatchId(f))}(i.localStore);if(-1===s)return void r.resolve();const o=i.Ec.get(s)||[];o.push(r),i.Ec.set(s,o)}catch(s){const o=I0(s,"Initialization of waitForPendingWrites() operation failed");r.reject(o)}})).apply(this,arguments)}(yield MM(e),t)})),t.promise}(ki(n=$n(n,Vr)))}(this._delegate)}onSnapshotsInSync(e){return function f3(n,e){return function EH(n,e){const t=new ZS(e);return n.asyncQueue.enqueueAndForget((0,xe.Z)(function*(){return function(r,i){vt(r).ku.add(i),i.next()}(yield x0(n),t)})),()=>{t.Dc(),n.asyncQueue.enqueueAndForget((0,xe.Z)(function*(){return function(r,i){vt(r).ku.delete(i)}(yield x0(n),t)}))}}(ki(n=$n(n,Vr)),PM(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new Ge("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new k0(this,GN(this._delegate,e))}catch(t){throw To(t,"collection()","Firestore.collection()")}}doc(e){try{return new fl(this,tD(this._delegate,e))}catch(t){throw To(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Io(this,function SH(n,e){if(n=$n(n,pE),kM("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Ge(Te.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Us(n,null,(t=e,new vd(Qn.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw To(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function w3(n,e,t){n=$n(n,Vr);const r=Object.assign(Object.assign({},T3),t);return function(i){if(i.maxAttempts<1)throw new Ge(Te.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,s,o){const u=new Zi;return i.asyncQueue.enqueueAndForget((0,xe.Z)(function*(){const d=yield function MN(n){return XS(n).then(e=>e.datastore)}(i);new mH(i.asyncQueue,d,o,s,u).run()})),u.promise}(ki(n),i=>e(new I3(n,i)),r)}(this._delegate,t=>e(new s2(this,t)))}batch(){return ki(this._delegate),new o2(new uF(this._delegate,e=>R0(this._delegate,e)))}loadBundle(e){return function NH(n,e){const t=ki(n=$n(n,Vr)),r=new AH;return function TH(n,e,t,r){const i=function(s,o){let u;return u="string"==typeof s?tO().encode(s):s,d=function(d,f){if(d instanceof Uint8Array)return AN(d,f);if(d instanceof ArrayBuffer)return AN(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),new fH(d,o);var d}(t,uE(e));n.asyncQueue.enqueueAndForget((0,xe.Z)(function*(){!function dH(n,e,t){var r;const i=vt(n);(function(s,o,u){return(r=r||(0,xe.Z)(function*(d,f,g){try{const b=yield f.getMetadata();if(yield function(k,N){const z=vt(k),X=Mi(N.createTime);return z.persistence.runTransaction("hasNewerBundle","readonly",K=>z.qs.getBundleMetadata(K,N.id)).then(K=>!!K&&K.createTime.compareTo(X)>=0)}(d.localStore,b))return yield f.close(),g._completeWith({taskState:"Success",documentsLoaded:(k=b).totalDocuments,bytesLoaded:k.totalBytes,totalDocuments:k.totalDocuments,totalBytes:k.totalBytes}),Promise.resolve(new Set);g._updateProgress(yN(b));const T=new jG(b,d.localStore,f.serializer);let w=yield f.bc();for(;w;){const k=yield T.zu(w);k&&g._updateProgress(k),w=yield f.bc()}const x=yield T.complete();return yield Id(d,x.Ju,void 0),yield function(k,N){const z=vt(k);return z.persistence.runTransaction("Save bundle","readwrite",X=>z.qs.saveBundleMetadata(X,N))}(d.localStore,b),g._completeWith(x.progress),Promise.resolve(x.Hu)}catch(b){return hl("SyncEngine",`Loading bundle failed with ${b}`),g._failWith(b),Promise.resolve(new Set)}var k})).apply(this,arguments)})(i,e,t).then(s=>{i.sharedClientState.notifyBundleLoaded(s)})}(yield MM(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function FH(n,e){return function IH(n,e){return n.asyncQueue.enqueue((0,xe.Z)(function*(){return function(t,r){const i=vt(t);return i.persistence.runTransaction("Get named query","readonly",s=>i.qs.getNamedQuery(s,r))}(yield JS(n),e)}))}(ki(n=$n(n,Vr)),e).then(t=>t?new Us(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Io(this,t):null)}}class bD extends $M{constructor(e){super(),this.firestore=e}convertBytes(e){return new SE(new hu(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return fl.forKey(t,this.firestore,null)}}class s2{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new bD(e)}get(e){const t=Hm(e);return this._delegate.get(t).then(r=>new DE(this._firestore,new Sd(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=Hm(e);return r?(o1("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Hm(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Hm(e);return this._delegate.delete(t),this}}class o2{constructor(e){this._delegate=e}set(e,t,r){const i=Hm(e);return r?(o1("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Hm(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Hm(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Gm{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new EE(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new AE(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=Gm.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new Gm(e,new bD(e),t),i.set(t,s)),s}}Gm.INSTANCES=new WeakMap;class fl{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new bD(e)}static forPath(e,t,r){if(e.length%2!=0)throw new Ge("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new fl(t,new Br(t._delegate,r,new gt(e)))}static forKey(e,t,r){return new fl(t,new Br(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new k0(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new k0(this.firestore,GN(this._delegate,e))}catch(t){throw To(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,Rn.m9)(e))instanceof Br&&HN(this._delegate,e)}set(e,t){t=o1("DocumentReference.set",t);try{return t?lF(this._delegate,e,t):lF(this._delegate,e)}catch(r){throw To(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?cF(this._delegate,e):cF(this._delegate,e,t,...r)}catch(i){throw To(i,"updateDoc()","DocumentReference.update()")}}delete(){return function d3(n){return R0($n(n.firestore,Vr),[new f0(n._key,Jr.none())])}(this._delegate)}onSnapshot(...e){const t=a2(e),r=l2(e,i=>new DE(this.firestore,new Sd(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return GM(this._delegate,t,r)}get(e){let t;return t="cache"===e?.source?function o3(n){n=$n(n,Br);const e=$n(n.firestore,Vr),t=ki(e),r=new Lf(e);return function vH(n,e){const t=new Zi;return n.asyncQueue.enqueueAndForget((0,xe.Z)(function*(){var r;return function(i,s,o){return(r=r||(0,xe.Z)(function*(u,d,f){try{const g=yield function(b,T){const w=vt(b);return w.persistence.runTransaction("read document","readonly",x=>w.localDocuments.getDocument(x,T))}(u,d);g.isFoundDocument()?f.resolve(g):g.isNoDocument()?f.resolve(null):f.reject(new Ge(Te.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(g){const b=I0(g,`Failed to get document '${d} from cache`);f.reject(b)}})).apply(this,arguments)}(yield JS(n),e,t)})),t.promise}(t,n._key).then(i=>new Sd(e,r,n._key,i,new Vm(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===e?.source?function a3(n){n=$n(n,Br);const e=$n(n.firestore,Vr);return kN(ki(e),n._key,{source:"server"}).then(t=>HM(e,n,t))}(this._delegate):function s3(n){n=$n(n,Br);const e=$n(n.firestore,Vr);return kN(ki(e),n._key).then(t=>HM(e,n,t))}(this._delegate),t.then(r=>new DE(this.firestore,new Sd(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new fl(this.firestore,this._delegate.withConverter(e?Gm.getInstance(this.firestore,e):null))}}function To(n,e,t){return n.message=n.message.replace(e,t),n}function a2(n){for(const e of n)if("object"==typeof e&&!a1(e))return e;return{}}function l2(n,e){var t,r;let i;return i=a1(n[0])?n[0]:a1(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class DE{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new fl(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return aF(this._delegate,e._delegate)}}class AE extends DE{data(e){const t=this._delegate.data(e);return function IV(n,e){n||kt()}(void 0!==t),t}}class Io{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new bD(e)}where(e,t,r){try{return new Io(this.firestore,Mf(this._delegate,function KH(n,e,t){const r=e,i=aD("where",n);return bE._create(i,r,t)}(e,t,r)))}catch(i){throw To(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Io(this.firestore,Mf(this._delegate,function qH(n,e="asc"){const t=e,r=aD("orderBy",n);return VM._create(r,t)}(e,t)))}catch(r){throw To(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Io(this.firestore,Mf(this._delegate,function YH(n){return BN("limit",n),lD._create("limit",n,"F")}(e)))}catch(t){throw To(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Io(this.firestore,Mf(this._delegate,function ZH(n){return BN("limitToLast",n),lD._create("limitToLast",n,"L")}(e)))}catch(t){throw To(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Io(this.firestore,Mf(this._delegate,function QH(...n){return cD._create("startAt",n,!0)}(...e)))}catch(t){throw To(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Io(this.firestore,Mf(this._delegate,function XH(...n){return cD._create("startAfter",n,!1)}(...e)))}catch(t){throw To(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Io(this.firestore,Mf(this._delegate,function JH(...n){return uD._create("endBefore",n,!1)}(...e)))}catch(t){throw To(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Io(this.firestore,Mf(this._delegate,function e3(...n){return uD._create("endAt",n,!0)}(...e)))}catch(t){throw To(t,"endAt()","Query.endAt()")}}isEqual(e){return LM(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function c3(n){n=$n(n,Us);const e=$n(n.firestore,Vr),t=ki(e),r=new Lf(e);return function bH(n,e){const t=new Zi;return n.asyncQueue.enqueueAndForget((0,xe.Z)(function*(){var r;return function(i,s,o){return(r=r||(0,xe.Z)(function*(u,d,f){try{const g=yield HS(u,d,!0),b=new bN(d,g.ir),T=b.sc(g.documents),w=b.applyChanges(T,!1);f.resolve(w.snapshot)}catch(g){const b=I0(g,`Failed to execute query '${d} against cache`);f.reject(b)}})).apply(this,arguments)}(yield JS(n),e,t)})),t.promise}(t,n._query).then(i=>new kf(e,r,n,i))}(this._delegate):"server"===e?.source?function u3(n){n=$n(n,Us);const e=$n(n.firestore,Vr),t=ki(e),r=new Lf(e);return LN(t,n._query,{source:"server"}).then(i=>new kf(e,r,n,i))}(this._delegate):function l3(n){n=$n(n,Us);const e=$n(n.firestore,Vr),t=ki(e),r=new Lf(e);return eF(n._query),LN(t,n._query).then(i=>new kf(e,r,n,i))}(this._delegate),t.then(r=>new l1(this.firestore,new kf(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=a2(e),r=l2(e,i=>new l1(this.firestore,new kf(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return GM(this._delegate,t,r)}withConverter(e){return new Io(this.firestore,this._delegate.withConverter(e?Gm.getInstance(this.firestore,e):null))}}class Vj{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new AE(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class l1{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Io(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new AE(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Vj(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new AE(this._firestore,r))})}isEqual(e){return aF(this._delegate,e._delegate)}}class k0 extends Io{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new fl(this.firestore,e):null}doc(e){try{return new fl(this.firestore,void 0===e?tD(this._delegate):tD(this._delegate,e))}catch(t){throw To(t,"doc()","CollectionReference.doc()")}}add(e){return function h3(n,e){const t=$n(n.firestore,Vr),r=tD(n),i=dD(n.converter,e);return R0(t,[iD(Um(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,Jr.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new fl(this.firestore,t))}isEqual(e){return HN(this._delegate,e._delegate)}withConverter(e){return new k0(this.firestore,this._delegate.withConverter(e?Gm.getInstance(this.firestore,e):null))}}function Hm(n){return $n(n,Br)}class c1{constructor(...e){this._delegate=new wd(...e)}static documentId(){return new c1(bi.keyField().canonicalString())}isEqual(e){return(e=(0,Rn.m9)(e))instanceof wd&&this._delegate._internalPath.isEqual(e._internalPath)}}class jm{constructor(e){this._delegate=e}static serverTimestamp(){const e=function D3(){return new OM("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new jm(e)}static delete(){const e=function S3(){return new gE("deleteField")}();return e._methodName="FieldValue.delete",new jm(e)}static arrayUnion(...e){const t=function A3(...n){return new GH("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new jm(t)}static arrayRemove(...e){const t=function x3(...n){return new HH("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new jm(t)}static increment(e){const t=function C3(n){return new jH("increment",n)}(e);return t._methodName="FieldValue.increment",new jm(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const $j={Firestore:r2,GeoPoint:nD,Timestamp:Xr,Blob:SE,Transaction:s2,WriteBatch:o2,DocumentReference:fl,DocumentSnapshot:DE,Query:Io,QueryDocumentSnapshot:AE,QuerySnapshot:l1,CollectionReference:k0,FieldPath:c1,FieldValue:jm,setLogLevel:function Bj(n){!function TV(n){mf.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};function c2(n,e){return function jj(n,e=JF.z){return new us.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}(n,e)}function u1(n,e){return c2(n,e).pipe((0,Ht.U)(t=>({payload:t,type:"query"})))}function ED(n,e){return u1(n,e).pipe(Xa(void 0),s1(),(0,Ht.U)(([t,r])=>{const i=r.payload.docChanges(),s=i.map(o=>({type:o.type,payload:o}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((o,u)=>{const d=i.find(g=>g.doc.ref.isEqual(o.ref)),f=t?.payload.docs.find(g=>g.ref.isEqual(o.ref));d&&JSON.stringify(d.doc.metadata)===JSON.stringify(o.metadata)||!d&&f&&JSON.stringify(f.metadata)===JSON.stringify(o.metadata)||s.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:o}})}),s}))}function u2(n,e,t){return ED(n,t).pipe(Fc((r,i)=>function Wj(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function Kj(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return d1(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return d1(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return d1(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),e2(),(0,Ht.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function d1(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function d2(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}!function Hj(n){(function Gj(n,e){n.INTERNAL.registerComponent(new Zh.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},$j)))})(n,(e,t)=>new r2(e,t,new Uj)),n.registerVersion("@firebase/firestore-compat","0.3.12")}(Pj.Z);class h2{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=ED(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Ht.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Xa(void 0),s1(),Wi(([r,i])=>i.length>0||!r),(0,Ht.U)(([r,i])=>i),Mn.iC)}auditTrail(e){return this.stateChanges(e).pipe(Fc((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=d2(e);return u2(this.query,t,this.afs.schedulers.outsideAngular).pipe(Mn.iC)}valueChanges(e={}){return u1(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ht.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),Mn.iC)}get(e){return(0,Wn.D)(this.query.get(e)).pipe(Mn.iC)}add(e){return this.ref.add(e)}doc(e){return new f2(this.ref.doc(e),this.afs)}}class f2{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=p2(r,t);return new h2(i,s,this.afs)}snapshotChanges(){return function zj(n,e){return c2(n,e).pipe(Xa(void 0),s1(),(0,Ht.U)(([t,r])=>r.exists?t?.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Mn.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Ht.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,Wn.D)(this.ref.get(e)).pipe(Mn.iC)}}class qj{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?ED(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ht.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),Wi(t=>t.length>0),Mn.iC):ED(this.query,this.afs.schedulers.outsideAngular).pipe(Mn.iC)}auditTrail(e){return this.stateChanges(e).pipe(Fc((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=d2(e);return u2(this.query,t,this.afs.schedulers.outsideAngular).pipe(Mn.iC)}valueChanges(e={}){return u1(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ht.U)(r=>r.payload.docs.map(i=>e.idField?Object.assign({[e.idField]:i.id},i.data()):i.data())),Mn.iC)}get(e){return(0,Wn.D)(this.query.get(e)).pipe(Mn.iC)}}const Yj=new m.OlP("angularfire2.enableFirestorePersistence"),Zj=new m.OlP("angularfire2.firestore.persistenceSettings"),Qj=new m.OlP("angularfire2.firestore.settings"),Xj=new m.OlP("angularfire2.firestore.use-emulator");function p2(n,e=(t=>t)){return{query:e(n),ref:n}}let h1,Jj=(()=>{class n{constructor(t,r,i,s,o,u,d,f,g,b,T,w,x,k,N,z,X){this.schedulers=d;const K=(0,ic.on)(t,u,r),ie=g;b&&XF(K,u,T,x,k,N,w,z),[this.firestore,this.persistenceEnabled$]=(0,ic.cc)(`${K.name}.firestore`,"AngularFirestore",K.name,()=>{const le=u.runOutsideAngular(()=>K.firestore());if(s&&le.settings(s),ie&&le.useEmulator(...ie),i&&!Wf(o)){const Me=()=>{try{return(0,Wn.D)(le.enablePersistence(f||void 0).then(()=>!0,()=>!1))}catch(Ie){return typeof console<"u"&&console.warn(Ie),Bt(!1)}};return[le,u.runOutsideAngular(Me)]}return[le,Bt(!1)]},[s,ie,i])}collection(t,r){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:o}=p2(i,r),u=this.schedulers.ngZone.run(()=>s);return new h2(u,o,this)}collectionGroup(t,r){const i=r||(o=>o),s=this.firestore.collectionGroup(t);return new qj(i(s),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>r);return new f2(i,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(ic.Dh),m.LFG(ic.xv,8),m.LFG(Yj,8),m.LFG(Qj,8),m.LFG(m.Lbi),m.LFG(m.R0b),m.LFG(Mn.HU),m.LFG(Zj,8),m.LFG(Xj,8),m.LFG(r1,8),m.LFG(WF,8),m.LFG(KF,8),m.LFG(qF,8),m.LFG(YF,8),m.LFG(ZF,8),m.LFG(QF,8),m.LFG($m,8))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();try{h1=typeof Intl<"u"&&Intl.v8BreakIterator}catch{h1=!1}let xE,f1,L0=(()=>{class n{constructor(t){this._platformId=t,this.isBrowser=this._platformId?function zf(n){return n===fc}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!h1)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(m.Lbi))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function TD(n){return function e4(){if(null==xE&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>xE=!0}))}finally{xE=xE||!1}return xE}()?n:!!n.capture}function O0(n){return n.composedPath?n.composedPath()[0]:n.target}function g2(n){return Wi((e,t)=>n<=t)}var c4=W(5032);function y2(n){return(0,Wr.e)((e,t)=>{(0,No.Xf)(n).subscribe((0,zr.x)(t,()=>t.complete(),c4.Z)),!t.closed&&e.subscribe(t)})}function _2(n){return null!=n&&"false"!=`${n}`}function v2(n){return Array.isArray(n)?n:[n]}function CE(n){return n instanceof m.SBq?n.nativeElement:n}const b2=new Set;let N0,h4=(()=>{class n{constructor(t){this._platform=t,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):p4}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function f4(n){if(!b2.has(n))try{N0||(N0=document.createElement("style"),N0.setAttribute("type","text/css"),document.head.appendChild(N0)),N0.sheet&&(N0.sheet.insertRule(`@media ${n} {body{ }}`,0),b2.add(n))}catch(e){console.error(e)}}(t),this._matchMedia(t)}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(L0))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function p4(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let m4=(()=>{class n{constructor(t,r){this._mediaMatcher=t,this._zone=r,this._queries=new Map,this._destroySubject=new ls.x}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return E2(v2(t)).some(i=>this._registerQuery(i).mql.matches)}observe(t){const i=E2(v2(t)).map(o=>this._registerQuery(o).observable);let s=uh(i);return s=Oc(s.pipe(Qa(1)),s.pipe(g2(1),function d4(n,e=JF.z){return(0,Wr.e)((t,r)=>{let i=null,s=null,o=null;const u=()=>{if(i){i.unsubscribe(),i=null;const f=s;s=null,r.next(f)}};function d(){const f=o+n,g=e.now();if(g<f)return i=this.schedule(void 0,f-g),void r.add(i);u()}t.subscribe((0,zr.x)(r,f=>{s=f,o=e.now(),i||(i=e.schedule(d,n),r.add(i))},()=>{u(),r.complete()},void 0,()=>{s=i=null}))})}(0))),s.pipe((0,Ht.U)(o=>{const u={matches:!1,breakpoints:{}};return o.forEach(({matches:d,query:f})=>{u.matches=u.matches||d,u.breakpoints[f]=d}),u}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const r=this._mediaMatcher.matchMedia(t),s={observable:new us.y(o=>{const u=d=>this._zone.run(()=>o.next(d));return r.addListener(u),()=>{r.removeListener(u)}}).pipe(Xa(r),(0,Ht.U)(({matches:o})=>({query:t,matches:o})),y2(this._destroySubject)),mql:r};return this._queries.set(t,s),s}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(h4),m.LFG(m.R0b))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function E2(n){return n.map(e=>e.split(",")).reduce((e,t)=>e.concat(t)).map(e=>e.trim())}function S2(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}function D2(n){const e=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!e||-1!==e.identifier||null!=e.radiusX&&1!==e.radiusX||null!=e.radiusY&&1!==e.radiusY)}const I4=new m.OlP("cdk-input-modality-detector-options"),w4={ignoreKeys:[18,17,224,91,16]},F0=TD({passive:!0,capture:!0});let S4=(()=>{class n{get mostRecentModality(){return this._modality.value}constructor(t,r,i,s){this._platform=t,this._mostRecentTarget=null,this._modality=new cs(null),this._lastTouchMs=0,this._onKeydown=o=>{this._options?.ignoreKeys?.some(u=>u===o.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=O0(o))},this._onMousedown=o=>{Date.now()-this._lastTouchMs<650||(this._modality.next(S2(o)?"keyboard":"mouse"),this._mostRecentTarget=O0(o))},this._onTouchstart=o=>{D2(o)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=O0(o))},this._options={...w4,...s},this.modalityDetected=this._modality.pipe(g2(1)),this.modalityChanged=this.modalityDetected.pipe(e2()),t.isBrowser&&r.runOutsideAngular(()=>{i.addEventListener("keydown",this._onKeydown,F0),i.addEventListener("mousedown",this._onMousedown,F0),i.addEventListener("touchstart",this._onTouchstart,F0)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,F0),document.removeEventListener("mousedown",this._onMousedown,F0),document.removeEventListener("touchstart",this._onTouchstart,F0))}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(L0),m.LFG(m.R0b),m.LFG(me),m.LFG(I4,8))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const A4=new m.OlP("cdk-focus-monitor-default-options"),wD=TD({passive:!0,capture:!0});let x4=(()=>{class n{constructor(t,r,i,s,o){this._ngZone=t,this._platform=r,this._inputModalityDetector=i,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new ls.x,this._rootNodeFocusAndBlurListener=u=>{for(let f=O0(u);f;f=f.parentElement)"focus"===u.type?this._onFocus(u,f):this._onBlur(u,f)},this._document=s,this._detectionMode=o?.detectionMode||0}monitor(t,r=!1){const i=CE(t);if(!this._platform.isBrowser||1!==i.nodeType)return Bt(null);const s=function n4(n){if(function t4(){if(null==f1){const n=typeof document<"u"?document.head:null;f1=!(!n||!n.createShadowRoot&&!n.attachShadow)}return f1}()){const e=n.getRootNode?n.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&e instanceof ShadowRoot)return e}return null}(i)||this._getDocument(),o=this._elementInfo.get(i);if(o)return r&&(o.checkChildren=!0),o.subject;const u={checkChildren:r,subject:new ls.x,rootNode:s};return this._elementInfo.set(i,u),this._registerGlobalListeners(u),u.subject}stopMonitoring(t){const r=CE(t),i=this._elementInfo.get(r);i&&(i.subject.complete(),this._setClasses(r),this._elementInfo.delete(r),this._removeGlobalListeners(i))}focusVia(t,r,i){const s=CE(t);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([u,d])=>this._originChanged(u,r,d)):(this._setOrigin(r),"function"==typeof s.focus&&s.focus(i))}ngOnDestroy(){this._elementInfo.forEach((t,r)=>this.stopMonitoring(r))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return 1===this._detectionMode||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,r){t.classList.toggle("cdk-focused",!!r),t.classList.toggle("cdk-touch-focused","touch"===r),t.classList.toggle("cdk-keyboard-focused","keyboard"===r),t.classList.toggle("cdk-mouse-focused","mouse"===r),t.classList.toggle("cdk-program-focused","program"===r)}_setOrigin(t,r=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&r,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,r){const i=this._elementInfo.get(r),s=O0(t);!i||!i.checkChildren&&r!==s||this._originChanged(r,this._getFocusOrigin(s),i)}_onBlur(t,r){const i=this._elementInfo.get(r);!i||i.checkChildren&&t.relatedTarget instanceof Node&&r.contains(t.relatedTarget)||(this._setClasses(r),this._emitOrigin(i,null))}_emitOrigin(t,r){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(r))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const r=t.rootNode,i=this._rootNodeFocusListenerCount.get(r)||0;i||this._ngZone.runOutsideAngular(()=>{r.addEventListener("focus",this._rootNodeFocusAndBlurListener,wD),r.addEventListener("blur",this._rootNodeFocusAndBlurListener,wD)}),this._rootNodeFocusListenerCount.set(r,i+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(y2(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(t){const r=t.rootNode;if(this._rootNodeFocusListenerCount.has(r)){const i=this._rootNodeFocusListenerCount.get(r);i>1?this._rootNodeFocusListenerCount.set(r,i-1):(r.removeEventListener("focus",this._rootNodeFocusAndBlurListener,wD),r.removeEventListener("blur",this._rootNodeFocusAndBlurListener,wD),this._rootNodeFocusListenerCount.delete(r))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,r,i){this._setClasses(t,r),this._emitOrigin(i,r),this._lastFocusOrigin=r}_getClosestElementsInfo(t){const r=[];return this._elementInfo.forEach((i,s)=>{(s===t||i.checkChildren&&s.contains(t))&&r.push([s,i])}),r}_isLastInteractionFromInputLabel(t){const{_mostRecentTarget:r,mostRecentModality:i}=this._inputModalityDetector;if("mouse"!==i||!r||r===t||"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName||t.disabled)return!1;const s=t.labels;if(s)for(let o=0;o<s.length;o++)if(s[o].contains(r))return!0;return!1}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(m.R0b),m.LFG(L0),m.LFG(S4),m.LFG(me,8),m.LFG(A4,8))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const x2="cdk-high-contrast-black-on-white",C2="cdk-high-contrast-white-on-black",p1="cdk-high-contrast-active";let C4=(()=>{class n{constructor(t,r){this._platform=t,this._document=r,this._breakpointSubscription=(0,m.f3M)(m4).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const r=this._document.defaultView||window,i=r&&r.getComputedStyle?r.getComputedStyle(t):null,s=(i&&i.backgroundColor||"").replace(/ /g,"");switch(t.remove(),s){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(p1,x2,C2),this._hasCheckedHighContrastMode=!0;const r=this.getHighContrastMode();1===r?t.add(p1,x2):2===r&&t.add(p1,C2)}}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(L0),m.LFG(me))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),R2=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({}),n})();const L4=new m.OlP("mat-sanity-checks",{providedIn:"root",factory:function k4(){return!0}});let SD=(()=>{class n{constructor(t,r,i){this._sanityChecks=r,this._document=i,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!function r4(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(C4),m.LFG(L4,8),m.LFG(me))},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({imports:[R2,R2]}),n})();function P4(n){return class extends n{get disabled(){return this._disabled}set disabled(e){this._disabled=_2(e)}constructor(...e){super(...e),this._disabled=!1}}}function O4(n,e){return class extends n{get color(){return this._color}set color(t){const r=t||this.defaultColor;r!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),r&&this._elementRef.nativeElement.classList.add(`mat-${r}`),this._color=r)}constructor(...t){super(...t),this.defaultColor=e,this.color=e}}}function N4(n){return class extends n{get disableRipple(){return this._disableRipple}set disableRipple(e){this._disableRipple=_2(e)}constructor(...e){super(...e),this._disableRipple=!1}}}class U4{constructor(e,t,r,i=!1){this._renderer=e,this.element=t,this.config=r,this._animationForciblyDisabledThroughCss=i,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const L2=TD({passive:!0,capture:!0});class B4{constructor(){this._events=new Map,this._delegateEventHandler=e=>{const t=O0(e);t&&this._events.get(e.type)?.forEach((r,i)=>{(i===t||i.contains(t))&&r.forEach(s=>s.handleEvent(e))})}}addHandler(e,t,r,i){const s=this._events.get(t);if(s){const o=s.get(r);o?o.add(i):s.set(r,new Set([i]))}else this._events.set(t,new Map([[r,new Set([i])]])),e.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,L2)})}removeHandler(e,t,r){const i=this._events.get(e);if(!i)return;const s=i.get(t);s&&(s.delete(r),0===s.size&&i.delete(t),0===i.size&&(this._events.delete(e),document.removeEventListener(e,this._delegateEventHandler,L2)))}}const P2={enterDuration:225,exitDuration:150},O2=TD({passive:!0,capture:!0}),N2=["mousedown","touchstart"],F2=["mouseup","mouseleave","touchend","touchcancel"];class ME{constructor(e,t,r,i){this._target=e,this._ngZone=t,this._platform=i,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,i.isBrowser&&(this._containerElement=CE(r))}fadeInRipple(e,t,r={}){const i=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),s={...P2,...r.animation};r.centered&&(e=i.left+i.width/2,t=i.top+i.height/2);const o=r.radius||function $4(n,e,t){const r=Math.max(Math.abs(n-t.left),Math.abs(n-t.right)),i=Math.max(Math.abs(e-t.top),Math.abs(e-t.bottom));return Math.sqrt(r*r+i*i)}(e,t,i),u=e-i.left,d=t-i.top,f=s.enterDuration,g=document.createElement("div");g.classList.add("mat-ripple-element"),g.style.left=u-o+"px",g.style.top=d-o+"px",g.style.height=2*o+"px",g.style.width=2*o+"px",null!=r.color&&(g.style.backgroundColor=r.color),g.style.transitionDuration=`${f}ms`,this._containerElement.appendChild(g);const b=window.getComputedStyle(g),w=b.transitionDuration,x="none"===b.transitionProperty||"0s"===w||"0s, 0s"===w||0===i.width&&0===i.height,k=new U4(this,g,r,x);g.style.transform="scale3d(1, 1, 1)",k.state=0,r.persistent||(this._mostRecentTransientRipple=k);let N=null;return!x&&(f||s.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const z=()=>this._finishRippleTransition(k),X=()=>this._destroyRipple(k);g.addEventListener("transitionend",z),g.addEventListener("transitioncancel",X),N={onTransitionEnd:z,onTransitionCancel:X}}),this._activeRipples.set(k,N),(x||!f)&&this._finishRippleTransition(k),k}fadeOutRipple(e){if(2===e.state||3===e.state)return;const t=e.element,r={...P2,...e.config.animation};t.style.transitionDuration=`${r.exitDuration}ms`,t.style.opacity="0",e.state=2,(e._animationForciblyDisabledThroughCss||!r.exitDuration)&&this._finishRippleTransition(e)}fadeOutAll(){this._getActiveRipples().forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){const t=CE(e);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,N2.forEach(r=>{ME._eventManager.addHandler(this._ngZone,r,t,this)}))}handleEvent(e){"mousedown"===e.type?this._onMousedown(e):"touchstart"===e.type?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{F2.forEach(t=>{this._triggerElement.addEventListener(t,this,O2)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(e){0===e.state?this._startFadeOutTransition(e):2===e.state&&this._destroyRipple(e)}_startFadeOutTransition(e){const t=e===this._mostRecentTransientRipple,{persistent:r}=e.config;e.state=1,!r&&(!t||!this._isPointerDown)&&e.fadeOut()}_destroyRipple(e){const t=this._activeRipples.get(e)??null;this._activeRipples.delete(e),this._activeRipples.size||(this._containerRect=null),e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),e.state=3,null!==t&&(e.element.removeEventListener("transitionend",t.onTransitionEnd),e.element.removeEventListener("transitioncancel",t.onTransitionCancel)),e.element.remove()}_onMousedown(e){const t=S2(e),r=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!r&&(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!D2(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=e.changedTouches;for(let r=0;r<t.length;r++)this.fadeInRipple(t[r].clientX,t[r].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(e=>{!e.config.persistent&&(1===e.state||e.config.terminateOnPointerUp&&0===e.state)&&e.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const e=this._triggerElement;e&&(N2.forEach(t=>ME._eventManager.removeHandler(t,e,this)),this._pointerUpEventsRegistered&&F2.forEach(t=>e.removeEventListener(t,this,O2)))}}ME._eventManager=new B4;const G4=new m.OlP("mat-ripple-global-options");let U2=(()=>{class n{get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}constructor(t,r,i,s,o){this._elementRef=t,this._animationMode=o,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=s||{},this._rippleRenderer=new ME(this,r,t,i)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,r=0,i){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,r,{...this.rippleConfig,...i}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...t})}}return n.\u0275fac=function(t){return new(t||n)(m.Y36(m.SBq),m.Y36(m.R0b),m.Y36(L0),m.Y36(G4,8),m.Y36(m.QbO,8))},n.\u0275dir=m.lG2({type:n,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(t,r){2&t&&m.ekj("mat-ripple-unbounded",r.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]}),n})(),H4=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({imports:[SD,SD]}),n})();const j4=["mat-button",""],z4=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],W4=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],K4=[{selector:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{selector:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{selector:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{selector:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{selector:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{selector:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{selector:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],q4=O4(P4(N4(class{constructor(n){this._elementRef=n}})));let Y4=(()=>{class n extends q4{constructor(t,r,i,s){super(t),this._platform=r,this._ngZone=i,this._animationMode=s,this._focusMonitor=(0,m.f3M)(x4),this._isFab=!1;const o=t.nativeElement.classList;for(const u of K4)this._hasHostAttributes(u.selector)&&u.mdcClasses.forEach(d=>{o.add(d)})}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(t="program",r){t?this._focusMonitor.focusVia(this._elementRef.nativeElement,t,r):this._elementRef.nativeElement.focus(r)}_hasHostAttributes(...t){return t.some(r=>this._elementRef.nativeElement.hasAttribute(r))}_isRippleDisabled(){return this.disableRipple||this.disabled}}return n.\u0275fac=function(t){m.$Z()},n.\u0275dir=m.lG2({type:n,viewQuery:function(t,r){if(1&t&&m.Gf(U2,5),2&t){let i;m.iGM(i=m.CRH())&&(r.ripple=i.first)}},features:[m.qOj]}),n})(),Q4=(()=>{class n extends Y4{constructor(t,r,i,s){super(t,r,i,s)}}return n.\u0275fac=function(t){return new(t||n)(m.Y36(m.SBq),m.Y36(L0),m.Y36(m.R0b),m.Y36(m.QbO,8))},n.\u0275cmp=m.Xpm({type:n,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:7,hostBindings:function(t,r){2&t&&(m.uIk("disabled",r.disabled||null),m.ekj("_mat-animation-noopable","NoopAnimations"===r._animationMode)("mat-unthemed",!r.color)("mat-mdc-button-base",!0))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[m.qOj],attrs:j4,ngContentSelectors:W4,decls:8,vars:6,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],["matRipple","",1,"mat-mdc-button-ripple",3,"matRippleDisabled","matRippleTrigger"],[1,"mat-mdc-button-touch-target"]],template:function(t,r){1&t&&(m.F$t(z4),m._UZ(0,"span",0),m.Hsn(1),m.TgZ(2,"span",1),m.Hsn(3,1),m.qZA(),m.Hsn(4,2),m._UZ(5,"span",2)(6,"span",3)(7,"span",4)),2&t&&(m.ekj("mdc-button__ripple",!r._isFab)("mdc-fab__ripple",r._isFab),m.xp6(6),m.Q6J("matRippleDisabled",r._isRippleDisabled())("matRippleTrigger",r._elementRef.nativeElement))},dependencies:[U2],styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(\n      100% + 4px\n    );width:calc(\n      100% + 4px\n    );display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{height:var(--mdc-text-button-container-height, 36px);border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, inherit)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button{height:var(--mdc-filled-button-container-height, 36px);border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color, transparent)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, inherit)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button{height:var(--mdc-protected-button-container-height, 36px);border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px));box-shadow:var(--mdc-protected-button-container-elevation, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color, transparent)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, inherit)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button.mdc-ripple-upgraded--background-focused,.mat-mdc-raised-button:not(.mdc-ripple-upgraded):focus{box-shadow:var(--mdc-protected-button-focus-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled):active{box-shadow:var(--mdc-protected-button-pressed-container-elevation, 0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation, 0px 0px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 0px rgba(0, 0, 0, 0.14), 0px 0px 0px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button{height:var(--mdc-outlined-button-container-height, 36px);border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px));padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, inherit)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width, 1px));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width, 1px))}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0;background-color:var(--mat-mdc-button-persistent-ripple-color)}.mat-mdc-button .mat-ripple-element,.mat-mdc-unelevated-button .mat-ripple-element,.mat-mdc-raised-button .mat-ripple-element,.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-mdc-button-ripple-color)}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button[disabled],.mat-mdc-unelevated-button[disabled],.mat-mdc-raised-button[disabled],.mat-mdc-outlined-button[disabled]{cursor:default;pointer-events:none}.mat-mdc-button .mat-mdc-button-touch-target,.mat-mdc-unelevated-button .mat-mdc-button-touch-target,.mat-mdc-raised-button .mat-mdc-button-touch-target,.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}[dir=rtl] .mat-mdc-button>.mat-icon,.mat-mdc-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}.mat-mdc-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon,.mat-mdc-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem;margin-left:-4px;margin-right:8px}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:-4px}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon,.mat-mdc-raised-button .mdc-button__label+.mat-icon,.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:-4px}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon,.mat-mdc-unelevated-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-raised-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-outlined-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:-4px;margin-right:8px}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px) * -1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px) * -1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0}),n})(),J4=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({imports:[SD,H4,SD]}),n})();const e8=["videoPlayer"];function t8(n,e){if(1&n){const t=m.EpF();m.TgZ(0,"button",19),m.NdJ("click",function(){const i=m.CHM(t),s=i.index,o=i.$implicit,u=m.oxw();return u.createCollection(s,o.name),m.KtG(u.changeChannel(s,!0))}),m._uU(1),m.qZA()}if(2&n){const t=e.$implicit,r=e.index,i=m.oxw();m.ekj("active",i.activeLocalChannel===r),m.xp6(1),m.hij(" ",t.name," ")}}function n8(n,e){if(1&n){const t=m.EpF();m.TgZ(0,"button",19),m.NdJ("click",function(){const s=m.CHM(t).index,o=m.oxw();return m.KtG(o.changeChannel(s,!1))}),m._uU(1),m.qZA()}if(2&n){const t=e.$implicit,r=e.index,i=m.oxw();m.ekj("active",i.activeGlobalChannel===r),m.xp6(1),m.hij(" ",t.name," ")}}function r8(n,e){if(1&n){const t=m.EpF();m.TgZ(0,"button",20),m.NdJ("click",function(){const s=m.CHM(t).$implicit,o=m.oxw();return m.KtG(o.updateChannelIndex(s))}),m._uU(1),m.qZA()}if(2&n){const t=e.$implicit;m.xp6(1),m.hij(" ",t," ")}}const i8=function(){return[1,2,3,4,5,6,7,8,9,0]},s8=[{path:"",component:Cg,children:[{path:"",redirectTo:"display/default-channel/draftChannel",pathMatch:"full"},{path:"display/:channelName/:index",component:(()=>{var n;class e{constructor(r,i,s,o,u){this.route=r,this.router=i,this.store=s,this.auth=o,this.firestore=u,this.documentRef=null,this.activeLocalChannel=-1,this.activeGlobalChannel=-1,this.channelIndex=0,this.hls=new Ey,this.volumeLevel=0}handleKeyboardEvent(r){"ArrowLeft"===r.key?this.changeChannel(this.activeLocalChannel-1,!0):"ArrowRight"===r.key&&this.changeChannel(this.activeLocalChannel+1,!0)}login(){this.auth.loginWithGoogle()}createCollection(r,i){const s=this.firestore.collection("test"),u={SelectedIndex:r,ChannelName:i,IncreaseVolume:this.volumeLevel<1?this.volumeLevel+.1:this.volumeLevel,DecreaseVolume:this.volumeLevel>0?this.volumeLevel-.1:this.volumeLevel},d=s.doc("v9dWU1YRCsIOISzKbbjH");return this.documentRef=d.ref,d.set(u).then(()=>{}).catch(f=>{}),this.unsubscribe=GM(this.documentRef,f=>{const g=f.data();g&&this.router.navigate(["/display",g.ChannelName,g.SelectedIndex])}),d}ngAfterViewInit(){Ey.isSupported()&&this.route.paramMap.subscribe(r=>{const i=(r.get("channelName")||"").replace(/-/g," "),s=r.get("index");if(null!==s){const o=+s;this.changeChannel(o,o<this.store.localChannels.length),this.createCollection(o,i).valueChanges().subscribe(f=>{f&&(void 0!==f.IncreaseVolume&&(this.videoplayer.nativeElement.volume=f.IncreaseVolume/100),void 0!==f.DecreaseVolume&&(this.videoplayer.nativeElement.volume=f.DecreaseVolume/100))})}})}ngOnDestroy(){this.unsubscribe()}playChannel(r){r.startsWith("blob:")?fetch(r).then(i=>i.blob()).then(i=>{const s=URL.createObjectURL(i);this.videoplayer.nativeElement.src=s,this.videoplayer.nativeElement.play()}):(this.hls.loadSource(r),this.hls.attachMedia(this.videoplayer.nativeElement),this.hls.on(Ey.Events.MANIFEST_PARSED,()=>{this.videoplayer.nativeElement.play()}))}changeChannel(r,i){const s=i?this.store.localChannels:this.store.globalChannels;r<0?r=0:r>=s.length&&(r%=s.length),i?(this.activeLocalChannel=r,this.activeGlobalChannel=-1):(this.activeGlobalChannel=r,this.activeLocalChannel=-1),this.playChannel(s[r].url);const u=s[r].name;this.createCollection(r,u),this.router.navigate(["/display",u,r])}increaseVolume(){let r=this.videoplayer.nativeElement.volume;r<1&&(this.videoplayer.nativeElement.volume=Math.min(r+.1,1),this.volumeLevel=Math.round(100*this.videoplayer.nativeElement.volume),this.createCollection(this.activeLocalChannel,this.store.localChannels[this.activeLocalChannel].name))}decreaseVolume(){let r=this.videoplayer.nativeElement.volume;r>0&&(this.videoplayer.nativeElement.volume=Math.max(r-.1,0),this.volumeLevel=Math.round(100*this.videoplayer.nativeElement.volume),this.createCollection(this.activeLocalChannel,this.store.localChannels[this.activeLocalChannel].name))}onChannelIndexChange(r){this.channelIndex=+r.target.value}updateChannelIndex(r){this.channelIndex=10*this.channelIndex+r,this.changeChannelTimeout&&clearTimeout(this.changeChannelTimeout),this.changeChannelTimeout=setTimeout(()=>{this.changeChannel(this.channelIndex,!0),this.channelIndex=0},2e3),this.createCollection(this.channelIndex,this.store.localChannels[this.channelIndex].name)}}return(n=e).\u0275fac=function(r){return new(r||n)(m.Y36(Ih),m.Y36(Rs),m.Y36(R3),m.Y36(kj),m.Y36(Jj))},n.\u0275cmp=m.Xpm({type:n,selectors:[["app-main-display"]],viewQuery:function(r,i){if(1&r&&m.Gf(e8,5),2&r){let s;m.iGM(s=m.CRH())&&(i.videoplayer=s.first)}},hostBindings:function(r,i){1&r&&m.NdJ("keydown",function(o){return i.handleKeyboardEvent(o)},!1,m.Jf7)},decls:49,vars:6,consts:[[1,"container"],["mat-raised-button","","color","accent",2,"margin-left","10px",3,"click"],[1,"row"],[1,"text-center","my-3"],[1,"col-12","centre"],["controls","","autoplay","",1,"w-100","video"],["videoPlayer",""],[1,"channel"],["mat-raised-button","","color","primary",3,"active","click",4,"ngFor","ngForOf"],[1,"remote-control"],[1,"volume-display"],[1,"number-display"],[1,""],[1,"remote-button"],[1,"remote-row"],[1,"remote-button",3,"click"],[1,"channel-input"],[1,"number-buttons"],[3,"click",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",3,"click"],[3,"click"]],template:function(r,i){1&r&&(m.TgZ(0,"div",0)(1,"button",1),m.NdJ("click",function(){return i.auth.loginWithGoogle()}),m._uU(2," Sign In "),m.qZA(),m.TgZ(3,"div",2)(4,"div",3)(5,"h1"),m._uU(6,"Welcome to Live TV Streaming!"),m.qZA()(),m.TgZ(7,"div",4),m._UZ(8,"video",5,6),m.qZA(),m.TgZ(10,"div",7)(11,"h2"),m._uU(12,"Local Channels"),m.qZA(),m.YNc(13,t8,2,3,"button",8),m.qZA(),m.TgZ(14,"div",7)(15,"h2"),m._uU(16,"Global Channels"),m.qZA(),m.YNc(17,n8,2,3,"button",8),m.qZA()()(),m.TgZ(18,"div",9)(19,"div",10),m._uU(20),m.qZA(),m.TgZ(21,"div",11),m._uU(22),m.qZA(),m.TgZ(23,"div",12)(24,"button",13),m._uU(25,"\u2191"),m.qZA()(),m.TgZ(26,"div",12)(27,"button",13),m._uU(28,"\u2190"),m.qZA(),m.TgZ(29,"button",13),m._uU(30,"OK"),m.qZA(),m.TgZ(31,"button",13),m._uU(32,"\u2192"),m.qZA()(),m.TgZ(33,"div",12)(34,"button",13),m._uU(35,"\u2193"),m.qZA()(),m.TgZ(36,"div",14)(37,"button",15),m.NdJ("click",function(){return i.increaseVolume()}),m._uU(38,"Vol +"),m.qZA(),m.TgZ(39,"button",15),m.NdJ("click",function(){return i.changeChannel(i.activeLocalChannel+1,!0)}),m._uU(40," Ch + "),m.qZA()(),m.TgZ(41,"div",14)(42,"button",15),m.NdJ("click",function(){return i.decreaseVolume()}),m._uU(43,"Vol -"),m.qZA(),m.TgZ(44,"button",15),m.NdJ("click",function(){return i.changeChannel(i.activeLocalChannel-1,!0)}),m._uU(45," Ch - "),m.qZA()(),m.TgZ(46,"div",16)(47,"div",17),m.YNc(48,r8,2,1,"button",18),m.qZA()()()),2&r&&(m.xp6(13),m.Q6J("ngForOf",i.store.localChannels),m.xp6(4),m.Q6J("ngForOf",i.store.globalChannels),m.xp6(3),m.hij(" Volume: ",i.volumeLevel," "),m.xp6(2),m.hij(" ",i.channelIndex," "),m.xp6(26),m.Q6J("ngForOf",m.DdM(5,i8)))},dependencies:[Ba,Q4],styles:[".container[_ngcontent-%COMP%]{font-family:Arial,sans-serif;background-color:#181818;height:100vh;min-width:100%;color:#fff}h1[_ngcontent-%COMP%]{color:#fff;text-align:center}.channel[_ngcontent-%COMP%]{width:100%;text-align:center}.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;border-color:#007bff}.centre[_ngcontent-%COMP%]{display:flex;justify-content:center}.video[_ngcontent-%COMP%]{height:460px}button.active[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.remote-control[_ngcontent-%COMP%]{display:none}@media screen and (max-width: 600px){.container[_ngcontent-%COMP%]{display:none}.remote-control[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;justify-content:center;align-items:center}.remote-control[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;background-color:#333;padding:20px;border-radius:15px}.remote-row[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:10px}.remote-button[_ngcontent-%COMP%]{color:#007bff;padding:0 5px;border-radius:5px;margin:5px}.remote-row[_ngcontent-%COMP%]{display:flex;justify-content:center}.remote-button[_ngcontent-%COMP%]{margin:5px;padding:5px 10px;font-size:14px}.number-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}.number-display[_ngcontent-%COMP%]{background-color:#fff;color:#000;padding:0 25px;margin-bottom:20px;border-radius:6px}@keyframes fade{0%{opacity:1}50%{opacity:1}to{opacity:0}}.volume-display[_ngcontent-%COMP%]{animation:fade 3s}}"]}),e})()}]}];let o8=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({imports:[nx.forRoot(s8),nx]}),e})();class B2{}class a8{}const Dd="*";function V2(n,e=null){return{type:2,steps:n,options:e}}function $2(n){return{type:6,styles:n,offset:null}}function G2(n){Promise.resolve().then(n)}class kE{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){G2(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(r=>r()),t.length=0}}class H2{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,r=0,i=0;const s=this.players.length;0==s?G2(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++t==s&&this._onFinish()}),o.onDestroy(()=>{++r==s&&this._onDestroy()}),o.onStart(()=>{++i==s&&this._onStart()})}),this.totalTime=this.players.reduce((o,u)=>Math.max(o,u.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(r=>{const i=r.totalTime?Math.min(1,t/r.totalTime):1;r.setPosition(i)})}getPosition(){const e=this.players.reduce((t,r)=>null===t||r.totalTime>t.totalTime?r:t,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(r=>r()),t.length=0}}const m1="!";function j2(n){return new m.vHH(3e3,!1)}function G8(){return typeof window<"u"&&typeof window.document<"u"}function g1(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function Nf(n){switch(n.length){case 0:return new kE;case 1:return n[0];default:return new H2(n)}}function z2(n,e,t,r,i=new Map,s=new Map){const o=[],u=[];let d=-1,f=null;if(r.forEach(g=>{const b=g.get("offset"),T=b==d,w=T&&f||new Map;g.forEach((x,k)=>{let N=k,z=x;if("offset"!==k)switch(N=e.normalizePropertyName(N,o),z){case m1:z=i.get(k);break;case Dd:z=s.get(k);break;default:z=e.normalizeStyleValue(k,N,z,o)}w.set(N,z)}),T||u.push(w),f=w,d=b}),o.length)throw function R8(n){return new m.vHH(3502,!1)}();return u}function y1(n,e,t,r){switch(e){case"start":n.onStart(()=>r(t&&_1(t,"start",n)));break;case"done":n.onDone(()=>r(t&&_1(t,"done",n)));break;case"destroy":n.onDestroy(()=>r(t&&_1(t,"destroy",n)))}}function _1(n,e,t){const s=v1(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,t.totalTime??n.totalTime,!!t.disabled),o=n._data;return null!=o&&(s._data=o),s}function v1(n,e,t,r,i="",s=0,o){return{element:n,triggerName:e,fromState:t,toState:r,phaseName:i,totalTime:s,disabled:!!o}}function Na(n,e,t){let r=n.get(e);return r||n.set(e,r=t),r}function W2(n){const e=n.indexOf(":");return[n.substring(1,e),n.slice(e+1)]}let b1=(n,e)=>!1,K2=(n,e,t)=>[],q2=null;function E1(n){const e=n.parentNode||n.host;return e===q2?null:e}(g1()||typeof Element<"u")&&(G8()?(q2=(()=>document.documentElement)(),b1=(n,e)=>{for(;e;){if(e===n)return!0;e=E1(e)}return!1}):b1=(n,e)=>n.contains(e),K2=(n,e,t)=>{if(t)return Array.from(n.querySelectorAll(e));const r=n.querySelector(e);return r?[r]:[]});let Wm=null,Y2=!1;const Z2=b1,Q2=K2;let X2=(()=>{class n{validateStyleProperty(t){return function j8(n){Wm||(Wm=function z8(){return typeof document<"u"?document.body:null}()||{},Y2=!!Wm.style&&"WebkitAppearance"in Wm.style);let e=!0;return Wm.style&&!function H8(n){return"ebkit"==n.substring(1,6)}(n)&&(e=n in Wm.style,!e&&Y2&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in Wm.style)),e}(t)}matchesElement(t,r){return!1}containsElement(t,r){return Z2(t,r)}getParentElement(t){return E1(t)}query(t,r,i){return Q2(t,r,i)}computeStyle(t,r,i){return i||""}animate(t,r,i,s,o,u=[],d){return new kE(i,s)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})(),T1=(()=>{class n{}return n.NOOP=new X2,n})();const W8=1e3,I1="ng-enter",DD="ng-leave",AD="ng-trigger",xD=".ng-trigger",eU="ng-animating",w1=".ng-animating";function Ad(n){if("number"==typeof n)return n;const e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:S1(parseFloat(e[1]),e[2])}function S1(n,e){return"s"===e?n*W8:n}function CD(n,e,t){return n.hasOwnProperty("duration")?n:function q8(n,e,t){let i,s=0,o="";if("string"==typeof n){const u=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===u)return e.push(j2()),{duration:0,delay:0,easing:""};i=S1(parseFloat(u[1]),u[2]);const d=u[3];null!=d&&(s=S1(parseFloat(d),u[4]));const f=u[5];f&&(o=f)}else i=n;if(!t){let u=!1,d=e.length;i<0&&(e.push(function l8(){return new m.vHH(3100,!1)}()),u=!0),s<0&&(e.push(function c8(){return new m.vHH(3101,!1)}()),u=!0),u&&e.splice(d,0,j2())}return{duration:i,delay:s,easing:o}}(n,e,t)}function LE(n,e={}){return Object.keys(n).forEach(t=>{e[t]=n[t]}),e}function tU(n){const e=new Map;return Object.keys(n).forEach(t=>{e.set(t,n[t])}),e}function Ff(n,e=new Map,t){if(t)for(let[r,i]of t)e.set(r,i);for(let[r,i]of n)e.set(r,i);return e}function rU(n,e,t){return t?e+":"+t+";":""}function iU(n){let e="";for(let t=0;t<n.style.length;t++){const r=n.style.item(t);e+=rU(0,r,n.style.getPropertyValue(r))}for(const t in n.style)n.style.hasOwnProperty(t)&&!t.startsWith("_")&&(e+=rU(0,X8(t),n.style[t]));n.setAttribute("style",e)}function fu(n,e,t){n.style&&(e.forEach((r,i)=>{const s=A1(i);t&&!t.has(i)&&t.set(i,n.style[s]),n.style[s]=r}),g1()&&iU(n))}function Km(n,e){n.style&&(e.forEach((t,r)=>{const i=A1(r);n.style[i]=""}),g1()&&iU(n))}function PE(n){return Array.isArray(n)?1==n.length?n[0]:V2(n):n}const D1=new RegExp("{{\\s*(.+?)\\s*}}","g");function sU(n){let e=[];if("string"==typeof n){let t;for(;t=D1.exec(n);)e.push(t[1]);D1.lastIndex=0}return e}function OE(n,e,t){const r=n.toString(),i=r.replace(D1,(s,o)=>{let u=e[o];return null==u&&(t.push(function d8(n){return new m.vHH(3003,!1)}()),u=""),u.toString()});return i==r?n:i}function RD(n){const e=[];let t=n.next();for(;!t.done;)e.push(t.value),t=n.next();return e}const Q8=/-+([a-z0-9])/g;function A1(n){return n.replace(Q8,(...e)=>e[1].toUpperCase())}function X8(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Fa(n,e,t){switch(e.type){case 7:return n.visitTrigger(e,t);case 0:return n.visitState(e,t);case 1:return n.visitTransition(e,t);case 2:return n.visitSequence(e,t);case 3:return n.visitGroup(e,t);case 4:return n.visitAnimate(e,t);case 5:return n.visitKeyframes(e,t);case 6:return n.visitStyle(e,t);case 8:return n.visitReference(e,t);case 9:return n.visitAnimateChild(e,t);case 10:return n.visitAnimateRef(e,t);case 11:return n.visitQuery(e,t);case 12:return n.visitStagger(e,t);default:throw function h8(n){return new m.vHH(3004,!1)}()}}function oU(n,e){return window.getComputedStyle(n)[e]}const LD="*";function i6(n,e){const t=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(r=>function s6(n,e,t){if(":"==n[0]){const d=function o6(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,r)=>parseFloat(r)>parseFloat(t);case":decrement":return(t,r)=>parseFloat(r)<parseFloat(t);default:return e.push(function D8(n){return new m.vHH(3016,!1)}()),"* => *"}}(n,t);if("function"==typeof d)return void e.push(d);n=d}const r=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==r||r.length<4)return t.push(function S8(n){return new m.vHH(3015,!1)}()),e;const i=r[1],s=r[2],o=r[3];e.push(aU(i,o));"<"==s[0]&&!(i==LD&&o==LD)&&e.push(aU(o,i))}(r,t,e)):t.push(n),t}const PD=new Set(["true","1"]),OD=new Set(["false","0"]);function aU(n,e){const t=PD.has(n)||OD.has(n),r=PD.has(e)||OD.has(e);return(i,s)=>{let o=n==LD||n==i,u=e==LD||e==s;return!o&&t&&"boolean"==typeof i&&(o=i?PD.has(n):OD.has(n)),!u&&r&&"boolean"==typeof s&&(u=s?PD.has(e):OD.has(e)),o&&u}}const a6=new RegExp("s*:selfs*,?","g");function x1(n,e,t,r){return new l6(n).build(e,t,r)}class l6{constructor(e){this._driver=e}build(e,t,r){const i=new d6(t);return this._resetContextStyleTimingState(i),Fa(this,PE(e),i)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles=new Map,e.collectedStyles.set("",new Map),e.currentTime=0}visitTrigger(e,t){let r=t.queryCount=0,i=t.depCount=0;const s=[],o=[];return"@"==e.name.charAt(0)&&t.errors.push(function p8(){return new m.vHH(3006,!1)}()),e.definitions.forEach(u=>{if(this._resetContextStyleTimingState(t),0==u.type){const d=u,f=d.name;f.toString().split(/\s*,\s*/).forEach(g=>{d.name=g,s.push(this.visitState(d,t))}),d.name=f}else if(1==u.type){const d=this.visitTransition(u,t);r+=d.queryCount,i+=d.depCount,o.push(d)}else t.errors.push(function m8(){return new m.vHH(3007,!1)}())}),{type:7,name:e.name,states:s,transitions:o,queryCount:r,depCount:i,options:null}}visitState(e,t){const r=this.visitStyle(e.styles,t),i=e.options&&e.options.params||null;if(r.containsDynamicStyles){const s=new Set,o=i||{};r.styles.forEach(u=>{u instanceof Map&&u.forEach(d=>{sU(d).forEach(f=>{o.hasOwnProperty(f)||s.add(f)})})}),s.size&&(RD(s.values()),t.errors.push(function g8(n,e){return new m.vHH(3008,!1)}()))}return{type:0,name:e.name,style:r,options:i?{params:i}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const r=Fa(this,PE(e.animation),t);return{type:1,matchers:i6(e.expr,t.errors),animation:r,queryCount:t.queryCount,depCount:t.depCount,options:qm(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(r=>Fa(this,r,t)),options:qm(e.options)}}visitGroup(e,t){const r=t.currentTime;let i=0;const s=e.steps.map(o=>{t.currentTime=r;const u=Fa(this,o,t);return i=Math.max(i,t.currentTime),u});return t.currentTime=i,{type:3,steps:s,options:qm(e.options)}}visitAnimate(e,t){const r=function f6(n,e){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return C1(CD(n,e).duration,0,"");const t=n;if(t.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=C1(0,0,"");return s.dynamic=!0,s.strValue=t,s}const i=CD(t,e);return C1(i.duration,i.delay,i.easing)}(e.timings,t.errors);t.currentAnimateTimings=r;let i,s=e.styles?e.styles:$2({});if(5==s.type)i=this.visitKeyframes(s,t);else{let o=e.styles,u=!1;if(!o){u=!0;const f={};r.easing&&(f.easing=r.easing),o=$2(f)}t.currentTime+=r.duration+r.delay;const d=this.visitStyle(o,t);d.isEmptyStep=u,i=d}return t.currentAnimateTimings=null,{type:4,timings:r,style:i,options:null}}visitStyle(e,t){const r=this._makeStyleAst(e,t);return this._validateStyleAst(r,t),r}_makeStyleAst(e,t){const r=[],i=Array.isArray(e.styles)?e.styles:[e.styles];for(let u of i)"string"==typeof u?u===Dd?r.push(u):t.errors.push(new m.vHH(3002,!1)):r.push(tU(u));let s=!1,o=null;return r.forEach(u=>{if(u instanceof Map&&(u.has("easing")&&(o=u.get("easing"),u.delete("easing")),!s))for(let d of u.values())if(d.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:r,easing:o,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,t){const r=t.currentAnimateTimings;let i=t.currentTime,s=t.currentTime;r&&s>0&&(s-=r.duration+r.delay),e.styles.forEach(o=>{"string"!=typeof o&&o.forEach((u,d)=>{const f=t.collectedStyles.get(t.currentQuerySelector),g=f.get(d);let b=!0;g&&(s!=i&&s>=g.startTime&&i<=g.endTime&&(t.errors.push(function _8(n,e,t,r,i){return new m.vHH(3010,!1)}()),b=!1),s=g.startTime),b&&f.set(d,{startTime:s,endTime:i}),t.options&&function Z8(n,e,t){const r=e.params||{},i=sU(n);i.length&&i.forEach(s=>{r.hasOwnProperty(s)||t.push(function u8(n){return new m.vHH(3001,!1)}())})}(u,t.options,t.errors)})})}visitKeyframes(e,t){const r={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function v8(){return new m.vHH(3011,!1)}()),r;let s=0;const o=[];let u=!1,d=!1,f=0;const g=e.steps.map(z=>{const X=this._makeStyleAst(z,t);let K=null!=X.offset?X.offset:function h6(n){if("string"==typeof n)return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){const r=t;e=parseFloat(r.get("offset")),r.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}(X.styles),ie=0;return null!=K&&(s++,ie=X.offset=K),d=d||ie<0||ie>1,u=u||ie<f,f=ie,o.push(ie),X});d&&t.errors.push(function b8(){return new m.vHH(3012,!1)}()),u&&t.errors.push(function E8(){return new m.vHH(3200,!1)}());const b=e.steps.length;let T=0;s>0&&s<b?t.errors.push(function T8(){return new m.vHH(3202,!1)}()):0==s&&(T=1/(b-1));const w=b-1,x=t.currentTime,k=t.currentAnimateTimings,N=k.duration;return g.forEach((z,X)=>{const K=T>0?X==w?1:T*X:o[X],ie=K*N;t.currentTime=x+k.delay+ie,k.duration=ie,this._validateStyleAst(z,t),z.offset=K,r.styles.push(z)}),r}visitReference(e,t){return{type:8,animation:Fa(this,PE(e.animation),t),options:qm(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:qm(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:qm(e.options)}}visitQuery(e,t){const r=t.currentQuerySelector,i=e.options||{};t.queryCount++,t.currentQuery=e;const[s,o]=function c6(n){const e=!!n.split(/\s*,\s*/).find(t=>":self"==t);return e&&(n=n.replace(a6,"")),n=n.replace(/@\*/g,xD).replace(/@\w+/g,t=>xD+"-"+t.slice(1)).replace(/:animating/g,w1),[n,e]}(e.selector);t.currentQuerySelector=r.length?r+" "+s:s,Na(t.collectedStyles,t.currentQuerySelector,new Map);const u=Fa(this,PE(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=r,{type:11,selector:s,limit:i.limit||0,optional:!!i.optional,includeSelf:o,animation:u,originalSelector:e.selector,options:qm(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(function I8(){return new m.vHH(3013,!1)}());const r="full"===e.timings?{duration:0,delay:0,easing:"full"}:CD(e.timings,t.errors,!0);return{type:12,animation:Fa(this,PE(e.animation),t),timings:r,options:null}}}class d6{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function qm(n){return n?(n=LE(n)).params&&(n.params=function u6(n){return n?LE(n):null}(n.params)):n={},n}function C1(n,e,t){return{duration:n,delay:e,easing:t}}function R1(n,e,t,r,i,s,o=null,u=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:r,duration:i,delay:s,totalTime:i+s,easing:o,subTimeline:u}}class ND{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let r=this._map.get(e);r||this._map.set(e,r=[]),r.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const g6=new RegExp(":enter","g"),_6=new RegExp(":leave","g");function M1(n,e,t,r,i,s=new Map,o=new Map,u,d,f=[]){return(new v6).buildKeyframes(n,e,t,r,i,s,o,u,d,f)}class v6{buildKeyframes(e,t,r,i,s,o,u,d,f,g=[]){f=f||new ND;const b=new k1(e,t,f,i,s,g,[]);b.options=d;const T=d.delay?Ad(d.delay):0;b.currentTimeline.delayNextStep(T),b.currentTimeline.setStyles([o],null,b.errors,d),Fa(this,r,b);const w=b.timelines.filter(x=>x.containsAnimation());if(w.length&&u.size){let x;for(let k=w.length-1;k>=0;k--){const N=w[k];if(N.element===t){x=N;break}}x&&!x.allowOnlyTimelineStyles()&&x.setStyles([u],null,b.errors,d)}return w.length?w.map(x=>x.buildKeyframes()):[R1(t,[],[],[],0,T,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const r=t.subInstructions.get(t.element);if(r){const i=t.createSubContext(e.options),s=t.currentTimeline.currentTime,o=this._visitSubInstructions(r,i,i.options);s!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){const r=t.createSubContext(e.options);r.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,r),this.visitReference(e.animation,r),t.transformIntoNewTimeline(r.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,r){for(const i of e){const s=i?.delay;if(s){const o="number"==typeof s?s:Ad(OE(s,i?.params??{},t.errors));r.delayNextStep(o)}}}_visitSubInstructions(e,t,r){let s=t.currentTimeline.currentTime;const o=null!=r.duration?Ad(r.duration):null,u=null!=r.delay?Ad(r.delay):null;return 0!==o&&e.forEach(d=>{const f=t.appendInstructionToTimeline(d,o,u);s=Math.max(s,f.duration+f.delay)}),s}visitReference(e,t){t.updateOptions(e.options,!0),Fa(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const r=t.subContextCount;let i=t;const s=e.options;if(s&&(s.params||s.delay)&&(i=t.createSubContext(s),i.transformIntoNewTimeline(),null!=s.delay)){6==i.previousNode.type&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=FD);const o=Ad(s.delay);i.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>Fa(this,o,i)),i.currentTimeline.applyStylesToKeyframe(),i.subContextCount>r&&i.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const r=[];let i=t.currentTimeline.currentTime;const s=e.options&&e.options.delay?Ad(e.options.delay):0;e.steps.forEach(o=>{const u=t.createSubContext(e.options);s&&u.delayNextStep(s),Fa(this,o,u),i=Math.max(i,u.currentTimeline.currentTime),r.push(u.currentTimeline)}),r.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(i),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const r=e.strValue;return CD(t.params?OE(r,t.params,t.errors):r,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const r=t.currentAnimateTimings=this._visitTiming(e.timings,t),i=t.currentTimeline;r.delay&&(t.incrementTime(r.delay),i.snapshotCurrentStyles());const s=e.style;5==s.type?this.visitKeyframes(s,t):(t.incrementTime(r.duration),this.visitStyle(s,t),i.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const r=t.currentTimeline,i=t.currentAnimateTimings;!i&&r.hasCurrentStyleProperties()&&r.forwardFrame();const s=i&&i.easing||e.easing;e.isEmptyStep?r.applyEmptyStep(s):r.setStyles(e.styles,s,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const r=t.currentAnimateTimings,i=t.currentTimeline.duration,s=r.duration,u=t.createSubContext().currentTimeline;u.easing=r.easing,e.styles.forEach(d=>{u.forwardTime((d.offset||0)*s),u.setStyles(d.styles,d.easing,t.errors,t.options),u.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(u),t.transformIntoNewTimeline(i+s),t.previousNode=e}visitQuery(e,t){const r=t.currentTimeline.currentTime,i=e.options||{},s=i.delay?Ad(i.delay):0;s&&(6===t.previousNode.type||0==r&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=FD);let o=r;const u=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!i.optional,t.errors);t.currentQueryTotal=u.length;let d=null;u.forEach((f,g)=>{t.currentQueryIndex=g;const b=t.createSubContext(e.options,f);s&&b.delayNextStep(s),f===t.element&&(d=b.currentTimeline),Fa(this,e.animation,b),b.currentTimeline.applyStylesToKeyframe(),o=Math.max(o,b.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),d&&(t.currentTimeline.mergeTimelineCollectedStyles(d),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const r=t.parentContext,i=t.currentTimeline,s=e.timings,o=Math.abs(s.duration),u=o*(t.currentQueryTotal-1);let d=o*t.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":d=u-d;break;case"full":d=r.currentStaggerTime}const g=t.currentTimeline;d&&g.delayNextStep(d);const b=g.currentTime;Fa(this,e.animation,t),t.previousNode=e,r.currentStaggerTime=i.currentTime-b+(i.startTime-r.currentTimeline.startTime)}}const FD={};class k1{constructor(e,t,r,i,s,o,u,d){this._driver=e,this.element=t,this.subInstructions=r,this._enterClassName=i,this._leaveClassName=s,this.errors=o,this.timelines=u,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=FD,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=d||new UD(this._driver,t,0),u.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const r=e;let i=this.options;null!=r.duration&&(i.duration=Ad(r.duration)),null!=r.delay&&(i.delay=Ad(r.delay));const s=r.params;if(s){let o=i.params;o||(o=this.options.params={}),Object.keys(s).forEach(u=>{(!t||!o.hasOwnProperty(u))&&(o[u]=OE(s[u],o,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const r=e.params={};Object.keys(t).forEach(i=>{r[i]=t[i]})}}return e}createSubContext(e=null,t,r){const i=t||this.element,s=new k1(this._driver,i,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(i,r||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=FD,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,r){const i={duration:t??e.duration,delay:this.currentTimeline.currentTime+(r??0)+e.delay,easing:""},s=new b6(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,i,e.stretchStartingKeyframe);return this.timelines.push(s),i}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,r,i,s,o){let u=[];if(i&&u.push(this.element),e.length>0){e=(e=e.replace(g6,"."+this._enterClassName)).replace(_6,"."+this._leaveClassName);let f=this._driver.query(this.element,e,1!=r);0!==r&&(f=r<0?f.slice(f.length+r,f.length):f.slice(0,r)),u.push(...f)}return!s&&0==u.length&&o.push(function w8(n){return new m.vHH(3014,!1)}()),u}}class UD{constructor(e,t,r,i){this._driver=e,this.element=t,this.startTime=r,this._elementTimelineStylesLookup=i,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new UD(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,r]of this._globalTimelineStyles)this._backFill.set(t,r||Dd),this._currentKeyframe.set(t,Dd);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,r,i){t&&this._previousKeyframe.set("easing",t);const s=i&&i.params||{},o=function E6(n,e){const t=new Map;let r;return n.forEach(i=>{if("*"===i){r=r||e.keys();for(let s of r)t.set(s,Dd)}else Ff(i,t)}),t}(e,this._globalTimelineStyles);for(let[u,d]of o){const f=OE(d,s,r);this._pendingStyles.set(u,f),this._localTimelineStyles.has(u)||this._backFill.set(u,this._globalTimelineStyles.get(u)??Dd),this._updateStyle(u,f)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,r)=>{const i=this._styleSummary.get(r);(!i||t.time>i.time)&&this._updateStyle(r,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,r=1===this._keyframes.size&&0===this.duration;let i=[];this._keyframes.forEach((u,d)=>{const f=Ff(u,new Map,this._backFill);f.forEach((g,b)=>{g===m1?e.add(b):g===Dd&&t.add(b)}),r||f.set("offset",d/this.duration),i.push(f)});const s=e.size?RD(e.values()):[],o=t.size?RD(t.values()):[];if(r){const u=i[0],d=new Map(u);u.set("offset",0),d.set("offset",1),i=[u,d]}return R1(this.element,i,s,o,this.duration,this.startTime,this.easing,!1)}}class b6 extends UD{constructor(e,t,r,i,s,o,u=!1){super(e,t,o.delay),this.keyframes=r,this.preStyleProps=i,this.postStyleProps=s,this._stretchStartingKeyframe=u,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:r,easing:i}=this.timings;if(this._stretchStartingKeyframe&&t){const s=[],o=r+t,u=t/o,d=Ff(e[0]);d.set("offset",0),s.push(d);const f=Ff(e[0]);f.set("offset",uU(u)),s.push(f);const g=e.length-1;for(let b=1;b<=g;b++){let T=Ff(e[b]);const w=T.get("offset");T.set("offset",uU((t+w*r)/o)),s.push(T)}r=o,t=0,i="",e=s}return R1(this.element,e,this.preStyleProps,this.postStyleProps,r,t,i,!0)}}function uU(n,e=3){const t=Math.pow(10,e-1);return Math.round(n*t)/t}class L1{}const T6=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class I6 extends L1{normalizePropertyName(e,t){return A1(e)}normalizeStyleValue(e,t,r,i){let s="";const o=r.toString().trim();if(T6.has(t)&&0!==r&&"0"!==r)if("number"==typeof r)s="px";else{const u=r.match(/^[+-]?[\d\.]+([a-z]*)$/);u&&0==u[1].length&&i.push(function f8(n,e){return new m.vHH(3005,!1)}())}return o+s}}function dU(n,e,t,r,i,s,o,u,d,f,g,b,T){return{type:0,element:n,triggerName:e,isRemovalTransition:i,fromState:t,fromStyles:s,toState:r,toStyles:o,timelines:u,queriedElements:d,preStyleProps:f,postStyleProps:g,totalTime:b,errors:T}}const P1={};class hU{constructor(e,t,r){this._triggerName=e,this.ast=t,this._stateStyles=r}match(e,t,r,i){return function w6(n,e,t,r,i){return n.some(s=>s(e,t,r,i))}(this.ast.matchers,e,t,r,i)}buildStyles(e,t,r){let i=this._stateStyles.get("*");return void 0!==e&&(i=this._stateStyles.get(e?.toString())||i),i?i.buildStyles(t,r):new Map}build(e,t,r,i,s,o,u,d,f,g){const b=[],T=this.ast.options&&this.ast.options.params||P1,x=this.buildStyles(r,u&&u.params||P1,b),k=d&&d.params||P1,N=this.buildStyles(i,k,b),z=new Set,X=new Map,K=new Map,ie="void"===i,le={params:S6(k,T),delay:this.ast.options?.delay},Me=g?[]:M1(e,t,this.ast.animation,s,o,x,N,le,f,b);let Ie=0;if(Me.forEach(ot=>{Ie=Math.max(ot.duration+ot.delay,Ie)}),b.length)return dU(t,this._triggerName,r,i,ie,x,N,[],[],X,K,Ie,b);Me.forEach(ot=>{const Fe=ot.element,Jt=Na(X,Fe,new Set);ot.preStyleProps.forEach(Bn=>Jt.add(Bn));const bt=Na(K,Fe,new Set);ot.postStyleProps.forEach(Bn=>bt.add(Bn)),Fe!==t&&z.add(Fe)});const We=RD(z.values());return dU(t,this._triggerName,r,i,ie,x,N,Me,We,X,K,Ie)}}function S6(n,e){const t=LE(e);for(const r in n)n.hasOwnProperty(r)&&null!=n[r]&&(t[r]=n[r]);return t}class D6{constructor(e,t,r){this.styles=e,this.defaultParams=t,this.normalizer=r}buildStyles(e,t){const r=new Map,i=LE(this.defaultParams);return Object.keys(e).forEach(s=>{const o=e[s];null!==o&&(i[s]=o)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((o,u)=>{o&&(o=OE(o,i,t));const d=this.normalizer.normalizePropertyName(u,t);o=this.normalizer.normalizeStyleValue(u,d,o,t),r.set(u,o)})}),r}}class x6{constructor(e,t,r){this.name=e,this.ast=t,this._normalizer=r,this.transitionFactories=[],this.states=new Map,t.states.forEach(i=>{this.states.set(i.name,new D6(i.style,i.options&&i.options.params||{},r))}),fU(this.states,"true","1"),fU(this.states,"false","0"),t.transitions.forEach(i=>{this.transitionFactories.push(new hU(e,i,this.states))}),this.fallbackTransition=function C6(n,e,t){return new hU(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(o,u)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,r,i){return this.transitionFactories.find(o=>o.match(e,t,r,i))||null}matchStyles(e,t,r){return this.fallbackTransition.buildStyles(e,t,r)}}function fU(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}const R6=new ND;class M6{constructor(e,t,r){this.bodyNode=e,this._driver=t,this._normalizer=r,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){const r=[],i=[],s=x1(this._driver,t,r,i);if(r.length)throw function M8(n){return new m.vHH(3503,!1)}();this._animations.set(e,s)}_buildPlayer(e,t,r){const i=e.element,s=z2(0,this._normalizer,0,e.keyframes,t,r);return this._driver.animate(i,s,e.duration,e.delay,e.easing,[],!0)}create(e,t,r={}){const i=[],s=this._animations.get(e);let o;const u=new Map;if(s?(o=M1(this._driver,t,s,I1,DD,new Map,new Map,r,R6,i),o.forEach(g=>{const b=Na(u,g.element,new Map);g.postStyleProps.forEach(T=>b.set(T,null))})):(i.push(function k8(){return new m.vHH(3300,!1)}()),o=[]),i.length)throw function L8(n){return new m.vHH(3504,!1)}();u.forEach((g,b)=>{g.forEach((T,w)=>{g.set(w,this._driver.computeStyle(b,w,Dd))})});const f=Nf(o.map(g=>{const b=u.get(g.element);return this._buildPlayer(g,new Map,b)}));return this._playersById.set(e,f),f.onDestroy(()=>this.destroy(e)),this.players.push(f),f}destroy(e){const t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);const r=this.players.indexOf(t);r>=0&&this.players.splice(r,1)}_getPlayer(e){const t=this._playersById.get(e);if(!t)throw function P8(n){return new m.vHH(3301,!1)}();return t}listen(e,t,r,i){const s=v1(t,"","","");return y1(this._getPlayer(e),r,s,i),()=>{}}command(e,t,r,i){if("register"==r)return void this.register(e,i[0]);if("create"==r)return void this.create(e,t,i[0]||{});const s=this._getPlayer(e);switch(r){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(i[0]));break;case"destroy":this.destroy(e)}}}const pU="ng-animate-queued",O1="ng-animate-disabled",N6=[],mU={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},F6={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},pl="__ng_removed";class N1{get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;const r=e&&e.hasOwnProperty("value");if(this.value=function $6(n){return n??null}(r?e.value:e),r){const s=LE(e);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){const t=e.params;if(t){const r=this.options.params;Object.keys(t).forEach(i=>{null==r[i]&&(r[i]=t[i])})}}}const NE="void",F1=new N1(NE);class U6{constructor(e,t,r){this.id=e,this.hostElement=t,this._engine=r,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,ml(t,this._hostClassName)}listen(e,t,r,i){if(!this._triggers.has(t))throw function O8(n,e){return new m.vHH(3302,!1)}();if(null==r||0==r.length)throw function N8(n){return new m.vHH(3303,!1)}();if(!function G6(n){return"start"==n||"done"==n}(r))throw function F8(n,e){return new m.vHH(3400,!1)}();const s=Na(this._elementListeners,e,[]),o={name:t,phase:r,callback:i};s.push(o);const u=Na(this._engine.statesByElement,e,new Map);return u.has(t)||(ml(e,AD),ml(e,AD+"-"+t),u.set(t,F1)),()=>{this._engine.afterFlush(()=>{const d=s.indexOf(o);d>=0&&s.splice(d,1),this._triggers.has(t)||u.delete(t)})}}register(e,t){return!this._triggers.has(e)&&(this._triggers.set(e,t),!0)}_getTrigger(e){const t=this._triggers.get(e);if(!t)throw function U8(n){return new m.vHH(3401,!1)}();return t}trigger(e,t,r,i=!0){const s=this._getTrigger(t),o=new U1(this.id,t,e);let u=this._engine.statesByElement.get(e);u||(ml(e,AD),ml(e,AD+"-"+t),this._engine.statesByElement.set(e,u=new Map));let d=u.get(t);const f=new N1(r,this.id);if(!(r&&r.hasOwnProperty("value"))&&d&&f.absorbOptions(d.options),u.set(t,f),d||(d=F1),f.value!==NE&&d.value===f.value){if(!function z6(n,e){const t=Object.keys(n),r=Object.keys(e);if(t.length!=r.length)return!1;for(let i=0;i<t.length;i++){const s=t[i];if(!e.hasOwnProperty(s)||n[s]!==e[s])return!1}return!0}(d.params,f.params)){const k=[],N=s.matchStyles(d.value,d.params,k),z=s.matchStyles(f.value,f.params,k);k.length?this._engine.reportError(k):this._engine.afterFlush(()=>{Km(e,N),fu(e,z)})}return}const T=Na(this._engine.playersByElement,e,[]);T.forEach(k=>{k.namespaceId==this.id&&k.triggerName==t&&k.queued&&k.destroy()});let w=s.matchTransition(d.value,f.value,e,f.params),x=!1;if(!w){if(!i)return;w=s.fallbackTransition,x=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:w,fromState:d,toState:f,player:o,isFallbackTransition:x}),x||(ml(e,pU),o.onStart(()=>{U0(e,pU)})),o.onDone(()=>{let k=this.players.indexOf(o);k>=0&&this.players.splice(k,1);const N=this._engine.playersByElement.get(e);if(N){let z=N.indexOf(o);z>=0&&N.splice(z,1)}}),this.players.push(o),T.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,r)=>{this._elementListeners.set(r,t.filter(i=>i.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(r=>r.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const r=this._engine.driver.query(e,xD,!0);r.forEach(i=>{if(i[pl])return;const s=this._engine.fetchNamespacesByElement(i);s.size?s.forEach(o=>o.triggerLeaveAnimation(i,t,!1,!0)):this.clearElementCache(i)}),this._engine.afterFlushAnimationsDone(()=>r.forEach(i=>this.clearElementCache(i)))}triggerLeaveAnimation(e,t,r,i){const s=this._engine.statesByElement.get(e),o=new Map;if(s){const u=[];if(s.forEach((d,f)=>{if(o.set(f,d.value),this._triggers.has(f)){const g=this.trigger(e,f,NE,i);g&&u.push(g)}}),u.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),r&&Nf(u).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),r=this._engine.statesByElement.get(e);if(t&&r){const i=new Set;t.forEach(s=>{const o=s.name;if(i.has(o))return;i.add(o);const d=this._triggers.get(o).fallbackTransition,f=r.get(o)||F1,g=new N1(NE),b=new U1(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:d,fromState:f,toState:g,player:b,isFallbackTransition:!0})})}}removeNode(e,t){const r=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let i=!1;if(r.totalAnimations){const s=r.players.length?r.playersByQueriedElement.get(e):[];if(s&&s.length)i=!0;else{let o=e;for(;o=o.parentNode;)if(r.statesByElement.get(o)){i=!0;break}}}if(this.prepareLeaveAnimationListeners(e),i)r.markElementAsRemoved(this.id,e,!1,t);else{const s=e[pl];(!s||s===mU)&&(r.afterFlush(()=>this.clearElementCache(e)),r.destroyInnerAnimations(e),r._onRemovalComplete(e,t))}}insertNode(e,t){ml(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(r=>{const i=r.player;if(i.destroyed)return;const s=r.element,o=this._elementListeners.get(s);o&&o.forEach(u=>{if(u.name==r.triggerName){const d=v1(s,r.triggerName,r.fromState.value,r.toState.value);d._data=e,y1(r.player,u.phase,d,u.callback)}}),i.markedForDestroy?this._engine.afterFlush(()=>{i.destroy()}):t.push(r)}),this._queue=[],t.sort((r,i)=>{const s=r.transition.ast.depCount,o=i.transition.ast.depCount;return 0==s||0==o?s-o:this._engine.driver.containsElement(r.element,i.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(r=>r.element===e)||t,t}}class B6{_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,r){this.bodyNode=e,this.driver=t,this._normalizer=r,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(i,s)=>{}}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(r=>{r.queued&&e.push(r)})}),e}createNamespace(e,t){const r=new U6(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(r,t):(this.newHostElements.set(t,r),this.collectEnterElement(t)),this._namespaceLookup[e]=r}_balanceNamespaceList(e,t){const r=this._namespaceList,i=this.namespacesByHostElement;if(r.length-1>=0){let o=!1,u=this.driver.getParentElement(t);for(;u;){const d=i.get(u);if(d){const f=r.indexOf(d);r.splice(f+1,0,e),o=!0;break}u=this.driver.getParentElement(u)}o||r.unshift(e)}else r.push(e);return i.set(t,e),e}register(e,t){let r=this._namespaceLookup[e];return r||(r=this.createNamespace(e,t)),r}registerTrigger(e,t,r){let i=this._namespaceLookup[e];i&&i.register(t,r)&&this.totalAnimations++}destroy(e,t){if(!e)return;const r=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(r.hostElement),delete this._namespaceLookup[e];const i=this._namespaceList.indexOf(r);i>=0&&this._namespaceList.splice(i,1)}),this.afterFlushAnimationsDone(()=>r.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,r=this.statesByElement.get(e);if(r)for(let i of r.values())if(i.namespaceId){const s=this._fetchNamespace(i.namespaceId);s&&t.add(s)}return t}trigger(e,t,r,i){if(BD(t)){const s=this._fetchNamespace(e);if(s)return s.trigger(t,r,i),!0}return!1}insertNode(e,t,r,i){if(!BD(t))return;const s=t[pl];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){const o=this._fetchNamespace(e);o&&o.insertNode(t,r)}i&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),ml(e,O1)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),U0(e,O1))}removeNode(e,t,r,i){if(BD(t)){const s=e?this._fetchNamespace(e):null;if(s?s.removeNode(t,i):this.markElementAsRemoved(e,t,!1,i),r){const o=this.namespacesByHostElement.get(t);o&&o.id!==e&&o.removeNode(t,i)}}else this._onRemovalComplete(t,i)}markElementAsRemoved(e,t,r,i,s){this.collectedLeaveElements.push(t),t[pl]={namespaceId:e,setForRemoval:i,hasAnimation:r,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,t,r,i,s){return BD(t)?this._fetchNamespace(e).listen(t,r,i,s):()=>{}}_buildInstruction(e,t,r,i,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,r,i,e.fromState.options,e.toState.options,t,s)}destroyInnerAnimations(e){let t=this.driver.query(e,xD,!0);t.forEach(r=>this.destroyActiveAnimationsForElement(r)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,w1,!0),t.forEach(r=>this.finishActiveQueriedAnimationOnElement(r)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(r=>{r.queued?r.markedForDestroy=!0:r.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(r=>r.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Nf(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[pl];if(t&&t.setForRemoval){if(e[pl]=mU,t.namespaceId){this.destroyInnerAnimations(e);const r=this._fetchNamespace(t.namespaceId);r&&r.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(O1)&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((r,i)=>this._balanceNamespaceList(r,i)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let r=0;r<this.collectedEnterElements.length;r++)ml(this.collectedEnterElements[r],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const r=[];try{t=this._flushAnimations(r,e)}finally{for(let i=0;i<r.length;i++)r[i]()}}else for(let r=0;r<this.collectedLeaveElements.length;r++)this.processLeaveNode(this.collectedLeaveElements[r]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(r=>r()),this._flushFns=[],this._whenQuietFns.length){const r=this._whenQuietFns;this._whenQuietFns=[],t.length?Nf(t).onDone(()=>{r.forEach(i=>i())}):r.forEach(i=>i())}}reportError(e){throw function B8(n){return new m.vHH(3402,!1)}()}_flushAnimations(e,t){const r=new ND,i=[],s=new Map,o=[],u=new Map,d=new Map,f=new Map,g=new Set;this.disabledNodes.forEach(dt=>{g.add(dt);const yt=this.driver.query(dt,".ng-animate-queued",!0);for(let He=0;He<yt.length;He++)g.add(yt[He])});const b=this.bodyNode,T=Array.from(this.statesByElement.keys()),w=_U(T,this.collectedEnterElements),x=new Map;let k=0;w.forEach((dt,yt)=>{const He=I1+k++;x.set(yt,He),dt.forEach(ft=>ml(ft,He))});const N=[],z=new Set,X=new Set;for(let dt=0;dt<this.collectedLeaveElements.length;dt++){const yt=this.collectedLeaveElements[dt],He=yt[pl];He&&He.setForRemoval&&(N.push(yt),z.add(yt),He.hasAnimation?this.driver.query(yt,".ng-star-inserted",!0).forEach(ft=>z.add(ft)):X.add(yt))}const K=new Map,ie=_U(T,Array.from(z));ie.forEach((dt,yt)=>{const He=DD+k++;K.set(yt,He),dt.forEach(ft=>ml(ft,He))}),e.push(()=>{w.forEach((dt,yt)=>{const He=x.get(yt);dt.forEach(ft=>U0(ft,He))}),ie.forEach((dt,yt)=>{const He=K.get(yt);dt.forEach(ft=>U0(ft,He))}),N.forEach(dt=>{this.processLeaveNode(dt)})});const le=[],Me=[];for(let dt=this._namespaceList.length-1;dt>=0;dt--)this._namespaceList[dt].drainQueuedTransitions(t).forEach(He=>{const ft=He.player,In=He.element;if(le.push(ft),this.collectedEnterElements.length){const ei=In[pl];if(ei&&ei.setForMove){if(ei.previousTriggersValues&&ei.previousTriggersValues.has(He.triggerName)){const lc=ei.previousTriggersValues.get(He.triggerName),gl=this.statesByElement.get(He.element);if(gl&&gl.has(He.triggerName)){const sA=gl.get(He.triggerName);sA.value=lc,gl.set(He.triggerName,sA)}}return void ft.destroy()}}const Gn=!b||!this.driver.containsElement(b,In),Sn=K.get(In),_r=x.get(In),Hn=this._buildInstruction(He,r,_r,Sn,Gn);if(Hn.errors&&Hn.errors.length)return void Me.push(Hn);if(Gn)return ft.onStart(()=>Km(In,Hn.fromStyles)),ft.onDestroy(()=>fu(In,Hn.toStyles)),void i.push(ft);if(He.isFallbackTransition)return ft.onStart(()=>Km(In,Hn.fromStyles)),ft.onDestroy(()=>fu(In,Hn.toStyles)),void i.push(ft);const ea=[];Hn.timelines.forEach(ei=>{ei.stretchStartingKeyframe=!0,this.disabledNodes.has(ei.element)||ea.push(ei)}),Hn.timelines=ea,r.append(In,Hn.timelines),o.push({instruction:Hn,player:ft,element:In}),Hn.queriedElements.forEach(ei=>Na(u,ei,[]).push(ft)),Hn.preStyleProps.forEach((ei,lc)=>{if(ei.size){let gl=d.get(lc);gl||d.set(lc,gl=new Set),ei.forEach((sA,Rk)=>gl.add(Rk))}}),Hn.postStyleProps.forEach((ei,lc)=>{let gl=f.get(lc);gl||f.set(lc,gl=new Set),ei.forEach((sA,Rk)=>gl.add(Rk))})});if(Me.length){const dt=[];Me.forEach(yt=>{dt.push(function V8(n,e){return new m.vHH(3505,!1)}())}),le.forEach(yt=>yt.destroy()),this.reportError(dt)}const Ie=new Map,We=new Map;o.forEach(dt=>{const yt=dt.element;r.has(yt)&&(We.set(yt,yt),this._beforeAnimationBuild(dt.player.namespaceId,dt.instruction,Ie))}),i.forEach(dt=>{const yt=dt.element;this._getPreviousPlayers(yt,!1,dt.namespaceId,dt.triggerName,null).forEach(ft=>{Na(Ie,yt,[]).push(ft),ft.destroy()})});const ot=N.filter(dt=>bU(dt,d,f)),Fe=new Map;yU(Fe,this.driver,X,f,Dd).forEach(dt=>{bU(dt,d,f)&&ot.push(dt)});const bt=new Map;w.forEach((dt,yt)=>{yU(bt,this.driver,new Set(dt),d,m1)}),ot.forEach(dt=>{const yt=Fe.get(dt),He=bt.get(dt);Fe.set(dt,new Map([...Array.from(yt?.entries()??[]),...Array.from(He?.entries()??[])]))});const Bn=[],Li=[],gr={};o.forEach(dt=>{const{element:yt,player:He,instruction:ft}=dt;if(r.has(yt)){if(g.has(yt))return He.onDestroy(()=>fu(yt,ft.toStyles)),He.disabled=!0,He.overrideTotalTime(ft.totalTime),void i.push(He);let In=gr;if(We.size>1){let Sn=yt;const _r=[];for(;Sn=Sn.parentNode;){const Hn=We.get(Sn);if(Hn){In=Hn;break}_r.push(Sn)}_r.forEach(Hn=>We.set(Hn,In))}const Gn=this._buildAnimation(He.namespaceId,ft,Ie,s,bt,Fe);if(He.setRealPlayer(Gn),In===gr)Bn.push(He);else{const Sn=this.playersByElement.get(In);Sn&&Sn.length&&(He.parentPlayer=Nf(Sn)),i.push(He)}}else Km(yt,ft.fromStyles),He.onDestroy(()=>fu(yt,ft.toStyles)),Li.push(He),g.has(yt)&&i.push(He)}),Li.forEach(dt=>{const yt=s.get(dt.element);if(yt&&yt.length){const He=Nf(yt);dt.setRealPlayer(He)}}),i.forEach(dt=>{dt.parentPlayer?dt.syncPlayerEvents(dt.parentPlayer):dt.destroy()});for(let dt=0;dt<N.length;dt++){const yt=N[dt],He=yt[pl];if(U0(yt,DD),He&&He.hasAnimation)continue;let ft=[];if(u.size){let Gn=u.get(yt);Gn&&Gn.length&&ft.push(...Gn);let Sn=this.driver.query(yt,w1,!0);for(let _r=0;_r<Sn.length;_r++){let Hn=u.get(Sn[_r]);Hn&&Hn.length&&ft.push(...Hn)}}const In=ft.filter(Gn=>!Gn.destroyed);In.length?H6(this,yt,In):this.processLeaveNode(yt)}return N.length=0,Bn.forEach(dt=>{this.players.push(dt),dt.onDone(()=>{dt.destroy();const yt=this.players.indexOf(dt);this.players.splice(yt,1)}),dt.play()}),Bn}elementContainsData(e,t){let r=!1;const i=t[pl];return i&&i.setForRemoval&&(r=!0),this.playersByElement.has(t)&&(r=!0),this.playersByQueriedElement.has(t)&&(r=!0),this.statesByElement.has(t)&&(r=!0),this._fetchNamespace(e).elementContainsData(t)||r}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,r,i,s){let o=[];if(t){const u=this.playersByQueriedElement.get(e);u&&(o=u)}else{const u=this.playersByElement.get(e);if(u){const d=!s||s==NE;u.forEach(f=>{f.queued||!d&&f.triggerName!=i||o.push(f)})}}return(r||i)&&(o=o.filter(u=>!(r&&r!=u.namespaceId||i&&i!=u.triggerName))),o}_beforeAnimationBuild(e,t,r){const s=t.element,o=t.isRemovalTransition?void 0:e,u=t.isRemovalTransition?void 0:t.triggerName;for(const d of t.timelines){const f=d.element,g=f!==s,b=Na(r,f,[]);this._getPreviousPlayers(f,g,o,u,t.toState).forEach(w=>{const x=w.getRealPlayer();x.beforeDestroy&&x.beforeDestroy(),w.destroy(),b.push(w)})}Km(s,t.fromStyles)}_buildAnimation(e,t,r,i,s,o){const u=t.triggerName,d=t.element,f=[],g=new Set,b=new Set,T=t.timelines.map(x=>{const k=x.element;g.add(k);const N=k[pl];if(N&&N.removedBeforeQueried)return new kE(x.duration,x.delay);const z=k!==d,X=function j6(n){const e=[];return vU(n,e),e}((r.get(k)||N6).map(Ie=>Ie.getRealPlayer())).filter(Ie=>!!Ie.element&&Ie.element===k),K=s.get(k),ie=o.get(k),le=z2(0,this._normalizer,0,x.keyframes,K,ie),Me=this._buildPlayer(x,le,X);if(x.subTimeline&&i&&b.add(k),z){const Ie=new U1(e,u,k);Ie.setRealPlayer(Me),f.push(Ie)}return Me});f.forEach(x=>{Na(this.playersByQueriedElement,x.element,[]).push(x),x.onDone(()=>function V6(n,e,t){let r=n.get(e);if(r){if(r.length){const i=r.indexOf(t);r.splice(i,1)}0==r.length&&n.delete(e)}return r}(this.playersByQueriedElement,x.element,x))}),g.forEach(x=>ml(x,eU));const w=Nf(T);return w.onDestroy(()=>{g.forEach(x=>U0(x,eU)),fu(d,t.toStyles)}),b.forEach(x=>{Na(i,x,[]).push(w)}),w}_buildPlayer(e,t,r){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,r):new kE(e.duration,e.delay)}}class U1{constructor(e,t,r){this.namespaceId=e,this.triggerName=t,this.element=r,this._player=new kE,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,r)=>{t.forEach(i=>y1(e,r,void 0,i))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){Na(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function BD(n){return n&&1===n.nodeType}function gU(n,e){const t=n.style.display;return n.style.display=e??"none",t}function yU(n,e,t,r,i){const s=[];t.forEach(d=>s.push(gU(d)));const o=[];r.forEach((d,f)=>{const g=new Map;d.forEach(b=>{const T=e.computeStyle(f,b,i);g.set(b,T),(!T||0==T.length)&&(f[pl]=F6,o.push(f))}),n.set(f,g)});let u=0;return t.forEach(d=>gU(d,s[u++])),o}function _U(n,e){const t=new Map;if(n.forEach(u=>t.set(u,[])),0==e.length)return t;const r=1,i=new Set(e),s=new Map;function o(u){if(!u)return r;let d=s.get(u);if(d)return d;const f=u.parentNode;return d=t.has(f)?f:i.has(f)?r:o(f),s.set(u,d),d}return e.forEach(u=>{const d=o(u);d!==r&&t.get(d).push(u)}),t}function ml(n,e){n.classList?.add(e)}function U0(n,e){n.classList?.remove(e)}function H6(n,e,t){Nf(t).onDone(()=>n.processLeaveNode(e))}function vU(n,e){for(let t=0;t<n.length;t++){const r=n[t];r instanceof H2?vU(r.players,e):e.push(r)}}function bU(n,e,t){const r=t.get(n);if(!r)return!1;let i=e.get(n);return i?r.forEach(s=>i.add(s)):e.set(n,r),t.delete(n),!0}class VD{constructor(e,t,r){this.bodyNode=e,this._driver=t,this._normalizer=r,this._triggerCache={},this.onRemovalComplete=(i,s)=>{},this._transitionEngine=new B6(e,t,r),this._timelineEngine=new M6(e,t,r),this._transitionEngine.onRemovalComplete=(i,s)=>this.onRemovalComplete(i,s)}registerTrigger(e,t,r,i,s){const o=e+"-"+i;let u=this._triggerCache[o];if(!u){const d=[],f=[],g=x1(this._driver,s,d,f);if(d.length)throw function C8(n,e){return new m.vHH(3404,!1)}();u=function A6(n,e,t){return new x6(n,e,t)}(i,g,this._normalizer),this._triggerCache[o]=u}this._transitionEngine.registerTrigger(t,i,u)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,r,i){this._transitionEngine.insertNode(e,t,r,i)}onRemove(e,t,r,i){this._transitionEngine.removeNode(e,t,i||!1,r)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,r,i){if("@"==r.charAt(0)){const[s,o]=W2(r);this._timelineEngine.command(s,t,o,i)}else this._transitionEngine.trigger(e,t,r,i)}listen(e,t,r,i,s){if("@"==r.charAt(0)){const[o,u]=W2(r);return this._timelineEngine.listen(o,t,u,s)}return this._transitionEngine.listen(e,t,r,i,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let K6=(()=>{class n{constructor(t,r,i){this._element=t,this._startStyles=r,this._endStyles=i,this._state=0;let s=n.initialStylesByElement.get(t);s||n.initialStylesByElement.set(t,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&fu(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(fu(this._element,this._initialStyles),this._endStyles&&(fu(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(Km(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Km(this._element,this._endStyles),this._endStyles=null),fu(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function B1(n){let e=null;return n.forEach((t,r)=>{(function q6(n){return"display"===n||"position"===n})(r)&&(e=e||new Map,e.set(r,t))}),e}class EU{constructor(e,t,r,i){this.element=e,this.keyframes=t,this.options=r,this._specialStyles=i,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=r.duration,this._delay=r.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){const t=[];return e.forEach(r=>{t.push(Object.fromEntries(r))}),t}_triggerWebAnimation(e,t,r){return e.animate(this._convertKeyframesToObject(t),r)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((r,i)=>{"offset"!==i&&e.set(i,this._finished?r:oU(this.element,i))}),this.currentSnapshot=e}triggerCallback(e){const t="start"===e?this._onStartFns:this._onDoneFns;t.forEach(r=>r()),t.length=0}}class Y6{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,t){return!1}containsElement(e,t){return Z2(e,t)}getParentElement(e){return E1(e)}query(e,t,r){return Q2(e,t,r)}computeStyle(e,t,r){return window.getComputedStyle(e)[t]}animate(e,t,r,i,s,o=[]){const d={duration:r,delay:i,fill:0==i?"both":"forwards"};s&&(d.easing=s);const f=new Map,g=o.filter(w=>w instanceof EU);(function J8(n,e){return 0===n||0===e})(r,i)&&g.forEach(w=>{w.currentSnapshot.forEach((x,k)=>f.set(k,x))});let b=function Y8(n){return n.length?n[0]instanceof Map?n:n.map(e=>tU(e)):[]}(t).map(w=>Ff(w));b=function e6(n,e,t){if(t.size&&e.length){let r=e[0],i=[];if(t.forEach((s,o)=>{r.has(o)||i.push(o),r.set(o,s)}),i.length)for(let s=1;s<e.length;s++){let o=e[s];i.forEach(u=>o.set(u,oU(n,u)))}}return e}(e,b,f);const T=function W6(n,e){let t=null,r=null;return Array.isArray(e)&&e.length?(t=B1(e[0]),e.length>1&&(r=B1(e[e.length-1]))):e instanceof Map&&(t=B1(e)),t||r?new K6(n,t,r):null}(e,b);return new EU(e,b,d,T)}}let Z6=(()=>{class n extends B2{constructor(t,r){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(r.body,{id:"0",encapsulation:m.ifc.None,styles:[],data:{animation:[]}})}build(t){const r=this._nextAnimationId.toString();this._nextAnimationId++;const i=Array.isArray(t)?V2(t):t;return TU(this._renderer,null,r,"register",[i]),new Q6(r,this._renderer)}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(m.FYo),m.LFG(me))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})();class Q6 extends a8{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new X6(this._id,e,t||{},this._renderer)}}class X6{constructor(e,t,r,i){this.id=e,this.element=t,this._renderer=i,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",r)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return TU(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function TU(n,e,t,r,i){return n.setProperty(e,`@@${t}:${r}`,i)}const IU="@.disabled";let J6=(()=>{class n{constructor(t,r,i){this.delegate=t,this.engine=r,this._zone=i,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),r.onRemovalComplete=(s,o)=>{const u=o?.parentNode(s);u&&o.removeChild(u,s)}}createRenderer(t,r){const s=this.delegate.createRenderer(t,r);if(!(t&&r&&r.data&&r.data.animation)){let g=this._rendererCache.get(s);return g||(g=new wU("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,g)),g}const o=r.id,u=r.id+"-"+this._currentId;this._currentId++,this.engine.register(u,t);const d=g=>{Array.isArray(g)?g.forEach(d):this.engine.registerTrigger(o,u,t,g.name,g)};return r.data.animation.forEach(d),new ez(this,u,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,r,i){t>=0&&t<this._microtaskId?this._zone.run(()=>r(i)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[o,u]=s;o(u)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([r,i]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(m.FYo),m.LFG(VD),m.LFG(m.R0b))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})();class wU{constructor(e,t,r,i){this.namespaceId=e,this.delegate=t,this.engine=r,this._onDestroy=i,this.destroyNode=this.delegate.destroyNode?s=>t.destroyNode(s):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,r,i=!0){this.delegate.insertBefore(e,t,r),this.engine.onInsert(this.namespaceId,t,e,i)}removeChild(e,t,r){this.engine.onRemove(this.namespaceId,t,this.delegate,r)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,r,i){this.delegate.setAttribute(e,t,r,i)}removeAttribute(e,t,r){this.delegate.removeAttribute(e,t,r)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,r,i){this.delegate.setStyle(e,t,r,i)}removeStyle(e,t,r){this.delegate.removeStyle(e,t,r)}setProperty(e,t,r){"@"==t.charAt(0)&&t==IU?this.disableAnimations(e,!!r):this.delegate.setProperty(e,t,r)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,r){return this.delegate.listen(e,t,r)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class ez extends wU{constructor(e,t,r,i,s){super(t,r,i,s),this.factory=e,this.namespaceId=t}setProperty(e,t,r){"@"==t.charAt(0)?"."==t.charAt(1)&&t==IU?this.disableAnimations(e,r=void 0===r||!!r):this.engine.process(this.namespaceId,e,t.slice(1),r):this.delegate.setProperty(e,t,r)}listen(e,t,r){if("@"==t.charAt(0)){const i=function tz(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(e);let s=t.slice(1),o="";return"@"!=s.charAt(0)&&([s,o]=function nz(n){const e=n.indexOf(".");return[n.substring(0,e),n.slice(e+1)]}(s)),this.engine.listen(this.namespaceId,i,s,o,u=>{this.factory.scheduleListenerCallback(u._data||-1,r,u)})}return this.delegate.listen(e,t,r)}}let rz=(()=>{class n extends VD{constructor(t,r,i,s){super(t.body,r,i)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(t){return new(t||n)(m.LFG(me),m.LFG(T1),m.LFG(L1),m.LFG(m.z2F))},n.\u0275prov=m.Yz7({token:n,factory:n.\u0275fac}),n})();const SU=[{provide:B2,useClass:Z6},{provide:L1,useFactory:function iz(){return new I6}},{provide:VD,useClass:rz},{provide:m.FYo,useFactory:function sz(n,e,t){return new J6(n,e,t)},deps:[os,VD,m.R0b]}],V1=[{provide:T1,useFactory:()=>new Y6},{provide:m.QbO,useValue:"BrowserAnimations"},...SU],DU=[{provide:T1,useClass:X2},{provide:m.QbO,useValue:"NoopAnimations"},...SU];let oz=(()=>{class n{static withConfig(t){return{ngModule:n,providers:t.disableAnimations?DU:V1}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({providers:V1,imports:[ho]}),n})();const V0=new m.OlP("CallSetDisabledState",{providedIn:"root",factory:()=>KD}),KD="always";let fB=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({}),n})(),l5=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({imports:[fB]}),n})(),u5=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:V0,useValue:t.callSetDisabledState??KD}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({imports:[l5]}),n})();class lk{constructor(e){return e}}class XD{constructor(){return(0,Mn.vb)("auth")}}const ck=new m.OlP("angularfire2.auth-instances");function h5(n){return(e,t)=>{const r=e.runOutsideAngular(()=>n(t));return new lk(r)}}const f5={provide:XD,deps:[[new m.FiY,ck]]},p5={provide:lk,useFactory:function d5(n,e){const t=(0,Mn.JM)("auth",n,e);return t&&new lk(t)},deps:[[new m.FiY,ck],Of]};let m5=(()=>{class n{constructor(){(0,sc.KN)("angularfire",Mn.q4.full,"auth")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({providers:[p5,f5]}),n})();function g5(n,...e){return{ngModule:m5,providers:[{provide:ck,useFactory:h5(n),multi:!0,deps:[m.R0b,m.zs3,Mn.HU,TE,[new m.FiY,$m],...e]}]}}const y5=(0,Mn.u3)(hF.o,!0);class uk{constructor(e){return e}}const kB="firestore",dk=new m.OlP("angularfire2.firestore-instances");function b5(n){return(e,t)=>{const r=e.runOutsideAngular(()=>n(t));return new uk(r)}}const E5={provide:class _5{constructor(){return(0,Mn.vb)(kB)}},deps:[[new m.FiY,dk]]},T5={provide:uk,useFactory:function v5(n,e){const t=(0,Mn.JM)(kB,n,e);return t&&new uk(t)},deps:[[new m.FiY,dk],Of]};let I5=(()=>{class n{constructor(){(0,sc.KN)("angularfire",Mn.q4.full,"fst")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({providers:[T5,E5]}),n})();function w5(n,...e){return{ngModule:I5,providers:[{provide:dk,useFactory:b5(n),multi:!0,deps:[m.R0b,m.zs3,Mn.HU,TE,[new m.FiY,XD],[new m.FiY,$m],...e]}]}}const S5=(0,Mn.u3)(CH,!0),PB="firebasestorage.googleapis.com",OB="storageBucket";class pi extends Rn.ZR{constructor(e,t,r=0){super(hk(e),`Firebase Storage: ${t} (${hk(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,pi.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return hk(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.message=this.customData.serverResponse?`${this._baseMessage}\n${this.customData.serverResponse}`:this._baseMessage}}var Cr=(()=>(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Cr||(Cr={})),Cr))();function hk(n){return"storage/"+n}function pk(n){return new pi(Cr.INVALID_ARGUMENT,n)}function BB(){return new pi(Cr.APP_DELETED,"The Firebase app was deleted.")}class So{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=So.makeFromUrl(e,t)}catch{return new So(e,"")}if(""===r.path)return r;throw function O5(n){return new pi(Cr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}(e)}static makeFromUrl(e,t){let r=null;const i="([A-Za-z0-9.\\-_]+)",u=new RegExp("^gs://"+i+"(/(.*))?$","i");function f(ie){ie.path_=decodeURIComponent(ie.path)}const b=t.replace(/[.]/g,"\\."),K=[{regex:u,indices:{bucket:1,path:3},postModify:function s(ie){"/"===ie.path.charAt(ie.path.length-1)&&(ie.path_=ie.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${b}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:f},{regex:new RegExp(`^https?://${t===PB?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:f}];for(let ie=0;ie<K.length;ie++){const le=K[ie],Me=le.regex.exec(e);if(Me){let We=Me[le.indices.path];We||(We=""),r=new So(Me[le.indices.bucket],We),le.postModify(r);break}}if(null==r)throw function P5(n){return new pi(Cr.INVALID_URL,"Invalid URL '"+n+"'.")}(e);return r}}class $5{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function gk(n,e,t,r){if(r<e)throw pk(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw pk(`Invalid value for '${n}'. Expected ${t} or less.`)}var $f=(()=>(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"}($f||($f={})),$f))();class K5{constructor(e,t,r,i,s,o,u,d,f,g,b,T=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=u,this.errorCallback_=d,this.timeout_=f,this.progressCallback_=g,this.connectionFactory_=b,this.retry=T,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((w,x)=>{this.resolve_=w,this.reject_=x,this.start_()})}start_(){const t=(r,i)=>{const s=this.resolve_,o=this.reject_,u=i.connection;if(i.wasSuccessCode)try{const d=this.callback_(u,u.getResponse());!function j5(n){return void 0!==n}(d)?s():s(d)}catch(d){o(d)}else if(null!==u){const d=function fk(){return new pi(Cr.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}();d.serverResponse=u.getErrorText(),o(this.errorCallback_?this.errorCallback_(u,d):d)}else o(i.canceled?this.appDelete_?BB():function FB(){return new pi(Cr.CANCELED,"User canceled the upload/download.")}():function NB(){return new pi(Cr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}())};this.canceled_?t(0,new eA(!1,null,!0)):this.backoffId_=function G5(n,e,t){let r=1,i=null,s=null,o=!1,u=0;function d(){return 2===u}let f=!1;function g(...N){f||(f=!0,e.apply(null,N))}function b(N){i=setTimeout(()=>{i=null,n(w,d())},N)}function T(){s&&clearTimeout(s)}function w(N,...z){if(f)return void T();if(N)return T(),void g.call(null,N,...z);if(d()||o)return T(),void g.call(null,N,...z);let K;r<64&&(r*=2),1===u?(u=2,K=0):K=1e3*(r+Math.random()),b(K)}let x=!1;function k(N){x||(x=!0,T(),!f&&(null!==i?(N||(u=2),clearTimeout(i),b(0)):N||(u=1)))}return b(0),s=setTimeout(()=>{o=!0,k(!0)},t),k}((r,i)=>{if(i)return void r(!1,new eA(!1,null,!0));const s=this.connectionFactory_();this.pendingConnection_=s;const o=u=>{null!==this.progressCallback_&&this.progressCallback_(u.loaded,u.lengthComputable?u.total:-1)};null!==this.progressCallback_&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&s.removeUploadProgressListener(o),this.pendingConnection_=null;const u=s.getErrorCode()===$f.NO_ERROR,d=s.getStatus();if(!u||function GB(n,e){const t=n>=500&&n<600,i=-1!==[408,429].indexOf(n),s=-1!==e.indexOf(n);return t||i||s}(d,this.additionalRetryCodes_)&&this.retry){const g=s.getErrorCode()===$f.ABORT;return void r(!1,new eA(!1,null,g))}const f=-1!==this.successCodes_.indexOf(d);r(!0,new eA(f,s))})},t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function H5(n){n(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class eA{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}class Qm{constructor(e,t){this._service=e,this._location=t instanceof So?t:So.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Qm(e,t)}get root(){const e=new So(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function KB(n){const e=n.lastIndexOf("/",n.length-2);return-1===e?n:n.slice(e+1)}(this._location.path)}get storage(){return this._service}get parent(){const e=function aW(n){if(0===n.length)return null;const e=n.lastIndexOf("/");return-1===e?"":n.slice(0,e)}(this._location.path);if(null===e)return null;const t=new So(this._location.bucket,e);return new Qm(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function V5(n){return new pi(Cr.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function lV(n,e){const t=e?.[OB];return null==t?null:So.makeFromBucketSpec(t,n)}class Tk{constructor(e,t,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=PB,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?So.makeFromBucketSpec(i,this._host):lV(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._bucket=null!=this._url?So.makeFromBucketSpec(this._url,e):lV(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){gk("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){gk("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){var e=this;return(0,xe.Z)(function*(){if(e._overrideAuthToken)return e._overrideAuthToken;const t=e._authProvider.getImmediate({optional:!0});if(t){const r=yield t.getToken();if(null!==r)return r.accessToken}return null})()}_getAppCheckToken(){var e=this;return(0,xe.Z)(function*(){const t=e._appCheckProvider.getImmediate({optional:!0});return t?(yield t.getToken()).token:null})()}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Qm(this,e)}_makeRequest(e,t,r,i,s=!0){if(this._deleted)return new $5(BB());{const o=function X5(n,e,t,r,i,s,o=!0){const u=function $B(n){const e=encodeURIComponent;let t="?";for(const r in n)n.hasOwnProperty(r)&&(t=t+(e(r)+"=")+e(n[r])+"&");return t=t.slice(0,-1),t}(n.urlParams),d=n.url+u,f=Object.assign({},n.headers);return function Z5(n,e){e&&(n["X-Firebase-GMPID"]=e)}(f,e),function q5(n,e){null!==e&&e.length>0&&(n.Authorization="Firebase "+e)}(f,t),function Y5(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}(f,s),function Q5(n,e){null!==e&&(n["X-Firebase-AppCheck"]=e)}(f,r),new K5(d,n.method,f,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o)}(e,this._appId,r,i,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){var r=this;return(0,xe.Z)(function*(){const[i,s]=yield Promise.all([r._getAuthToken(),r._getAppCheckToken()]);return r._makeRequest(e,t,i,s).getPromise()})()}}const cV="@firebase/storage",dV="storage";function WW(n=(0,fi.getApp)(),e){n=(0,Rn.m9)(n);const r=(0,fi._getProvider)(n,dV).getImmediate({identifier:e}),i=(0,Rn.P0)("storage");return i&&function KW(n,e,t,r={}){!function zW(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:i}=r;i&&(n._overrideAuthToken="string"==typeof i?i:(0,Rn.Sg)(i,n.app.options.projectId))}(n,e,t,r)}(r,...i),r}function qW(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new Tk(t,r,i,e,fi.SDK_VERSION)}!function YW(){(0,fi._registerComponent)(new Zh.wA(dV,qW,"PUBLIC").setMultipleInstances(!0)),(0,fi.registerVersion)(cV,"0.11.2",""),(0,fi.registerVersion)(cV,"0.11.2","esm2017")}();class Ik{constructor(e){return e}}const hV="storage",wk=new m.OlP("angularfire2.storage-instances");function XW(n){return(e,t)=>{const r=e.runOutsideAngular(()=>n(t));return new Ik(r)}}const JW={provide:class ZW{constructor(){return(0,Mn.vb)(hV)}},deps:[[new m.FiY,wk]]},eK={provide:Ik,useFactory:function QW(n,e){const t=(0,Mn.JM)(hV,n,e);return t&&new Ik(t)},deps:[[new m.FiY,wk],Of]};let tK=(()=>{class n{constructor(){(0,sc.KN)("angularfire",Mn.q4.full,"gcs")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({providers:[eK,JW]}),n})();function nK(n,...e){return{ngModule:tK,providers:[{provide:wk,useFactory:XW(n),multi:!0,deps:[m.R0b,m.zs3,Mn.HU,TE,[new m.FiY,XD],[new m.FiY,$m],...e]}]}}const rK=(0,Mn.u3)(WW,!0),Dk="functions";class lK{constructor(e,t,r){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(i=>this.auth=i,()=>{}),this.messaging||t.get().then(i=>this.messaging=i,()=>{}),this.appCheck||r.get().then(i=>this.appCheck=i,()=>{})}getAuthToken(){var e=this;return(0,xe.Z)(function*(){if(e.auth)try{return(yield e.auth.getToken())?.accessToken}catch{return}})()}getMessagingToken(){var e=this;return(0,xe.Z)(function*(){if(e.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return yield e.messaging.getToken()}catch{return}})()}getAppCheckToken(e){var t=this;return(0,xe.Z)(function*(){if(t.appCheck){const r=e?yield t.appCheck.getLimitedUseToken():yield t.appCheck.getToken();return r.error?null:r.token}return null})()}getContext(e){var t=this;return(0,xe.Z)(function*(){return{authToken:yield t.getAuthToken(),messagingToken:yield t.getMessagingToken(),appCheckToken:yield t.getAppCheckToken(e)}})()}}const Ak="us-central1";class uK{constructor(e,t,r,i,s=Ak,o){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new lK(t,r,i),this.cancelAllRequests=new Promise(u=>{this.deleteService=()=>Promise.resolve(u())});try{const u=new URL(s);this.customDomain=u.origin,this.region=Ak}catch{this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return null!==this.emulatorOrigin?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}const _V="@firebase/functions";function bK(n=(0,fi.getApp)(),e=Ak){const r=(0,fi._getProvider)((0,Rn.m9)(n),Dk).getImmediate({identifier:e}),i=(0,Rn.P0)("functions");return i&&function EK(n,e,t){!function dK(n,e,t){n.emulatorOrigin=`http://${e}:${t}`}((0,Rn.m9)(n),e,t)}(r,...i),r}!function vK(n,e){(0,fi._registerComponent)(new Zh.wA(Dk,(r,{instanceIdentifier:i})=>{const s=r.getProvider("app").getImmediate(),o=r.getProvider("auth-internal"),u=r.getProvider("messaging-internal"),d=r.getProvider("app-check-internal");return new uK(s,o,u,d,i,n)},"PUBLIC").setMultipleInstances(!0)),(0,fi.registerVersion)(_V,"0.10.0",e),(0,fi.registerVersion)(_V,"0.10.0","esm2017")}(fetch.bind(self));class xk{constructor(e){return e}}const bV="functions",Ck=new m.OlP("angularfire2.functions-instances");function wK(n){return(e,t)=>{const r=e.runOutsideAngular(()=>n(t));return new xk(r)}}const SK={provide:class TK{constructor(){return(0,Mn.vb)(bV)}},deps:[[new m.FiY,Ck]]},DK={provide:xk,useFactory:function IK(n,e){const t=(0,Mn.JM)(bV,n,e);return t&&new xk(t)},deps:[[new m.FiY,Ck],Of]};let AK=(()=>{class n{constructor(){(0,sc.KN)("angularfire",Mn.q4.full,"fn")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=m.oAB({type:n}),n.\u0275inj=m.cJS({providers:[DK,SK]}),n})();function xK(n,...e){return{ngModule:AK,providers:[{provide:Ck,useFactory:wK(n),multi:!0,deps:[m.R0b,m.zs3,Mn.HU,TE,[new m.FiY,XD],[new m.FiY,$m],...e]}]}}const CK=(0,Mn.u3)(bK,!0),EV_firebaseConfig={apiKey:"AIzaSyAmG52vP8RvmwchQ71fQggTMu0eRdUz0Bc",authDomain:"tv-project-ffd44.firebaseapp.com",databaseURL:"https://tv-project-ffd44-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"tv-project-ffd44",storageBucket:"tv-project-ffd44.appspot.com",messagingSenderId:"711946849087",appId:"1:711946849087:web:0079a3cd80b97cea04e18a",measurementId:"G-0GRY2RNYRQ"};let RK=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=m.oAB({type:n,bootstrap:[Cg]}),n.\u0275inj=m.cJS({imports:[ho,o8,J4,oz,u5,V3(()=>G3(EV_firebaseConfig)),g5(()=>y5()),w5(()=>S5()),nK(()=>rK()),xK(()=>CK($3(),"asia-east2")),ic.hO.initializeApp(EV_firebaseConfig)]}),e})();nh().bootstrapModule(RK).catch(n=>console.error(n))},9751:(Vt,$e,W)=>{W.d($e,{y:()=>Oe});var m=W(930),ee=W(727),$=W(8822),fe=W(9635),be=W(2416),me=W(576),Le=W(2806);let Oe=(()=>{class ue{constructor(Ve){Ve&&(this._subscribe=Ve)}lift(Ve){const ut=new ue;return ut.source=this,ut.operator=Ve,ut}subscribe(Ve,ut,At){const Ae=function te(ue){return ue&&ue instanceof m.Lv||function ne(ue){return ue&&(0,me.m)(ue.next)&&(0,me.m)(ue.error)&&(0,me.m)(ue.complete)}(ue)&&(0,ee.Nn)(ue)}(Ve)?Ve:new m.Hp(Ve,ut,At);return(0,Le.x)(()=>{const{operator:Ke,source:Ze}=this;Ae.add(Ke?Ke.call(Ae,Ze):Ze?this._subscribe(Ae):this._trySubscribe(Ae))}),Ae}_trySubscribe(Ve){try{return this._subscribe(Ve)}catch(ut){Ve.error(ut)}}forEach(Ve,ut){return new(ut=Ce(ut))((At,Ae)=>{const Ke=new m.Hp({next:Ze=>{try{Ve(Ze)}catch(at){Ae(at),Ke.unsubscribe()}},error:Ae,complete:At});this.subscribe(Ke)})}_subscribe(Ve){var ut;return null===(ut=this.source)||void 0===ut?void 0:ut.subscribe(Ve)}[$.L](){return this}pipe(...Ve){return(0,fe.U)(Ve)(this)}toPromise(Ve){return new(Ve=Ce(Ve))((ut,At)=>{let Ae;this.subscribe(Ke=>Ae=Ke,Ke=>At(Ke),()=>ut(Ae))})}}return ue.create=rt=>new ue(rt),ue})();function Ce(ue){var rt;return null!==(rt=ue??be.v.Promise)&&void 0!==rt?rt:Promise}},7579:(Vt,$e,W)=>{W.d($e,{x:()=>Le});var m=W(9751),ee=W(727);const fe=(0,W(3888).d)(Ce=>function(){Ce(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var be=W(8737),me=W(2806);let Le=(()=>{class Ce extends m.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(te){const ue=new Oe(this,this);return ue.operator=te,ue}_throwIfClosed(){if(this.closed)throw new fe}next(te){(0,me.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const ue of this.currentObservers)ue.next(te)}})}error(te){(0,me.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=te;const{observers:ue}=this;for(;ue.length;)ue.shift().error(te)}})}complete(){(0,me.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:te}=this;for(;te.length;)te.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var te;return(null===(te=this.observers)||void 0===te?void 0:te.length)>0}_trySubscribe(te){return this._throwIfClosed(),super._trySubscribe(te)}_subscribe(te){return this._throwIfClosed(),this._checkFinalizedStatuses(te),this._innerSubscribe(te)}_innerSubscribe(te){const{hasError:ue,isStopped:rt,observers:Ve}=this;return ue||rt?ee.Lc:(this.currentObservers=null,Ve.push(te),new ee.w0(()=>{this.currentObservers=null,(0,be.P)(Ve,te)}))}_checkFinalizedStatuses(te){const{hasError:ue,thrownError:rt,isStopped:Ve}=this;ue?te.error(rt):Ve&&te.complete()}asObservable(){const te=new m.y;return te.source=this,te}}return Ce.create=(ne,te)=>new Oe(ne,te),Ce})();class Oe extends Le{constructor(ne,te){super(),this.destination=ne,this.source=te}next(ne){var te,ue;null===(ue=null===(te=this.destination)||void 0===te?void 0:te.next)||void 0===ue||ue.call(te,ne)}error(ne){var te,ue;null===(ue=null===(te=this.destination)||void 0===te?void 0:te.error)||void 0===ue||ue.call(te,ne)}complete(){var ne,te;null===(te=null===(ne=this.destination)||void 0===ne?void 0:ne.complete)||void 0===te||te.call(ne)}_subscribe(ne){var te,ue;return null!==(ue=null===(te=this.source)||void 0===te?void 0:te.subscribe(ne))&&void 0!==ue?ue:ee.Lc}}},930:(Vt,$e,W)=>{W.d($e,{Hp:()=>At,Lv:()=>ue});var m=W(576),ee=W(727),$=W(2416),fe=W(7849),be=W(5032);const me=Ce("C",void 0,void 0);function Ce(Qe,je,ze){return{kind:Qe,value:je,error:ze}}var ne=W(3410),te=W(2806);class ue extends ee.w0{constructor(je){super(),this.isStopped=!1,je?(this.destination=je,(0,ee.Nn)(je)&&je.add(this)):this.destination=at}static create(je,ze,ct){return new At(je,ze,ct)}next(je){this.isStopped?Ze(function Oe(Qe){return Ce("N",Qe,void 0)}(je),this):this._next(je)}error(je){this.isStopped?Ze(function Le(Qe){return Ce("E",void 0,Qe)}(je),this):(this.isStopped=!0,this._error(je))}complete(){this.isStopped?Ze(me,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(je){this.destination.next(je)}_error(je){try{this.destination.error(je)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const rt=Function.prototype.bind;function Ve(Qe,je){return rt.call(Qe,je)}class ut{constructor(je){this.partialObserver=je}next(je){const{partialObserver:ze}=this;if(ze.next)try{ze.next(je)}catch(ct){Ae(ct)}}error(je){const{partialObserver:ze}=this;if(ze.error)try{ze.error(je)}catch(ct){Ae(ct)}else Ae(je)}complete(){const{partialObserver:je}=this;if(je.complete)try{je.complete()}catch(ze){Ae(ze)}}}class At extends ue{constructor(je,ze,ct){let tt;if(super(),(0,m.m)(je)||!je)tt={next:je??void 0,error:ze??void 0,complete:ct??void 0};else{let Tt;this&&$.v.useDeprecatedNextContext?(Tt=Object.create(je),Tt.unsubscribe=()=>this.unsubscribe(),tt={next:je.next&&Ve(je.next,Tt),error:je.error&&Ve(je.error,Tt),complete:je.complete&&Ve(je.complete,Tt)}):tt=je}this.destination=new ut(tt)}}function Ae(Qe){$.v.useDeprecatedSynchronousErrorHandling?(0,te.O)(Qe):(0,fe.h)(Qe)}function Ze(Qe,je){const{onStoppedNotification:ze}=$.v;ze&&ne.z.setTimeout(()=>ze(Qe,je))}const at={closed:!0,next:be.Z,error:function Ke(Qe){throw Qe},complete:be.Z}},727:(Vt,$e,W)=>{W.d($e,{Lc:()=>me,w0:()=>be,Nn:()=>Le});var m=W(576);const $=(0,W(3888).d)(Ce=>function(te){Ce(this),this.message=te?`${te.length} errors occurred during unsubscription:\n${te.map((ue,rt)=>`${rt+1}) ${ue.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=te});var fe=W(8737);class be{constructor(ne){this.initialTeardown=ne,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let ne;if(!this.closed){this.closed=!0;const{_parentage:te}=this;if(te)if(this._parentage=null,Array.isArray(te))for(const Ve of te)Ve.remove(this);else te.remove(this);const{initialTeardown:ue}=this;if((0,m.m)(ue))try{ue()}catch(Ve){ne=Ve instanceof $?Ve.errors:[Ve]}const{_finalizers:rt}=this;if(rt){this._finalizers=null;for(const Ve of rt)try{Oe(Ve)}catch(ut){ne=ne??[],ut instanceof $?ne=[...ne,...ut.errors]:ne.push(ut)}}if(ne)throw new $(ne)}}add(ne){var te;if(ne&&ne!==this)if(this.closed)Oe(ne);else{if(ne instanceof be){if(ne.closed||ne._hasParent(this))return;ne._addParent(this)}(this._finalizers=null!==(te=this._finalizers)&&void 0!==te?te:[]).push(ne)}}_hasParent(ne){const{_parentage:te}=this;return te===ne||Array.isArray(te)&&te.includes(ne)}_addParent(ne){const{_parentage:te}=this;this._parentage=Array.isArray(te)?(te.push(ne),te):te?[te,ne]:ne}_removeParent(ne){const{_parentage:te}=this;te===ne?this._parentage=null:Array.isArray(te)&&(0,fe.P)(te,ne)}remove(ne){const{_finalizers:te}=this;te&&(0,fe.P)(te,ne),ne instanceof be&&ne._removeParent(this)}}be.EMPTY=(()=>{const Ce=new be;return Ce.closed=!0,Ce})();const me=be.EMPTY;function Le(Ce){return Ce instanceof be||Ce&&"closed"in Ce&&(0,m.m)(Ce.remove)&&(0,m.m)(Ce.add)&&(0,m.m)(Ce.unsubscribe)}function Oe(Ce){(0,m.m)(Ce)?Ce():Ce.unsubscribe()}},2416:(Vt,$e,W)=>{W.d($e,{v:()=>m});const m={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},515:(Vt,$e,W)=>{W.d($e,{E:()=>ee});const ee=new(W(9751).y)(be=>be.complete())},8996:(Vt,$e,W)=>{W.d($e,{D:()=>je});var m=W(8421),ee=W(5363),$=W(9468),me=W(9751),Oe=W(2202),Ce=W(576),ne=W(9672);function ue(ze,ct){if(!ze)throw new Error("Iterable cannot be null");return new me.y(tt=>{(0,ne.f)(tt,ct,()=>{const Tt=ze[Symbol.asyncIterator]();(0,ne.f)(tt,ct,()=>{Tt.next().then(Ct=>{Ct.done?tt.complete():tt.next(Ct.value)})},0,!0)})})}var rt=W(3670),Ve=W(8239),ut=W(1144),At=W(6495),Ae=W(2206),Ke=W(4532),Ze=W(3260);function je(ze,ct){return ct?function Qe(ze,ct){if(null!=ze){if((0,rt.c)(ze))return function fe(ze,ct){return(0,m.Xf)(ze).pipe((0,$.R)(ct),(0,ee.Q)(ct))}(ze,ct);if((0,ut.z)(ze))return function Le(ze,ct){return new me.y(tt=>{let Tt=0;return ct.schedule(function(){Tt===ze.length?tt.complete():(tt.next(ze[Tt++]),tt.closed||this.schedule())})})}(ze,ct);if((0,Ve.t)(ze))return function be(ze,ct){return(0,m.Xf)(ze).pipe((0,$.R)(ct),(0,ee.Q)(ct))}(ze,ct);if((0,Ae.D)(ze))return ue(ze,ct);if((0,At.T)(ze))return function te(ze,ct){return new me.y(tt=>{let Tt;return(0,ne.f)(tt,ct,()=>{Tt=ze[Oe.h](),(0,ne.f)(tt,ct,()=>{let Ct,dn;try{({value:Ct,done:dn}=Tt.next())}catch(It){return void tt.error(It)}dn?tt.complete():tt.next(Ct)},0,!0)}),()=>(0,Ce.m)(Tt?.return)&&Tt.return()})}(ze,ct);if((0,Ze.L)(ze))return function at(ze,ct){return ue((0,Ze.Q)(ze),ct)}(ze,ct)}throw(0,Ke.z)(ze)}(ze,ct):(0,m.Xf)(ze)}},8421:(Vt,$e,W)=>{W.d($e,{Xf:()=>rt});var m=W(7582),ee=W(1144),$=W(8239),fe=W(9751),be=W(3670),me=W(2206),Le=W(4532),Oe=W(6495),Ce=W(3260),ne=W(576),te=W(7849),ue=W(8822);function rt(Qe){if(Qe instanceof fe.y)return Qe;if(null!=Qe){if((0,be.c)(Qe))return function Ve(Qe){return new fe.y(je=>{const ze=Qe[ue.L]();if((0,ne.m)(ze.subscribe))return ze.subscribe(je);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Qe);if((0,ee.z)(Qe))return function ut(Qe){return new fe.y(je=>{for(let ze=0;ze<Qe.length&&!je.closed;ze++)je.next(Qe[ze]);je.complete()})}(Qe);if((0,$.t)(Qe))return function At(Qe){return new fe.y(je=>{Qe.then(ze=>{je.closed||(je.next(ze),je.complete())},ze=>je.error(ze)).then(null,te.h)})}(Qe);if((0,me.D)(Qe))return Ke(Qe);if((0,Oe.T)(Qe))return function Ae(Qe){return new fe.y(je=>{for(const ze of Qe)if(je.next(ze),je.closed)return;je.complete()})}(Qe);if((0,Ce.L)(Qe))return function Ze(Qe){return Ke((0,Ce.Q)(Qe))}(Qe)}throw(0,Le.z)(Qe)}function Ke(Qe){return new fe.y(je=>{(function at(Qe,je){var ze,ct,tt,Tt;return(0,m.mG)(this,void 0,void 0,function*(){try{for(ze=(0,m.KL)(Qe);!(ct=yield ze.next()).done;)if(je.next(ct.value),je.closed)return}catch(Ct){tt={error:Ct}}finally{try{ct&&!ct.done&&(Tt=ze.return)&&(yield Tt.call(ze))}finally{if(tt)throw tt.error}}je.complete()})})(Qe,je).catch(ze=>je.error(ze))})}},6451:(Vt,$e,W)=>{W.d($e,{T:()=>me});var m=W(8189),ee=W(8421),$=W(515),fe=W(7669),be=W(8996);function me(...Le){const Oe=(0,fe.yG)(Le),Ce=(0,fe._6)(Le,1/0),ne=Le;return ne.length?1===ne.length?(0,ee.Xf)(ne[0]):(0,m.J)(Ce)((0,be.D)(ne,Oe)):$.E}},5403:(Vt,$e,W)=>{W.d($e,{x:()=>ee});var m=W(930);function ee(fe,be,me,Le,Oe){return new $(fe,be,me,Le,Oe)}class $ extends m.Lv{constructor(be,me,Le,Oe,Ce,ne){super(be),this.onFinalize=Ce,this.shouldUnsubscribe=ne,this._next=me?function(te){try{me(te)}catch(ue){be.error(ue)}}:super._next,this._error=Oe?function(te){try{Oe(te)}catch(ue){be.error(ue)}finally{this.unsubscribe()}}:super._error,this._complete=Le?function(){try{Le()}catch(te){be.error(te)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var be;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:me}=this;super.unsubscribe(),!me&&(null===(be=this.onFinalize)||void 0===be||be.call(this))}}}},4004:(Vt,$e,W)=>{W.d($e,{U:()=>$});var m=W(4482),ee=W(5403);function $(fe,be){return(0,m.e)((me,Le)=>{let Oe=0;me.subscribe((0,ee.x)(Le,Ce=>{Le.next(fe.call(be,Ce,Oe++))}))})}},8189:(Vt,$e,W)=>{W.d($e,{J:()=>$});var m=W(5577),ee=W(4671);function $(fe=1/0){return(0,m.z)(ee.y,fe)}},5577:(Vt,$e,W)=>{W.d($e,{z:()=>Oe});var m=W(4004),ee=W(8421),$=W(4482),fe=W(9672),be=W(5403),Le=W(576);function Oe(Ce,ne,te=1/0){return(0,Le.m)(ne)?Oe((ue,rt)=>(0,m.U)((Ve,ut)=>ne(ue,Ve,rt,ut))((0,ee.Xf)(Ce(ue,rt))),te):("number"==typeof ne&&(te=ne),(0,$.e)((ue,rt)=>function me(Ce,ne,te,ue,rt,Ve,ut,At){const Ae=[];let Ke=0,Ze=0,at=!1;const Qe=()=>{at&&!Ae.length&&!Ke&&ne.complete()},je=ct=>Ke<ue?ze(ct):Ae.push(ct),ze=ct=>{Ve&&ne.next(ct),Ke++;let tt=!1;(0,ee.Xf)(te(ct,Ze++)).subscribe((0,be.x)(ne,Tt=>{rt?.(Tt),Ve?je(Tt):ne.next(Tt)},()=>{tt=!0},void 0,()=>{if(tt)try{for(Ke--;Ae.length&&Ke<ue;){const Tt=Ae.shift();ut?(0,fe.f)(ne,ut,()=>ze(Tt)):ze(Tt)}Qe()}catch(Tt){ne.error(Tt)}}))};return Ce.subscribe((0,be.x)(ne,je,()=>{at=!0,Qe()})),()=>{At?.()}}(ue,rt,Ce,te)))}},5363:(Vt,$e,W)=>{W.d($e,{Q:()=>fe});var m=W(9672),ee=W(4482),$=W(5403);function fe(be,me=0){return(0,ee.e)((Le,Oe)=>{Le.subscribe((0,$.x)(Oe,Ce=>(0,m.f)(Oe,be,()=>Oe.next(Ce),me),()=>(0,m.f)(Oe,be,()=>Oe.complete(),me),Ce=>(0,m.f)(Oe,be,()=>Oe.error(Ce),me)))})}},3099:(Vt,$e,W)=>{W.d($e,{B:()=>be});var m=W(8421),ee=W(7579),$=W(930),fe=W(4482);function be(Le={}){const{connector:Oe=(()=>new ee.x),resetOnError:Ce=!0,resetOnComplete:ne=!0,resetOnRefCountZero:te=!0}=Le;return ue=>{let rt,Ve,ut,At=0,Ae=!1,Ke=!1;const Ze=()=>{Ve?.unsubscribe(),Ve=void 0},at=()=>{Ze(),rt=ut=void 0,Ae=Ke=!1},Qe=()=>{const je=rt;at(),je?.unsubscribe()};return(0,fe.e)((je,ze)=>{At++,!Ke&&!Ae&&Ze();const ct=ut=ut??Oe();ze.add(()=>{At--,0===At&&!Ke&&!Ae&&(Ve=me(Qe,te))}),ct.subscribe(ze),!rt&&At>0&&(rt=new $.Hp({next:tt=>ct.next(tt),error:tt=>{Ke=!0,Ze(),Ve=me(at,Ce,tt),ct.error(tt)},complete:()=>{Ae=!0,Ze(),Ve=me(at,ne),ct.complete()}}),(0,m.Xf)(je).subscribe(rt))})(ue)}}function me(Le,Oe,...Ce){if(!0===Oe)return void Le();if(!1===Oe)return;const ne=new $.Hp({next:()=>{ne.unsubscribe(),Le()}});return(0,m.Xf)(Oe(...Ce)).subscribe(ne)}},9468:(Vt,$e,W)=>{W.d($e,{R:()=>ee});var m=W(4482);function ee($,fe=0){return(0,m.e)((be,me)=>{me.add($.schedule(()=>be.subscribe(me),fe))})}},8505:(Vt,$e,W)=>{W.d($e,{b:()=>be});var m=W(576),ee=W(4482),$=W(5403),fe=W(4671);function be(me,Le,Oe){const Ce=(0,m.m)(me)||Le||Oe?{next:me,error:Le,complete:Oe}:me;return Ce?(0,ee.e)((ne,te)=>{var ue;null===(ue=Ce.subscribe)||void 0===ue||ue.call(Ce);let rt=!0;ne.subscribe((0,$.x)(te,Ve=>{var ut;null===(ut=Ce.next)||void 0===ut||ut.call(Ce,Ve),te.next(Ve)},()=>{var Ve;rt=!1,null===(Ve=Ce.complete)||void 0===Ve||Ve.call(Ce),te.complete()},Ve=>{var ut;rt=!1,null===(ut=Ce.error)||void 0===ut||ut.call(Ce,Ve),te.error(Ve)},()=>{var Ve,ut;rt&&(null===(Ve=Ce.unsubscribe)||void 0===Ve||Ve.call(Ce)),null===(ut=Ce.finalize)||void 0===ut||ut.call(Ce)}))}):fe.y}},4408:(Vt,$e,W)=>{W.d($e,{o:()=>be});var m=W(727);class ee extends m.w0{constructor(Le,Oe){super()}schedule(Le,Oe=0){return this}}const $={setInterval(me,Le,...Oe){const{delegate:Ce}=$;return Ce?.setInterval?Ce.setInterval(me,Le,...Oe):setInterval(me,Le,...Oe)},clearInterval(me){const{delegate:Le}=$;return(Le?.clearInterval||clearInterval)(me)},delegate:void 0};var fe=W(8737);class be extends ee{constructor(Le,Oe){super(Le,Oe),this.scheduler=Le,this.work=Oe,this.pending=!1}schedule(Le,Oe=0){var Ce;if(this.closed)return this;this.state=Le;const ne=this.id,te=this.scheduler;return null!=ne&&(this.id=this.recycleAsyncId(te,ne,Oe)),this.pending=!0,this.delay=Oe,this.id=null!==(Ce=this.id)&&void 0!==Ce?Ce:this.requestAsyncId(te,this.id,Oe),this}requestAsyncId(Le,Oe,Ce=0){return $.setInterval(Le.flush.bind(Le,this),Ce)}recycleAsyncId(Le,Oe,Ce=0){if(null!=Ce&&this.delay===Ce&&!1===this.pending)return Oe;null!=Oe&&$.clearInterval(Oe)}execute(Le,Oe){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const Ce=this._execute(Le,Oe);if(Ce)return Ce;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(Le,Oe){let ne,Ce=!1;try{this.work(Le)}catch(te){Ce=!0,ne=te||new Error("Scheduled action threw falsy error")}if(Ce)return this.unsubscribe(),ne}unsubscribe(){if(!this.closed){const{id:Le,scheduler:Oe}=this,{actions:Ce}=Oe;this.work=this.state=this.scheduler=null,this.pending=!1,(0,fe.P)(Ce,this),null!=Le&&(this.id=this.recycleAsyncId(Oe,Le,null)),this.delay=null,super.unsubscribe()}}}},7565:(Vt,$e,W)=>{W.d($e,{v:()=>$});var m=W(6063);class ee{constructor(be,me=ee.now){this.schedulerActionCtor=be,this.now=me}schedule(be,me=0,Le){return new this.schedulerActionCtor(this,be).schedule(Le,me)}}ee.now=m.l.now;class $ extends ee{constructor(be,me=ee.now){super(be,me),this.actions=[],this._active=!1}flush(be){const{actions:me}=this;if(this._active)return void me.push(be);let Le;this._active=!0;do{if(Le=be.execute(be.state,be.delay))break}while(be=me.shift());if(this._active=!1,Le){for(;be=me.shift();)be.unsubscribe();throw Le}}}},4986:(Vt,$e,W)=>{W.d($e,{z:()=>$});var m=W(4408);const $=new(W(7565).v)(m.o)},6063:(Vt,$e,W)=>{W.d($e,{l:()=>m});const m={now:()=>(m.delegate||Date).now(),delegate:void 0}},3410:(Vt,$e,W)=>{W.d($e,{z:()=>m});const m={setTimeout(ee,$,...fe){const{delegate:be}=m;return be?.setTimeout?be.setTimeout(ee,$,...fe):setTimeout(ee,$,...fe)},clearTimeout(ee){const{delegate:$}=m;return($?.clearTimeout||clearTimeout)(ee)},delegate:void 0}},2202:(Vt,$e,W)=>{W.d($e,{h:()=>ee});const ee=function m(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},8822:(Vt,$e,W)=>{W.d($e,{L:()=>m});const m="function"==typeof Symbol&&Symbol.observable||"@@observable"},7669:(Vt,$e,W)=>{W.d($e,{_6:()=>me,jO:()=>fe,yG:()=>be});var m=W(576);function $(Le){return Le[Le.length-1]}function fe(Le){return(0,m.m)($(Le))?Le.pop():void 0}function be(Le){return function ee(Le){return Le&&(0,m.m)(Le.schedule)}($(Le))?Le.pop():void 0}function me(Le,Oe){return"number"==typeof $(Le)?Le.pop():Oe}},8737:(Vt,$e,W)=>{function m(ee,$){if(ee){const fe=ee.indexOf($);0<=fe&&ee.splice(fe,1)}}W.d($e,{P:()=>m})},3888:(Vt,$e,W)=>{function m(ee){const fe=ee(be=>{Error.call(be),be.stack=(new Error).stack});return fe.prototype=Object.create(Error.prototype),fe.prototype.constructor=fe,fe}W.d($e,{d:()=>m})},2806:(Vt,$e,W)=>{W.d($e,{O:()=>fe,x:()=>$});var m=W(2416);let ee=null;function $(be){if(m.v.useDeprecatedSynchronousErrorHandling){const me=!ee;if(me&&(ee={errorThrown:!1,error:null}),be(),me){const{errorThrown:Le,error:Oe}=ee;if(ee=null,Le)throw Oe}}else be()}function fe(be){m.v.useDeprecatedSynchronousErrorHandling&&ee&&(ee.errorThrown=!0,ee.error=be)}},9672:(Vt,$e,W)=>{function m(ee,$,fe,be=0,me=!1){const Le=$.schedule(function(){fe(),me?ee.add(this.schedule(null,be)):this.unsubscribe()},be);if(ee.add(Le),!me)return Le}W.d($e,{f:()=>m})},4671:(Vt,$e,W)=>{function m(ee){return ee}W.d($e,{y:()=>m})},1144:(Vt,$e,W)=>{W.d($e,{z:()=>m});const m=ee=>ee&&"number"==typeof ee.length&&"function"!=typeof ee},2206:(Vt,$e,W)=>{W.d($e,{D:()=>ee});var m=W(576);function ee($){return Symbol.asyncIterator&&(0,m.m)($?.[Symbol.asyncIterator])}},576:(Vt,$e,W)=>{function m(ee){return"function"==typeof ee}W.d($e,{m:()=>m})},3670:(Vt,$e,W)=>{W.d($e,{c:()=>$});var m=W(8822),ee=W(576);function $(fe){return(0,ee.m)(fe[m.L])}},6495:(Vt,$e,W)=>{W.d($e,{T:()=>$});var m=W(2202),ee=W(576);function $(fe){return(0,ee.m)(fe?.[m.h])}},8239:(Vt,$e,W)=>{W.d($e,{t:()=>ee});var m=W(576);function ee($){return(0,m.m)($?.then)}},3260:(Vt,$e,W)=>{W.d($e,{L:()=>fe,Q:()=>$});var m=W(7582),ee=W(576);function $(be){return(0,m.FC)(this,arguments,function*(){const Le=be.getReader();try{for(;;){const{value:Oe,done:Ce}=yield(0,m.qq)(Le.read());if(Ce)return yield(0,m.qq)(void 0);yield yield(0,m.qq)(Oe)}}finally{Le.releaseLock()}})}function fe(be){return(0,ee.m)(be?.getReader)}},4482:(Vt,$e,W)=>{W.d($e,{A:()=>ee,e:()=>$});var m=W(576);function ee(fe){return(0,m.m)(fe?.lift)}function $(fe){return be=>{if(ee(be))return be.lift(function(me){try{return fe(me,this)}catch(Le){this.error(Le)}});throw new TypeError("Unable to lift unknown Observable type")}}},5032:(Vt,$e,W)=>{function m(){}W.d($e,{Z:()=>m})},9635:(Vt,$e,W)=>{W.d($e,{U:()=>$,z:()=>ee});var m=W(4671);function ee(...fe){return $(fe)}function $(fe){return 0===fe.length?m.y:1===fe.length?fe[0]:function(me){return fe.reduce((Le,Oe)=>Oe(Le),me)}}},7849:(Vt,$e,W)=>{W.d($e,{h:()=>$});var m=W(2416),ee=W(3410);function $(fe){ee.z.setTimeout(()=>{const{onUnhandledError:be}=m.v;if(!be)throw fe;be(fe)})}},4532:(Vt,$e,W)=>{function m(ee){return new TypeError(`You provided ${null!==ee&&"object"==typeof ee?"an invalid object":`'${ee}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}W.d($e,{z:()=>m})},4650:(Vt,$e,W)=>{W.d($e,{$8M:()=>qa,$WT:()=>et,$Z:()=>FT,AFp:()=>pm,AaK:()=>Oe,CHM:()=>Vd,CRH:()=>Cy,CZH:()=>tu,CqO:()=>cI,D6c:()=>Rb,DdM:()=>Iw,EJc:()=>$w,EpF:()=>Kg,F$t:()=>uI,F4k:()=>lI,FYo:()=>y_,FiY:()=>ya,Gf:()=>Ay,GfV:()=>gT,Gpc:()=>te,Hsn:()=>dI,JOm:()=>Xt,Jf7:()=>vT,KtG:()=>$d,LFG:()=>wn,Lbi:()=>mm,Lck:()=>Mv,MMx:()=>Lv,NdJ:()=>zp,OlP:()=>On,P3R:()=>aT,PXZ:()=>uf,Q6J:()=>jg,QGY:()=>Q_,QbO:()=>ub,Qsj:()=>MA,R0b:()=>vo,RDi:()=>cA,Rgc:()=>am,SBq:()=>Rh,Sil:()=>Hw,Suo:()=>xy,TTD:()=>Ld,TgZ:()=>jh,X6Q:()=>rS,XFs:()=>Ft,Xpm:()=>Nn,Xts:()=>a_,Y36:()=>Oh,YKP:()=>Rv,YNc:()=>K_,Yjl:()=>Gt,Yz7:()=>xt,Z0I:()=>ir,ZZ4:()=>ff,_Bn:()=>mw,_UZ:()=>Y_,_Vd:()=>Ch,_c5:()=>lr,_uU:()=>AI,aQg:()=>t0,c2e:()=>db,cJS:()=>$t,cg1:()=>Yc,dDg:()=>vm,dqk:()=>tr,eFA:()=>bb,eJc:()=>My,ekj:()=>pr,eoX:()=>Ww,f3M:()=>Gr,g9A:()=>cb,h0i:()=>Zc,hGG:()=>mR,hij:()=>ny,iGM:()=>Dy,ifc:()=>j,ip1:()=>ab,jDz:()=>vy,kL8:()=>ay,lG2:()=>St,lqb:()=>Qu,lri:()=>_m,n5z:()=>Bu,oAB:()=>pe,oxw:()=>J_,q4F:()=>yT,qLn:()=>Cp,qOj:()=>Vg,qZA:()=>Wg,rWj:()=>cf,sBO:()=>iS,s_b:()=>Iy,soG:()=>nu,tb:()=>ec,tp0:()=>Ht,uIk:()=>Uh,vHH:()=>Ae,vpe:()=>qo,wAp:()=>sn,xp6:()=>CT,z2F:()=>yd,zSh:()=>Wc,zs3:()=>kh});var m=W(7579),ee=W(727),$=W(9751),fe=W(6451),be=W(3099);function me(a){for(let l in a)if(a[l]===me)return l;throw Error("Could not find renamed property on target object.")}function Le(a,l){for(const c in l)l.hasOwnProperty(c)&&!a.hasOwnProperty(c)&&(a[c]=l[c])}function Oe(a){if("string"==typeof a)return a;if(Array.isArray(a))return"["+a.map(Oe).join(", ")+"]";if(null==a)return""+a;if(a.overriddenName)return`${a.overriddenName}`;if(a.name)return`${a.name}`;const l=a.toString();if(null==l)return""+l;const c=l.indexOf("\n");return-1===c?l:l.substring(0,c)}function Ce(a,l){return null==a||""===a?null===l?"":l:null==l||""===l?a:a+" "+l}const ne=me({__forward_ref__:me});function te(a){return a.__forward_ref__=te,a.toString=function(){return Oe(this())},a}function ue(a){return rt(a)?a():a}function rt(a){return"function"==typeof a&&a.hasOwnProperty(ne)&&a.__forward_ref__===te}function Ve(a){return a&&!!a.\u0275providers}const At="https://g.co/ng/security#xss";class Ae extends Error{constructor(l,c){super(Ke(l,c)),this.code=l}}function Ke(a,l){return`NG0${Math.abs(a)}${l?": "+l.trim():""}`}function Ze(a){return"string"==typeof a?a:null==a?"":String(a)}function ct(a,l){throw new Ae(-201,!1)}function De(a,l){null==a&&function ye(a,l,c,h){throw new Error(`ASSERTION ERROR: ${a}`+(null==h?"":` [Expected=> ${c} ${h} ${l} <=Actual]`))}(l,a,null,"!=")}function xt(a){return{token:a.token,providedIn:a.providedIn||null,factory:a.factory,value:void 0}}function $t(a){return{providers:a.providers||[],imports:a.imports||[]}}function Dn(a){return jn(a,yr)||jn(a,ti)}function ir(a){return null!==Dn(a)}function jn(a,l){return a.hasOwnProperty(l)?a[l]:null}function Mr(a){return a&&(a.hasOwnProperty(kr)||a.hasOwnProperty(vr))?a[kr]:null}const yr=me({\u0275prov:me}),kr=me({\u0275inj:me}),ti=me({ngInjectableDef:me}),vr=me({ngInjectorDef:me});var Ft=(()=>((Ft=Ft||{})[Ft.Default=0]="Default",Ft[Ft.Host=1]="Host",Ft[Ft.Self=2]="Self",Ft[Ft.SkipSelf=4]="SkipSelf",Ft[Ft.Optional=8]="Optional",Ft))();let _s;function Fn(a){const l=_s;return _s=a,l}function Vi(a,l,c){const h=Dn(a);return h&&"root"==h.providedIn?void 0===h.value?h.value=h.factory():h.value:c&Ft.Optional?null:void 0!==l?l:void ct(Oe(a))}const tr=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),ni={},ur="__NG_DI_FLAG__",br="ngTempTokenPath",mi="ngTokenPath",$r=/\n/gm,ra="\u0275",zn="__source";let dr;function an(a){const l=dr;return dr=a,l}function to(a,l=Ft.Default){if(void 0===dr)throw new Ae(-203,!1);return null===dr?Vi(a,void 0,l):dr.get(a,l&Ft.Optional?null:void 0,l)}function wn(a,l=Ft.Default){return(function na(){return _s}()||to)(ue(a),l)}function Gr(a,l=Ft.Default){return wn(a,ri(l))}function ri(a){return typeof a>"u"||"number"==typeof a?a:0|(a.optional&&8)|(a.host&&1)|(a.self&&2)|(a.skipSelf&&4)}function es(a){const l=[];for(let c=0;c<a.length;c++){const h=ue(a[c]);if(Array.isArray(h)){if(0===h.length)throw new Ae(900,!1);let p,y=Ft.Default;for(let E=0;E<h.length;E++){const S=h[E],D=vs(S);"number"==typeof D?-1===D?p=S.token:y|=D:p=S}l.push(wn(p,y))}else l.push(wn(h))}return l}function Hr(a,l){return a[ur]=l,a.prototype[ur]=l,a}function vs(a){return a[ur]}function Q(a){return{toString:a}.toString()}var G=(()=>((G=G||{})[G.OnPush=0]="OnPush",G[G.Default=1]="Default",G))(),j=(()=>{return(a=j||(j={}))[a.Emulated=0]="Emulated",a[a.None=2]="None",a[a.ShadowDom=3]="ShadowDom",j;var a})();const V={},se=[],ke=me({\u0275cmp:me}),ht=me({\u0275dir:me}),nn=me({\u0275pipe:me}),Qt=me({\u0275mod:me}),fn=me({\u0275fac:me}),Ut=me({__NG_ELEMENT_ID__:me});let qn=0;function Nn(a){return Q(()=>{const l=Oi(a),c={...l,decls:a.decls,vars:a.vars,template:a.template,consts:a.consts||null,ngContentSelectors:a.ngContentSelectors,onPush:a.changeDetection===G.OnPush,directiveDefs:null,pipeDefs:null,dependencies:l.standalone&&a.dependencies||null,getStandaloneInjector:null,data:a.data||{},encapsulation:a.encapsulation||j.Emulated,id:"c"+qn++,styles:a.styles||se,_:null,schemas:a.schemas||null,tView:null};no(c);const h=a.dependencies;return c.directiveDefs=Ua(h,!1),c.pipeDefs=Ua(h,!0),c})}function ts(a){return Lt(a)||kn(a)}function Se(a){return null!==a}function pe(a){return Q(()=>({type:a.type,bootstrap:a.bootstrap||se,declarations:a.declarations||se,imports:a.imports||se,exports:a.exports||se,transitiveCompileScopes:null,schemas:a.schemas||null,id:a.id||null}))}function wt(a,l){if(null==a)return V;const c={};for(const h in a)if(a.hasOwnProperty(h)){let p=a[h],y=p;Array.isArray(p)&&(y=p[1],p=p[0]),c[p]=h,l&&(l[p]=y)}return c}function St(a){return Q(()=>{const l=Oi(a);return no(l),l})}function Gt(a){return{type:a.type,name:a.name,factory:null,pure:!1!==a.pure,standalone:!0===a.standalone,onDestroy:a.type.prototype.ngOnDestroy||null}}function Lt(a){return a[ke]||null}function kn(a){return a[ht]||null}function Ln(a){return a[nn]||null}function et(a){const l=Lt(a)||kn(a)||Ln(a);return null!==l&&l.standalone}function Jn(a,l){const c=a[Qt]||null;if(!c&&!0===l)throw new Error(`Type ${Oe(a)} does not have '\u0275mod' property.`);return c}function Oi(a){const l={};return{type:a.type,providersResolver:null,factory:null,hostBindings:a.hostBindings||null,hostVars:a.hostVars||0,hostAttrs:a.hostAttrs||null,contentQueries:a.contentQueries||null,declaredInputs:l,exportAs:a.exportAs||null,standalone:!0===a.standalone,selectors:a.selectors||se,viewQuery:a.viewQuery||null,features:a.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:wt(a.inputs,l),outputs:wt(a.outputs)}}function no(a){a.features?.forEach(l=>l(a))}function Ua(a,l){if(!a)return null;const c=l?Ln:ts;return()=>("function"==typeof a?a():a).map(h=>c(h)).filter(Se)}const ns=0,Et=1,bn=2,nr=3,Ni=4,ro=5,Ii=6,Ba=7,pn=8,sr=9,ia=10,tn=11,yl=12,sa=13,Ao=14,Va=15,ii=16,_l=17,rs=18,io=19,$a=20,cc=21,er=22,Ts=1,wi=2,uc=7,vl=8,$s=9,gi=10;function Si(a){return Array.isArray(a)&&"object"==typeof a[Ts]}function Gs(a){return Array.isArray(a)&&!0===a[Ts]}function oa(a){return 0!=(4&a.flags)}function is(a){return a.componentOffset>-1}function Hs(a){return 1==(1&a.flags)}function Is(a){return!!a.template}function so(a){return 0!=(256&a[bn])}function aa(a,l){return a.hasOwnProperty(fn)?a[fn]:null}class Kf{constructor(l,c,h){this.previousValue=l,this.currentValue=c,this.firstChange=h}isFirstChange(){return this.firstChange}}function Ld(){return bu}function bu(a){return a.type.prototype.ngOnChanges&&(a.setInput=bl),qf}function qf(){const a=Yf(this),l=a?.current;if(l){const c=a.previous;if(c===V)a.previous=l;else for(let h in l)c[h]=l[h];a.current=null,this.ngOnChanges(l)}}function bl(a,l,c,h){const p=this.declaredInputs[c],y=Yf(a)||function Zf(a,l){return a[pc]=l}(a,{previous:V,current:null}),E=y.current||(y.current={}),S=y.previous,D=S[p];E[p]=new Kf(D&&D.currentValue,l,S===V),a[h]=l}Ld.ngInherit=!0;const pc="__ngSimpleChanges__";function Yf(a){return a[pc]||null}const Lr=function(a,l,c){};function An(a){for(;Array.isArray(a);)a=a[ns];return a}function Ha(a,l){return An(l[a])}function yi(a,l){return An(l[a.index])}function Tu(a,l){return a.data[l]}function si(a,l){const c=l[a];return Si(c)?c:c[ns]}function ws(a){return 64==(64&a[bn])}function Ro(a,l){return null==l?null:a[l]}function yc(a){a[rs]=0}function ja(a,l){a[ro]+=l;let c=a,h=a[nr];for(;null!==h&&(1===l&&1===c[ro]||-1===l&&0===c[ro]);)h[ro]+=l,c=h,h=h[nr]}const rn={lFrame:Wd(null),bindingsEnabled:!0};function wu(){return rn.bindingsEnabled}function Re(){return rn.lFrame.lView}function mn(){return rn.lFrame.tView}function Vd(a){return rn.lFrame.contextLView=a,a[pn]}function $d(a){return rn.lFrame.contextLView=null,a}function oi(){let a=Gd();for(;null!==a&&64===a.type;)a=a.parent;return a}function Gd(){return rn.lFrame.currentTNode}function ai(a,l){const c=rn.lFrame;c.currentTNode=a,c.isParent=l}function Su(){return rn.lFrame.isParent}function Du(){rn.lFrame.isParent=!1}function Dl(){return rn.lFrame.bindingIndex++}function Al(a,l){const c=rn.lFrame;c.bindingIndex=c.bindingRootIndex=a,Ds(l)}function Ds(a){rn.lFrame.currentDirectiveIndex=a}function vc(){return rn.lFrame.currentQueryIndex}function Di(a){rn.lFrame.currentQueryIndex=a}function Xf(a){const l=a[Et];return 2===l.type?l.declTNode:1===l.type?a[Ii]:null}function jd(a,l,c){if(c&Ft.SkipSelf){let p=l,y=a;for(;!(p=p.parent,null!==p||c&Ft.Host||(p=Xf(y),null===p||(y=y[Va],10&p.type))););if(null===p)return!1;l=p,a=y}const h=rn.lFrame=zd();return h.currentTNode=l,h.lView=a,!0}function xl(a){const l=zd(),c=a[Et];rn.lFrame=l,l.currentTNode=c.firstChild,l.lView=a,l.tView=c,l.contextLView=a,l.bindingIndex=c.bindingStartIndex,l.inI18n=!1}function zd(){const a=rn.lFrame,l=null===a?null:a.child;return null===l?Wd(a):l}function Wd(a){const l={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:a,child:null,inI18n:!1};return null!==a&&(a.child=l),l}function Jf(){const a=rn.lFrame;return rn.lFrame=a.parent,a.currentTNode=null,a.lView=null,a}const ao=Jf;function la(){const a=Jf();a.isParent=!0,a.tView=null,a.selectedIndex=-1,a.contextLView=null,a.elementDepthCount=0,a.currentDirectiveIndex=-1,a.currentNamespace=null,a.bindingRootIndex=-1,a.bindingIndex=-1,a.currentQueryIndex=0}function Sr(){return rn.lFrame.selectedIndex}function Mo(a){rn.lFrame.selectedIndex=a}function or(){const a=rn.lFrame;return Tu(a.tView,a.selectedIndex)}function Cl(a,l){for(let c=l.directiveStart,h=l.directiveEnd;c<h;c++){const y=a.data[c].type.prototype,{ngAfterContentInit:E,ngAfterContentChecked:S,ngAfterViewInit:D,ngAfterViewChecked:L,ngOnDestroy:B}=y;E&&(a.contentHooks??(a.contentHooks=[])).push(-c,E),S&&((a.contentHooks??(a.contentHooks=[])).push(c,S),(a.contentCheckHooks??(a.contentCheckHooks=[])).push(c,S)),D&&(a.viewHooks??(a.viewHooks=[])).push(-c,D),L&&((a.viewHooks??(a.viewHooks=[])).push(c,L),(a.viewCheckHooks??(a.viewCheckHooks=[])).push(c,L)),null!=B&&(a.destroyHooks??(a.destroyHooks=[])).push(c,B)}}function Tc(a,l,c){Rl(a,l,3,c)}function Cu(a,l,c,h){(3&a[bn])===c&&Rl(a,l,c,h)}function Ic(a,l){let c=a[bn];(3&c)===l&&(c&=2047,c+=1,a[bn]=c)}function Rl(a,l,c,h){const y=h??-1,E=l.length-1;let S=0;for(let D=void 0!==h?65535&a[rs]:0;D<E;D++)if("number"==typeof l[D+1]){if(S=l[D],null!=h&&S>=h)break}else l[D]<0&&(a[rs]+=65536),(S<y||-1==y)&&(Ml(a,c,l,D),a[rs]=(4294901760&a[rs])+D+2),D++}function Ml(a,l,c,h){const p=c[h]<0,y=c[h+1],S=a[p?-c[h]:c[h]];if(p){if(a[bn]>>11<a[rs]>>16&&(3&a[bn])===l){a[bn]+=2048,Lr(4,S,y);try{y.call(S)}finally{Lr(5,S,y)}}}else{Lr(4,S,y);try{y.call(S)}finally{Lr(5,S,y)}}}const ua=-1;class ko{constructor(l,c,h){this.factory=l,this.resolving=!1,this.canSeeViewProviders=c,this.injectImpl=h}}function za(a,l,c){let h=0;for(;h<c.length;){const p=c[h];if("number"==typeof p){if(0!==p)break;h++;const y=c[h++],E=c[h++],S=c[h++];a.setAttribute(l,E,S,y)}else{const y=p,E=c[++h];Lo(y)?a.setProperty(l,y,E):a.setAttribute(l,y,E),h++}}return h}function ku(a){return 3===a||4===a||6===a}function Lo(a){return 64===a.charCodeAt(0)}function da(a,l){if(null!==l&&0!==l.length)if(null===a||0===a.length)a=l.slice();else{let c=-1;for(let h=0;h<l.length;h++){const p=l[h];"number"==typeof p?c=p:0===c||lo(a,c,p,null,-1===c||2===c?l[++h]:null)}}return a}function lo(a,l,c,h,p){let y=0,E=a.length;if(-1===l)E=-1;else for(;y<a.length;){const S=a[y++];if("number"==typeof S){if(S===l){E=-1;break}if(S>l){E=y-1;break}}}for(;y<a.length;){const S=a[y];if("number"==typeof S)break;if(S===c){if(null===h)return void(null!==p&&(a[y+1]=p));if(h===a[y+1])return void(a[y+2]=p)}y++,null!==h&&y++,null!==p&&y++}-1!==E&&(a.splice(E,0,l),y=E+1),a.splice(y++,0,c),null!==h&&a.splice(y++,0,h),null!==p&&a.splice(y++,0,p)}function kl(a){return a!==ua}function Ll(a){return 32767&a}function Sc(a,l){let c=function rp(a){return a>>16}(a),h=l;for(;c>0;)h=h[Va],c--;return h}let Dc=!0;function Wa(a){const l=Dc;return Dc=a,l}const ip=255,Lu=5;let Pu=0;const os={};function Qd(a,l){const c=sp(a,l);if(-1!==c)return c;const h=l[Et];h.firstCreatePass&&(a.injectorIndex=l.length,Xd(h.data,a),Xd(l,null),Xd(h.blueprint,null));const p=Po(a,l),y=a.injectorIndex;if(kl(p)){const E=Ll(p),S=Sc(p,l),D=S[Et].data;for(let L=0;L<8;L++)l[y+L]=S[E+L]|D[E+L]}return l[y+8]=p,y}function Xd(a,l){a.push(0,0,0,0,0,0,0,0,l)}function sp(a,l){return-1===a.injectorIndex||a.parent&&a.parent.injectorIndex===a.injectorIndex||null===l[a.injectorIndex+8]?-1:a.injectorIndex}function Po(a,l){if(a.parent&&-1!==a.parent.injectorIndex)return a.parent.injectorIndex;let c=0,h=null,p=l;for(;null!==p;){if(h=rh(p),null===h)return ua;if(c++,p=p[Va],-1!==h.injectorIndex)return h.injectorIndex|c<<16}return ua}function Oo(a,l,c){!function Zd(a,l,c){let h;"string"==typeof c?h=c.charCodeAt(0)||0:c.hasOwnProperty(Ut)&&(h=c[Ut]),null==h&&(h=c[Ut]=Pu++);const p=h&ip;l.data[a+(p>>Lu)]|=1<<p}(a,l,c)}function Nu(a,l,c){if(c&Ft.Optional||void 0!==a)return a;ct()}function Ac(a,l,c,h){if(c&Ft.Optional&&void 0===h&&(h=null),!(c&(Ft.Self|Ft.Host))){const p=a[sr],y=Fn(void 0);try{return p?p.get(l,h,c&Ft.Optional):Vi(l,h,c&Ft.Optional)}finally{Fn(y)}}return Nu(h,0,c)}function Jd(a,l,c,h=Ft.Default,p){if(null!==a){if(1024&l[bn]){const E=function nh(a,l,c,h,p){let y=a,E=l;for(;null!==y&&null!==E&&1024&E[bn]&&!(256&E[bn]);){const S=Fu(y,E,c,h|Ft.Self,os);if(S!==os)return S;let D=y.parent;if(!D){const L=E[cc];if(L){const B=L.get(c,os,h);if(B!==os)return B}D=rh(E),E=E[Va]}y=D}return p}(a,l,c,h,os);if(E!==os)return E}const y=Fu(a,l,c,h,os);if(y!==os)return y}return Ac(l,c,h,p)}function Fu(a,l,c,h,p){const y=function op(a){if("string"==typeof a)return a.charCodeAt(0)||0;const l=a.hasOwnProperty(Ut)?a[Ut]:void 0;return"number"==typeof l?l>=0?l&ip:th:l}(c);if("function"==typeof y){if(!jd(l,a,h))return h&Ft.Host?Nu(p,0,h):Ac(l,c,h,p);try{const E=y(h);if(null!=E||h&Ft.Optional)return E;ct()}finally{ao()}}else if("number"==typeof y){let E=null,S=sp(a,l),D=ua,L=h&Ft.Host?l[ii][Ii]:null;for((-1===S||h&Ft.SkipSelf)&&(D=-1===S?Po(a,l):l[S+8],D!==ua&&Uu(h,!1)?(E=l[Et],S=Ll(D),l=Sc(D,l)):S=-1);-1!==S;){const B=l[Et];if(ha(y,S,B.data)){const q=eh(S,l,c,E,h,L);if(q!==os)return q}D=l[S+8],D!==ua&&Uu(h,l[Et].data[S+8]===L)&&ha(y,S,l)?(E=B,S=Ll(D),l=Sc(D,l)):S=-1}}return p}function eh(a,l,c,h,p,y){const E=l[Et],S=E.data[a+8],B=co(S,E,c,null==h?is(S)&&Dc:h!=E&&0!=(3&S.type),p&Ft.Host&&y===S);return null!==B?uo(l,E,B,S):os}function co(a,l,c,h,p){const y=a.providerIndexes,E=l.data,S=1048575&y,D=a.directiveStart,B=y>>20,ae=p?S+B:a.directiveEnd;for(let he=h?S:S+B;he<ae;he++){const Pe=E[he];if(he<D&&c===Pe||he>=D&&Pe.type===c)return he}if(p){const he=E[D];if(he&&Is(he)&&he.type===c)return D}return null}function uo(a,l,c,h){let p=a[c];const y=l.data;if(function ep(a){return a instanceof ko}(p)){const E=p;E.resolving&&function Qe(a,l){const c=l?`. Dependency path: ${l.join(" > ")} > ${a}`:"";throw new Ae(-200,`Circular dependency in DI detected for ${a}${c}`)}(function at(a){return"function"==typeof a?a.name||a.toString():"object"==typeof a&&null!=a&&"function"==typeof a.type?a.type.name||a.type.toString():Ze(a)}(y[c]));const S=Wa(E.canSeeViewProviders);E.resolving=!0;const D=E.injectImpl?Fn(E.injectImpl):null;jd(a,h,Ft.Default);try{p=a[c]=E.factory(void 0,y,a,h),l.firstCreatePass&&c>=h.directiveStart&&function ca(a,l,c){const{ngOnChanges:h,ngOnInit:p,ngDoCheck:y}=l.type.prototype;if(h){const E=bu(l);(c.preOrderHooks??(c.preOrderHooks=[])).push(a,E),(c.preOrderCheckHooks??(c.preOrderCheckHooks=[])).push(a,E)}p&&(c.preOrderHooks??(c.preOrderHooks=[])).push(0-a,p),y&&((c.preOrderHooks??(c.preOrderHooks=[])).push(a,y),(c.preOrderCheckHooks??(c.preOrderCheckHooks=[])).push(a,y))}(c,y[c],l)}finally{null!==D&&Fn(D),Wa(S),E.resolving=!1,ao()}}return p}function ha(a,l,c){return!!(c[l+(a>>Lu)]&1<<a)}function Uu(a,l){return!(a&Ft.Self||a&Ft.Host&&l)}class fa{constructor(l,c){this._tNode=l,this._lView=c}get(l,c,h){return Jd(this._tNode,this._lView,l,ri(h),c)}}function th(){return new fa(oi(),Re())}function Bu(a){return Q(()=>{const l=a.prototype.constructor,c=l[fn]||Ka(l),h=Object.prototype;let p=Object.getPrototypeOf(a.prototype).constructor;for(;p&&p!==h;){const y=p[fn]||Ka(p);if(y&&y!==c)return y;p=Object.getPrototypeOf(p)}return y=>new y})}function Ka(a){return rt(a)?()=>{const l=Ka(ue(a));return l&&l()}:aa(a)}function rh(a){const l=a[Et],c=l.type;return 2===c?l.declTNode:1===c?a[Ii]:null}function qa(a){return function Ou(a,l){if("class"===l)return a.classes;if("style"===l)return a.styles;const c=a.attrs;if(c){const h=c.length;let p=0;for(;p<h;){const y=c[p];if(ku(y))break;if(0===y)p+=2;else if("number"==typeof y)for(p++;p<h&&"string"==typeof c[p];)p++;else{if(y===l)return c[p+1];p+=2}}}return null}(oi(),a)}const ho="__parameters__";function Ya(a,l,c){return Q(()=>{const h=function Cn(a){return function(...c){if(a){const h=a(...c);for(const p in h)this[p]=h[p]}}}(l);function p(...y){if(this instanceof p)return h.apply(this,y),this;const E=new p(...y);return S.annotation=E,S;function S(D,L,B){const q=D.hasOwnProperty(ho)?D[ho]:Object.defineProperty(D,ho,{value:[]})[ho];for(;q.length<=B;)q.push(null);return(q[B]=q[B]||[]).push(E),D}}return c&&(p.prototype=Object.create(c.prototype)),p.prototype.ngMetadataName=a,p.annotationCls=p,p})}class On{constructor(l,c){this._desc=l,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof c?this.__NG_ELEMENT_ID__=c:void 0!==c&&(this.\u0275prov=xt({token:this,providedIn:c.providedIn||"root",factory:c.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function ma(a,l){a.forEach(c=>Array.isArray(c)?ma(c,l):l(c))}function up(a,l,c){l>=a.length?a.push(c):a.splice(l,0,c)}function Ol(a,l){return l>=a.length-1?a.pop():a.splice(l,1)[0]}function Mc(a,l){const c=[];for(let h=0;h<a;h++)c.push(l);return c}function as(a,l,c){let h=Fi(a,l);return h>=0?a[1|h]=c:(h=~h,function Gu(a,l,c,h){let p=a.length;if(p==l)a.push(c,h);else if(1===p)a.push(h,a[0]),a[0]=c;else{for(p--,a.push(a[p-1],a[p]);p>l;)a[p]=a[p-2],p--;a[l]=c,a[l+1]=h}}(a,h,l,c)),h}function Wn(a,l){const c=Fi(a,l);if(c>=0)return a[1|c]}function Fi(a,l){return function ls(a,l,c){let h=0,p=a.length>>c;for(;p!==h;){const y=h+(p-h>>1),E=a[y<<c];if(l===E)return y<<c;E>l?p=y:h=y+1}return~(p<<c)}(a,l,1)}const ya=Hr(Ya("Optional"),8),Ht=Hr(Ya("SkipSelf"),4);var Xt=(()=>((Xt=Xt||{})[Xt.Important=1]="Important",Xt[Xt.DashCase=2]="DashCase",Xt))();const ph=new Map;let po=0;const J="__ngContext__";function ce(a,l){Si(l)?(a[J]=l[$a],function mh(a){ph.set(a[$a],a)}(l)):a[J]=l}let cn;function Pr(a,l){return cn(a,l)}function xs(a){const l=a[nr];return Gs(l)?l[nr]:l}function Gl(a){return pp(a[sa])}function Hl(a){return pp(a[Ni])}function pp(a){for(;null!==a&&!Gs(a);)a=a[Ni];return a}function el(a,l,c,h,p){if(null!=h){let y,E=!1;Gs(h)?y=h:Si(h)&&(E=!0,h=h[ns]);const S=An(h);0===a&&null!==c?null==p?qt(l,c,S):Mt(l,c,S,p||null,!0):1===a&&null!==c?Mt(l,c,S,p||null,!0):2===a?function q0(a,l,c){const h=ui(a,l);h&&function ci(a,l,c,h){a.removeChild(l,c,h)}(a,h,l,c)}(l,S,E):3===a&&l.destroyNode(S),null!=y&&function vp(a,l,c,h,p){const y=c[uc];y!==An(c)&&el(l,a,h,y,p);for(let S=gi;S<c.length;S++){const D=c[S];_p(D[Et],D,a,l,h,y)}}(l,a,y,c,p)}}function gp(a,l,c){return a.createElement(l,c)}function I(a,l){const c=a[$s],h=c.indexOf(l),p=l[nr];512&l[bn]&&(l[bn]&=-513,ja(p,-1)),c.splice(h,1)}function O(a,l){if(a.length<=gi)return;const c=gi+l,h=a[c];if(h){const p=h[_l];null!==p&&p!==a&&I(p,h),l>0&&(a[c-1][Ni]=h[Ni]);const y=Ol(a,gi+l);!function fg(a,l){_p(a,l,l[tn],2,null,null),l[ns]=null,l[Ii]=null}(h[Et],h);const E=y[io];null!==E&&E.detachView(y[Et]),h[nr]=null,h[Ni]=null,h[bn]&=-65}return h}function U(a,l){if(!(128&l[bn])){const c=l[tn];c.destroyNode&&_p(a,l,c,3,null,null),function M(a){let l=a[sa];if(!l)return Y(a[Et],a);for(;l;){let c=null;if(Si(l))c=l[sa];else{const h=l[gi];h&&(c=h)}if(!c){for(;l&&!l[Ni]&&l!==a;)Si(l)&&Y(l[Et],l),l=l[nr];null===l&&(l=a),Si(l)&&Y(l[Et],l),c=l&&l[Ni]}l=c}}(l)}}function Y(a,l){if(!(128&l[bn])){l[bn]&=-65,l[bn]|=128,function ge(a,l){let c;if(null!=a&&null!=(c=a.destroyHooks))for(let h=0;h<c.length;h+=2){const p=l[c[h]];if(!(p instanceof ko)){const y=c[h+1];if(Array.isArray(y))for(let E=0;E<y.length;E+=2){const S=p[y[E]],D=y[E+1];Lr(4,S,D);try{D.call(S)}finally{Lr(5,S,D)}}else{Lr(4,p,y);try{y.call(p)}finally{Lr(5,p,y)}}}}}(a,l),function oe(a,l){const c=a.cleanup,h=l[Ba];let p=-1;if(null!==c)for(let y=0;y<c.length-1;y+=2)if("string"==typeof c[y]){const E=c[y+3];E>=0?h[p=E]():h[p=-E].unsubscribe(),y+=2}else{const E=h[p=c[y+1]];c[y].call(E)}if(null!==h){for(let y=p+1;y<h.length;y++)(0,h[y])();l[Ba]=null}}(a,l),1===l[Et].type&&l[tn].destroy();const c=l[_l];if(null!==c&&Gs(l[nr])){c!==l[nr]&&I(c,l);const h=l[io];null!==h&&h.detachView(a)}!function dg(a){ph.delete(a[$a])}(l)}}function Be(a,l,c){return function jt(a,l,c){let h=l;for(;null!==h&&40&h.type;)h=(l=h).parent;if(null===h)return c[ns];{const{componentOffset:p}=h;if(p>-1){const{encapsulation:y}=a.data[h.directiveStart+p];if(y===j.None||y===j.Emulated)return null}return yi(h,c)}}(a,l.parent,c)}function Mt(a,l,c,h,p){a.insertBefore(l,c,h,p)}function qt(a,l,c){a.appendChild(l,c)}function Un(a,l,c,h,p){null!==h?Mt(a,l,c,h,p):qt(a,l,c)}function ui(a,l){return a.parentNode(l)}function yh(a,l,c){return tl(a,l,c)}let _h,Q0,pg,tl=function qu(a,l,c){return 40&a.type?yi(a,c):null};function Hc(a,l,c,h){const p=Be(a,h,l),y=l[tn],S=yh(h.parent||l[Ii],h,l);if(null!=p)if(Array.isArray(c))for(let D=0;D<c.length;D++)Un(y,p,c[D],S,!1);else Un(y,p,c,S,!1);void 0!==_h&&_h(y,h,l,c,p)}function bh(a,l){if(null!==l){const c=l.type;if(3&c)return yi(l,a);if(4&c)return nl(-1,a[l.index]);if(8&c){const h=l.child;if(null!==h)return bh(a,h);{const p=a[l.index];return Gs(p)?nl(-1,p):An(p)}}if(32&c)return Pr(l,a)()||An(a[l.index]);{const h=jc(a,l);return null!==h?Array.isArray(h)?h[0]:bh(xs(a[ii]),h):bh(a,l.next)}}return null}function jc(a,l){return null!==l?a[ii][Ii].projection[l.projection]:null}function nl(a,l){const c=gi+a+1;if(c<l.length){const h=l[c],p=h[Et].firstChild;if(null!==p)return bh(h,p)}return l[uc]}function yp(a,l,c,h,p,y,E){for(;null!=c;){const S=h[c.index],D=c.type;if(E&&0===l&&(S&&ce(An(S),h),c.flags|=2),32!=(32&c.flags))if(8&D)yp(a,l,c.child,h,p,y,!1),el(l,a,p,S,y);else if(32&D){const L=Pr(c,h);let B;for(;B=L();)el(l,a,p,B,y);el(l,a,p,S,y)}else 16&D?Y0(a,l,h,c,p,y):el(l,a,p,S,y);c=E?c.projectionNext:c.next}}function _p(a,l,c,h,p,y){yp(c,h,a.firstChild,l,p,y,!1)}function Y0(a,l,c,h,p,y){const E=c[ii],D=E[Ii].projection[h.projection];if(Array.isArray(D))for(let L=0;L<D.length;L++)el(l,a,p,D[L],y);else yp(a,l,D,E[nr],p,y,!0)}function zc(a,l,c){""===c?a.removeAttribute(l,"class"):a.setAttribute(l,"class",c)}function bp(a,l,c){const{mergedAttrs:h,classes:p,styles:y}=c;null!==h&&za(a,l,h),null!==p&&zc(a,l,p),null!==y&&function Z0(a,l,c){a.setAttribute(l,"style",c)}(a,l,y)}function cA(a){Q0=a}function YE(a){return function X0(){if(void 0===pg&&(pg=null,tr.trustedTypes))try{pg=tr.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:a=>a,createScript:a=>a,createScriptURL:a=>a})}catch{}return pg}()?.createScriptURL(a)||a}class ZE{constructor(l){this.changingThisBreaksApplicationSecurity=l}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${At})`}}function il(a){return a instanceof ZE?a.changingThisBreaksApplicationSecurity:a}function go(a,l){const c=function Th(a){return a instanceof ZE&&a.getTypeName()||null}(a);if(null!=c&&c!==l){if("ResourceURL"===c&&"URL"===l)return!0;throw new Error(`Required a safe ${l}, got a ${c} (see ${At})`)}return c===l}const eT=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var qr=(()=>((qr=qr||{})[qr.NONE=0]="NONE",qr[qr.HTML=1]="HTML",qr[qr.STYLE=2]="STYLE",qr[qr.SCRIPT=3]="SCRIPT",qr[qr.URL=4]="URL",qr[qr.RESOURCE_URL=5]="RESOURCE_URL",qr))();function sT(a){const l=Dp();return l?l.sanitize(qr.URL,a)||"":go(a,"URL")?il(a):function Tp(a){return(a=String(a)).match(eT)?a:"unsafe:"+a}(Ze(a))}function vg(a){const l=Dp();if(l)return YE(l.sanitize(qr.RESOURCE_URL,a)||"");if(go(a,"ResourceURL"))return YE(il(a));throw new Ae(904,!1)}function aT(a,l,c){return function TA(a,l){return"src"===l&&("embed"===a||"frame"===a||"iframe"===a||"media"===a||"script"===a)||"href"===l&&("base"===a||"link"===a)?vg:sT}(l,c)(a)}function Dp(){const a=Re();return a&&a[yl]}const a_=new On("ENVIRONMENT_INITIALIZER"),Zu=new On("INJECTOR",-1),Sh=new On("INJECTOR_DEF_TYPES");class lT{get(l,c=ni){if(c===ni){const h=new Error(`NullInjectorError: No provider for ${Oe(l)}!`);throw h.name="NullInjectorError",h}return c}}function Ap(...a){return{\u0275providers:Dh(0,a),\u0275fromNgModule:!0}}function Dh(a,...l){const c=[],h=new Set;let p;return ma(l,y=>{const E=y;l_(E,c,[],h)&&(p||(p=[]),p.push(E))}),void 0!==p&&cT(p,c),c}function cT(a,l){for(let c=0;c<a.length;c++){const{providers:p}=a[c];c_(p,y=>{l.push(y)})}}function l_(a,l,c,h){if(!(a=ue(a)))return!1;let p=null,y=Mr(a);const E=!y&&Lt(a);if(y||E){if(E&&!E.standalone)return!1;p=a}else{const D=a.ngModule;if(y=Mr(D),!y)return!1;p=D}const S=h.has(p);if(E){if(S)return!1;if(h.add(p),E.dependencies){const D="function"==typeof E.dependencies?E.dependencies():E.dependencies;for(const L of D)l_(L,l,c,h)}}else{if(!y)return!1;{if(null!=y.imports&&!S){let L;h.add(p);try{ma(y.imports,B=>{l_(B,l,c,h)&&(L||(L=[]),L.push(B))})}finally{}void 0!==L&&cT(L,l)}if(!S){const L=aa(p)||(()=>new p);l.push({provide:p,useFactory:L,deps:se},{provide:Sh,useValue:p,multi:!0},{provide:a_,useValue:()=>wn(p),multi:!0})}const D=y.providers;null==D||S||c_(D,B=>{l.push(B)})}}return p!==a&&void 0!==a.providers}function c_(a,l){for(let c of a)Ve(c)&&(c=c.\u0275providers),Array.isArray(c)?c_(c,l):l(c)}const wA=me({provide:String,useValue:me});function u_(a){return null!==a&&"object"==typeof a&&wA in a}function zl(a){return"function"==typeof a}const Wc=new On("Set Injector scope."),Eg={},DA={};let d_;function Tg(){return void 0===d_&&(d_=new lT),d_}class Qu{}class dT extends Qu{get destroyed(){return this._destroyed}constructor(l,c,h,p){super(),this.parent=c,this.source=h,this.scopes=p,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,xh(l,E=>this.processProvider(E)),this.records.set(Zu,Ah(void 0,this)),p.has("environment")&&this.records.set(Qu,Ah(void 0,this));const y=this.records.get(Wc);null!=y&&"string"==typeof y.value&&this.scopes.add(y.value),this.injectorDefTypes=new Set(this.get(Sh.multi,se,Ft.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const l of this._ngOnDestroyHooks)l.ngOnDestroy();for(const l of this._onDestroyHooks)l()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(l){this._onDestroyHooks.push(l)}runInContext(l){this.assertNotDestroyed();const c=an(this),h=Fn(void 0);try{return l()}finally{an(c),Fn(h)}}get(l,c=ni,h=Ft.Default){this.assertNotDestroyed(),h=ri(h);const p=an(this),y=Fn(void 0);try{if(!(h&Ft.SkipSelf)){let S=this.records.get(l);if(void 0===S){const D=function m_(a){return"function"==typeof a||"object"==typeof a&&a instanceof On}(l)&&Dn(l);S=D&&this.injectableDefInScope(D)?Ah(h_(l),Eg):null,this.records.set(l,S)}if(null!=S)return this.hydrate(l,S)}return(h&Ft.Self?Tg():this.parent).get(l,c=h&Ft.Optional&&c===ni?null:c)}catch(E){if("NullInjectorError"===E.name){if((E[br]=E[br]||[]).unshift(Oe(l)),p)throw E;return function bs(a,l,c,h){const p=a[br];throw l[zn]&&p.unshift(l[zn]),a.message=function re(a,l,c,h=null){a=a&&"\n"===a.charAt(0)&&a.charAt(1)==ra?a.slice(2):a;let p=Oe(l);if(Array.isArray(l))p=l.map(Oe).join(" -> ");else if("object"==typeof l){let y=[];for(let E in l)if(l.hasOwnProperty(E)){let S=l[E];y.push(E+":"+("string"==typeof S?JSON.stringify(S):Oe(S)))}p=`{${y.join(", ")}}`}return`${c}${h?"("+h+")":""}[${p}]: ${a.replace($r,"\n  ")}`}("\n"+a.message,p,c,h),a[mi]=p,a[br]=null,a}(E,l,"R3InjectorError",this.source)}throw E}finally{Fn(y),an(p)}}resolveInjectorInitializers(){const l=an(this),c=Fn(void 0);try{const h=this.get(a_.multi,se,Ft.Self);for(const p of h)p()}finally{an(l),Fn(c)}}toString(){const l=[],c=this.records;for(const h of c.keys())l.push(Oe(h));return`R3Injector[${l.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ae(205,!1)}processProvider(l){let c=zl(l=ue(l))?l:ue(l&&l.provide);const h=function xA(a){return u_(a)?Ah(void 0,a.useValue):Ah(f_(a),Eg)}(l);if(zl(l)||!0!==l.multi)this.records.get(c);else{let p=this.records.get(c);p||(p=Ah(void 0,Eg,!0),p.factory=()=>es(p.multi),this.records.set(c,p)),c=l,p.multi.push(l)}this.records.set(c,h)}hydrate(l,c){return c.value===Eg&&(c.value=DA,c.value=c.factory()),"object"==typeof c.value&&c.value&&function hT(a){return null!==a&&"object"==typeof a&&"function"==typeof a.ngOnDestroy}(c.value)&&this._ngOnDestroyHooks.add(c.value),c.value}injectableDefInScope(l){if(!l.providedIn)return!1;const c=ue(l.providedIn);return"string"==typeof c?"any"===c||this.scopes.has(c):this.injectorDefTypes.has(c)}}function h_(a){const l=Dn(a),c=null!==l?l.factory:aa(a);if(null!==c)return c;if(a instanceof On)throw new Ae(204,!1);if(a instanceof Function)return function AA(a){const l=a.length;if(l>0)throw Mc(l,"?"),new Ae(204,!1);const c=function Rr(a){return a&&(a[yr]||a[ti])||null}(a);return null!==c?()=>c.factory(a):()=>new a}(a);throw new Ae(204,!1)}function f_(a,l,c){let h;if(zl(a)){const p=ue(a);return aa(p)||h_(p)}if(u_(a))h=()=>ue(a.useValue);else if(function uT(a){return!(!a||!a.useFactory)}(a))h=()=>a.useFactory(...es(a.deps||[]));else if(function SA(a){return!(!a||!a.useExisting)}(a))h=()=>wn(ue(a.useExisting));else{const p=ue(a&&(a.useClass||a.provide));if(!function p_(a){return!!a.deps}(a))return aa(p)||h_(p);h=()=>new p(...es(a.deps))}return h}function Ah(a,l,c=!1){return{factory:a,value:l,multi:c?[]:void 0}}function xh(a,l){for(const c of a)Array.isArray(c)?xh(c,l):c&&Ve(c)?xh(c.\u0275providers,l):l(c)}class CA{}class fT{}class mT{resolveComponentFactory(l){throw function RA(a){const l=Error(`No component factory found for ${Oe(a)}. Did you add it to @NgModule.entryComponents?`);return l.ngComponent=a,l}(l)}}let Ch=(()=>{class a{}return a.NULL=new mT,a})();function Ig(){return Wl(oi(),Re())}function Wl(a,l){return new Rh(yi(a,l))}let Rh=(()=>{class a{constructor(c){this.nativeElement=c}}return a.__NG_ELEMENT_ID__=Ig,a})();function xp(a){return a instanceof Rh?a.nativeElement:a}class y_{}let MA=(()=>{class a{}return a.__NG_ELEMENT_ID__=()=>function kA(){const a=Re(),c=si(oi().index,a);return(Si(c)?c:a)[tn]}(),a})(),LA=(()=>{class a{}return a.\u0275prov=xt({token:a,providedIn:"root",factory:()=>null}),a})();class gT{constructor(l){this.full=l,this.major=l.split(".")[0],this.minor=l.split(".")[1],this.patch=l.split(".").slice(2).join(".")}}const yT=new gT("15.2.9"),wg={},__="ngOriginalError";function v_(a){return a[__]}class Cp{constructor(){this._console=console}handleError(l){const c=this._findOriginalError(l);this._console.error("ERROR",l),c&&this._console.error("ORIGINAL ERROR",c)}_findOriginalError(l){let c=l&&v_(l);for(;c&&v_(c);)c=v_(c);return c||null}}function vT(a){return a.ownerDocument.defaultView}function sl(a){return a instanceof Function?a():a}function wT(a,l,c){let h=a.length;for(;;){const p=a.indexOf(l,c);if(-1===p)return p;if(0===p||a.charCodeAt(p-1)<=32){const y=l.length;if(p+y===h||a.charCodeAt(p+y)<=32)return p}c=p+1}}const b_="ng-template";function E_(a,l,c){let h=0,p=!0;for(;h<a.length;){let y=a[h++];if("string"==typeof y&&p){const E=a[h++];if(c&&"class"===y&&-1!==wT(E.toLowerCase(),l,0))return!0}else{if(1===y){for(;h<a.length&&"string"==typeof(y=a[h++]);)if(y.toLowerCase()===l)return!0;return!1}"number"==typeof y&&(p=!1)}}return!1}function T_(a){return 4===a.type&&a.value!==b_}function Mh(a,l,c){return l===(4!==a.type||c?a.value:b_)}function I_(a,l,c){let h=4;const p=a.attrs||[],y=function DT(a){for(let l=0;l<a.length;l++)if(ku(a[l]))return l;return a.length}(p);let E=!1;for(let S=0;S<l.length;S++){const D=l[S];if("number"!=typeof D){if(!E)if(4&h){if(h=2|1&h,""!==D&&!Mh(a,D,c)||""===D&&1===l.length){if(Ia(h))return!1;E=!0}}else{const L=8&h?D:l[++S];if(8&h&&null!==a.attrs){if(!E_(a.attrs,L,c)){if(Ia(h))return!1;E=!0}continue}const q=ST(8&h?"class":D,p,T_(a),c);if(-1===q){if(Ia(h))return!1;E=!0;continue}if(""!==L){let ae;ae=q>y?"":p[q+1].toLowerCase();const he=8&h?ae:null;if(he&&-1!==wT(he,L,0)||2&h&&L!==ae){if(Ia(h))return!1;E=!0}}}}else{if(!E&&!Ia(h)&&!Ia(D))return!1;if(E&&Ia(D))continue;E=!1,h=D|1&h}}return Ia(h)||E}function Ia(a){return 0==(1&a)}function ST(a,l,c,h){if(null===l)return-1;let p=0;if(h||!c){let y=!1;for(;p<l.length;){const E=l[p];if(E===a)return p;if(3===E||6===E)y=!0;else{if(1===E||2===E){let S=l[++p];for(;"string"==typeof S;)S=l[++p];continue}if(4===E)break;if(0===E){p+=4;continue}}p+=y?1:2}return-1}return function AT(a,l){let c=a.indexOf(4);if(c>-1)for(c++;c<a.length;){const h=a[c];if("number"==typeof h)return-1;if(h===l)return c;c++}return-1}(l,a)}function Mp(a,l,c=!1){for(let h=0;h<l.length;h++)if(I_(a,l[h],c))return!0;return!1}function BA(a,l){e:for(let c=0;c<l.length;c++){const h=l[c];if(a.length===h.length){for(let p=0;p<a.length;p++)if(a[p]!==h[p])continue e;return!0}}return!1}function xT(a,l){return a?":not("+l.trim()+")":l}function VA(a){let l=a[0],c=1,h=2,p="",y=!1;for(;c<a.length;){let E=a[c];if("string"==typeof E)if(2&h){const S=a[++c];p+="["+E+(S.length>0?'="'+S+'"':"")+"]"}else 8&h?p+="."+E:4&h&&(p+=" "+E);else""!==p&&!Ia(E)&&(l+=xT(y,p),p=""),h=E,y=y||!Ia(h);c++}return""!==p&&(l+=xT(y,p)),l}const gn={};function CT(a){RT(mn(),Re(),Sr()+a,!1)}function RT(a,l,c,h){if(!h)if(3==(3&l[bn])){const y=a.preOrderCheckHooks;null!==y&&Tc(l,y,c)}else{const y=a.preOrderHooks;null!==y&&Cu(l,y,0,c)}Mo(c)}function kT(a,l=null,c=null,h){const p=S_(a,l,c,h);return p.resolveInjectorInitializers(),p}function S_(a,l=null,c=null,h,p=new Set){const y=[c||se,Ap(a)];return h=h||("object"==typeof a?void 0:Oe(a)),new dT(y,l||Tg(),h||null,p)}let kh=(()=>{class a{static create(c,h){if(Array.isArray(c))return kT({name:""},h,c,"");{const p=c.name??"";return kT({name:p},c.parent,c.providers,p)}}}return a.THROW_IF_NOT_FOUND=ni,a.NULL=new lT,a.\u0275prov=xt({token:a,providedIn:"any",factory:()=>wn(Zu)}),a.__NG_ELEMENT_ID__=-1,a})();function Oh(a,l=Ft.Default){const c=Re();return null===c?wn(a,l):Jd(oi(),c,ue(a),l)}function FT(){throw new Error("invalid")}function UT(a,l){const c=a.contentQueries;if(null!==c)for(let h=0;h<c.length;h+=2){const y=c[h+1];if(-1!==y){const E=a.data[y];Di(c[h]),E.contentQueries(2,l[y],y)}}}function xg(a,l,c,h,p,y,E,S,D,L,B){const q=l.blueprint.slice();return q[ns]=p,q[bn]=76|h,(null!==B||a&&1024&a[bn])&&(q[bn]|=1024),yc(q),q[nr]=q[Va]=a,q[pn]=c,q[ia]=E||a&&a[ia],q[tn]=S||a&&a[tn],q[yl]=D||a&&a[yl]||null,q[sr]=L||a&&a[sr]||null,q[Ii]=y,q[$a]=function Wu(){return po++}(),q[cc]=B,q[ii]=2==l.type?a[ii]:q,q}function Op(a,l,c,h,p){let y=a.data[l];if(null===y)y=function Cg(a,l,c,h,p){const y=Gd(),E=Su(),D=a.data[l]=function Ne(a,l,c,h,p,y){return{type:c,index:h,insertBeforeIndex:null,injectorIndex:l?l.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:p,attrs:y,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:l,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,E?y:y&&y.parent,c,l,h,p);return null===a.firstChild&&(a.firstChild=D),null!==y&&(E?null==y.child&&null!==D.parent&&(y.child=D):null===y.next&&(y.next=D,D.prev=y)),D}(a,l,c,h,p),function Hd(){return rn.lFrame.inI18n}()&&(y.flags|=32);else if(64&y.type){y.type=c,y.value=h,y.attrs=p;const E=function Il(){const a=rn.lFrame,l=a.currentTNode;return a.isParent?l:l.parent}();y.injectorIndex=null===E?-1:E.injectorIndex}return ai(y,!0),y}function Np(a,l,c,h){if(0===c)return-1;const p=l.length;for(let y=0;y<c;y++)l.push(h),a.blueprint.push(h),a.data.push(null);return p}function Rg(a,l,c){xl(l);try{const h=a.viewQuery;null!==h&&Ng(1,h,c);const p=a.template;null!==p&&R_(a,l,p,1,c),a.firstCreatePass&&(a.firstCreatePass=!1),a.staticContentQueries&&UT(a,l),a.staticViewQueries&&Ng(2,a.viewQuery,c);const y=a.components;null!==y&&function BT(a,l){for(let c=0;c<l.length;c++)O_(a,l[c])}(l,y)}catch(h){throw a.firstCreatePass&&(a.incompleteFirstPass=!0,a.firstCreatePass=!1),h}finally{l[bn]&=-5,la()}}function Nh(a,l,c,h){const p=l[bn];if(128!=(128&p)){xl(l);try{yc(l),function Ss(a){return rn.lFrame.bindingIndex=a}(a.bindingStartIndex),null!==c&&R_(a,l,c,2,h);const E=3==(3&p);if(E){const L=a.preOrderCheckHooks;null!==L&&Tc(l,L,null)}else{const L=a.preOrderHooks;null!==L&&Cu(l,L,0,null),Ic(l,0)}if(function zT(a){for(let l=Gl(a);null!==l;l=Hl(l)){if(!l[wi])continue;const c=l[$s];for(let h=0;h<c.length;h++){const p=c[h];512&p[bn]||ja(p[nr],1),p[bn]|=512}}}(l),function jT(a){for(let l=Gl(a);null!==l;l=Hl(l))for(let c=gi;c<l.length;c++){const h=l[c],p=h[Et];ws(h)&&Nh(p,h,p.template,h[pn])}}(l),null!==a.contentQueries&&UT(a,l),E){const L=a.contentCheckHooks;null!==L&&Tc(l,L)}else{const L=a.contentHooks;null!==L&&Cu(l,L,1),Ic(l,1)}!function rx(a,l){const c=a.hostBindingOpCodes;if(null!==c)try{for(let h=0;h<c.length;h++){const p=c[h];if(p<0)Mo(~p);else{const y=p,E=c[++h],S=c[++h];Al(E,y),S(2,l[y])}}}finally{Mo(-1)}}(a,l);const S=a.components;null!==S&&function ix(a,l){for(let c=0;c<l.length;c++)fx(a,l[c])}(l,S);const D=a.viewQuery;if(null!==D&&Ng(2,D,h),E){const L=a.viewCheckHooks;null!==L&&Tc(l,L)}else{const L=a.viewHooks;null!==L&&Cu(l,L,2),Ic(l,2)}!0===a.firstUpdatePass&&(a.firstUpdatePass=!1),l[bn]&=-41,512&l[bn]&&(l[bn]&=-513,ja(l[nr],-1))}finally{la()}}}function R_(a,l,c,h,p){const y=Sr(),E=2&h;try{Mo(-1),E&&l.length>er&&RT(a,l,er,!1),Lr(E?2:0,p),c(h,p)}finally{Mo(y),Lr(E?3:1,p)}}function hs(a,l,c){if(oa(l)){const p=l.directiveEnd;for(let y=l.directiveStart;y<p;y++){const E=a.data[y];E.contentQueries&&E.contentQueries(1,c[y],y)}}}function M_(a,l,c){wu()&&(function $T(a,l,c,h){const p=c.directiveStart,y=c.directiveEnd;is(c)&&function hx(a,l,c){const h=yi(l,a),p=VT(c),y=a[ia],E=Pg(a,xg(a,p,null,c.onPush?32:16,h,l,y,y.createRenderer(h,c),null,null,null));a[l.index]=E}(l,c,a.data[p+c.componentOffset]),a.firstCreatePass||Qd(c,l),ce(h,l);const E=c.initialInputs;for(let S=p;S<y;S++){const D=a.data[S],L=uo(l,a,S,c);ce(L,l),null!==E&&HT(0,S-p,L,D,0,E),Is(D)&&(si(c.index,l)[pn]=uo(l,a,S,c))}}(a,l,c,yi(c,l)),64==(64&c.flags)&&Up(a,l,c))}function di(a,l,c=yi){const h=l.localNames;if(null!==h){let p=l.index+1;for(let y=0;y<h.length;y+=2){const E=h[y+1],S=-1===E?c(l,a):a[E];a[p++]=S}}}function VT(a){const l=a.tView;return null===l||l.incompleteFirstPass?a.tView=k_(1,null,a.template,a.decls,a.vars,a.directiveDefs,a.pipeDefs,a.viewQuery,a.schemas,a.consts):l}function k_(a,l,c,h,p,y,E,S,D,L){const B=er+h,q=B+p,ae=function en(a,l){const c=[];for(let h=0;h<l;h++)c.push(h<a?null:gn);return c}(B,q),he="function"==typeof L?L():L;return ae[Et]={type:a,blueprint:ae,template:c,queries:null,viewQuery:S,declTNode:l,data:ae.slice().fill(null,B),bindingStartIndex:B,expandoStartIndex:q,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof y?y():y,pipeRegistry:"function"==typeof E?E():E,firstChild:null,schemas:D,consts:he,incompleteFirstPass:!1}}function ln(a,l,c,h){const p=Vp(l);null===c?p.push(h):(p.push(c),a.firstCreatePass&&qT(a).push(h,p.length-1))}function Kc(a,l,c,h){for(let p in a)if(a.hasOwnProperty(p)){c=null===c?{}:c;const y=a[p];null===h?Mg(c,l,p,y):h.hasOwnProperty(p)&&Mg(c,l,h[p],y)}return c}function Mg(a,l,c,h){a.hasOwnProperty(c)?a[c].push(l,h):a[c]=[l,h]}function kg(a,l,c,h){if(wu()){const p=null===h?null:{"":-1},y=function GT(a,l){const c=a.directiveRegistry;let h=null,p=null;if(c)for(let y=0;y<c.length;y++){const E=c[y];if(Mp(l,E.selectors,!1))if(h||(h=[]),Is(E))if(null!==E.findHostDirectiveDefs){const S=[];p=p||new Map,E.findHostDirectiveDefs(E,S,p),h.unshift(...S,E),Bp(a,l,S.length)}else h.unshift(E),Bp(a,l,0);else p=p||new Map,E.findHostDirectiveDefs?.(E,h,p),h.push(E)}return null===h?null:[h,p]}(a,c);let E,S;null===y?E=S=null:[E,S]=y,null!==E&&Ar(a,l,c,E,p,S),p&&function cx(a,l,c){if(l){const h=a.localNames=[];for(let p=0;p<l.length;p+=2){const y=c[l[p+1]];if(null==y)throw new Ae(-301,!1);h.push(l[p],y)}}}(c,h,p)}c.mergedAttrs=da(c.mergedAttrs,c.attrs)}function Ar(a,l,c,h,p,y){for(let L=0;L<h.length;L++)Oo(Qd(c,l),a,h[L].type);!function dx(a,l,c){a.flags|=1,a.directiveStart=l,a.directiveEnd=l+c,a.providerIndexes=l}(c,a.data.length,h.length);for(let L=0;L<h.length;L++){const B=h[L];B.providersResolver&&B.providersResolver(B)}let E=!1,S=!1,D=Np(a,l,h.length,null);for(let L=0;L<h.length;L++){const B=h[L];c.mergedAttrs=da(c.mergedAttrs,B.hostAttrs),L_(a,c,l,D,B),ux(D,B,p),null!==B.contentQueries&&(c.flags|=4),(null!==B.hostBindings||null!==B.hostAttrs||0!==B.hostVars)&&(c.flags|=64);const q=B.type.prototype;!E&&(q.ngOnChanges||q.ngOnInit||q.ngDoCheck)&&((a.preOrderHooks??(a.preOrderHooks=[])).push(c.index),E=!0),!S&&(q.ngOnChanges||q.ngDoCheck)&&((a.preOrderCheckHooks??(a.preOrderCheckHooks=[])).push(c.index),S=!0),D++}!function Fp(a,l,c){const p=l.directiveEnd,y=a.data,E=l.attrs,S=[];let D=null,L=null;for(let B=l.directiveStart;B<p;B++){const q=y[B],ae=c?c.get(q):null,Pe=ae?ae.outputs:null;D=Kc(q.inputs,B,D,ae?ae.inputs:null),L=Kc(q.outputs,B,L,Pe);const lt=null===D||null===E||T_(l)?null:Or(D,B,E);S.push(lt)}null!==D&&(D.hasOwnProperty("class")&&(l.flags|=8),D.hasOwnProperty("style")&&(l.flags|=16)),l.initialInputs=S,l.inputs=D,l.outputs=L}(a,c,y)}function Up(a,l,c){const h=c.directiveStart,p=c.directiveEnd,y=c.index,E=function j0(){return rn.lFrame.currentDirectiveIndex}();try{Mo(y);for(let S=h;S<p;S++){const D=a.data[S],L=l[S];Ds(S),(null!==D.hostBindings||0!==D.hostVars||null!==D.hostAttrs)&&hr(D,L)}}finally{Mo(-1),Ds(E)}}function hr(a,l){null!==a.hostBindings&&a.hostBindings(1,l)}function Bp(a,l,c){l.componentOffset=c,(a.components??(a.components=[])).push(l.index)}function ux(a,l,c){if(c){if(l.exportAs)for(let h=0;h<l.exportAs.length;h++)c[l.exportAs[h]]=a;Is(l)&&(c[""]=a)}}function L_(a,l,c,h,p){a.data[h]=p;const y=p.factory||(p.factory=aa(p.type)),E=new ko(y,Is(p),Oh);a.blueprint[h]=E,c[h]=E,function ax(a,l,c,h,p){const y=p.hostBindings;if(y){let E=a.hostBindingOpCodes;null===E&&(E=a.hostBindingOpCodes=[]);const S=~l.index;(function lx(a){let l=a.length;for(;l>0;){const c=a[--l];if("number"==typeof c&&c<0)return c}return 0})(E)!=S&&E.push(S),E.push(c,h,y)}}(a,l,h,Np(a,c,p.hostVars,gn),p)}function ol(a,l,c,h,p,y){const E=yi(a,l);!function P_(a,l,c,h,p,y,E){if(null==y)a.removeAttribute(l,p,c);else{const S=null==E?Ze(y):E(y,h||"",p);a.setAttribute(l,p,S,c)}}(l[tn],E,y,a.value,c,h,p)}function HT(a,l,c,h,p,y){const E=y[l];if(null!==E){const S=h.setInput;for(let D=0;D<E.length;){const L=E[D++],B=E[D++],q=E[D++];null!==S?h.setInput(c,q,L,B):c[B]=q}}}function Or(a,l,c){let h=null,p=0;for(;p<c.length;){const y=c[p];if(0!==y)if(5!==y){if("number"==typeof y)break;if(a.hasOwnProperty(y)){null===h&&(h=[]);const E=a[y];for(let S=0;S<E.length;S+=2)if(E[S]===l){h.push(y,E[S+1],c[p+1]);break}}p+=2}else p+=2;else p+=4}return h}function Ms(a,l,c,h){return[a,!0,!1,l,null,0,h,c,null,null]}function fx(a,l){const c=si(l,a);if(ws(c)){const h=c[Et];48&c[bn]?Nh(h,c,h.template,c[pn]):c[ro]>0&&Lg(c)}}function Lg(a){for(let h=Gl(a);null!==h;h=Hl(h))for(let p=gi;p<h.length;p++){const y=h[p];if(ws(y))if(512&y[bn]){const E=y[Et];Nh(E,y,E.template,y[pn])}else y[ro]>0&&Lg(y)}const c=a[Et].components;if(null!==c)for(let h=0;h<c.length;h++){const p=si(c[h],a);ws(p)&&p[ro]>0&&Lg(p)}}function O_(a,l){const c=si(l,a),h=c[Et];(function WT(a,l){for(let c=l.length;c<a.blueprint.length;c++)l.push(a.blueprint[c])})(h,c),Rg(h,c,c[pn])}function Pg(a,l){return a[sa]?a[Ao][Ni]=l:a[sa]=l,a[Ao]=l,l}function Og(a){for(;a;){a[bn]|=32;const l=xs(a);if(so(a)&&!l)return a;a=l}return null}function al(a,l,c,h=!0){const p=l[ia];p.begin&&p.begin();try{Nh(a,l,a.template,c)}catch(E){throw h&&F_(l,E),E}finally{p.end&&p.end()}}function Ng(a,l,c){Di(0),l(a,c)}function Vp(a){return a[Ba]||(a[Ba]=[])}function qT(a){return a.cleanup||(a.cleanup=[])}function F_(a,l){const c=a[sr],h=c?c.get(Cp,null):null;h&&h.handleError(l)}function U_(a,l,c,h,p){for(let y=0;y<c.length;){const E=c[y++],S=c[y++],D=l[E],L=a.data[E];null!==L.setInput?L.setInput(D,p,h,S):D[S]=p}}function Fg(a,l,c){let h=c?a.styles:null,p=c?a.classes:null,y=0;if(null!==l)for(let E=0;E<l.length;E++){const S=l[E];"number"==typeof S?y=S:1==y?p=Ce(p,S):2==y&&(h=Ce(h,S+": "+l[++E]+";"))}c?a.styles=h:a.stylesWithoutHost=h,c?a.classes=p:a.classesWithoutHost=p}function Ug(a,l,c,h,p=!1){for(;null!==c;){const y=l[c.index];if(null!==y&&h.push(An(y)),Gs(y))for(let S=gi;S<y.length;S++){const D=y[S],L=D[Et].firstChild;null!==L&&Ug(D[Et],D,L,h)}const E=c.type;if(8&E)Ug(a,l,c.child,h);else if(32&E){const S=Pr(c,l);let D;for(;D=S();)h.push(D)}else if(16&E){const S=jc(l,c);if(Array.isArray(S))h.push(...S);else{const D=xs(l[ii]);Ug(D[Et],D,S,h,!0)}}c=p?c.projectionNext:c.next}return h}class $p{get rootNodes(){const l=this._lView,c=l[Et];return Ug(c,l,c.firstChild,[])}constructor(l,c){this._lView=l,this._cdRefInjectingView=c,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[pn]}set context(l){this._lView[pn]=l}get destroyed(){return 128==(128&this._lView[bn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const l=this._lView[nr];if(Gs(l)){const c=l[vl],h=c?c.indexOf(this):-1;h>-1&&(O(l,h),Ol(c,h))}this._attachedToViewContainer=!1}U(this._lView[Et],this._lView)}onDestroy(l){ln(this._lView[Et],this._lView,null,l)}markForCheck(){Og(this._cdRefInjectingView||this._lView)}detach(){this._lView[bn]&=-65}reattach(){this._lView[bn]|=64}detectChanges(){al(this._lView[Et],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ae(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function gh(a,l){_p(a,l,l[tn],2,null,null)}(this._lView[Et],this._lView)}attachToAppRef(l){if(this._attachedToViewContainer)throw new Ae(902,!1);this._appRef=l}}class px extends $p{constructor(l){super(l),this._view=l}detectChanges(){const l=this._view;al(l[Et],l,l[pn],!1)}checkNoChanges(){}get context(){return null}}class ZT extends Ch{constructor(l){super(),this.ngModule=l}resolveComponentFactory(l){const c=Lt(l);return new Ks(c,this.ngModule)}}function wa(a){const l=[];for(let c in a)a.hasOwnProperty(c)&&l.push({propName:a[c],templateName:c});return l}class mx{constructor(l,c){this.injector=l,this.parentInjector=c}get(l,c,h){h=ri(h);const p=this.injector.get(l,wg,h);return p!==wg||c===wg?p:this.parentInjector.get(l,c,h)}}class Ks extends fT{get inputs(){return wa(this.componentDef.inputs)}get outputs(){return wa(this.componentDef.outputs)}constructor(l,c){super(),this.componentDef=l,this.ngModule=c,this.componentType=l.type,this.selector=function $A(a){return a.map(VA).join(",")}(l.selectors),this.ngContentSelectors=l.ngContentSelectors?l.ngContentSelectors:[],this.isBoundToModule=!!c}create(l,c,h,p){let y=(p=p||this.ngModule)instanceof Qu?p:p?.injector;y&&null!==this.componentDef.getStandaloneInjector&&(y=this.componentDef.getStandaloneInjector(y)||y);const E=y?new mx(l,y):l,S=E.get(y_,null);if(null===S)throw new Ae(407,!1);const D=E.get(LA,null),L=S.createRenderer(null,this.componentDef),B=this.componentDef.selectors[0][0]||"div",q=h?function F(a,l,c){return a.selectRootElement(l,c===j.ShadowDom)}(L,h,this.componentDef.encapsulation):gp(L,B,function B_(a){const l=a.toLowerCase();return"svg"===l?"svg":"math"===l?"math":null}(B)),ae=this.componentDef.onPush?288:272,he=k_(0,null,null,1,0,null,null,null,null,null),Pe=xg(null,he,null,ae,null,null,S,L,D,E,null);let lt,mt;xl(Pe);try{const Pt=this.componentDef;let on,Ye=null;Pt.findHostDirectiveDefs?(on=[],Ye=new Map,Pt.findHostDirectiveDefs(Pt,on,Ye),on.push(Pt)):on=[Pt];const _n=function QT(a,l){const c=a[Et],h=er;return a[h]=l,Op(c,h,2,"#host",null)}(Pe,q),Ir=function Ki(a,l,c,h,p,y,E,S){const D=p[Et];!function XT(a,l,c,h){for(const p of a)l.mergedAttrs=da(l.mergedAttrs,p.hostAttrs);null!==l.mergedAttrs&&(Fg(l,l.mergedAttrs,!0),null!==c&&bp(h,c,l))}(h,a,l,E);const L=y.createRenderer(l,c),B=xg(p,VT(c),null,c.onPush?32:16,p[a.index],a,y,L,S||null,null,null);return D.firstCreatePass&&Bp(D,a,h.length-1),Pg(p,B),p[a.index]=B}(_n,q,Pt,on,Pe,S,L);mt=Tu(he,er),q&&function JT(a,l,c,h){if(h)za(a,c,["ng-version",yT.full]);else{const{attrs:p,classes:y}=function GA(a){const l=[],c=[];let h=1,p=2;for(;h<a.length;){let y=a[h];if("string"==typeof y)2===p?""!==y&&l.push(y,a[++h]):8===p&&c.push(y);else{if(!Ia(p))break;p=y}h++}return{attrs:l,classes:c}}(l.selectors[0]);p&&za(a,c,p),y&&y.length>0&&zc(a,c,y.join(" "))}}(L,Pt,q,h),void 0!==c&&function V_(a,l,c){const h=a.projection=[];for(let p=0;p<l.length;p++){const y=c[p];h.push(null!=y?Array.from(y):null)}}(mt,this.ngContentSelectors,c),lt=function yn(a,l,c,h,p,y){const E=oi(),S=p[Et],D=yi(E,p);Ar(S,p,E,c,null,h);for(let B=0;B<c.length;B++)ce(uo(p,S,E.directiveStart+B,E),p);Up(S,p,E),D&&ce(D,p);const L=uo(p,S,E.directiveStart+E.componentOffset,E);if(a[pn]=p[pn]=L,null!==y)for(const B of y)B(L,l);return hs(S,E,a),L}(Ir,Pt,on,Ye,Pe,[Kn]),Rg(he,Pe,null)}finally{la()}return new Bg(this.componentType,lt,Wl(mt,Pe),Pe,mt)}}class Bg extends CA{constructor(l,c,h,p,y){super(),this.location=h,this._rootLView=p,this._tNode=y,this.instance=c,this.hostView=this.changeDetectorRef=new px(p),this.componentType=l}setInput(l,c){const h=this._tNode.inputs;let p;if(null!==h&&(p=h[l])){const y=this._rootLView;U_(y[Et],y,p,l,c),Og(si(this._tNode.index,y))}}get injector(){return new fa(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(l){this.hostView.onDestroy(l)}}function Kn(){const a=oi();Cl(Re()[Et],a)}function Vg(a){let l=function eI(a){return Object.getPrototypeOf(a.prototype).constructor}(a.type),c=!0;const h=[a];for(;l;){let p;if(Is(a))p=l.\u0275cmp||l.\u0275dir;else{if(l.\u0275cmp)throw new Ae(903,!1);p=l.\u0275dir}if(p){if(c){h.push(p);const E=a;E.inputs=$g(a.inputs),E.declaredInputs=$g(a.declaredInputs),E.outputs=$g(a.outputs);const S=p.hostBindings;S&&vx(a,S);const D=p.viewQuery,L=p.contentQueries;if(D&&yx(a,D),L&&_x(a,L),Le(a.inputs,p.inputs),Le(a.declaredInputs,p.declaredInputs),Le(a.outputs,p.outputs),Is(p)&&p.data.animation){const B=a.data;B.animation=(B.animation||[]).concat(p.data.animation)}}const y=p.features;if(y)for(let E=0;E<y.length;E++){const S=y[E];S&&S.ngInherit&&S(a),S===Vg&&(c=!1)}}l=Object.getPrototypeOf(l)}!function gx(a){let l=0,c=null;for(let h=a.length-1;h>=0;h--){const p=a[h];p.hostVars=l+=p.hostVars,p.hostAttrs=da(p.hostAttrs,c=da(c,p.hostAttrs))}}(h)}function $g(a){return a===V?{}:a===se?[]:a}function yx(a,l){const c=a.viewQuery;a.viewQuery=c?(h,p)=>{l(h,p),c(h,p)}:l}function _x(a,l){const c=a.contentQueries;a.contentQueries=c?(h,p,y)=>{l(h,p,y),c(h,p,y)}:l}function vx(a,l){const c=a.hostBindings;a.hostBindings=c?(h,p)=>{l(h,p),c(h,p)}:l}function Gg(a){return!!ed(a)&&(Array.isArray(a)||!(a instanceof Map)&&Symbol.iterator in a)}function ed(a){return null!==a&&("function"==typeof a||"object"==typeof a)}function ar(a,l,c){return!Object.is(a[l],c)&&(a[l]=c,!0)}function Uh(a,l,c,h){const p=Re();return ar(p,Dl(),l)&&(mn(),ol(or(),p,a,l,c,h)),Uh}function K_(a,l,c,h,p,y,E,S){const D=Re(),L=mn(),B=a+er,q=L.firstCreatePass?function un(a,l,c,h,p,y,E,S,D){const L=l.consts,B=Op(l,a,4,E||null,Ro(L,S));kg(l,c,B,Ro(L,D)),Cl(l,B);const q=B.tView=k_(2,B,h,p,y,l.directiveRegistry,l.pipeRegistry,null,l.schemas,L);return null!==l.queries&&(l.queries.template(l,B),q.queries=l.queries.embeddedTView(B)),B}(B,L,D,l,c,h,p,y,E):L.data[B];ai(q,!1);const ae=D[tn].createComment("");Hc(L,D,ae,q),ce(ae,D),Pg(D,D[B]=Ms(ae,D,ae,q)),Hs(q)&&M_(L,D,q),null!=E&&di(D,q,S)}function jg(a,l,c){const h=Re();return ar(h,Dl(),l)&&function yo(a,l,c,h,p,y,E,S){const D=yi(l,c);let B,L=l.inputs;!S&&null!=L&&(B=L[h])?(U_(a,c,B,h,p),is(l)&&function ox(a,l){const c=si(l,a);16&c[bn]||(c[bn]|=32)}(c,l.index)):3&l.type&&(h=function sx(a){return"class"===a?"className":"for"===a?"htmlFor":"formaction"===a?"formAction":"innerHtml"===a?"innerHTML":"readonly"===a?"readOnly":"tabindex"===a?"tabIndex":a}(h),p=null!=E?E(p,l.value||"",h):p,y.setProperty(D,h,p))}(mn(),or(),h,a,l,h[tn],c,!1),jg}function zg(a,l,c,h,p){const E=p?"class":"style";U_(a,c,l.inputs[E],E,h)}function jh(a,l,c,h){const p=Re(),y=mn(),E=er+a,S=p[tn],D=y.firstCreatePass?function Hh(a,l,c,h,p,y){const E=l.consts,D=Op(l,a,2,h,Ro(E,p));return kg(l,c,D,Ro(E,y)),null!==D.attrs&&Fg(D,D.attrs,!1),null!==D.mergedAttrs&&Fg(D,D.mergedAttrs,!0),null!==l.queries&&l.queries.elementStart(l,D),D}(E,y,p,l,c,h):y.data[E],L=p[E]=gp(S,l,function xu(){return rn.lFrame.currentNamespace}()),B=Hs(D);return ai(D,!0),bp(S,L,D),32!=(32&D.flags)&&Hc(y,p,L,D),0===function _c(){return rn.lFrame.elementDepthCount}()&&ce(L,p),function Ud(){rn.lFrame.elementDepthCount++}(),B&&(M_(y,p,D),hs(y,D,p)),null!==h&&di(p,D),jh}function Wg(){let a=oi();Su()?Du():(a=a.parent,ai(a,!1));const l=a;!function Bd(){rn.lFrame.elementDepthCount--}();const c=mn();return c.firstCreatePass&&(Cl(c,a),oa(a)&&c.queries.elementEnd(a)),null!=l.classesWithoutHost&&function tp(a){return 0!=(8&a.flags)}(l)&&zg(c,l,Re(),l.classesWithoutHost,!0),null!=l.stylesWithoutHost&&function np(a){return 0!=(16&a.flags)}(l)&&zg(c,l,Re(),l.stylesWithoutHost,!1),Wg}function Y_(a,l,c,h){return jh(a,l,c,h),Wg(),Y_}function Kg(){return Re()}function Q_(a){return!!a&&"function"==typeof a.then}function lI(a){return!!a&&"function"==typeof a.subscribe}const cI=lI;function zp(a,l,c,h){const p=Re(),y=mn(),E=oi();return function X_(a,l,c,h,p,y,E){const S=Hs(h),L=a.firstCreatePass&&qT(a),B=l[pn],q=Vp(l);let ae=!0;if(3&h.type||E){const lt=yi(h,l),mt=E?E(lt):lt,Pt=q.length,on=E?_n=>E(An(_n[h.index])):h.index;let Ye=null;if(!E&&S&&(Ye=function Dx(a,l,c,h){const p=a.cleanup;if(null!=p)for(let y=0;y<p.length-1;y+=2){const E=p[y];if(E===c&&p[y+1]===h){const S=l[Ba],D=p[y+2];return S.length>D?S[D]:null}"string"==typeof E&&(y+=2)}return null}(a,l,p,h.index)),null!==Ye)(Ye.__ngLastListenerFn__||Ye).__ngNextListenerFn__=y,Ye.__ngLastListenerFn__=y,ae=!1;else{y=qg(h,l,B,y,!1);const _n=c.listen(mt,p,y);q.push(y,_n),L&&L.push(p,on,Pt,Pt+1)}}else y=qg(h,l,B,y,!1);const he=h.outputs;let Pe;if(ae&&null!==he&&(Pe=he[p])){const lt=Pe.length;if(lt)for(let mt=0;mt<lt;mt+=2){const Ir=l[Pe[mt]][Pe[mt+1]].subscribe(y),Qr=q.length;q.push(y,Ir),L&&L.push(p,h.index,Qr,-(Qr+1))}}}(y,p,p[tn],E,a,l,h),zp}function Wh(a,l,c,h){try{return Lr(6,l,c),!1!==c(h)}catch(p){return F_(a,p),!1}finally{Lr(7,l,c)}}function qg(a,l,c,h,p){return function y(E){if(E===Function)return h;Og(a.componentOffset>-1?si(a.index,l):l);let D=Wh(l,c,h,E),L=y.__ngNextListenerFn__;for(;L;)D=Wh(l,c,L,E)&&D,L=L.__ngNextListenerFn__;return p&&!1===D&&(E.preventDefault(),E.returnValue=!1),D}}function J_(a=1){return function bc(a){return(rn.lFrame.contextLView=function Kd(a,l){for(;a>0;)l=l[Va],a--;return l}(a,rn.lFrame.contextLView))[pn]}(a)}function Ax(a,l){let c=null;const h=function Sg(a){const l=a.attrs;if(null!=l){const c=l.indexOf(5);if(!(1&c))return l[c+1]}return null}(a);for(let p=0;p<l.length;p++){const y=l[p];if("*"!==y){if(null===h?Mp(a,y,!0):BA(h,y))return p}else c=p}return c}function uI(a){const l=Re()[ii][Ii];if(!l.projection){const h=l.projection=Mc(a?a.length:1,null),p=h.slice();let y=l.child;for(;null!==y;){const E=a?Ax(y,a):0;null!==E&&(p[E]?p[E].projectionNext=y:h[E]=y,p[E]=y),y=y.next}}}function dI(a,l=0,c){const h=Re(),p=mn(),y=Op(p,er+a,16,null,c||null);null===y.projection&&(y.projection=l),Du(),32!=(32&y.flags)&&function WE(a,l,c){Y0(l[tn],0,l,c,Be(a,c,l),yh(c.parent||l[Ii],c,l))}(p,h,y)}function Kp(a,l){return a<<17|l<<2}function Aa(a){return a>>17&32767}function rv(a){return 2|a}function xa(a){return(131068&a)>>2}function qp(a,l){return-131069&a|l<<2}function iv(a){return 1|a}function gI(a,l,c,h,p){const y=a[c+1],E=null===l;let S=h?Aa(y):xa(y),D=!1;for(;0!==S&&(!1===D||E);){const B=a[S+1];sv(a[S],l)&&(D=!0,a[S+1]=h?iv(B):rv(B)),S=h?Aa(B):xa(B)}D&&(a[c+1]=h?rv(y):iv(y))}function sv(a,l){return null===a||null==l||(Array.isArray(a)?a[1]:a)===l||!(!Array.isArray(a)||"string"!=typeof l)&&Fi(a,l)>=0}function pr(a,l){return function Ca(a,l,c,h){const p=Re(),y=mn(),E=function oo(a){const l=rn.lFrame,c=l.bindingIndex;return l.bindingIndex=l.bindingIndex+a,c}(2);y.firstUpdatePass&&function II(a,l,c,h){const p=a.data;if(null===p[c+1]){const y=p[Sr()],E=function ey(a,l){return l>=a.expandoStartIndex}(a,c);(function DI(a,l){return 0!=(a.flags&(l?8:16))})(y,h)&&null===l&&!E&&(l=!1),l=function Lx(a,l,c,h){const p=function ss(a){const l=rn.lFrame.currentDirectiveIndex;return-1===l?null:a[l]}(a);let y=h?l.residualClasses:l.residualStyles;if(null===p)0===(h?l.classBindings:l.styleBindings)&&(c=Zp(c=av(null,a,l,c,h),l.attrs,h),y=null);else{const E=l.directiveStylingLast;if(-1===E||a[E]!==p)if(c=av(p,a,l,c,h),null===y){let D=function Px(a,l,c){const h=c?l.classBindings:l.styleBindings;if(0!==xa(h))return a[Aa(h)]}(a,l,h);void 0!==D&&Array.isArray(D)&&(D=av(null,a,l,D[1],h),D=Zp(D,l.attrs,h),function wI(a,l,c,h){a[Aa(c?l.classBindings:l.styleBindings)]=h}(a,l,h,D))}else y=function Ox(a,l,c){let h;const p=l.directiveEnd;for(let y=1+l.directiveStylingLast;y<p;y++)h=Zp(h,a[y].hostAttrs,c);return Zp(h,l.attrs,c)}(a,l,h)}return void 0!==y&&(h?l.residualClasses=y:l.residualStyles=y),c}(p,y,l,h),function Ho(a,l,c,h,p,y){let E=y?l.classBindings:l.styleBindings,S=Aa(E),D=xa(E);a[h]=c;let B,L=!1;if(Array.isArray(c)?(B=c[1],(null===B||Fi(c,B)>0)&&(L=!0)):B=c,p)if(0!==D){const ae=Aa(a[S+1]);a[h+1]=Kp(ae,S),0!==ae&&(a[ae+1]=qp(a[ae+1],h)),a[S+1]=function mI(a,l){return 131071&a|l<<17}(a[S+1],h)}else a[h+1]=Kp(S,0),0!==S&&(a[S+1]=qp(a[S+1],h)),S=h;else a[h+1]=Kp(D,0),0===S?S=h:a[D+1]=qp(a[D+1],h),D=h;L&&(a[h+1]=rv(a[h+1])),gI(a,B,h,!0),gI(a,B,h,!1),function Rx(a,l,c,h,p){const y=p?a.residualClasses:a.residualStyles;null!=y&&"string"==typeof l&&Fi(y,l)>=0&&(c[h+1]=iv(c[h+1]))}(l,B,a,h,y),E=Kp(S,D),y?l.classBindings=E:l.styleBindings=E}(p,y,l,c,E,h)}}(y,a,E,h),l!==gn&&ar(p,E,l)&&function qe(a,l,c,h,p,y,E,S){if(!(3&l.type))return;const D=a.data,L=D[S+1],B=function Cx(a){return 1==(1&a)}(L)?ty(D,l,c,p,xa(L),E):void 0;Qp(B)||(Qp(y)||function xx(a){return 2==(2&a)}(L)&&(y=ty(D,null,c,p,S,E)),function rl(a,l,c,h,p){if(l)p?a.addClass(c,h):a.removeClass(c,h);else{let y=-1===h.indexOf("-")?void 0:Xt.DashCase;null==p?a.removeStyle(c,h,y):("string"==typeof p&&p.endsWith("!important")&&(p=p.slice(0,-10),y|=Xt.Important),a.setStyle(c,h,p,y))}}(h,E,Ha(Sr(),c),p,y))}(y,y.data[Sr()],p,p[tn],a,p[E+1]=function Ux(a,l){return null==a||""===a||("string"==typeof l?a+=l:"object"==typeof a&&(a=Oe(il(a)))),a}(l,c),h,E)}(a,l,null,!0),pr}function av(a,l,c,h,p){let y=null;const E=c.directiveEnd;let S=c.directiveStylingLast;for(-1===S?S=c.directiveStart:S++;S<E&&(y=l[S],h=Zp(h,y.hostAttrs,p),y!==a);)S++;return null!==a&&(c.directiveStylingLast=S),h}function Zp(a,l,c){const h=c?1:2;let p=-1;if(null!==l)for(let y=0;y<l.length;y++){const E=l[y];"number"==typeof E?p=E:p===h&&(Array.isArray(a)||(a=void 0===a?[]:["",a]),as(a,E,!!c||l[++y]))}return void 0===a?null:a}function ty(a,l,c,h,p,y){const E=null===l;let S;for(;p>0;){const D=a[p],L=Array.isArray(D),B=L?D[1]:D,q=null===B;let ae=c[p+1];ae===gn&&(ae=q?se:void 0);let he=q?Wn(ae,h):B===h?ae:void 0;if(L&&!Qp(he)&&(he=Wn(D,h)),Qp(he)&&(S=he,E))return S;const Pe=a[p+1];p=E?Aa(Pe):xa(Pe)}if(null!==l){let D=y?l.residualClasses:l.residualStyles;null!=D&&(S=Wn(D,h))}return S}function Qp(a){return void 0!==a}function AI(a,l=""){const c=Re(),h=mn(),p=a+er,y=h.firstCreatePass?Op(h,p,1,l,null):h.data[p],E=c[p]=function Gc(a,l){return a.createText(l)}(c[tn],l);Hc(h,c,E,y),ai(y,!1)}function ny(a,l,c){const h=Re(),p=function td(a,l,c,h){return ar(a,Dl(),c)?l+Ze(c)+h:gn}(h,a,l,c);return p!==gn&&function ll(a,l,c){const h=Ha(l,a);!function mp(a,l,c){a.setValue(l,c)}(a[tn],h,c)}(h,Sr(),p),ny}const Wo=void 0;var Yx=["en",[["a","p"],["AM","PM"],Wo],[["AM","PM"],Wo,Wo],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Wo,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Wo,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Wo,"{1} 'at' {0}",Wo],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Jp(a){const c=Math.floor(Math.abs(a)),h=a.toString().replace(/^[^.]*\.?/,"").length;return 1===c&&0===h?1:5}];let ad={};function Yc(a){const l=function Qx(a){return a.toLowerCase().replace(/_/g,"-")}(a);let c=GI(l);if(c)return c;const h=l.split("-")[0];if(c=GI(h),c)return c;if("en"===h)return Yx;throw new Ae(701,!1)}function ay(a){return Yc(a)[sn.PluralCase]}function GI(a){return a in ad||(ad[a]=tr.ng&&tr.ng.common&&tr.ng.common.locales&&tr.ng.common.locales[a]),ad[a]}var sn=(()=>((sn=sn||{})[sn.LocaleId=0]="LocaleId",sn[sn.DayPeriodsFormat=1]="DayPeriodsFormat",sn[sn.DayPeriodsStandalone=2]="DayPeriodsStandalone",sn[sn.DaysFormat=3]="DaysFormat",sn[sn.DaysStandalone=4]="DaysStandalone",sn[sn.MonthsFormat=5]="MonthsFormat",sn[sn.MonthsStandalone=6]="MonthsStandalone",sn[sn.Eras=7]="Eras",sn[sn.FirstDayOfWeek=8]="FirstDayOfWeek",sn[sn.WeekendRange=9]="WeekendRange",sn[sn.DateFormat=10]="DateFormat",sn[sn.TimeFormat=11]="TimeFormat",sn[sn.DateTimeFormat=12]="DateTimeFormat",sn[sn.NumberSymbols=13]="NumberSymbols",sn[sn.NumberFormats=14]="NumberFormats",sn[sn.CurrencyCode=15]="CurrencyCode",sn[sn.CurrencySymbol=16]="CurrencySymbol",sn[sn.CurrencyName=17]="CurrencyName",sn[sn.Currencies=18]="Currencies",sn[sn.Directionality=19]="Directionality",sn[sn.PluralCase=20]="PluralCase",sn[sn.ExtraData=21]="ExtraData",sn))();const Zl="en-US";let gv=Zl;function my(a,l,c,h,p){if(a=ue(a),Array.isArray(a))for(let y=0;y<a.length;y++)my(a[y],l,c,h,p);else{const y=mn(),E=Re();let S=zl(a)?a:ue(a.provide),D=f_(a);const L=oi(),B=1048575&L.providerIndexes,q=L.directiveStart,ae=L.providerIndexes>>20;if(zl(a)||!a.multi){const he=new ko(D,p,Oh),Pe=yy(S,l,p?B:B+ae,q);-1===Pe?(Oo(Qd(L,E),y,S),gy(y,a,l.length),l.push(S),L.directiveStart++,L.directiveEnd++,p&&(L.providerIndexes+=1048576),c.push(he),E.push(he)):(c[Pe]=he,E[Pe]=he)}else{const he=yy(S,l,B+ae,q),Pe=yy(S,l,B,B+ae),mt=Pe>=0&&c[Pe];if(p&&!mt||!p&&!(he>=0&&c[he])){Oo(Qd(L,E),y,S);const Pt=function pw(a,l,c,h,p){const y=new ko(a,c,Oh);return y.multi=[],y.index=l,y.componentProviders=0,fw(y,p,h&&!c),y}(p?Cv:DC,c.length,p,h,D);!p&&mt&&(c[Pe].providerFactory=Pt),gy(y,a,l.length,0),l.push(S),L.directiveStart++,L.directiveEnd++,p&&(L.providerIndexes+=1048576),c.push(Pt),E.push(Pt)}else gy(y,a,he>-1?he:Pe,fw(c[p?Pe:he],D,!p&&h));!p&&h&&mt&&c[Pe].componentProviders++}}}function gy(a,l,c,h){const p=zl(l),y=function bg(a){return!!a.useClass}(l);if(p||y){const D=(y?ue(l.useClass):l).prototype.ngOnDestroy;if(D){const L=a.destroyHooks||(a.destroyHooks=[]);if(!p&&l.multi){const B=L.indexOf(c);-1===B?L.push(c,[h,D]):L[B+1].push(h,D)}else L.push(c,D)}}}function fw(a,l,c){return c&&a.componentProviders++,a.multi.push(l)-1}function yy(a,l,c,h){for(let p=c;p<h;p++)if(l[p]===a)return p;return-1}function DC(a,l,c,h){return _y(this.multi,[])}function Cv(a,l,c,h){const p=this.multi;let y;if(this.providerFactory){const E=this.providerFactory.componentProviders,S=uo(c,c[Et],this.providerFactory.index,h);y=S.slice(0,E),_y(p,y);for(let D=E;D<S.length;D++)y.push(S[D])}else y=[],_y(p,y);return y}function _y(a,l){for(let c=0;c<a.length;c++)l.push((0,a[c])());return l}function mw(a,l=[]){return c=>{c.providersResolver=(h,p)=>function xv(a,l,c){const h=mn();if(h.firstCreatePass){const p=Is(a);my(c,h.data,h.blueprint,p,!0),my(l,h.data,h.blueprint,p,!1)}}(h,p?p(a):a,l)}}class Zc{}class Rv{}function Mv(a,l){return new gw(a,l??null)}class gw extends Zc{constructor(l,c){super(),this._parent=c,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new ZT(this);const h=Jn(l);this._bootstrapComponents=sl(h.bootstrap),this._r3Injector=S_(l,c,[{provide:Zc,useValue:this},{provide:Ch,useValue:this.componentFactoryResolver}],Oe(l),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(l)}get injector(){return this._r3Injector}destroy(){const l=this._r3Injector;!l.destroyed&&l.destroy(),this.destroyCbs.forEach(c=>c()),this.destroyCbs=null}onDestroy(l){this.destroyCbs.push(l)}}class kv extends Rv{constructor(l){super(),this.moduleType=l}create(l){return new gw(this.moduleType,l)}}class AC extends Zc{constructor(l,c,h){super(),this.componentFactoryResolver=new ZT(this),this.instance=null;const p=new dT([...l,{provide:Zc,useValue:this},{provide:Ch,useValue:this.componentFactoryResolver}],c||Tg(),h,new Set(["environment"]));this.injector=p,p.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(l){this.injector.onDestroy(l)}}function Lv(a,l,c=null){return new AC(a,l,c).injector}let yw=(()=>{class a{constructor(c){this._injector=c,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(c){if(!c.standalone)return null;if(!this.cachedInjectors.has(c.id)){const h=Dh(0,c.type),p=h.length>0?Lv([h],this._injector,`Standalone[${c.type.name}]`):null;this.cachedInjectors.set(c.id,p)}return this.cachedInjectors.get(c.id)}ngOnDestroy(){try{for(const c of this.cachedInjectors.values())null!==c&&c.destroy()}finally{this.cachedInjectors.clear()}}}return a.\u0275prov=xt({token:a,providedIn:"environment",factory:()=>new a(wn(Qu))}),a})();function vy(a){a.getStandaloneInjector=l=>l.get(yw).getOrCreateStandaloneInjector(a)}function Iw(a,l,c){const h=function fr(){const a=rn.lFrame;let l=a.bindingRootIndex;return-1===l&&(l=a.bindingRootIndex=a.tView.bindingStartIndex),l}()+a,p=Re();return p[h]===gn?function Sa(a,l,c){return a[l]=c}(p,h,c?l.call(c):l()):function Fh(a,l){return a[l]}(p,h)}function Fv(a){return l=>{setTimeout(a,void 0,l)}}const qo=class om extends m.x{constructor(l=!1){super(),this.__isAsync=l}emit(l){super.next(l)}subscribe(l,c,h){let p=l,y=c||(()=>null),E=h;if(l&&"object"==typeof l){const D=l;p=D.next?.bind(D),y=D.error?.bind(D),E=D.complete?.bind(D)}this.__isAsync&&(y=Fv(y),p&&(p=Fv(p)),E&&(E=Fv(E)));const S=super.subscribe({next:p,error:y,complete:E});return l instanceof ee.w0&&l.add(S),S}};function HC(){return this._results[Symbol.iterator]()}class Uv{get changes(){return this._changes||(this._changes=new qo)}constructor(l=!1){this._emitDistinctChangesOnly=l,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const c=Uv.prototype;c[Symbol.iterator]||(c[Symbol.iterator]=HC)}get(l){return this._results[l]}map(l){return this._results.map(l)}filter(l){return this._results.filter(l)}find(l){return this._results.find(l)}reduce(l,c){return this._results.reduce(l,c)}forEach(l){this._results.forEach(l)}some(l){return this._results.some(l)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(l,c){const h=this;h.dirty=!1;const p=function zs(a){return a.flat(Number.POSITIVE_INFINITY)}(l);(this._changesDetected=!function lh(a,l,c){if(a.length!==l.length)return!1;for(let h=0;h<a.length;h++){let p=a[h],y=l[h];if(c&&(p=c(p),y=c(y)),y!==p)return!1}return!0}(h._results,p,c))&&(h._results=p,h.length=p.length,h.last=p[this.length-1],h.first=p[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let am=(()=>{class a{}return a.__NG_ELEMENT_ID__=Ui,a})();const fs=am,Ty=class extends fs{constructor(l,c,h){super(),this._declarationLView=l,this._declarationTContainer=c,this.elementRef=h}createEmbeddedView(l,c){const h=this._declarationTContainer.tView,p=xg(this._declarationLView,h,l,16,null,h.declTNode,null,null,null,null,c||null);p[_l]=this._declarationLView[this._declarationTContainer.index];const E=this._declarationLView[io];return null!==E&&(p[io]=E.createEmbeddedView(h)),Rg(h,p,l),new $p(p)}};function Ui(){return ka(oi(),Re())}function ka(a,l){return 4&a.type?new Ty(l,a,Wl(a,l)):null}let Iy=(()=>{class a{}return a.__NG_ELEMENT_ID__=Sw,a})();function Sw(){return Qh(oi(),Re())}const Bv=Iy,Vv=class extends Bv{constructor(l,c,h){super(),this._lContainer=l,this._hostTNode=c,this._hostLView=h}get element(){return Wl(this._hostTNode,this._hostLView)}get injector(){return new fa(this._hostTNode,this._hostLView)}get parentInjector(){const l=Po(this._hostTNode,this._hostLView);if(kl(l)){const c=Sc(l,this._hostLView),h=Ll(l);return new fa(c[Et].data[h+8],c)}return new fa(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(l){const c=Yi(this._lContainer);return null!==c&&c[l]||null}get length(){return this._lContainer.length-gi}createEmbeddedView(l,c,h){let p,y;"number"==typeof h?p=h:null!=h&&(p=h.index,y=h.injector);const E=l.createEmbeddedView(c||{},y);return this.insert(E,p),E}createComponent(l,c,h,p,y){const E=l&&!function Rc(a){return"function"==typeof a}(l);let S;if(E)S=c;else{const q=c||{};S=q.index,h=q.injector,p=q.projectableNodes,y=q.environmentInjector||q.ngModuleRef}const D=E?l:new Ks(Lt(l)),L=h||this.parentInjector;if(!y&&null==D.ngModule){const ae=(E?L:this.parentInjector).get(Qu,null);ae&&(y=ae)}const B=D.create(L,p,void 0,y);return this.insert(B.hostView,S),B}insert(l,c){const h=l._lView,p=h[Et];if(function Nd(a){return Gs(a[nr])}(h)){const B=this.indexOf(l);if(-1!==B)this.detach(B);else{const q=h[nr],ae=new Vv(q,q[Ii],q[nr]);ae.detach(ae.indexOf(l))}}const y=this._adjustIndex(c),E=this._lContainer;!function _(a,l,c,h){const p=gi+h,y=c.length;h>0&&(c[p-1][Ni]=l),h<y-gi?(l[Ni]=c[p],up(c,gi+h,l)):(c.push(l),l[Ni]=null),l[nr]=c;const E=l[_l];null!==E&&c!==E&&function v(a,l){const c=a[$s];l[ii]!==l[nr][nr][ii]&&(a[wi]=!0),null===c?a[$s]=[l]:c.push(l)}(E,l);const S=l[io];null!==S&&S.insertView(a),l[bn]|=64}(p,h,E,y);const S=nl(y,E),D=h[tn],L=ui(D,E[uc]);return null!==L&&function K0(a,l,c,h,p,y){h[ns]=p,h[Ii]=l,_p(a,h,c,1,p,y)}(p,E[Ii],D,h,L,S),l.attachToViewContainerRef(),up($v(E),y,l),l}move(l,c){return this.insert(l,c)}indexOf(l){const c=Yi(this._lContainer);return null!==c?c.indexOf(l):-1}remove(l){const c=this._adjustIndex(l,-1),h=O(this._lContainer,c);h&&(Ol($v(this._lContainer),c),U(h[Et],h))}detach(l){const c=this._adjustIndex(l,-1),h=O(this._lContainer,c);return h&&null!=Ol($v(this._lContainer),c)?new $p(h):null}_adjustIndex(l,c=0){return l??this.length+c}};function Yi(a){return a[vl]}function $v(a){return a[vl]||(a[vl]=[])}function Qh(a,l){let c;const h=l[a.index];if(Gs(h))c=h;else{let p;if(8&a.type)p=An(h);else{const y=l[tn];p=y.createComment("");const E=yi(a,l);Mt(y,ui(y,E),p,function jl(a,l){return a.nextSibling(l)}(y,E),!1)}l[a.index]=c=Ms(h,l,p,a),Pg(l,c)}return new Vv(c,a,l)}class Xh{constructor(l){this.queryList=l,this.matches=null}clone(){return new Xh(this.queryList)}setDirty(){this.queryList.setDirty()}}class Yo{constructor(l=[]){this.queries=l}createEmbeddedView(l){const c=l.queries;if(null!==c){const h=null!==l.contentQueries?l.contentQueries[0]:c.length,p=[];for(let y=0;y<h;y++){const E=c.getByIndex(y);p.push(this.queries[E.indexInDeclarationView].clone())}return new Yo(p)}return null}insertView(l){this.dirtyQueriesWithMatches(l)}detachView(l){this.dirtyQueriesWithMatches(l)}dirtyQueriesWithMatches(l){for(let c=0;c<this.queries.length;c++)null!==Rw(l,c).matches&&this.queries[c].setDirty()}}class wy{constructor(l,c,h=null){this.predicate=l,this.flags=c,this.read=h}}class Gv{constructor(l=[]){this.queries=l}elementStart(l,c){for(let h=0;h<this.queries.length;h++)this.queries[h].elementStart(l,c)}elementEnd(l){for(let c=0;c<this.queries.length;c++)this.queries[c].elementEnd(l)}embeddedTView(l){let c=null;for(let h=0;h<this.length;h++){const p=null!==c?c.length:0,y=this.getByIndex(h).embeddedTView(l,p);y&&(y.indexInDeclarationView=h,null!==c?c.push(y):c=[y])}return null!==c?new Gv(c):null}template(l,c){for(let h=0;h<this.queries.length;h++)this.queries[h].template(l,c)}getByIndex(l){return this.queries[l]}get length(){return this.queries.length}track(l){this.queries.push(l)}}class Hv{constructor(l,c=-1){this.metadata=l,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=c}elementStart(l,c){this.isApplyingToNode(c)&&this.matchTNode(l,c)}elementEnd(l){this._declarationNodeIndex===l.index&&(this._appliesToNextNode=!1)}template(l,c){this.elementStart(l,c)}embeddedTView(l,c){return this.isApplyingToNode(l)?(this.crossesNgTemplate=!0,this.addMatch(-l.index,c),new Hv(this.metadata)):null}isApplyingToNode(l){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const c=this._declarationNodeIndex;let h=l.parent;for(;null!==h&&8&h.type&&h.index!==c;)h=h.parent;return c===(null!==h?h.index:-1)}return this._appliesToNextNode}matchTNode(l,c){const h=this.metadata.predicate;if(Array.isArray(h))for(let p=0;p<h.length;p++){const y=h[p];this.matchTNodeWithReadOption(l,c,Jh(c,y)),this.matchTNodeWithReadOption(l,c,co(c,l,y,!1,!1))}else h===am?4&c.type&&this.matchTNodeWithReadOption(l,c,-1):this.matchTNodeWithReadOption(l,c,co(c,l,h,!1,!1))}matchTNodeWithReadOption(l,c,h){if(null!==h){const p=this.metadata.read;if(null!==p)if(p===Rh||p===Iy||p===am&&4&c.type)this.addMatch(c.index,-2);else{const y=co(c,l,p,!1,!1);null!==y&&this.addMatch(c.index,y)}else this.addMatch(c.index,h)}}addMatch(l,c){null===this.matches?this.matches=[l,c]:this.matches.push(l,c)}}function Jh(a,l){const c=a.localNames;if(null!==c)for(let h=0;h<c.length;h+=2)if(c[h]===l)return c[h+1];return null}function jv(a,l,c,h){return-1===c?function Dw(a,l){return 11&a.type?Wl(a,l):4&a.type?ka(a,l):null}(l,a):-2===c?function Aw(a,l,c){return c===Rh?Wl(l,a):c===am?ka(l,a):c===Iy?Qh(l,a):void 0}(a,l,h):uo(a,a[Et],c,l)}function xw(a,l,c,h){const p=l[io].queries[h];if(null===p.matches){const y=a.data,E=c.matches,S=[];for(let D=0;D<E.length;D+=2){const L=E[D];S.push(L<0?null:jv(l,y[L],E[D+1],c.metadata.read))}p.matches=S}return p.matches}function Sy(a,l,c,h){const p=a.queries.getByIndex(c),y=p.matches;if(null!==y){const E=xw(a,l,p,c);for(let S=0;S<y.length;S+=2){const D=y[S];if(D>0)h.push(E[S/2]);else{const L=y[S+1],B=l[-D];for(let q=gi;q<B.length;q++){const ae=B[q];ae[_l]===ae[nr]&&Sy(ae[Et],ae,L,h)}if(null!==B[$s]){const q=B[$s];for(let ae=0;ae<q.length;ae++){const he=q[ae];Sy(he[Et],he,L,h)}}}}}return h}function Dy(a){const l=Re(),c=mn(),h=vc();Di(h+1);const p=Rw(c,h);if(a.dirty&&function Od(a){return 4==(4&a[bn])}(l)===(2==(2&p.metadata.flags))){if(null===p.matches)a.reset([]);else{const y=p.crossesNgTemplate?Sy(c,l,h,[]):xw(c,l,p,h);a.reset(y,xp),a.notifyOnChanges()}return!0}return!1}function Ay(a,l,c){const h=mn();h.firstCreatePass&&(Cw(h,new wy(a,l,c),-1),2==(2&l)&&(h.staticViewQueries=!0)),Wv(h,Re(),l)}function xy(a,l,c,h){const p=mn();if(p.firstCreatePass){const y=oi();Cw(p,new wy(l,c,h),y.index),function lm(a,l){const c=a.contentQueries||(a.contentQueries=[]);l!==(c.length?c[c.length-1]:-1)&&c.push(a.queries.length-1,l)}(p,a),2==(2&c)&&(p.staticContentQueries=!0)}Wv(p,Re(),c)}function Cy(){return function zv(a,l){return a[io].queries[l].queryList}(Re(),vc())}function Wv(a,l,c){const h=new Uv(4==(4&c));ln(a,l,h,h.destroy),null===l[io]&&(l[io]=new Yo),l[io].queries.push(new Xh(h))}function Cw(a,l,c){null===a.queries&&(a.queries=new Gv),a.queries.track(new Hv(l,c))}function Rw(a,l){return a.queries.getByIndex(l)}function My(a){return!!Jn(a)}function fm(...a){}const ab=new On("Application Initializer");let tu=(()=>{class a{constructor(c){this.appInits=c,this.resolve=fm,this.reject=fm,this.initialized=!1,this.done=!1,this.donePromise=new Promise((h,p)=>{this.resolve=h,this.reject=p})}runInitializers(){if(this.initialized)return;const c=[],h=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let p=0;p<this.appInits.length;p++){const y=this.appInits[p]();if(Q_(y))c.push(y);else if(cI(y)){const E=new Promise((S,D)=>{y.subscribe({complete:S,error:D})});c.push(E)}}Promise.all(c).then(()=>{h()}).catch(p=>{this.reject(p)}),0===c.length&&h(),this.initialized=!0}}return a.\u0275fac=function(c){return new(c||a)(wn(ab,8))},a.\u0275prov=xt({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const pm=new On("AppId",{providedIn:"root",factory:function lb(){return`${Gy()}${Gy()}${Gy()}`}});function Gy(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const cb=new On("Platform Initializer"),mm=new On("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),ub=new On("AnimationModuleType");let db=(()=>{class a{log(c){console.log(c)}warn(c){console.warn(c)}}return a.\u0275fac=function(c){return new(c||a)},a.\u0275prov=xt({token:a,factory:a.\u0275fac,providedIn:"platform"}),a})();const nu=new On("LocaleId",{providedIn:"root",factory:()=>Gr(nu,Ft.Optional|Ft.SkipSelf)||function Hy(){return typeof $localize<"u"&&$localize.locale||Zl}()}),$w=new On("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class fb{constructor(l,c){this.ngModuleFactory=l,this.componentFactories=c}}let Hw=(()=>{class a{compileModuleSync(c){return new kv(c)}compileModuleAsync(c){return Promise.resolve(this.compileModuleSync(c))}compileModuleAndAllComponentsSync(c){const h=this.compileModuleSync(c),y=sl(Jn(c).declarations).reduce((E,S)=>{const D=Lt(S);return D&&E.push(new Ks(D)),E},[]);return new fb(h,y)}compileModuleAndAllComponentsAsync(c){return Promise.resolve(this.compileModuleAndAllComponentsSync(c))}clearCache(){}clearCacheFor(c){}getModuleId(c){}}return a.\u0275fac=function(c){return new(c||a)},a.\u0275prov=xt({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const pd=(()=>Promise.resolve(0))();function gm(a){typeof Zone>"u"?pd.then(()=>{a&&a.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",a)}class vo{constructor({enableLongStackTrace:l=!1,shouldCoalesceEventChangeDetection:c=!1,shouldCoalesceRunChangeDetection:h=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new qo(!1),this.onMicrotaskEmpty=new qo(!1),this.onStable=new qo(!1),this.onError=new qo(!1),typeof Zone>"u")throw new Ae(908,!1);Zone.assertZonePatched();const p=this;p._nesting=0,p._outer=p._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(p._inner=p._inner.fork(new Zone.TaskTrackingZoneSpec)),l&&Zone.longStackTraceZoneSpec&&(p._inner=p._inner.fork(Zone.longStackTraceZoneSpec)),p.shouldCoalesceEventChangeDetection=!h&&c,p.shouldCoalesceRunChangeDetection=h,p.lastRequestAnimationFrameId=-1,p.nativeRequestAnimationFrame=function tR(){let a=tr.requestAnimationFrame,l=tr.cancelAnimationFrame;if(typeof Zone<"u"&&a&&l){const c=a[Zone.__symbol__("OriginalDelegate")];c&&(a=c);const h=l[Zone.__symbol__("OriginalDelegate")];h&&(l=h)}return{nativeRequestAnimationFrame:a,nativeCancelAnimationFrame:l}}().nativeRequestAnimationFrame,function Xl(a){const l=()=>{!function md(a){a.isCheckStableRunning||-1!==a.lastRequestAnimationFrameId||(a.lastRequestAnimationFrameId=a.nativeRequestAnimationFrame.call(tr,()=>{a.fakeTopEventTask||(a.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{a.lastRequestAnimationFrameId=-1,lf(a),a.isCheckStableRunning=!0,gb(a),a.isCheckStableRunning=!1},void 0,()=>{},()=>{})),a.fakeTopEventTask.invoke()}),lf(a))}(a)};a._inner=a._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(c,h,p,y,E,S)=>{try{return ym(a),c.invokeTask(p,y,E,S)}finally{(a.shouldCoalesceEventChangeDetection&&"eventTask"===y.type||a.shouldCoalesceRunChangeDetection)&&l(),yb(a)}},onInvoke:(c,h,p,y,E,S,D)=>{try{return ym(a),c.invoke(p,y,E,S,D)}finally{a.shouldCoalesceRunChangeDetection&&l(),yb(a)}},onHasTask:(c,h,p,y)=>{c.hasTask(p,y),h===p&&("microTask"==y.change?(a._hasPendingMicrotasks=y.microTask,lf(a),gb(a)):"macroTask"==y.change&&(a.hasPendingMacrotasks=y.macroTask))},onHandleError:(c,h,p,y)=>(c.handleError(p,y),a.runOutsideAngular(()=>a.onError.emit(y)),!1)})}(p)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!vo.isInAngularZone())throw new Ae(909,!1)}static assertNotInAngularZone(){if(vo.isInAngularZone())throw new Ae(909,!1)}run(l,c,h){return this._inner.run(l,c,h)}runTask(l,c,h,p){const y=this._inner,E=y.scheduleEventTask("NgZoneEvent: "+p,l,zw,fm,fm);try{return y.runTask(E,c,h)}finally{y.cancelTask(E)}}runGuarded(l,c,h){return this._inner.runGuarded(l,c,h)}runOutsideAngular(l){return this._outer.run(l)}}const zw={};function gb(a){if(0==a._nesting&&!a.hasPendingMicrotasks&&!a.isStable)try{a._nesting++,a.onMicrotaskEmpty.emit(null)}finally{if(a._nesting--,!a.hasPendingMicrotasks)try{a.runOutsideAngular(()=>a.onStable.emit(null))}finally{a.isStable=!0}}}function lf(a){a.hasPendingMicrotasks=!!(a._hasPendingMicrotasks||(a.shouldCoalesceEventChangeDetection||a.shouldCoalesceRunChangeDetection)&&-1!==a.lastRequestAnimationFrameId)}function ym(a){a._nesting++,a.isStable&&(a.isStable=!1,a.onUnstable.emit(null))}function yb(a){a._nesting--,gb(a)}class Tr{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new qo,this.onMicrotaskEmpty=new qo,this.onStable=new qo,this.onError=new qo}run(l,c,h){return l.apply(c,h)}runGuarded(l,c,h){return l.apply(c,h)}runOutsideAngular(l){return l()}runTask(l,c,h,p){return l.apply(c,h)}}const _m=new On(""),cf=new On("");let _b,vm=(()=>{class a{constructor(c,h,p){this._ngZone=c,this.registry=h,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,_b||(function Kw(a){_b=a}(p),p.addToWindow(h)),this._watchAngularEvents(),c.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{vo.assertNotInAngularZone(),gm(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())gm(()=>{for(;0!==this._callbacks.length;){let c=this._callbacks.pop();clearTimeout(c.timeoutId),c.doneCb(this._didWork)}this._didWork=!1});else{let c=this.getPendingTasks();this._callbacks=this._callbacks.filter(h=>!h.updateCb||!h.updateCb(c)||(clearTimeout(h.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(c=>({source:c.source,creationLocation:c.creationLocation,data:c.data})):[]}addCallback(c,h,p){let y=-1;h&&h>0&&(y=setTimeout(()=>{this._callbacks=this._callbacks.filter(E=>E.timeoutId!==y),c(this._didWork,this.getPendingTasks())},h)),this._callbacks.push({doneCb:c,timeoutId:y,updateCb:p})}whenStable(c,h,p){if(p&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(c,h,p),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(c){this.registry.registerApplication(c,this)}unregisterApplication(c){this.registry.unregisterApplication(c)}findProviders(c,h,p){return[]}}return a.\u0275fac=function(c){return new(c||a)(wn(vo),wn(Ww),wn(cf))},a.\u0275prov=xt({token:a,factory:a.\u0275fac}),a})(),Ww=(()=>{class a{constructor(){this._applications=new Map}registerApplication(c,h){this._applications.set(c,h)}unregisterApplication(c){this._applications.delete(c)}unregisterAllApplications(){this._applications.clear()}getTestability(c){return this._applications.get(c)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(c,h=!0){return _b?.findTestabilityInTree(this,c,h)??null}}return a.\u0275fac=function(c){return new(c||a)},a.\u0275prov=xt({token:a,factory:a.\u0275fac,providedIn:"platform"}),a})();const Jl=!1;let ru=null;const qw=new On("AllowMultipleToken"),gd=new On("PlatformDestroyListeners"),ec=new On("appBootstrapListener");class uf{constructor(l,c){this.name=l,this.token=c}}function bb(a,l,c=[]){const h=`Platform: ${l}`,p=new On(h);return(y=[])=>{let E=zy();if(!E||E.injector.get(qw,!1)){const S=[...c,...y,{provide:p,useValue:!0}];a?a(S):function rR(a){if(ru&&!ru.get(qw,!1))throw new Ae(400,!1);ru=a;const l=a.get(Eb);(function vb(a){const l=a.get(cb,null);l&&l.forEach(c=>c())})(a)}(function jy(a=[],l){return kh.create({name:l,providers:[{provide:Wc,useValue:"platform"},{provide:gd,useValue:new Set([()=>ru=null])},...a]})}(S,h))}return function Qw(a){const l=zy();if(!l)throw new Ae(401,!1);return l}()}}function zy(){return ru?.get(Eb)??null}let Eb=(()=>{class a{constructor(c){this._injector=c,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(c,h){const p=function eS(a,l){let c;return c="noop"===a?new Tr:("zone.js"===a?void 0:a)||new vo(l),c}(h?.ngZone,function Jw(a){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!a||!a.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!a||!a.ngZoneRunCoalescing)||!1}}(h)),y=[{provide:vo,useValue:p}];return p.run(()=>{const E=kh.create({providers:y,parent:this.injector,name:c.moduleType.name}),S=c.create(E),D=S.injector.get(Cp,null);if(!D)throw new Ae(402,!1);return p.runOutsideAngular(()=>{const L=p.onError.subscribe({next:B=>{D.handleError(B)}});S.onDestroy(()=>{iu(this._modules,S),L.unsubscribe()})}),function tS(a,l,c){try{const h=c();return Q_(h)?h.catch(p=>{throw l.runOutsideAngular(()=>a.handleError(p)),p}):h}catch(h){throw l.runOutsideAngular(()=>a.handleError(h)),h}}(D,p,()=>{const L=S.injector.get(tu);return L.runInitializers(),L.donePromise.then(()=>(function yv(a){De(a,"Expected localeId to be defined"),"string"==typeof a&&(gv=a.toLowerCase().replace(/_/g,"-"))}(S.injector.get(nu,Zl)||Zl),this._moduleDoBootstrap(S),S))})})}bootstrapModule(c,h=[]){const p=nS({},h);return function Yw(a,l,c){const h=new kv(c);return Promise.resolve(h)}(0,0,c).then(y=>this.bootstrapModuleFactory(y,p))}_moduleDoBootstrap(c){const h=c.injector.get(yd);if(c._bootstrapComponents.length>0)c._bootstrapComponents.forEach(p=>h.bootstrap(p));else{if(!c.instance.ngDoBootstrap)throw new Ae(-403,!1);c.instance.ngDoBootstrap(h)}this._modules.push(c)}onDestroy(c){this._destroyListeners.push(c)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Ae(404,!1);this._modules.slice().forEach(h=>h.destroy()),this._destroyListeners.forEach(h=>h());const c=this._injector.get(gd,null);c&&(c.forEach(h=>h()),c.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return a.\u0275fac=function(c){return new(c||a)(wn(kh))},a.\u0275prov=xt({token:a,factory:a.\u0275fac,providedIn:"platform"}),a})();function nS(a,l){return Array.isArray(l)?l.reduce(nS,a):{...a,...l}}let yd=(()=>{class a{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(c,h,p){this._zone=c,this._injector=h,this._exceptionHandler=p,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const y=new $.y(S=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{S.next(this._stable),S.complete()})}),E=new $.y(S=>{let D;this._zone.runOutsideAngular(()=>{D=this._zone.onStable.subscribe(()=>{vo.assertNotInAngularZone(),gm(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,S.next(!0))})})});const L=this._zone.onUnstable.subscribe(()=>{vo.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{S.next(!1)}))});return()=>{D.unsubscribe(),L.unsubscribe()}});this.isStable=(0,fe.T)(y,E.pipe((0,be.B)()))}bootstrap(c,h){const p=c instanceof fT;if(!this._injector.get(tu).done){!p&&et(c);throw new Ae(405,Jl)}let E;E=p?c:this._injector.get(Ch).resolveComponentFactory(c),this.componentTypes.push(E.componentType);const S=function Zw(a){return a.isBoundToModule}(E)?void 0:this._injector.get(Zc),L=E.create(kh.NULL,[],h||E.selector,S),B=L.location.nativeElement,q=L.injector.get(_m,null);return q?.registerApplication(B),L.onDestroy(()=>{this.detachView(L.hostView),iu(this.components,L),q?.unregisterApplication(B)}),this._loadComponent(L),L}tick(){if(this._runningTick)throw new Ae(101,!1);try{this._runningTick=!0;for(let c of this._views)c.detectChanges()}catch(c){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(c))}finally{this._runningTick=!1}}attachView(c){const h=c;this._views.push(h),h.attachToAppRef(this)}detachView(c){const h=c;iu(this._views,h),h.detachFromAppRef()}_loadComponent(c){this.attachView(c.hostView),this.tick(),this.components.push(c);const h=this._injector.get(ec,[]);h.push(...this._bootstrapListeners),h.forEach(p=>p(c))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(c=>c()),this._views.slice().forEach(c=>c.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(c){return this._destroyListeners.push(c),()=>iu(this._destroyListeners,c)}destroy(){if(this._destroyed)throw new Ae(406,!1);const c=this._injector;c.destroy&&!c.destroyed&&c.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return a.\u0275fac=function(c){return new(c||a)(wn(vo),wn(Qu),wn(Cp))},a.\u0275prov=xt({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();function iu(a,l){const c=a.indexOf(l);c>-1&&a.splice(c,1)}function rS(){return!1}let iS=(()=>{class a{}return a.__NG_ELEMENT_ID__=sR,a})();function sR(a){return function oR(a,l,c){if(is(a)&&!c){const h=si(a.index,l);return new $p(h,h)}return 47&a.type?new $p(l[ii],l):null}(oi(),Re(),16==(16&a))}class Jy{constructor(){}supports(l){return Gg(l)}create(l){return new aS(l)}}const Sb=(a,l)=>l;class aS{constructor(l){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=l||Sb}forEachItem(l){let c;for(c=this._itHead;null!==c;c=c._next)l(c)}forEachOperation(l){let c=this._itHead,h=this._removalsHead,p=0,y=null;for(;c||h;){const E=!h||c&&c.currentIndex<su(h,p,y)?c:h,S=su(E,p,y),D=E.currentIndex;if(E===h)p--,h=h._nextRemoved;else if(c=c._next,null==E.previousIndex)p++;else{y||(y=[]);const L=S-p,B=D-p;if(L!=B){for(let ae=0;ae<L;ae++){const he=ae<y.length?y[ae]:y[ae]=0,Pe=he+ae;B<=Pe&&Pe<L&&(y[ae]=he+1)}y[E.previousIndex]=B-L}}S!==D&&l(E,S,D)}}forEachPreviousItem(l){let c;for(c=this._previousItHead;null!==c;c=c._nextPrevious)l(c)}forEachAddedItem(l){let c;for(c=this._additionsHead;null!==c;c=c._nextAdded)l(c)}forEachMovedItem(l){let c;for(c=this._movesHead;null!==c;c=c._nextMoved)l(c)}forEachRemovedItem(l){let c;for(c=this._removalsHead;null!==c;c=c._nextRemoved)l(c)}forEachIdentityChange(l){let c;for(c=this._identityChangesHead;null!==c;c=c._nextIdentityChange)l(c)}diff(l){if(null==l&&(l=[]),!Gg(l))throw new Ae(900,!1);return this.check(l)?this:null}onDestroy(){}check(l){this._reset();let p,y,E,c=this._itHead,h=!1;if(Array.isArray(l)){this.length=l.length;for(let S=0;S<this.length;S++)y=l[S],E=this._trackByFn(S,y),null!==c&&Object.is(c.trackById,E)?(h&&(c=this._verifyReinsertion(c,y,E,S)),Object.is(c.item,y)||this._addIdentityChange(c,y)):(c=this._mismatch(c,y,E,S),h=!0),c=c._next}else p=0,function Hg(a,l){if(Array.isArray(a))for(let c=0;c<a.length;c++)l(a[c]);else{const c=a[Symbol.iterator]();let h;for(;!(h=c.next()).done;)l(h.value)}}(l,S=>{E=this._trackByFn(p,S),null!==c&&Object.is(c.trackById,E)?(h&&(c=this._verifyReinsertion(c,S,E,p)),Object.is(c.item,S)||this._addIdentityChange(c,S)):(c=this._mismatch(c,S,E,p),h=!0),c=c._next,p++}),this.length=p;return this._truncate(c),this.collection=l,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let l;for(l=this._previousItHead=this._itHead;null!==l;l=l._next)l._nextPrevious=l._next;for(l=this._additionsHead;null!==l;l=l._nextAdded)l.previousIndex=l.currentIndex;for(this._additionsHead=this._additionsTail=null,l=this._movesHead;null!==l;l=l._nextMoved)l.previousIndex=l.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(l,c,h,p){let y;return null===l?y=this._itTail:(y=l._prev,this._remove(l)),null!==(l=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null))?(Object.is(l.item,c)||this._addIdentityChange(l,c),this._reinsertAfter(l,y,p)):null!==(l=null===this._linkedRecords?null:this._linkedRecords.get(h,p))?(Object.is(l.item,c)||this._addIdentityChange(l,c),this._moveAfter(l,y,p)):l=this._addAfter(new e0(c,h),y,p),l}_verifyReinsertion(l,c,h,p){let y=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null);return null!==y?l=this._reinsertAfter(y,l._prev,p):l.currentIndex!=p&&(l.currentIndex=p,this._addToMoves(l,p)),l}_truncate(l){for(;null!==l;){const c=l._next;this._addToRemovals(this._unlink(l)),l=c}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(l,c,h){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(l);const p=l._prevRemoved,y=l._nextRemoved;return null===p?this._removalsHead=y:p._nextRemoved=y,null===y?this._removalsTail=p:y._prevRemoved=p,this._insertAfter(l,c,h),this._addToMoves(l,h),l}_moveAfter(l,c,h){return this._unlink(l),this._insertAfter(l,c,h),this._addToMoves(l,h),l}_addAfter(l,c,h){return this._insertAfter(l,c,h),this._additionsTail=null===this._additionsTail?this._additionsHead=l:this._additionsTail._nextAdded=l,l}_insertAfter(l,c,h){const p=null===c?this._itHead:c._next;return l._next=p,l._prev=c,null===p?this._itTail=l:p._prev=l,null===c?this._itHead=l:c._next=l,null===this._linkedRecords&&(this._linkedRecords=new Db),this._linkedRecords.put(l),l.currentIndex=h,l}_remove(l){return this._addToRemovals(this._unlink(l))}_unlink(l){null!==this._linkedRecords&&this._linkedRecords.remove(l);const c=l._prev,h=l._next;return null===c?this._itHead=h:c._next=h,null===h?this._itTail=c:h._prev=c,l}_addToMoves(l,c){return l.previousIndex===c||(this._movesTail=null===this._movesTail?this._movesHead=l:this._movesTail._nextMoved=l),l}_addToRemovals(l){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Db),this._unlinkedRecords.put(l),l.currentIndex=null,l._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=l,l._prevRemoved=null):(l._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=l),l}_addIdentityChange(l,c){return l.item=c,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=l:this._identityChangesTail._nextIdentityChange=l,l}}class e0{constructor(l,c){this.item=l,this.trackById=c,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class lS{constructor(){this._head=null,this._tail=null}add(l){null===this._head?(this._head=this._tail=l,l._nextDup=null,l._prevDup=null):(this._tail._nextDup=l,l._prevDup=this._tail,l._nextDup=null,this._tail=l)}get(l,c){let h;for(h=this._head;null!==h;h=h._nextDup)if((null===c||c<=h.currentIndex)&&Object.is(h.trackById,l))return h;return null}remove(l){const c=l._prevDup,h=l._nextDup;return null===c?this._head=h:c._nextDup=h,null===h?this._tail=c:h._prevDup=c,null===this._head}}class Db{constructor(){this.map=new Map}put(l){const c=l.trackById;let h=this.map.get(c);h||(h=new lS,this.map.set(c,h)),h.add(l)}get(l,c){const p=this.map.get(l);return p?p.get(l,c):null}remove(l){const c=l.trackById;return this.map.get(c).remove(l)&&this.map.delete(c),l}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function su(a,l,c){const h=a.previousIndex;if(null===h)return h;let p=0;return c&&h<c.length&&(p=c[h]),h+l+p}class Ab{constructor(){}supports(l){return l instanceof Map||ed(l)}create(){return new cS}}class cS{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(l){let c;for(c=this._mapHead;null!==c;c=c._next)l(c)}forEachPreviousItem(l){let c;for(c=this._previousMapHead;null!==c;c=c._nextPrevious)l(c)}forEachChangedItem(l){let c;for(c=this._changesHead;null!==c;c=c._nextChanged)l(c)}forEachAddedItem(l){let c;for(c=this._additionsHead;null!==c;c=c._nextAdded)l(c)}forEachRemovedItem(l){let c;for(c=this._removalsHead;null!==c;c=c._nextRemoved)l(c)}diff(l){if(l){if(!(l instanceof Map||ed(l)))throw new Ae(900,!1)}else l=new Map;return this.check(l)?this:null}onDestroy(){}check(l){this._reset();let c=this._mapHead;if(this._appendAfter=null,this._forEach(l,(h,p)=>{if(c&&c.key===p)this._maybeAddToChanges(c,h),this._appendAfter=c,c=c._next;else{const y=this._getOrCreateRecordForKey(p,h);c=this._insertBeforeOrAppend(c,y)}}),c){c._prev&&(c._prev._next=null),this._removalsHead=c;for(let h=c;null!==h;h=h._nextRemoved)h===this._mapHead&&(this._mapHead=null),this._records.delete(h.key),h._nextRemoved=h._next,h.previousValue=h.currentValue,h.currentValue=null,h._prev=null,h._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(l,c){if(l){const h=l._prev;return c._next=l,c._prev=h,l._prev=c,h&&(h._next=c),l===this._mapHead&&(this._mapHead=c),this._appendAfter=l,l}return this._appendAfter?(this._appendAfter._next=c,c._prev=this._appendAfter):this._mapHead=c,this._appendAfter=c,null}_getOrCreateRecordForKey(l,c){if(this._records.has(l)){const p=this._records.get(l);this._maybeAddToChanges(p,c);const y=p._prev,E=p._next;return y&&(y._next=E),E&&(E._prev=y),p._next=null,p._prev=null,p}const h=new uS(l);return this._records.set(l,h),h.currentValue=c,this._addToAdditions(h),h}_reset(){if(this.isDirty){let l;for(this._previousMapHead=this._mapHead,l=this._previousMapHead;null!==l;l=l._next)l._nextPrevious=l._next;for(l=this._changesHead;null!==l;l=l._nextChanged)l.previousValue=l.currentValue;for(l=this._additionsHead;null!=l;l=l._nextAdded)l.previousValue=l.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(l,c){Object.is(c,l.currentValue)||(l.previousValue=l.currentValue,l.currentValue=c,this._addToChanges(l))}_addToAdditions(l){null===this._additionsHead?this._additionsHead=this._additionsTail=l:(this._additionsTail._nextAdded=l,this._additionsTail=l)}_addToChanges(l){null===this._changesHead?this._changesHead=this._changesTail=l:(this._changesTail._nextChanged=l,this._changesTail=l)}_forEach(l,c){l instanceof Map?l.forEach(c):Object.keys(l).forEach(h=>c(l[h],h))}}class uS{constructor(l){this.key=l,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function xb(){return new ff([new Jy])}let ff=(()=>{class a{constructor(c){this.factories=c}static create(c,h){if(null!=h){const p=h.factories.slice();c=c.concat(p)}return new a(c)}static extend(c){return{provide:a,useFactory:h=>a.create(c,h||xb()),deps:[[a,new Ht,new ya]]}}find(c){const h=this.factories.find(p=>p.supports(c));if(null!=h)return h;throw new Ae(901,!1)}}return a.\u0275prov=xt({token:a,providedIn:"root",factory:xb}),a})();function Cb(){return new t0([new Ab])}let t0=(()=>{class a{constructor(c){this.factories=c}static create(c,h){if(h){const p=h.factories.slice();c=c.concat(p)}return new a(c)}static extend(c){return{provide:a,useFactory:h=>a.create(c,h||Cb()),deps:[[a,new Ht,new ya]]}}find(c){const h=this.factories.find(p=>p.supports(c));if(h)return h;throw new Ae(901,!1)}}return a.\u0275prov=xt({token:a,providedIn:"root",factory:Cb}),a})();const lr=bb(null,"core",[]);let mR=(()=>{class a{constructor(c){}}return a.\u0275fac=function(c){return new(c||a)(wn(yd))},a.\u0275mod=pe({type:a}),a.\u0275inj=$t({}),a})();function Rb(a){return"boolean"==typeof a?a:null!=a&&"false"!==a}},3942:(Vt,$e,W)=>{W.d($e,{Z:()=>ut});var m=W(2090),ee=W(4859),$=W(6881),fe=W(1877);class be{constructor(Ae,Ke){this._delegate=Ae,this.firebase=Ke,(0,$._addComponent)(Ae,new ee.wA("app-compat",()=>this,"PUBLIC")),this.container=Ae.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(Ae){this._delegate.automaticDataCollectionEnabled=Ae}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(Ae=>{this._delegate.checkDestroyed(),Ae()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),(0,$.deleteApp)(this._delegate)))}_getService(Ae,Ke=$._DEFAULT_ENTRY_NAME){var Ze;this._delegate.checkDestroyed();const at=this._delegate.container.getProvider(Ae);return!at.isInitialized()&&"EXPLICIT"===(null===(Ze=at.getComponent())||void 0===Ze?void 0:Ze.instantiationMode)&&at.initialize(),at.getImmediate({identifier:Ke})}_removeServiceInstance(Ae,Ke=$._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(Ae).clearInstance(Ke)}_addComponent(Ae){(0,$._addComponent)(this._delegate,Ae)}_addOrOverwriteComponent(Ae){(0,$._addOrOverwriteComponent)(this._delegate,Ae)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Le=new m.LL("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),ne=function Ce(){const At=function Oe(At){const Ae={},Ke={__esModule:!0,initializeApp:function Qe(tt,Tt={}){const Ct=$.initializeApp(tt,Tt);if((0,m.r3)(Ae,Ct.name))return Ae[Ct.name];const dn=new At(Ct,Ke);return Ae[Ct.name]=dn,dn},app:at,registerVersion:$.registerVersion,setLogLevel:$.setLogLevel,onLog:$.onLog,apps:null,SDK_VERSION:$.SDK_VERSION,INTERNAL:{registerComponent:function ze(tt){const Tt=tt.name,Ct=Tt.replace("-compat","");if($._registerComponent(tt)&&"PUBLIC"===tt.type){const dn=(It=at())=>{if("function"!=typeof It[Ct])throw Le.create("invalid-app-argument",{appName:Tt});return It[Ct]()};void 0!==tt.serviceProps&&(0,m.ZB)(dn,tt.serviceProps),Ke[Ct]=dn,At.prototype[Ct]=function(...It){return this._getService.bind(this,Tt).apply(this,tt.multipleInstances?It:[])}}return"PUBLIC"===tt.type?Ke[Ct]:null},removeApp:function Ze(tt){delete Ae[tt]},useAsService:function ct(tt,Tt){return"serverAuth"===Tt?null:Tt},modularAPIs:$}};function at(tt){if(!(0,m.r3)(Ae,tt=tt||$._DEFAULT_ENTRY_NAME))throw Le.create("no-app",{appName:tt});return Ae[tt]}return Ke.default=Ke,Object.defineProperty(Ke,"apps",{get:function je(){return Object.keys(Ae).map(tt=>Ae[tt])}}),at.App=At,Ke}(be);return At.INTERNAL=Object.assign(Object.assign({},At.INTERNAL),{createFirebaseNamespace:Ce,extendNamespace:function Ae(Ke){(0,m.ZB)(At,Ke)},createSubscribe:m.ne,ErrorFactory:m.LL,deepExtend:m.ZB}),At}(),te=new fe.Yd("@firebase/app-compat");if((0,m.jU)()&&void 0!==self.firebase){te.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const At=self.firebase.SDK_VERSION;At&&At.indexOf("LITE")>=0&&te.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const ut=ne;!function Ve(At){(0,$.registerVersion)("@firebase/app-compat","0.2.13",At)}()},6881:(Vt,$e,W)=>{W.r($e),W.d($e,{FirebaseError:()=>fe.ZR,SDK_VERSION:()=>wn,_DEFAULT_ENTRY_NAME:()=>Pn,_addComponent:()=>ur,_addOrOverwriteComponent:()=>br,_apps:()=>Kt,_clearComponents:()=>zn,_components:()=>ni,_getProvider:()=>$r,_registerComponent:()=>mi,_removeServiceInstance:()=>ra,deleteApp:()=>es,getApp:()=>Gr,getApps:()=>ri,initializeApp:()=>Pi,onLog:()=>vs,registerVersion:()=>Hr,setLogLevel:()=>bs});var m=W(5861),ee=W(4859),$=W(1877),fe=W(2090);const be=(Se,pe)=>pe.some(Je=>Se instanceof Je);let me,Le;const ne=new WeakMap,te=new WeakMap,ue=new WeakMap,rt=new WeakMap,Ve=new WeakMap;let Ae={get(Se,pe,Je){if(Se instanceof IDBTransaction){if("done"===pe)return te.get(Se);if("objectStoreNames"===pe)return Se.objectStoreNames||ue.get(Se);if("store"===pe)return Je.objectStoreNames[1]?void 0:Je.objectStore(Je.objectStoreNames[0])}return Qe(Se[pe])},set:(Se,pe,Je)=>(Se[pe]=Je,!0),has:(Se,pe)=>Se instanceof IDBTransaction&&("done"===pe||"store"===pe)||pe in Se};function at(Se){return"function"==typeof Se?function Ze(Se){return Se!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function Ce(){return Le||(Le=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(Se)?function(...pe){return Se.apply(je(this),pe),Qe(ne.get(this))}:function(...pe){return Qe(Se.apply(je(this),pe))}:function(pe,...Je){const wt=Se.call(je(this),pe,...Je);return ue.set(wt,pe.sort?pe.sort():[pe]),Qe(wt)}}(Se):(Se instanceof IDBTransaction&&function At(Se){if(te.has(Se))return;const pe=new Promise((Je,wt)=>{const St=()=>{Se.removeEventListener("complete",Gt),Se.removeEventListener("error",Lt),Se.removeEventListener("abort",Lt)},Gt=()=>{Je(),St()},Lt=()=>{wt(Se.error||new DOMException("AbortError","AbortError")),St()};Se.addEventListener("complete",Gt),Se.addEventListener("error",Lt),Se.addEventListener("abort",Lt)});te.set(Se,pe)}(Se),be(Se,function Oe(){return me||(me=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(Se,Ae):Se)}function Qe(Se){if(Se instanceof IDBRequest)return function ut(Se){const pe=new Promise((Je,wt)=>{const St=()=>{Se.removeEventListener("success",Gt),Se.removeEventListener("error",Lt)},Gt=()=>{Je(Qe(Se.result)),St()},Lt=()=>{wt(Se.error),St()};Se.addEventListener("success",Gt),Se.addEventListener("error",Lt)});return pe.then(Je=>{Je instanceof IDBCursor&&ne.set(Je,Se)}).catch(()=>{}),Ve.set(pe,Se),pe}(Se);if(rt.has(Se))return rt.get(Se);const pe=at(Se);return pe!==Se&&(rt.set(Se,pe),Ve.set(pe,Se)),pe}const je=Se=>Ve.get(Se),tt=["get","getKey","getAll","getAllKeys","count"],Tt=["put","add","delete","clear"],Ct=new Map;function dn(Se,pe){var Je;if(!(Se instanceof IDBDatabase)||pe in Se||"string"!=typeof pe)return;if(Ct.get(pe))return Ct.get(pe);const wt=pe.replace(/FromIndex$/,""),St=pe!==wt,Gt=Tt.includes(wt);if(!(wt in(St?IDBIndex:IDBObjectStore).prototype)||!Gt&&!tt.includes(wt))return;const Lt=function(Ln){return(Je=Je||(0,m.Z)(function*(et,...Jn){const Oi=this.transaction(et,Gt?"readwrite":"readonly");let no=Oi.store;return St&&(no=no.index(Jn.shift())),(yield Promise.all([no[wt](...Jn),Gt&&Oi.done]))[0]})).apply(this,arguments)};return Ct.set(pe,Lt),Lt}var It,vn,Rt;!function Ke(Se){Ae=Se(Ae)}(Se=>({...Se,get:(pe,Je,wt)=>dn(pe,Je)||Se.get(pe,Je,wt),has:(pe,Je)=>!!dn(pe,Je)||Se.has(pe,Je)}));class eo{constructor(pe){this.container=pe}getPlatformInfoString(){return this.container.getProviders().map(Je=>{if(function Xi(Se){return"VERSION"===Se.getComponent()?.type}(Je)){const wt=Je.getImmediate();return`${wt.library}/${wt.version}`}return null}).filter(Je=>Je).join(" ")}}const Ji="@firebase/app",ve=new $.Yd("@firebase/app"),Pn="[DEFAULT]",Wt={[Ji]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Kt=new Map,ni=new Map;function ur(Se,pe){try{Se.container.addComponent(pe)}catch(Je){ve.debug(`Component ${pe.name} failed to register with FirebaseApp ${Se.name}`,Je)}}function br(Se,pe){Se.container.addOrOverwriteComponent(pe)}function mi(Se){const pe=Se.name;if(ni.has(pe))return ve.debug(`There were multiple attempts to register component ${pe}.`),!1;ni.set(pe,Se);for(const Je of Kt.values())ur(Je,Se);return!0}function $r(Se,pe){const Je=Se.container.getProvider("heartbeat").getImmediate({optional:!0});return Je&&Je.triggerHeartbeat(),Se.container.getProvider(pe)}function ra(Se,pe,Je=Pn){$r(Se,pe).clearInstance(Je)}function zn(){ni.clear()}const an=new fe.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class to{constructor(pe,Je,wt){this._isDeleted=!1,this._options=Object.assign({},pe),this._config=Object.assign({},Je),this._name=Je.name,this._automaticDataCollectionEnabled=Je.automaticDataCollectionEnabled,this._container=wt,this.container.addComponent(new ee.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(pe){this.checkDestroyed(),this._automaticDataCollectionEnabled=pe}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(pe){this._isDeleted=pe}checkDestroyed(){if(this.isDeleted)throw an.create("app-deleted",{appName:this._name})}}const wn="9.23.0";function Pi(Se,pe={}){let Je=Se;"object"!=typeof pe&&(pe={name:pe});const wt=Object.assign({name:Pn,automaticDataCollectionEnabled:!1},pe),St=wt.name;if("string"!=typeof St||!St)throw an.create("bad-app-name",{appName:String(St)});if(Je||(Je=(0,fe.aH)()),!Je)throw an.create("no-options");const Gt=Kt.get(St);if(Gt){if((0,fe.vZ)(Je,Gt.options)&&(0,fe.vZ)(wt,Gt.config))return Gt;throw an.create("duplicate-app",{appName:St})}const Lt=new ee.H0(St);for(const Ln of ni.values())Lt.addComponent(Ln);const kn=new to(Je,wt,Lt);return Kt.set(St,kn),kn}function Gr(Se=Pn){const pe=Kt.get(Se);if(!pe&&Se===Pn&&(0,fe.aH)())return Pi();if(!pe)throw an.create("no-app",{appName:Se});return pe}function ri(){return Array.from(Kt.values())}function es(Se){return(It=It||(0,m.Z)(function*(pe){const Je=pe.name;Kt.has(Je)&&(Kt.delete(Je),yield Promise.all(pe.container.getProviders().map(wt=>wt.delete())),pe.isDeleted=!0)})).apply(this,arguments)}function Hr(Se,pe,Je){var wt;let St=null!==(wt=Wt[Se])&&void 0!==wt?wt:Se;Je&&(St+=`-${Je}`);const Gt=St.match(/\s|\//),Lt=pe.match(/\s|\//);if(Gt||Lt){const kn=[`Unable to register library "${St}" with version "${pe}":`];return Gt&&kn.push(`library name "${St}" contains illegal characters (whitespace or "/")`),Gt&&Lt&&kn.push("and"),Lt&&kn.push(`version name "${pe}" contains illegal characters (whitespace or "/")`),void ve.warn(kn.join(" "))}mi(new ee.wA(`${St}-version`,()=>({library:St,version:pe}),"VERSION"))}function vs(Se,pe){if(null!==Se&&"function"!=typeof Se)throw an.create("invalid-log-argument");(0,$.Am)(Se,pe)}function bs(Se){(0,$.Ub)(Se)}const re="firebase-heartbeat-database",Q=1,G="firebase-heartbeat-store";let j=null;function V(){return j||(j=function ze(Se,pe,{blocked:Je,upgrade:wt,blocking:St,terminated:Gt}={}){const Lt=indexedDB.open(Se,pe),kn=Qe(Lt);return wt&&Lt.addEventListener("upgradeneeded",Ln=>{wt(Qe(Lt.result),Ln.oldVersion,Ln.newVersion,Qe(Lt.transaction),Ln)}),Je&&Lt.addEventListener("blocked",Ln=>Je(Ln.oldVersion,Ln.newVersion,Ln)),kn.then(Ln=>{Gt&&Ln.addEventListener("close",()=>Gt()),St&&Ln.addEventListener("versionchange",et=>St(et.oldVersion,et.newVersion,et))}).catch(()=>{}),kn}(re,Q,{upgrade:(Se,pe)=>{0===pe&&Se.createObjectStore(G)}}).catch(Se=>{throw an.create("idb-open",{originalErrorMessage:Se.message})})),j}function ke(Se,pe){return(Rt=Rt||(0,m.Z)(function*(Je,wt){try{const Gt=(yield V()).transaction(G,"readwrite");yield Gt.objectStore(G).put(wt,ht(Je)),yield Gt.done}catch(St){if(St instanceof fe.ZR)ve.warn(St.message);else{const Gt=an.create("idb-set",{originalErrorMessage:St?.message});ve.warn(Gt.message)}}})).apply(this,arguments)}function ht(Se){return`${Se.name}!${Se.options.appId}`}class fn{constructor(pe){this.container=pe,this._heartbeatsCache=null;const Je=this.container.getProvider("app").getImmediate();this._storage=new Nn(Je),this._heartbeatsCachePromise=this._storage.read().then(wt=>(this._heartbeatsCache=wt,wt))}triggerHeartbeat(){var pe=this;return(0,m.Z)(function*(){const wt=pe.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),St=Ut();if(null===pe._heartbeatsCache&&(pe._heartbeatsCache=yield pe._heartbeatsCachePromise),pe._heartbeatsCache.lastSentHeartbeatDate!==St&&!pe._heartbeatsCache.heartbeats.some(Gt=>Gt.date===St))return pe._heartbeatsCache.heartbeats.push({date:St,agent:wt}),pe._heartbeatsCache.heartbeats=pe._heartbeatsCache.heartbeats.filter(Gt=>{const Lt=new Date(Gt.date).valueOf();return Date.now()-Lt<=2592e6}),pe._storage.overwrite(pe._heartbeatsCache)})()}getHeartbeatsHeader(){var pe=this;return(0,m.Z)(function*(){if(null===pe._heartbeatsCache&&(yield pe._heartbeatsCachePromise),null===pe._heartbeatsCache||0===pe._heartbeatsCache.heartbeats.length)return"";const Je=Ut(),{heartbeatsToSend:wt,unsentEntries:St}=function qn(Se,pe=1024){const Je=[];let wt=Se.slice();for(const St of Se){const Gt=Je.find(Lt=>Lt.agent===St.agent);if(Gt){if(Gt.dates.push(St.date),$i(Je)>pe){Gt.dates.pop();break}}else if(Je.push({agent:St.agent,dates:[St.date]}),$i(Je)>pe){Je.pop();break}wt=wt.slice(1)}return{heartbeatsToSend:Je,unsentEntries:wt}}(pe._heartbeatsCache.heartbeats),Gt=(0,fe.L)(JSON.stringify({version:2,heartbeats:wt}));return pe._heartbeatsCache.lastSentHeartbeatDate=Je,St.length>0?(pe._heartbeatsCache.heartbeats=St,yield pe._storage.overwrite(pe._heartbeatsCache)):(pe._heartbeatsCache.heartbeats=[],pe._storage.overwrite(pe._heartbeatsCache)),Gt})()}}function Ut(){return(new Date).toISOString().substring(0,10)}class Nn{constructor(pe){this.app=pe,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,m.Z)(function*(){return!!(0,fe.hl)()&&(0,fe.eu)().then(()=>!0).catch(()=>!1)})()}read(){var pe=this;return(0,m.Z)(function*(){return(yield pe._canUseIndexedDBPromise)&&(yield function se(Se){return(vn=vn||(0,m.Z)(function*(pe){try{return yield(yield V()).transaction(G).objectStore(G).get(ht(pe))}catch(Je){if(Je instanceof fe.ZR)ve.warn(Je.message);else{const wt=an.create("idb-get",{originalErrorMessage:Je?.message});ve.warn(wt.message)}}})).apply(this,arguments)}(pe.app))||{heartbeats:[]}})()}overwrite(pe){var Je=this;return(0,m.Z)(function*(){var wt;if(yield Je._canUseIndexedDBPromise){const Gt=yield Je.read();return ke(Je.app,{lastSentHeartbeatDate:null!==(wt=pe.lastSentHeartbeatDate)&&void 0!==wt?wt:Gt.lastSentHeartbeatDate,heartbeats:pe.heartbeats})}})()}add(pe){var Je=this;return(0,m.Z)(function*(){var wt;if(yield Je._canUseIndexedDBPromise){const Gt=yield Je.read();return ke(Je.app,{lastSentHeartbeatDate:null!==(wt=pe.lastSentHeartbeatDate)&&void 0!==wt?wt:Gt.lastSentHeartbeatDate,heartbeats:[...Gt.heartbeats,...pe.heartbeats]})}})()}}function $i(Se){return(0,fe.L)(JSON.stringify({version:2,heartbeats:Se})).length}!function ts(Se){mi(new ee.wA("platform-logger",pe=>new eo(pe),"PRIVATE")),mi(new ee.wA("heartbeat",pe=>new fn(pe),"PRIVATE")),Hr(Ji,"0.9.13",Se),Hr(Ji,"0.9.13","esm2017"),Hr("fire-js","")}("")},4859:(Vt,$e,W)=>{W.d($e,{H0:()=>Oe,wA:()=>$});var m=W(5861),ee=W(2090);class ${constructor(ne,te,ue){this.name=ne,this.instanceFactory=te,this.type=ue,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(ne){return this.instantiationMode=ne,this}setMultipleInstances(ne){return this.multipleInstances=ne,this}setServiceProps(ne){return this.serviceProps=ne,this}setInstanceCreatedCallback(ne){return this.onInstanceCreated=ne,this}}const fe="[DEFAULT]";class be{constructor(ne,te){this.name=ne,this.container=te,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(ne){const te=this.normalizeInstanceIdentifier(ne);if(!this.instancesDeferred.has(te)){const ue=new ee.BH;if(this.instancesDeferred.set(te,ue),this.isInitialized(te)||this.shouldAutoInitialize())try{const rt=this.getOrInitializeService({instanceIdentifier:te});rt&&ue.resolve(rt)}catch{}}return this.instancesDeferred.get(te).promise}getImmediate(ne){var te;const ue=this.normalizeInstanceIdentifier(ne?.identifier),rt=null!==(te=ne?.optional)&&void 0!==te&&te;if(!this.isInitialized(ue)&&!this.shouldAutoInitialize()){if(rt)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:ue})}catch(Ve){if(rt)return null;throw Ve}}getComponent(){return this.component}setComponent(ne){if(ne.name!==this.name)throw Error(`Mismatching Component ${ne.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=ne,this.shouldAutoInitialize()){if(function Le(Ce){return"EAGER"===Ce.instantiationMode}(ne))try{this.getOrInitializeService({instanceIdentifier:fe})}catch{}for(const[te,ue]of this.instancesDeferred.entries()){const rt=this.normalizeInstanceIdentifier(te);try{const Ve=this.getOrInitializeService({instanceIdentifier:rt});ue.resolve(Ve)}catch{}}}}clearInstance(ne=fe){this.instancesDeferred.delete(ne),this.instancesOptions.delete(ne),this.instances.delete(ne)}delete(){var ne=this;return(0,m.Z)(function*(){const te=Array.from(ne.instances.values());yield Promise.all([...te.filter(ue=>"INTERNAL"in ue).map(ue=>ue.INTERNAL.delete()),...te.filter(ue=>"_delete"in ue).map(ue=>ue._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(ne=fe){return this.instances.has(ne)}getOptions(ne=fe){return this.instancesOptions.get(ne)||{}}initialize(ne={}){const{options:te={}}=ne,ue=this.normalizeInstanceIdentifier(ne.instanceIdentifier);if(this.isInitialized(ue))throw Error(`${this.name}(${ue}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const rt=this.getOrInitializeService({instanceIdentifier:ue,options:te});for(const[Ve,ut]of this.instancesDeferred.entries())ue===this.normalizeInstanceIdentifier(Ve)&&ut.resolve(rt);return rt}onInit(ne,te){var ue;const rt=this.normalizeInstanceIdentifier(te),Ve=null!==(ue=this.onInitCallbacks.get(rt))&&void 0!==ue?ue:new Set;Ve.add(ne),this.onInitCallbacks.set(rt,Ve);const ut=this.instances.get(rt);return ut&&ne(ut,rt),()=>{Ve.delete(ne)}}invokeOnInitCallbacks(ne,te){const ue=this.onInitCallbacks.get(te);if(ue)for(const rt of ue)try{rt(ne,te)}catch{}}getOrInitializeService({instanceIdentifier:ne,options:te={}}){let ue=this.instances.get(ne);if(!ue&&this.component&&(ue=this.component.instanceFactory(this.container,{instanceIdentifier:(Ce=ne,Ce===fe?void 0:Ce),options:te}),this.instances.set(ne,ue),this.instancesOptions.set(ne,te),this.invokeOnInitCallbacks(ue,ne),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,ne,ue)}catch{}var Ce;return ue||null}normalizeInstanceIdentifier(ne=fe){return this.component?this.component.multipleInstances?ne:fe:ne}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Oe{constructor(ne){this.name=ne,this.providers=new Map}addComponent(ne){const te=this.getProvider(ne.name);if(te.isComponentSet())throw new Error(`Component ${ne.name} has already been registered with ${this.name}`);te.setComponent(ne)}addOrOverwriteComponent(ne){this.getProvider(ne.name).isComponentSet()&&this.providers.delete(ne.name),this.addComponent(ne)}getProvider(ne){if(this.providers.has(ne))return this.providers.get(ne);const te=new be(ne,this);return this.providers.set(ne,te),te}getProviders(){return Array.from(this.providers.values())}}},1877:(Vt,$e,W)=>{W.d($e,{Am:()=>Ce,Ub:()=>Oe,Yd:()=>Le,in:()=>ee});const m=[];var ee=(()=>{return(ne=ee||(ee={}))[ne.DEBUG=0]="DEBUG",ne[ne.VERBOSE=1]="VERBOSE",ne[ne.INFO=2]="INFO",ne[ne.WARN=3]="WARN",ne[ne.ERROR=4]="ERROR",ne[ne.SILENT=5]="SILENT",ee;var ne})();const $={debug:ee.DEBUG,verbose:ee.VERBOSE,info:ee.INFO,warn:ee.WARN,error:ee.ERROR,silent:ee.SILENT},fe=ee.INFO,be={[ee.DEBUG]:"log",[ee.VERBOSE]:"log",[ee.INFO]:"info",[ee.WARN]:"warn",[ee.ERROR]:"error"},me=(ne,te,...ue)=>{if(te<ne.logLevel)return;const rt=(new Date).toISOString(),Ve=be[te];if(!Ve)throw new Error(`Attempted to log a message with an invalid logType (value: ${te})`);console[Ve](`[${rt}]  ${ne.name}:`,...ue)};class Le{constructor(te){this.name=te,this._logLevel=fe,this._logHandler=me,this._userLogHandler=null,m.push(this)}get logLevel(){return this._logLevel}set logLevel(te){if(!(te in ee))throw new TypeError(`Invalid value "${te}" assigned to \`logLevel\``);this._logLevel=te}setLogLevel(te){this._logLevel="string"==typeof te?$[te]:te}get logHandler(){return this._logHandler}set logHandler(te){if("function"!=typeof te)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=te}get userLogHandler(){return this._userLogHandler}set userLogHandler(te){this._userLogHandler=te}debug(...te){this._userLogHandler&&this._userLogHandler(this,ee.DEBUG,...te),this._logHandler(this,ee.DEBUG,...te)}log(...te){this._userLogHandler&&this._userLogHandler(this,ee.VERBOSE,...te),this._logHandler(this,ee.VERBOSE,...te)}info(...te){this._userLogHandler&&this._userLogHandler(this,ee.INFO,...te),this._logHandler(this,ee.INFO,...te)}warn(...te){this._userLogHandler&&this._userLogHandler(this,ee.WARN,...te),this._logHandler(this,ee.WARN,...te)}error(...te){this._userLogHandler&&this._userLogHandler(this,ee.ERROR,...te),this._logHandler(this,ee.ERROR,...te)}}function Oe(ne){m.forEach(te=>{te.setLogLevel(ne)})}function Ce(ne,te){for(const ue of m){let rt=null;te&&te.level&&(rt=$[te.level]),ue.userLogHandler=null===ne?null:(Ve,ut,...At)=>{const Ae=At.map(Ke=>{if(null==Ke)return null;if("string"==typeof Ke)return Ke;if("number"==typeof Ke||"boolean"==typeof Ke)return Ke.toString();if(Ke instanceof Error)return Ke.message;try{return JSON.stringify(Ke)}catch{return null}}).filter(Ke=>Ke).join(" ");ut>=(rt??Ve.logLevel)&&ne({level:ee[ut].toLowerCase(),message:Ae,args:At,type:Ve.name})}}}},259:(Vt,$e,W)=>{W.d($e,{C6:()=>m.getApps,KN:()=>m.registerVersion,Mq:()=>m.getApp,ZF:()=>m.initializeApp});var m=W(6881);(0,m.registerVersion)("firebase","9.23.0","app")},9260:(Vt,$e,W)=>{W.d($e,{Z:()=>m.Z});var m=W(3942);m.Z.registerVersion("firebase","9.23.0","app-compat")},9568:(Vt,$e,W)=>{W.r($e);var Oe,Ce,ne,te,ue,m=W(5861),ee=W(3942),$=W(1389),fe=W(2090),Le=(W(6881),W(1877),W(4859));function rt(){return window}const Ve=2e3;const je=20;class ze extends $.aB{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(j=>{this.resolveInialized=j})}addPassiveListener(j){this.passiveListeners.add(j)}removePassiveListener(j){this.passiveListeners.delete(j)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(j){return this.resolveInialized(),this.passiveListeners.forEach(V=>V(j)),super.onEvent(j)}initialized(){var j=this;return(0,m.Z)(function*(){yield j.initPromise})()}}function Tt(G){return(ue=ue||(0,m.Z)(function*(j){const V=yield It()._get(vn(j));return V&&(yield It()._remove(vn(j))),V})).apply(this,arguments)}function dn(){const G=[],j="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let V=0;V<je;V++){const se=Math.floor(Math.random()*j.length);G.push(j.charAt(se))}return G.join("")}function It(){return(0,$.aC)($.b)}function vn(G){return(0,$.aD)("authEvent",G.config.apiKey,G.name)}function Xi(G){if(!G?.includes("?"))return{};const[j,...V]=G.split("?");return(0,fe.zd)(V.join("?"))}const ve=class Vs{constructor(){this._redirectPersistence=$.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=$.aE,this._overrideRedirectResult=$.aF}_initialize(j){var V=this;return(0,m.Z)(function*(){const se=j._key();let ke=V.eventManagers.get(se);return ke||(ke=new ze(j),V.eventManagers.set(se,ke),V.attachCallbackListeners(j,ke)),ke})()}_openPopup(j){(0,$.av)(j,"operation-not-supported-in-this-environment")}_openRedirect(j,V,se,ke){var ht=this;return(0,m.Z)(function*(){!function Ze(G){var j,V,se,ke,ht,nn,Qt,fn,Ut,qn;const Nn=rt();(0,$.aA)("function"==typeof(null===(j=Nn?.universalLinks)||void 0===j?void 0:j.subscribe),G,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,$.aA)(typeof(null===(V=Nn?.BuildInfo)||void 0===V?void 0:V.packageName)<"u",G,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,$.aA)("function"==typeof(null===(ht=null===(ke=null===(se=Nn?.cordova)||void 0===se?void 0:se.plugins)||void 0===ke?void 0:ke.browsertab)||void 0===ht?void 0:ht.openUrl),G,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,$.aA)("function"==typeof(null===(fn=null===(Qt=null===(nn=Nn?.cordova)||void 0===nn?void 0:nn.plugins)||void 0===Qt?void 0:Qt.browsertab)||void 0===fn?void 0:fn.isAvailable),G,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,$.aA)("function"==typeof(null===(qn=null===(Ut=Nn?.cordova)||void 0===Ut?void 0:Ut.InAppBrowser)||void 0===qn?void 0:qn.open),G,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(j);const nn=yield ht._initialize(j);yield nn.initialized(),nn.resetRedirect(),(0,$.aG)(),yield ht._originValidation(j);const Qt=function ct(G,j,V=null){return{type:j,eventId:V,urlResponse:null,sessionId:dn(),postBody:null,tenantId:G.tenantId,error:(0,$.az)(G,"no-auth-event")}}(j,se,ke);yield function tt(G,j){return It()._set(vn(G),j)}(j,Qt);const fn=yield function ut(G,j,V){return(Oe=Oe||(0,m.Z)(function*(se,ke,ht){var nn;const{BuildInfo:Qt}=rt();(0,$.as)(ke.sessionId,"AuthEvent did not contain a session ID");const fn=yield function at(G){return(te=te||(0,m.Z)(function*(j){const V=function Qe(G){if((0,$.as)(/[0-9a-zA-Z]+/.test(G),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(G);const j=new ArrayBuffer(G.length),V=new Uint8Array(j);for(let se=0;se<G.length;se++)V[se]=G.charCodeAt(se);return V}(j),se=yield crypto.subtle.digest("SHA-256",V);return Array.from(new Uint8Array(se)).map(ht=>ht.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}(ke.sessionId),Ut={};return(0,$.at)()?Ut.ibi=Qt.packageName:(0,$.au)()?Ut.apn=Qt.packageName:(0,$.av)(se,"operation-not-supported-in-this-environment"),Qt.displayName&&(Ut.appDisplayName=Qt.displayName),Ut.sessionId=fn,(0,$.aw)(se,ht,ke.type,void 0,null!==(nn=ke.eventId)&&void 0!==nn?nn:void 0,Ut)})).apply(this,arguments)}(j,Qt,V),Ut=yield function Ae(G){const{cordova:j}=rt();return new Promise(V=>{j.plugins.browsertab.isAvailable(se=>{let ke=null;se?j.plugins.browsertab.openUrl(G):ke=j.InAppBrowser.open(G,(0,$.ay)()?"_blank":"_system","location=yes"),V(ke)})})}(fn);return function Ke(G,j,V){return(ne=ne||(0,m.Z)(function*(se,ke,ht){const{cordova:nn}=rt();let Qt=()=>{};try{yield new Promise((fn,Ut)=>{let qn=null;function Nn(){var Se;fn();const pe=null===(Se=nn.plugins.browsertab)||void 0===Se?void 0:Se.close;"function"==typeof pe&&pe(),"function"==typeof ht?.close&&ht.close()}function $i(){qn||(qn=window.setTimeout(()=>{Ut((0,$.az)(se,"redirect-cancelled-by-user"))},Ve))}function ts(){"visible"===document?.visibilityState&&$i()}ke.addPassiveListener(Nn),document.addEventListener("resume",$i,!1),(0,$.au)()&&document.addEventListener("visibilitychange",ts,!1),Qt=()=>{ke.removePassiveListener(Nn),document.removeEventListener("resume",$i,!1),document.removeEventListener("visibilitychange",ts,!1),qn&&window.clearTimeout(qn)}})}finally{Qt()}})).apply(this,arguments)}(j,nn,Ut)})()}_isIframeWebStorageSupported(j,V){throw new Error("Method not implemented.")}_originValidation(j){const V=j._key();return this.originValidationPromises[V]||(this.originValidationPromises[V]=function At(G){return(Ce=Ce||(0,m.Z)(function*(j){const{BuildInfo:V}=rt(),se={};(0,$.at)()?se.iosBundleId=V.packageName:(0,$.au)()?se.androidPackageName=V.packageName:(0,$.av)(j,"operation-not-supported-in-this-environment"),yield(0,$.ax)(j,se)})).apply(this,arguments)}(j)),this.originValidationPromises[V]}attachCallbackListeners(j,V){var se,ke;const{universalLinks:ht,handleOpenURL:nn,BuildInfo:Qt}=rt(),fn=setTimeout((0,m.Z)(function*(){yield Tt(j),V.onEvent(we())}),500),Ut=function(ts){return(se=se||(0,m.Z)(function*(Se){clearTimeout(fn);const pe=yield Tt(j);let Je=null;pe&&Se?.url&&(Je=function Ct(G,j){var V,se;const ke=function eo(G){const j=Xi(G),V=j.link?decodeURIComponent(j.link):void 0,se=Xi(V).link,ke=j.deep_link_id?decodeURIComponent(j.deep_link_id):void 0;return Xi(ke).link||ke||se||V||G}(j);if(ke.includes("/__/auth/callback")){const ht=Xi(ke),nn=ht.firebaseError?function Rt(G){try{return JSON.parse(G)}catch{return null}}(decodeURIComponent(ht.firebaseError)):null,Qt=null===(se=null===(V=nn?.code)||void 0===V?void 0:V.split("auth/"))||void 0===se?void 0:se[1],fn=Qt?(0,$.az)(Qt):null;return fn?{type:G.type,eventId:G.eventId,tenantId:G.tenantId,error:fn,urlResponse:null,sessionId:null,postBody:null}:{type:G.type,eventId:G.eventId,tenantId:G.tenantId,sessionId:G.sessionId,urlResponse:ke,postBody:null}}return null}(pe,Se.url)),V.onEvent(Je||we())})).apply(this,arguments)};typeof ht<"u"&&"function"==typeof ht.subscribe&&ht.subscribe(null,Ut);const qn=nn,Nn=`${Qt.packageName.toLowerCase()}://`;rt().handleOpenURL=function($i){return(ke=ke||(0,m.Z)(function*(ts){if(ts.toLowerCase().startsWith(Nn)&&Ut({url:ts}),"function"==typeof qn)try{qn(ts)}catch(Se){console.error(Se)}})).apply(this,arguments)}}};function we(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,$.az)("no-auth-event")}}var ye,st,Xe;const cr=1e3;function $t(){var G;return(null===(G=self?.location)||void 0===G?void 0:G.protocol)||null}function ir(G=(0,fe.z$)()){return!("file:"!==$t()&&"ionic:"!==$t()&&"capacitor:"!==$t()||!G.toLowerCase().match(/iphone|ipad|ipod|android/))}function kr(){try{const G=self.localStorage,j=$.aL();if(G)return G.setItem(j,"1"),G.removeItem(j),!function yr(G=(0,fe.z$)()){return function Rr(){return(0,fe.w1)()&&11===document?.documentMode}()||function Mr(G=(0,fe.z$)()){return/Edge\/\d+/.test(G)}(G)}()||(0,fe.hl)()}catch{return ti()&&(0,fe.hl)()}return!1}function ti(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function vr(){return(function Dn(){return"http:"===$t()||"https:"===$t()}()||(0,fe.ru)()||ir())&&!function jn(){return(0,fe.b$)()||(0,fe.UG)()}()&&kr()&&!ti()}function Ft(){return ir()&&typeof document<"u"}const Fn={LOCAL:"local",NONE:"none",SESSION:"session"},Vi=$.aA,wr="persistence";function Pn(G){return(st=st||(0,m.Z)(function*(j){yield j._initializationPromise;const V=Kt(),se=$.aD(wr,j.config.apiKey,j.name);V&&V.setItem(se,j._getPersistence())})).apply(this,arguments)}function Kt(){var G;try{return(null===(G=function na(){return typeof window<"u"?window:null}())||void 0===G?void 0:G.sessionStorage)||null}catch{return null}}const ni=$.aA;class ur{constructor(){this.browserResolver=$.aC($.k),this.cordovaResolver=$.aC(ve),this.underlyingResolver=null,this._redirectPersistence=$.a,this._completeRedirectFn=$.aE,this._overrideRedirectResult=$.aF}_initialize(j){var V=this;return(0,m.Z)(function*(){return yield V.selectUnderlyingResolver(),V.assertedUnderlyingResolver._initialize(j)})()}_openPopup(j,V,se,ke){var ht=this;return(0,m.Z)(function*(){return yield ht.selectUnderlyingResolver(),ht.assertedUnderlyingResolver._openPopup(j,V,se,ke)})()}_openRedirect(j,V,se,ke){var ht=this;return(0,m.Z)(function*(){return yield ht.selectUnderlyingResolver(),ht.assertedUnderlyingResolver._openRedirect(j,V,se,ke)})()}_isIframeWebStorageSupported(j,V){this.assertedUnderlyingResolver._isIframeWebStorageSupported(j,V)}_originValidation(j){return this.assertedUnderlyingResolver._originValidation(j)}get _shouldInitProactively(){return Ft()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return ni(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var j=this;return(0,m.Z)(function*(){if(j.underlyingResolver)return;const V=yield function _s(){return(ye=ye||(0,m.Z)(function*(){return!!Ft()&&new Promise(G=>{const j=setTimeout(()=>{G(!1)},cr);document.addEventListener("deviceready",()=>{clearTimeout(j),G(!0)})})})).apply(this,arguments)}();j.underlyingResolver=V?j.cordovaResolver:j.browserResolver})()}}function br(G){return G.unwrap()}function $r(G){return zn(G)}function zn(G){const{_tokenResponse:j}=G instanceof fe.ZR?G.customData:G;if(!j)return null;if(!(G instanceof fe.ZR)&&"temporaryProof"in j&&"phoneNumber"in j)return $.P.credentialFromResult(G);const V=j.providerId;if(!V||V===$.p.PASSWORD)return null;let se;switch(V){case $.p.GOOGLE:se=$.V;break;case $.p.FACEBOOK:se=$.U;break;case $.p.GITHUB:se=$.W;break;case $.p.TWITTER:se=$.Z;break;default:const{oauthIdToken:ke,oauthAccessToken:ht,oauthTokenSecret:nn,pendingToken:Qt,nonce:fn}=j;return ht||nn||ke||Qt?Qt?V.startsWith("saml.")?$.aO._create(V,Qt):$.L._fromParams({providerId:V,signInMethod:V,pendingToken:Qt,idToken:ke,accessToken:ht}):new $.X(V).credential({idToken:ke,accessToken:ht,rawNonce:fn}):null}return G instanceof fe.ZR?se.credentialFromError(G):se.credentialFromResult(G)}function dr(G,j){return j.catch(V=>{throw V instanceof fe.ZR&&function ra(G,j){var V;const se=null===(V=j.customData)||void 0===V?void 0:V._tokenResponse;if("auth/multi-factor-auth-required"===j?.code)j.resolver=new to(G,$.aq(G,j));else if(se){const ke=zn(j),ht=j;ke&&(ht.credential=ke,ht.tenantId=se.tenantId||void 0,ht.email=se.email||void 0,ht.phoneNumber=se.phoneNumber||void 0)}}(G,V),V}).then(V=>{const ke=V.user;return{operationType:V.operationType,credential:$r(V),additionalUserInfo:$.ao(V),user:wn.getOrCreate(ke)}})}function an(G,j){return(Xe=Xe||(0,m.Z)(function*(V,se){const ke=yield se;return{verificationId:ke.verificationId,confirm:ht=>dr(V,ke.confirm(ht))}})).apply(this,arguments)}class to{constructor(j,V){this.resolver=V,this.auth=function mi(G){return G.wrapped()}(j)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(j){return dr(br(this.auth),this.resolver.resolveSignIn(j))}}class wn{constructor(j){this._delegate=j,this.multiFactor=$.ar(j)}static getOrCreate(j){return wn.USER_MAP.has(j)||wn.USER_MAP.set(j,new wn(j)),wn.USER_MAP.get(j)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(j){return this._delegate.getIdTokenResult(j)}getIdToken(j){return this._delegate.getIdToken(j)}linkAndRetrieveDataWithCredential(j){return this.linkWithCredential(j)}linkWithCredential(j){var V=this;return(0,m.Z)(function*(){return dr(V.auth,$.a0(V._delegate,j))})()}linkWithPhoneNumber(j,V){var se=this;return(0,m.Z)(function*(){return an(se.auth,$.l(se._delegate,j,V))})()}linkWithPopup(j){var V=this;return(0,m.Z)(function*(){return dr(V.auth,$.d(V._delegate,j,ur))})()}linkWithRedirect(j){var V=this;return(0,m.Z)(function*(){return yield Pn($.aH(V.auth)),$.g(V._delegate,j,ur)})()}reauthenticateAndRetrieveDataWithCredential(j){return this.reauthenticateWithCredential(j)}reauthenticateWithCredential(j){var V=this;return(0,m.Z)(function*(){return dr(V.auth,$.a1(V._delegate,j))})()}reauthenticateWithPhoneNumber(j,V){return an(this.auth,$.r(this._delegate,j,V))}reauthenticateWithPopup(j){return dr(this.auth,$.e(this._delegate,j,ur))}reauthenticateWithRedirect(j){var V=this;return(0,m.Z)(function*(){return yield Pn($.aH(V.auth)),$.h(V._delegate,j,ur)})()}sendEmailVerification(j){return $.ae(this._delegate,j)}unlink(j){var V=this;return(0,m.Z)(function*(){return yield $.an(V._delegate,j),V})()}updateEmail(j){return $.aj(this._delegate,j)}updatePassword(j){return $.ak(this._delegate,j)}updatePhoneNumber(j){return $.u(this._delegate,j)}updateProfile(j){return $.ai(this._delegate,j)}verifyBeforeUpdateEmail(j,V){return $.af(this._delegate,j,V)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}wn.USER_MAP=new WeakMap;const Pi=$.aA;let Gr=(()=>{class G{constructor(V,se){if(this.app=V,se.isInitialized())return this._delegate=se.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:ke}=V.options;Pi(ke,"invalid-api-key",{appName:V.name}),Pi(ke,"invalid-api-key",{appName:V.name});const ht=typeof window<"u"?ur:void 0;this._delegate=se.initialize({options:{persistence:es(ke,V.name),popupRedirectResolver:ht}}),this._delegate._updateErrorMap($.D),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?wn.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(V){this._delegate.languageCode=V}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(V){this._delegate.tenantId=V}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(V,se){$.I(this._delegate,V,se)}applyActionCode(V){return $.a5(this._delegate,V)}checkActionCode(V){return $.a6(this._delegate,V)}confirmPasswordReset(V,se){return $.a4(this._delegate,V,se)}createUserWithEmailAndPassword(V,se){var ke=this;return(0,m.Z)(function*(){return dr(ke._delegate,$.a8(ke._delegate,V,se))})()}fetchProvidersForEmail(V){return this.fetchSignInMethodsForEmail(V)}fetchSignInMethodsForEmail(V){return $.ad(this._delegate,V)}isSignInWithEmailLink(V){return $.ab(this._delegate,V)}getRedirectResult(){var V=this;return(0,m.Z)(function*(){Pi(vr(),V._delegate,"operation-not-supported-in-this-environment");const se=yield $.j(V._delegate,ur);return se?dr(V._delegate,Promise.resolve(se)):{credential:null,user:null}})()}addFrameworkForLogging(V){!function De(G,j){(0,$.aH)(G)._logFramework(j)}(this._delegate,V)}onAuthStateChanged(V,se,ke){const{next:ht,error:nn,complete:Qt}=ri(V,se,ke);return this._delegate.onAuthStateChanged(ht,nn,Qt)}onIdTokenChanged(V,se,ke){const{next:ht,error:nn,complete:Qt}=ri(V,se,ke);return this._delegate.onIdTokenChanged(ht,nn,Qt)}sendSignInLinkToEmail(V,se){return $.aa(this._delegate,V,se)}sendPasswordResetEmail(V,se){return $.a3(this._delegate,V,se||void 0)}setPersistence(V){var se=this;return(0,m.Z)(function*(){let ke;switch(function tr(G,j){Vi(Object.values(Fn).includes(j),G,"invalid-persistence-type"),(0,fe.b$)()?Vi(j!==Fn.SESSION,G,"unsupported-persistence-type"):(0,fe.UG)()?Vi(j===Fn.NONE,G,"unsupported-persistence-type"):ti()?Vi(j===Fn.NONE||j===Fn.LOCAL&&(0,fe.hl)(),G,"unsupported-persistence-type"):Vi(j===Fn.NONE||kr(),G,"unsupported-persistence-type")}(se._delegate,V),V){case Fn.SESSION:ke=$.a;break;case Fn.LOCAL:ke=(yield $.aC($.i)._isAvailable())?$.i:$.b;break;case Fn.NONE:ke=$.N;break;default:return $.av("argument-error",{appName:se._delegate.name})}return se._delegate.setPersistence(ke)})()}signInAndRetrieveDataWithCredential(V){return this.signInWithCredential(V)}signInAnonymously(){return dr(this._delegate,$._(this._delegate))}signInWithCredential(V){return dr(this._delegate,$.$(this._delegate,V))}signInWithCustomToken(V){return dr(this._delegate,$.a2(this._delegate,V))}signInWithEmailAndPassword(V,se){return dr(this._delegate,$.a9(this._delegate,V,se))}signInWithEmailLink(V,se){return dr(this._delegate,$.ac(this._delegate,V,se))}signInWithPhoneNumber(V,se){return an(this._delegate,$.s(this._delegate,V,se))}signInWithPopup(V){var se=this;return(0,m.Z)(function*(){return Pi(vr(),se._delegate,"operation-not-supported-in-this-environment"),dr(se._delegate,$.c(se._delegate,V,ur))})()}signInWithRedirect(V){var se=this;return(0,m.Z)(function*(){return Pi(vr(),se._delegate,"operation-not-supported-in-this-environment"),yield Pn(se._delegate),$.f(se._delegate,V,ur)})()}updateCurrentUser(V){return this._delegate.updateCurrentUser(V)}verifyPasswordResetCode(V){return $.a7(this._delegate,V)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return G.Persistence=Fn,G})();function ri(G,j,V){let se=G;"function"!=typeof G&&({next:se,error:j,complete:V}=G);const ke=se;return{next:nn=>ke(nn&&wn.getOrCreate(nn)),error:j,complete:V}}function es(G,j){const V=function Wt(G,j){const V=Kt();if(!V)return[];const se=$.aD(wr,G,j);switch(V.getItem(se)){case Fn.NONE:return[$.N];case Fn.LOCAL:return[$.i,$.a];case Fn.SESSION:return[$.a];default:return[]}}(G,j);if(typeof self<"u"&&!V.includes($.i)&&V.push($.i),typeof window<"u")for(const se of[$.b,$.a])V.includes(se)||V.push(se);return V.includes($.N)||V.push($.N),V}class Hr{constructor(){this.providerId="phone",this._delegate=new $.P(br(ee.Z.auth()))}static credential(j,V){return $.P.credential(j,V)}verifyPhoneNumber(j,V){return this._delegate.verifyPhoneNumber(j,V)}unwrap(){return this._delegate}}Hr.PHONE_SIGN_IN_METHOD=$.P.PHONE_SIGN_IN_METHOD,Hr.PROVIDER_ID=$.P.PROVIDER_ID;const vs=$.aA;class bs{constructor(j,V,se=ee.Z.app()){var ke;vs(null===(ke=se.options)||void 0===ke?void 0:ke.apiKey,"invalid-api-key",{appName:se.name}),this._delegate=new $.R(j,V,se.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Q(G){G.INTERNAL.registerComponent(new Le.wA("auth-compat",j=>{const V=j.getProvider("app-compat").getImmediate(),se=j.getProvider("auth");return new Gr(V,se)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:$.A.EMAIL_SIGNIN,PASSWORD_RESET:$.A.PASSWORD_RESET,RECOVER_EMAIL:$.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:$.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:$.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:$.A.VERIFY_EMAIL}},EmailAuthProvider:$.Q,FacebookAuthProvider:$.U,GithubAuthProvider:$.W,GoogleAuthProvider:$.V,OAuthProvider:$.X,SAMLAuthProvider:$.Y,PhoneAuthProvider:Hr,PhoneMultiFactorGenerator:$.m,RecaptchaVerifier:bs,TwitterAuthProvider:$.Z,Auth:Gr,AuthCredential:$.J,Error:fe.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),G.registerVersion("@firebase/auth-compat","0.4.2")}(ee.Z)},5861:(Vt,$e,W)=>{function m($,fe,be,me,Le,Oe,Ce){try{var ne=$[Oe](Ce),te=ne.value}catch(ue){return void be(ue)}ne.done?fe(te):Promise.resolve(te).then(me,Le)}function ee($){return function(){var fe=this,be=arguments;return new Promise(function(me,Le){var Oe=$.apply(fe,be);function Ce(te){m(Oe,me,Le,Ce,ne,"next",te)}function ne(te){m(Oe,me,Le,Ce,ne,"throw",te)}Ce(void 0)})}}W.d($e,{Z:()=>ee})},7582:(Vt,$e,W)=>{function fe(ve,we){var De={};for(var ye in ve)Object.prototype.hasOwnProperty.call(ve,ye)&&we.indexOf(ye)<0&&(De[ye]=ve[ye]);if(null!=ve&&"function"==typeof Object.getOwnPropertySymbols){var st=0;for(ye=Object.getOwnPropertySymbols(ve);st<ye.length;st++)we.indexOf(ye[st])<0&&Object.prototype.propertyIsEnumerable.call(ve,ye[st])&&(De[ye[st]]=ve[ye[st]])}return De}function ue(ve,we,De,ye){return new(De||(De=Promise))(function(Xe,zt){function xt(Dn){try{$t(ye.next(Dn))}catch(ir){zt(ir)}}function cr(Dn){try{$t(ye.throw(Dn))}catch(ir){zt(ir)}}function $t(Dn){Dn.done?Xe(Dn.value):function st(Xe){return Xe instanceof De?Xe:new De(function(zt){zt(Xe)})}(Dn.value).then(xt,cr)}$t((ye=ye.apply(ve,we||[])).next())})}function Qe(ve){return this instanceof Qe?(this.v=ve,this):new Qe(ve)}function je(ve,we,De){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var st,ye=De.apply(ve,we||[]),Xe=[];return st={},zt("next"),zt("throw"),zt("return"),st[Symbol.asyncIterator]=function(){return this},st;function zt(jn){ye[jn]&&(st[jn]=function(Rr){return new Promise(function(Mr,yr){Xe.push([jn,Rr,Mr,yr])>1||xt(jn,Rr)})})}function xt(jn,Rr){try{!function cr(jn){jn.value instanceof Qe?Promise.resolve(jn.value.v).then($t,Dn):ir(Xe[0][2],jn)}(ye[jn](Rr))}catch(Mr){ir(Xe[0][3],Mr)}}function $t(jn){xt("next",jn)}function Dn(jn){xt("throw",jn)}function ir(jn,Rr){jn(Rr),Xe.shift(),Xe.length&&xt(Xe[0][0],Xe[0][1])}}function ct(ve){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var De,we=ve[Symbol.asyncIterator];return we?we.call(ve):(ve=function At(ve){var we="function"==typeof Symbol&&Symbol.iterator,De=we&&ve[we],ye=0;if(De)return De.call(ve);if(ve&&"number"==typeof ve.length)return{next:function(){return ve&&ye>=ve.length&&(ve=void 0),{value:ve&&ve[ye++],done:!ve}}};throw new TypeError(we?"Object is not iterable.":"Symbol.iterator is not defined.")}(ve),De={},ye("next"),ye("throw"),ye("return"),De[Symbol.asyncIterator]=function(){return this},De);function ye(Xe){De[Xe]=ve[Xe]&&function(zt){return new Promise(function(xt,cr){!function st(Xe,zt,xt,cr){Promise.resolve(cr).then(function($t){Xe({value:$t,done:xt})},zt)}(xt,cr,(zt=ve[Xe](zt)).done,zt.value)})}}}W.d($e,{FC:()=>je,KL:()=>ct,_T:()=>fe,mG:()=>ue,qq:()=>Qe}),"function"==typeof SuppressedError&&SuppressedError}},Vt=>{Vt(Vt.s=6673)}]);