"use strict";(self.webpackChunkTV_Project=self.webpackChunkTV_Project||[]).push([[179],{973:()=>{function Le(n){return"function"==typeof n}function Ws(n){const t=n(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const Ia=Ws(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function ki(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class Xt{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(Le(r))try{r()}catch(s){e=s instanceof Ia?s.errors:[s]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const s of i)try{_g(s)}catch(o){e=e??[],o instanceof Ia?e=[...e,...o.errors]:e.push(o)}}if(e)throw new Ia(e)}}add(e){var t;if(e&&e!==this)if(this.closed)_g(e);else{if(e instanceof Xt){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&ki(t,e)}remove(e){const{_finalizers:t}=this;t&&ki(t,e),e instanceof Xt&&e._removeParent(this)}}Xt.EMPTY=(()=>{const n=new Xt;return n.closed=!0,n})();const vg=Xt.EMPTY;function bg(n){return n instanceof Xt||n&&"closed"in n&&Le(n.remove)&&Le(n.add)&&Le(n.unsubscribe)}function _g(n){Le(n)?n():n.unsubscribe()}const ni={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ma={setTimeout(n,e,...t){const{delegate:r}=Ma;return r?.setTimeout?r.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=Ma;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function Eg(n){Ma.setTimeout(()=>{const{onUnhandledError:e}=ni;if(!e)throw n;e(n)})}function ku(){}const YA=Ou("C",void 0,void 0);function Ou(n,e,t){return{kind:n,value:e,error:t}}let ri=null;function Ra(n){if(ni.useDeprecatedSynchronousErrorHandling){const e=!ri;if(e&&(ri={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:r}=ri;if(ri=null,t)throw r}}else n()}class Pu extends Xt{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,bg(e)&&e.add(this)):this.destination=nw}static create(e,t,r){return new qs(e,t,r)}next(e){this.isStopped?Bu(function ZA(n){return Ou("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?Bu(function QA(n){return Ou("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Bu(YA,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const JA=Function.prototype.bind;function Nu(n,e){return JA.call(n,e)}class ew{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(r){La(r)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(r){La(r)}else La(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){La(t)}}}class qs extends Pu{constructor(e,t,r){let i;if(super(),Le(e)||!e)i={next:e??void 0,error:t??void 0,complete:r??void 0};else{let s;this&&ni.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),i={next:e.next&&Nu(e.next,s),error:e.error&&Nu(e.error,s),complete:e.complete&&Nu(e.complete,s)}):i=e}this.destination=new ew(i)}}function La(n){ni.useDeprecatedSynchronousErrorHandling?function XA(n){ni.useDeprecatedSynchronousErrorHandling&&ri&&(ri.errorThrown=!0,ri.error=n)}(n):Eg(n)}function Bu(n,e){const{onStoppedNotification:t}=ni;t&&Ma.setTimeout(()=>t(n,e))}const nw={closed:!0,next:ku,error:function tw(n){throw n},complete:ku},Uu="function"==typeof Symbol&&Symbol.observable||"@@observable";function kr(n){return n}function Dg(n){return 0===n.length?kr:1===n.length?n[0]:function(t){return n.reduce((r,i)=>i(r),t)}}let Ze=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new n;return r.source=this,r.operator=t,r}subscribe(t,r,i){const s=function sw(n){return n&&n instanceof Pu||function iw(n){return n&&Le(n.next)&&Le(n.error)&&Le(n.complete)}(n)&&bg(n)}(t)?t:new qs(t,r,i);return Ra(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=Tg(r))((i,s)=>{const o=new qs({next:a=>{try{t(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:i});this.subscribe(o)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[Uu](){return this}pipe(...t){return Dg(t)(this)}toPromise(t){return new(t=Tg(t))((r,i)=>{let s;this.subscribe(o=>s=o,o=>i(o),()=>r(s))})}}return n.create=e=>new n(e),n})();function Tg(n){var e;return null!==(e=n??ni.Promise)&&void 0!==e?e:Promise}const ow=Ws(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let un=(()=>{class n extends Ze{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const r=new xg(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new ow}next(t){Ra(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(t)}})}error(t){Ra(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){Ra(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:r,isStopped:i,observers:s}=this;return r||i?vg:(this.currentObservers=null,s.push(t),new Xt(()=>{this.currentObservers=null,ki(s,t)}))}_checkFinalizedStatuses(t){const{hasError:r,thrownError:i,isStopped:s}=this;r?t.error(i):s&&t.complete()}asObservable(){const t=new Ze;return t.source=this,t}}return n.create=(e,t)=>new xg(e,t),n})();class xg extends un{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)}error(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:vg}}function Sg(n){return Le(n?.lift)}function Xe(n){return e=>{if(Sg(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function We(n,e,t,r,i){return new aw(n,e,t,r,i)}class aw extends Pu{constructor(e,t,r,i,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(l){e.error(l)}}:super._next,this._error=i?function(a){try{i(a)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function pe(n,e){return Xe((t,r)=>{let i=0;t.subscribe(We(r,s=>{r.next(n.call(e,s,i++))}))})}function Or(n){return this instanceof Or?(this.v=n,this):new Or(n)}function Ig(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function ju(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,l){!function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}(a,l,(o=n[s](o)).done,o.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Mg=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Rg(n){return Le(n?.then)}function Lg(n){return Le(n[Uu])}function Fg(n){return Symbol.asyncIterator&&Le(n?.[Symbol.asyncIterator])}function kg(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Og=function Iw(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Pg(n){return Le(n?.[Og])}function Ng(n){return function wg(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=t.apply(n,e||[]),s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){r[h]&&(i[h]=function(f){return new Promise(function(p,m){s.push([h,f,p,m])>1||a(h,f)})})}function a(h,f){try{!function l(h){h.value instanceof Or?Promise.resolve(h.value.v).then(c,u):d(s[0][2],h)}(r[h](f))}catch(p){d(s[0][3],p)}}function c(h){a("next",h)}function u(h){a("throw",h)}function d(h,f){h(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:r,done:i}=yield Or(t.read());if(i)return yield Or(void 0);yield yield Or(r)}}finally{t.releaseLock()}})}function Bg(n){return Le(n?.getReader)}function Jt(n){if(n instanceof Ze)return n;if(null!=n){if(Lg(n))return function Mw(n){return new Ze(e=>{const t=n[Uu]();if(Le(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Mg(n))return function Rw(n){return new Ze(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(Rg(n))return function Lw(n){return new Ze(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,Eg)})}(n);if(Fg(n))return Ug(n);if(Pg(n))return function Fw(n){return new Ze(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(Bg(n))return function kw(n){return Ug(Ng(n))}(n)}throw kg(n)}function Ug(n){return new Ze(e=>{(function Ow(n,e){var t,r,i,s;return function Cg(n,e,t,r){return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):function i(s){return s instanceof t?s:new t(function(o){o(s)})}(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=Ig(n);!(r=yield t.next()).done;)if(e.next(r.value),e.closed)return}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=t.return)&&(yield s.call(t))}finally{if(i)throw i.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function cr(n,e,t,r=0,i=!1){const s=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function mt(n,e,t=1/0){return Le(e)?mt((r,i)=>pe((s,o)=>e(r,s,i,o))(Jt(n(r,i))),t):("number"==typeof e&&(t=e),Xe((r,i)=>function Pw(n,e,t,r,i,s,o,a){const l=[];let c=0,u=0,d=!1;const h=()=>{d&&!l.length&&!c&&e.complete()},f=m=>c<r?p(m):l.push(m),p=m=>{s&&e.next(m),c++;let g=!1;Jt(t(m,u++)).subscribe(We(e,v=>{i?.(v),s?f(v):e.next(v)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;l.length&&c<r;){const v=l.shift();o?cr(e,o,()=>p(v)):p(v)}h()}catch(v){e.error(v)}}))};return n.subscribe(We(e,f,()=>{d=!0,h()})),()=>{a?.()}}(r,i,n,t)))}function Oi(n=1/0){return mt(kr,n)}const jn=new Ze(n=>n.complete());function Gu(n){return n[n.length-1]}function Ys(n){return function Bw(n){return n&&Le(n.schedule)}(Gu(n))?n.pop():void 0}function $g(n,e=0){return Xe((t,r)=>{t.subscribe(We(r,i=>cr(r,n,()=>r.next(i),e),()=>cr(r,n,()=>r.complete(),e),i=>cr(r,n,()=>r.error(i),e)))})}function Hg(n,e=0){return Xe((t,r)=>{r.add(n.schedule(()=>t.subscribe(r),e))})}function jg(n,e){if(!n)throw new Error("Iterable cannot be null");return new Ze(t=>{cr(t,e,()=>{const r=n[Symbol.asyncIterator]();cr(t,e,()=>{r.next().then(i=>{i.done?t.complete():t.next(i.value)})},0,!0)})})}function rt(n,e){return e?function Kw(n,e){if(null!=n){if(Lg(n))return function Vw(n,e){return Jt(n).pipe(Hg(e),$g(e))}(n,e);if(Mg(n))return function Hw(n,e){return new Ze(t=>{let r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}(n,e);if(Rg(n))return function $w(n,e){return Jt(n).pipe(Hg(e),$g(e))}(n,e);if(Fg(n))return jg(n,e);if(Pg(n))return function jw(n,e){return new Ze(t=>{let r;return cr(t,e,()=>{r=n[Og](),cr(t,e,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(o){return void t.error(o)}s?t.complete():t.next(i)},0,!0)}),()=>Le(r?.return)&&r.return()})}(n,e);if(Bg(n))return function Gw(n,e){return jg(Ng(n),e)}(n,e)}throw kg(n)}(n,e):Jt(n)}function Ku(n,e,...t){if(!0===e)return void n();if(!1===e)return;const r=new qs({next:()=>{r.unsubscribe(),n()}});return Jt(e(...t)).subscribe(r)}function Me(n){for(let e in n)if(n[e]===Me)return e;throw Error("Could not find renamed property on target object.")}function zu(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function Fe(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Fe).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function Wu(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const qw=Me({__forward_ref__:Me});function ke(n){return n.__forward_ref__=ke,n.toString=function(){return Fe(this())},n}function Y(n){return qu(n)?n():n}function qu(n){return"function"==typeof n&&n.hasOwnProperty(qw)&&n.__forward_ref__===ke}function Yu(n){return n&&!!n.\u0275providers}class w extends Error{constructor(e,t){super(Fa(e,t)),this.code=e}}function Fa(n,e){return`NG0${Math.abs(n)}${e?": "+e.trim():""}`}function ie(n){return"string"==typeof n?n:null==n?"":String(n)}function ka(n,e){throw new w(-201,!1)}function dn(n,e){null==n&&function Se(n,e,t,r){throw new Error(`ASSERTION ERROR: ${n}`+(null==r?"":` [Expected=> ${t} ${r} ${e} <=Actual]`))}(e,n,null,"!=")}function G(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Et(n){return{providers:n.providers||[],imports:n.imports||[]}}function Oa(n){return Kg(n,Pa)||Kg(n,Wg)}function Kg(n,e){return n.hasOwnProperty(e)?n[e]:null}function zg(n){return n&&(n.hasOwnProperty(Qu)||n.hasOwnProperty(nI))?n[Qu]:null}const Pa=Me({\u0275prov:Me}),Qu=Me({\u0275inj:Me}),Wg=Me({ngInjectableDef:Me}),nI=Me({ngInjectorDef:Me});var Q=(()=>((Q=Q||{})[Q.Default=0]="Default",Q[Q.Host=1]="Host",Q[Q.Self=2]="Self",Q[Q.SkipSelf=4]="SkipSelf",Q[Q.Optional=8]="Optional",Q))();let Zu;function hn(n){const e=Zu;return Zu=n,e}function qg(n,e,t){const r=Oa(n);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&Q.Optional?null:void 0!==e?e:void ka(Fe(n))}const Pe=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Qs={},Xu="__NG_DI_FLAG__",Na="ngTempTokenPath",iI="ngTokenPath",sI=/\n/gm,oI="\u0275",Yg="__source";let Zs;function Pi(n){const e=Zs;return Zs=n,e}function aI(n,e=Q.Default){if(void 0===Zs)throw new w(-203,!1);return null===Zs?qg(n,void 0,e):Zs.get(n,e&Q.Optional?null:void 0,e)}function U(n,e=Q.Default){return(function rI(){return Zu}()||aI)(Y(n),e)}function de(n,e=Q.Default){return U(n,Ba(e))}function Ba(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function Ju(n){const e=[];for(let t=0;t<n.length;t++){const r=Y(n[t]);if(Array.isArray(r)){if(0===r.length)throw new w(900,!1);let i,s=Q.Default;for(let o=0;o<r.length;o++){const a=r[o],l=lI(a);"number"==typeof l?-1===l?i=a.token:s|=l:i=a}e.push(U(i,s))}else e.push(U(r))}return e}function Xs(n,e){return n[Xu]=e,n.prototype[Xu]=e,n}function lI(n){return n[Xu]}function ur(n){return{toString:n}.toString()}var Gn=(()=>((Gn=Gn||{})[Gn.OnPush=0]="OnPush",Gn[Gn.Default=1]="Default",Gn))(),An=(()=>{return(n=An||(An={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",An;var n})();const dr={},De=[],Ua=Me({\u0275cmp:Me}),ed=Me({\u0275dir:Me}),td=Me({\u0275pipe:Me}),Zg=Me({\u0275mod:Me}),hr=Me({\u0275fac:Me}),Js=Me({__NG_ELEMENT_ID__:Me});let dI=0;function eo(n){return ur(()=>{const e=Jg(n),t={...e,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===Gn.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:null,data:n.data||{},encapsulation:n.encapsulation||An.Emulated,id:"c"+dI++,styles:n.styles||De,_:null,schemas:n.schemas||null,tView:null};e0(t);const r=n.dependencies;return t.directiveDefs=Va(r,!1),t.pipeDefs=Va(r,!0),t})}function fI(n){return Ce(n)||Dt(n)}function pI(n){return null!==n}function Lt(n){return ur(()=>({type:n.type,bootstrap:n.bootstrap||De,declarations:n.declarations||De,imports:n.imports||De,exports:n.exports||De,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Xg(n,e){if(null==n)return dr;const t={};for(const r in n)if(n.hasOwnProperty(r)){let i=n[r],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),t[i]=r,e&&(e[i]=s)}return t}function J(n){return ur(()=>{const e=Jg(n);return e0(e),e})}function Ce(n){return n[Ua]||null}function Dt(n){return n[ed]||null}function Vt(n){return n[td]||null}function tn(n,e){const t=n[Zg]||null;if(!t&&!0===e)throw new Error(`Type ${Fe(n)} does not have '\u0275mod' property.`);return t}function Jg(n){const e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,exportAs:n.exportAs||null,standalone:!0===n.standalone,selectors:n.selectors||De,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Xg(n.inputs,e),outputs:Xg(n.outputs)}}function e0(n){n.features?.forEach(e=>e(n))}function Va(n,e){if(!n)return null;const t=e?Vt:fI;return()=>("function"==typeof n?n():n).map(r=>t(r)).filter(pI)}const fr=0,H=1,ce=2,qe=3,wn=4,ii=5,Tt=6,Bi=7,Je=8,$a=9,Ha=10,he=11,nd=12,to=13,t0=14,Ui=15,xt=16,no=17,Vi=18,Kn=19,ro=20,n0=21,Ne=22,rd=1,r0=2,ja=7,Ga=8,$i=9,Ft=10;function nn(n){return Array.isArray(n)&&"object"==typeof n[rd]}function In(n){return Array.isArray(n)&&!0===n[rd]}function id(n){return 0!=(4&n.flags)}function io(n){return n.componentOffset>-1}function Ka(n){return 1==(1&n.flags)}function Mn(n){return!!n.template}function gI(n){return 0!=(256&n[ce])}function si(n,e){return n.hasOwnProperty(hr)?n[hr]:null}class bI{constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function fn(){return a0}function a0(n){return n.type.prototype.ngOnChanges&&(n.setInput=EI),_I}function _I(){const n=c0(this),e=n?.current;if(e){const t=n.previous;if(t===dr)n.previous=e;else for(let r in e)t[r]=e[r];n.current=null,this.ngOnChanges(e)}}function EI(n,e,t,r){const i=this.declaredInputs[t],s=c0(n)||function DI(n,e){return n[l0]=e}(n,{previous:dr,current:null}),o=s.current||(s.current={}),a=s.previous,l=a[i];o[i]=new bI(l&&l.currentValue,e,a===dr),n[r]=e}fn.ngInherit=!0;const l0="__ngSimpleChanges__";function c0(n){return n[l0]||null}const pn=function(n,e,t){};function gt(n){for(;Array.isArray(n);)n=n[fr];return n}function za(n,e){return gt(e[n])}function rn(n,e){return gt(e[n.index])}function h0(n,e){return n.data[e]}function $t(n,e){const t=e[n];return nn(t)?t:t[fr]}function Wa(n){return 64==(64&n[ce])}function Nr(n,e){return null==e?null:n[e]}function f0(n){n[Vi]=0}function od(n,e){n[ii]+=e;let t=n,r=n[qe];for(;null!==r&&(1===e&&1===t[ii]||-1===e&&0===t[ii]);)r[ii]+=e,t=r,r=r[qe]}const se={lFrame:T0(null),bindingsEnabled:!0};function m0(){return se.bindingsEnabled}function L(){return se.lFrame.lView}function be(){return se.lFrame.tView}function qa(n){return se.lFrame.contextLView=n,n[Je]}function Ya(n){return se.lFrame.contextLView=null,n}function yt(){let n=g0();for(;null!==n&&64===n.type;)n=n.parent;return n}function g0(){return se.lFrame.currentTNode}function zn(n,e){const t=se.lFrame;t.currentTNode=n,t.isParent=e}function ad(){return se.lFrame.isParent}function ld(){se.lFrame.isParent=!1}function ji(){return se.lFrame.bindingIndex++}function OI(n,e){const t=se.lFrame;t.bindingIndex=t.bindingRootIndex=n,cd(e)}function cd(n){se.lFrame.currentDirectiveIndex=n}function _0(){return se.lFrame.currentQueryIndex}function dd(n){se.lFrame.currentQueryIndex=n}function NI(n){const e=n[H];return 2===e.type?e.declTNode:1===e.type?n[Tt]:null}function E0(n,e,t){if(t&Q.SkipSelf){let i=e,s=n;for(;!(i=i.parent,null!==i||t&Q.Host||(i=NI(s),null===i||(s=s[Ui],10&i.type))););if(null===i)return!1;e=i,n=s}const r=se.lFrame=D0();return r.currentTNode=e,r.lView=n,!0}function hd(n){const e=D0(),t=n[H];se.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function D0(){const n=se.lFrame,e=null===n?null:n.child;return null===e?T0(n):e}function T0(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function x0(){const n=se.lFrame;return se.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const S0=x0;function fd(){const n=x0();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Ot(){return se.lFrame.selectedIndex}function oi(n){se.lFrame.selectedIndex=n}function He(){const n=se.lFrame;return h0(n.tView,n.selectedIndex)}function Qa(n,e){for(let t=e.directiveStart,r=e.directiveEnd;t<r;t++){const s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=s;o&&(n.contentHooks??(n.contentHooks=[])).push(-t,o),a&&((n.contentHooks??(n.contentHooks=[])).push(t,a),(n.contentCheckHooks??(n.contentCheckHooks=[])).push(t,a)),l&&(n.viewHooks??(n.viewHooks=[])).push(-t,l),c&&((n.viewHooks??(n.viewHooks=[])).push(t,c),(n.viewCheckHooks??(n.viewCheckHooks=[])).push(t,c)),null!=u&&(n.destroyHooks??(n.destroyHooks=[])).push(t,u)}}function Za(n,e,t){C0(n,e,3,t)}function Xa(n,e,t,r){(3&n[ce])===t&&C0(n,e,t,r)}function pd(n,e){let t=n[ce];(3&t)===e&&(t&=2047,t+=1,n[ce]=t)}function C0(n,e,t,r){const s=r??-1,o=e.length-1;let a=0;for(let l=void 0!==r?65535&n[Vi]:0;l<o;l++)if("number"==typeof e[l+1]){if(a=e[l],null!=r&&a>=r)break}else e[l]<0&&(n[Vi]+=65536),(a<s||-1==s)&&(zI(n,t,e,l),n[Vi]=(4294901760&n[Vi])+l+2),l++}function zI(n,e,t,r){const i=t[r]<0,s=t[r+1],a=n[i?-t[r]:t[r]];if(i){if(n[ce]>>11<n[Vi]>>16&&(3&n[ce])===e){n[ce]+=2048,pn(4,a,s);try{s.call(a)}finally{pn(5,a,s)}}}else{pn(4,a,s);try{s.call(a)}finally{pn(5,a,s)}}}const Gi=-1;class oo{constructor(e,t,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function gd(n,e,t){let r=0;for(;r<t.length;){const i=t[r];if("number"==typeof i){if(0!==i)break;r++;const s=t[r++],o=t[r++],a=t[r++];n.setAttribute(e,o,a,s)}else{const s=i,o=t[++r];w0(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),r++}}return r}function A0(n){return 3===n||4===n||6===n}function w0(n){return 64===n.charCodeAt(0)}function ao(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let r=0;r<e.length;r++){const i=e[r];"number"==typeof i?t=i:0===t||I0(n,t,i,null,-1===t||2===t?e[++r]:null)}}return n}function I0(n,e,t,r,i){let s=0,o=n.length;if(-1===e)o=-1;else for(;s<n.length;){const a=n[s++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=s-1;break}}}for(;s<n.length;){const a=n[s];if("number"==typeof a)break;if(a===t){if(null===r)return void(null!==i&&(n[s+1]=i));if(r===n[s+1])return void(n[s+2]=i)}s++,null!==r&&s++,null!==i&&s++}-1!==o&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),null!==r&&n.splice(s++,0,r),null!==i&&n.splice(s++,0,i)}function M0(n){return n!==Gi}function Ja(n){return 32767&n}function el(n,e){let t=function QI(n){return n>>16}(n),r=e;for(;t>0;)r=r[Ui],t--;return r}let yd=!0;function tl(n){const e=yd;return yd=n,e}const R0=255,L0=5;let ZI=0;const Wn={};function nl(n,e){const t=F0(n,e);if(-1!==t)return t;const r=e[H];r.firstCreatePass&&(n.injectorIndex=e.length,vd(r.data,n),vd(e,null),vd(r.blueprint,null));const i=bd(n,e),s=n.injectorIndex;if(M0(i)){const o=Ja(i),a=el(i,e),l=a[H].data;for(let c=0;c<8;c++)e[s+c]=a[o+c]|l[o+c]}return e[s+8]=i,s}function vd(n,e){n.push(0,0,0,0,0,0,0,0,e)}function F0(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function bd(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,r=null,i=e;for(;null!==i;){if(r=V0(i),null===r)return Gi;if(t++,i=i[Ui],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return Gi}function _d(n,e,t){!function XI(n,e,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(Js)&&(r=t[Js]),null==r&&(r=t[Js]=ZI++);const i=r&R0;e.data[n+(i>>L0)]|=1<<i}(n,e,t)}function k0(n,e,t){if(t&Q.Optional||void 0!==n)return n;ka()}function O0(n,e,t,r){if(t&Q.Optional&&void 0===r&&(r=null),!(t&(Q.Self|Q.Host))){const i=n[$a],s=hn(void 0);try{return i?i.get(e,r,t&Q.Optional):qg(e,r,t&Q.Optional)}finally{hn(s)}}return k0(r,0,t)}function P0(n,e,t,r=Q.Default,i){if(null!==n){if(1024&e[ce]){const o=function rM(n,e,t,r,i){let s=n,o=e;for(;null!==s&&null!==o&&1024&o[ce]&&!(256&o[ce]);){const a=N0(s,o,t,r|Q.Self,Wn);if(a!==Wn)return a;let l=s.parent;if(!l){const c=o[n0];if(c){const u=c.get(t,Wn,r);if(u!==Wn)return u}l=V0(o),o=o[Ui]}s=l}return i}(n,e,t,r,Wn);if(o!==Wn)return o}const s=N0(n,e,t,r,Wn);if(s!==Wn)return s}return O0(e,t,r,i)}function N0(n,e,t,r,i){const s=function tM(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(Js)?n[Js]:void 0;return"number"==typeof e?e>=0?e&R0:nM:e}(t);if("function"==typeof s){if(!E0(e,n,r))return r&Q.Host?k0(i,0,r):O0(e,t,r,i);try{const o=s(r);if(null!=o||r&Q.Optional)return o;ka()}finally{S0()}}else if("number"==typeof s){let o=null,a=F0(n,e),l=Gi,c=r&Q.Host?e[xt][Tt]:null;for((-1===a||r&Q.SkipSelf)&&(l=-1===a?bd(n,e):e[a+8],l!==Gi&&U0(r,!1)?(o=e[H],a=Ja(l),e=el(l,e)):a=-1);-1!==a;){const u=e[H];if(B0(s,a,u.data)){const d=eM(a,e,t,o,r,c);if(d!==Wn)return d}l=e[a+8],l!==Gi&&U0(r,e[H].data[a+8]===c)&&B0(s,a,e)?(o=u,a=Ja(l),e=el(l,e)):a=-1}}return i}function eM(n,e,t,r,i,s){const o=e[H],a=o.data[n+8],u=rl(a,o,t,null==r?io(a)&&yd:r!=o&&0!=(3&a.type),i&Q.Host&&s===a);return null!==u?ai(e,o,u,a):Wn}function rl(n,e,t,r,i){const s=n.providerIndexes,o=e.data,a=1048575&s,l=n.directiveStart,u=s>>20,h=i?a+u:n.directiveEnd;for(let f=r?a:a+u;f<h;f++){const p=o[f];if(f<l&&t===p||f>=l&&p.type===t)return f}if(i){const f=o[l];if(f&&Mn(f)&&f.type===t)return l}return null}function ai(n,e,t,r){let i=n[t];const s=e.data;if(function WI(n){return n instanceof oo}(i)){const o=i;o.resolving&&function Yw(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new w(-200,`Circular dependency in DI detected for ${n}${t}`)}(function xe(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():ie(n)}(s[t]));const a=tl(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?hn(o.injectImpl):null;E0(n,r,Q.Default);try{i=n[t]=o.factory(void 0,s,n,r),e.firstCreatePass&&t>=r.directiveStart&&function KI(n,e,t){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=e.type.prototype;if(r){const o=a0(e);(t.preOrderHooks??(t.preOrderHooks=[])).push(n,o),(t.preOrderCheckHooks??(t.preOrderCheckHooks=[])).push(n,o)}i&&(t.preOrderHooks??(t.preOrderHooks=[])).push(0-n,i),s&&((t.preOrderHooks??(t.preOrderHooks=[])).push(n,s),(t.preOrderCheckHooks??(t.preOrderCheckHooks=[])).push(n,s))}(t,s[t],e)}finally{null!==l&&hn(l),tl(a),o.resolving=!1,S0()}}return i}function B0(n,e,t){return!!(t[e+(n>>L0)]&1<<n)}function U0(n,e){return!(n&Q.Self||n&Q.Host&&e)}class Ki{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,r){return P0(this._tNode,this._lView,e,Ba(r),t)}}function nM(){return new Ki(yt(),L())}function Ed(n){return qu(n)?()=>{const e=Ed(Y(n));return e&&e()}:si(n)}function V0(n){const e=n[H],t=e.type;return 2===t?e.declTNode:1===t?n[Tt]:null}const Wi="__parameters__";function Yi(n,e,t){return ur(()=>{const r=function Dd(n){return function(...t){if(n){const r=n(...t);for(const i in r)this[i]=r[i]}}}(e);function i(...s){if(this instanceof i)return r.apply(this,s),this;const o=new i(...s);return a.annotation=o,a;function a(l,c,u){const d=l.hasOwnProperty(Wi)?l[Wi]:Object.defineProperty(l,Wi,{value:[]})[Wi];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(o),l}}return t&&(i.prototype=Object.create(t.prototype)),i.prototype.ngMetadataName=n,i.annotationCls=i,i})}class j{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=G({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function li(n,e){n.forEach(t=>Array.isArray(t)?li(t,e):e(t))}function H0(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function sl(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function uo(n,e){const t=[];for(let r=0;r<n;r++)t.push(e);return t}function sn(n,e,t){let r=Qi(n,e);return r>=0?n[1|r]=t:(r=~r,function aM(n,e,t,r){let i=n.length;if(i==e)n.push(t,r);else if(1===i)n.push(r,n[0]),n[0]=t;else{for(i--,n.push(n[i-1],n[i]);i>e;)n[i]=n[i-2],i--;n[e]=t,n[e+1]=r}}(n,r,e,t)),r}function xd(n,e){const t=Qi(n,e);if(t>=0)return n[1|t]}function Qi(n,e){return function j0(n,e,t){let r=0,i=n.length>>t;for(;i!==r;){const s=r+(i-r>>1),o=n[s<<t];if(e===o)return s<<t;o>e?i=s:r=s+1}return~(i<<t)}(n,e,1)}const ho=Xs(Yi("Optional"),8),fo=Xs(Yi("SkipSelf"),4);var Ht=(()=>((Ht=Ht||{})[Ht.Important=1]="Important",Ht[Ht.DashCase=2]="DashCase",Ht))();const Md=new Map;let IM=0;const Ld="__ngContext__";function St(n,e){nn(e)?(n[Ld]=e[ro],function RM(n){Md.set(n[ro],n)}(e)):n[Ld]=e}let Fd;function kd(n,e){return Fd(n,e)}function yo(n){const e=n[qe];return In(e)?e[qe]:e}function Od(n){return cy(n[to])}function Pd(n){return cy(n[wn])}function cy(n){for(;null!==n&&!In(n);)n=n[wn];return n}function Xi(n,e,t,r,i){if(null!=r){let s,o=!1;In(r)?s=r:nn(r)&&(o=!0,r=r[fr]);const a=gt(r);0===n&&null!==t?null==i?my(e,t,a):ci(e,t,a,i||null,!0):1===n&&null!==t?ci(e,t,a,i||null,!0):2===n?function jd(n,e,t){const r=cl(n,e);r&&function ZM(n,e,t,r){n.removeChild(e,t,r)}(n,r,e,t)}(e,a,o):3===n&&e.destroyNode(a),null!=s&&function eR(n,e,t,r,i){const s=t[ja];s!==gt(t)&&Xi(e,n,r,s,i);for(let a=Ft;a<t.length;a++){const l=t[a];vo(l[H],l,n,e,r,s)}}(e,n,s,t,i)}}function Bd(n,e,t){return n.createElement(e,t)}function dy(n,e){const t=n[$i],r=t.indexOf(e),i=e[qe];512&e[ce]&&(e[ce]&=-513,od(i,-1)),t.splice(r,1)}function Ud(n,e){if(n.length<=Ft)return;const t=Ft+e,r=n[t];if(r){const i=r[no];null!==i&&i!==n&&dy(i,r),e>0&&(n[t-1][wn]=r[wn]);const s=sl(n,Ft+e);!function jM(n,e){vo(n,e,e[he],2,null,null),e[fr]=null,e[Tt]=null}(r[H],r);const o=s[Kn];null!==o&&o.detachView(s[H]),r[qe]=null,r[wn]=null,r[ce]&=-65}return r}function hy(n,e){if(!(128&e[ce])){const t=e[he];t.destroyNode&&vo(n,e,t,3,null,null),function zM(n){let e=n[to];if(!e)return Vd(n[H],n);for(;e;){let t=null;if(nn(e))t=e[to];else{const r=e[Ft];r&&(t=r)}if(!t){for(;e&&!e[wn]&&e!==n;)nn(e)&&Vd(e[H],e),e=e[qe];null===e&&(e=n),nn(e)&&Vd(e[H],e),t=e&&e[wn]}e=t}}(e)}}function Vd(n,e){if(!(128&e[ce])){e[ce]&=-65,e[ce]|=128,function QM(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let r=0;r<t.length;r+=2){const i=e[t[r]];if(!(i instanceof oo)){const s=t[r+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=i[s[o]],l=s[o+1];pn(4,a,l);try{l.call(a)}finally{pn(5,a,l)}}else{pn(4,i,s);try{s.call(i)}finally{pn(5,i,s)}}}}}(n,e),function YM(n,e){const t=n.cleanup,r=e[Bi];let i=-1;if(null!==t)for(let s=0;s<t.length-1;s+=2)if("string"==typeof t[s]){const o=t[s+3];o>=0?r[i=o]():r[i=-o].unsubscribe(),s+=2}else{const o=r[i=t[s+1]];t[s].call(o)}if(null!==r){for(let s=i+1;s<r.length;s++)(0,r[s])();e[Bi]=null}}(n,e),1===e[H].type&&e[he].destroy();const t=e[no];if(null!==t&&In(e[qe])){t!==e[qe]&&dy(t,e);const r=e[Kn];null!==r&&r.detachView(n)}!function LM(n){Md.delete(n[ro])}(e)}}function fy(n,e,t){return function py(n,e,t){let r=e;for(;null!==r&&40&r.type;)r=(e=r).parent;if(null===r)return t[fr];{const{componentOffset:i}=r;if(i>-1){const{encapsulation:s}=n.data[r.directiveStart+i];if(s===An.None||s===An.Emulated)return null}return rn(r,t)}}(n,e.parent,t)}function ci(n,e,t,r,i){n.insertBefore(e,t,r,i)}function my(n,e,t){n.appendChild(e,t)}function gy(n,e,t,r,i){null!==r?ci(n,e,t,r,i):my(n,e,t)}function cl(n,e){return n.parentNode(e)}function yy(n,e,t){return by(n,e,t)}let $d,zd,by=function vy(n,e,t){return 40&n.type?rn(n,t):null};function ul(n,e,t,r){const i=fy(n,r,e),s=e[he],a=yy(r.parent||e[Tt],r,e);if(null!=i)if(Array.isArray(t))for(let l=0;l<t.length;l++)gy(s,i,t[l],a,!1);else gy(s,i,t,a,!1);void 0!==$d&&$d(s,r,e,t,i)}function dl(n,e){if(null!==e){const t=e.type;if(3&t)return rn(e,n);if(4&t)return Hd(-1,n[e.index]);if(8&t){const r=e.child;if(null!==r)return dl(n,r);{const i=n[e.index];return In(i)?Hd(-1,i):gt(i)}}if(32&t)return kd(e,n)()||gt(n[e.index]);{const r=Ey(n,e);return null!==r?Array.isArray(r)?r[0]:dl(yo(n[xt]),r):dl(n,e.next)}}return null}function Ey(n,e){return null!==e?n[xt][Tt].projection[e.projection]:null}function Hd(n,e){const t=Ft+n+1;if(t<e.length){const r=e[t],i=r[H].firstChild;if(null!==i)return dl(r,i)}return e[ja]}function Gd(n,e,t,r,i,s,o){for(;null!=t;){const a=r[t.index],l=t.type;if(o&&0===e&&(a&&St(gt(a),r),t.flags|=2),32!=(32&t.flags))if(8&l)Gd(n,e,t.child,r,i,s,!1),Xi(e,n,i,a,s);else if(32&l){const c=kd(t,r);let u;for(;u=c();)Xi(e,n,i,u,s);Xi(e,n,i,a,s)}else 16&l?Dy(n,e,r,t,i,s):Xi(e,n,i,a,s);t=o?t.projectionNext:t.next}}function vo(n,e,t,r,i,s){Gd(t,r,n.firstChild,e,i,s,!1)}function Dy(n,e,t,r,i,s){const o=t[xt],l=o[Tt].projection[r.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)Xi(e,n,i,l[c],s);else Gd(n,e,l,o[qe],i,s,!0)}function Ty(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function xy(n,e,t){const{mergedAttrs:r,classes:i,styles:s}=t;null!==r&&gd(n,e,r),null!==i&&Ty(n,e,i),null!==s&&function nR(n,e,t){n.setAttribute(e,"style",t)}(n,e,s)}class Iy{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const ml=new j("ENVIRONMENT_INITIALIZER"),Uy=new j("INJECTOR",-1),Vy=new j("INJECTOR_DEF_TYPES");class $y{get(e,t=Qs){if(t===Qs){const r=new Error(`NullInjectorError: No provider for ${Fe(e)}!`);throw r.name="NullInjectorError",r}return t}}function IR(...n){return{\u0275providers:Hy(0,n),\u0275fromNgModule:!0}}function Hy(n,...e){const t=[],r=new Set;let i;return li(e,s=>{const o=s;Xd(o,t,[],r)&&(i||(i=[]),i.push(o))}),void 0!==i&&jy(i,t),t}function jy(n,e){for(let t=0;t<n.length;t++){const{providers:i}=n[t];Jd(i,s=>{e.push(s)})}}function Xd(n,e,t,r){if(!(n=Y(n)))return!1;let i=null,s=zg(n);const o=!s&&Ce(n);if(s||o){if(o&&!o.standalone)return!1;i=n}else{const l=n.ngModule;if(s=zg(l),!s)return!1;i=l}const a=r.has(i);if(o){if(a)return!1;if(r.add(i),o.dependencies){const l="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const c of l)Xd(c,e,t,r)}}else{if(!s)return!1;{if(null!=s.imports&&!a){let c;r.add(i);try{li(s.imports,u=>{Xd(u,e,t,r)&&(c||(c=[]),c.push(u))})}finally{}void 0!==c&&jy(c,e)}if(!a){const c=si(i)||(()=>new i);e.push({provide:i,useFactory:c,deps:De},{provide:Vy,useValue:i,multi:!0},{provide:ml,useValue:()=>U(i),multi:!0})}const l=s.providers;null==l||a||Jd(l,u=>{e.push(u)})}}return i!==n&&void 0!==n.providers}function Jd(n,e){for(let t of n)Yu(t)&&(t=t.\u0275providers),Array.isArray(t)?Jd(t,e):e(t)}const MR=Me({provide:String,useValue:Me});function eh(n){return null!==n&&"object"==typeof n&&MR in n}function ui(n){return"function"==typeof n}const th=new j("Set Injector scope."),gl={},LR={};let nh;function yl(){return void 0===nh&&(nh=new $y),nh}class yr{}class zy extends yr{get destroyed(){return this._destroyed}constructor(e,t,r,i){super(),this.parent=t,this.source=r,this.scopes=i,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,ih(e,o=>this.processProvider(o)),this.records.set(Uy,es(void 0,this)),i.has("environment")&&this.records.set(yr,es(void 0,this));const s=this.records.get(th);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(Vy.multi,De,Q.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();for(const e of this._onDestroyHooks)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(e){this._onDestroyHooks.push(e)}runInContext(e){this.assertNotDestroyed();const t=Pi(this),r=hn(void 0);try{return e()}finally{Pi(t),hn(r)}}get(e,t=Qs,r=Q.Default){this.assertNotDestroyed(),r=Ba(r);const i=Pi(this),s=hn(void 0);try{if(!(r&Q.SkipSelf)){let a=this.records.get(e);if(void 0===a){const l=function NR(n){return"function"==typeof n||"object"==typeof n&&n instanceof j}(e)&&Oa(e);a=l&&this.injectableDefInScope(l)?es(rh(e),gl):null,this.records.set(e,a)}if(null!=a)return this.hydrate(e,a)}return(r&Q.Self?yl():this.parent).get(e,t=r&Q.Optional&&t===Qs?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[Na]=o[Na]||[]).unshift(Fe(e)),i)throw o;return function cI(n,e,t,r){const i=n[Na];throw e[Yg]&&i.unshift(e[Yg]),n.message=function uI(n,e,t,r=null){n=n&&"\n"===n.charAt(0)&&n.charAt(1)==oI?n.slice(2):n;let i=Fe(e);if(Array.isArray(e))i=e.map(Fe).join(" -> ");else if("object"==typeof e){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+("string"==typeof a?JSON.stringify(a):Fe(a)))}i=`{${s.join(", ")}}`}return`${t}${r?"("+r+")":""}[${i}]: ${n.replace(sI,"\n  ")}`}("\n"+n.message,i,t,r),n[iI]=i,n[Na]=null,n}(o,e,"R3InjectorError",this.source)}throw o}finally{hn(s),Pi(i)}}resolveInjectorInitializers(){const e=Pi(this),t=hn(void 0);try{const r=this.get(ml.multi,De,Q.Self);for(const i of r)i()}finally{Pi(e),hn(t)}}toString(){const e=[],t=this.records;for(const r of t.keys())e.push(Fe(r));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new w(205,!1)}processProvider(e){let t=ui(e=Y(e))?e:Y(e&&e.provide);const r=function kR(n){return eh(n)?es(void 0,n.useValue):es(function Wy(n,e,t){let r;if(ui(n)){const i=Y(n);return si(i)||rh(i)}if(eh(n))r=()=>Y(n.useValue);else if(function Ky(n){return!(!n||!n.useFactory)}(n))r=()=>n.useFactory(...Ju(n.deps||[]));else if(function Gy(n){return!(!n||!n.useExisting)}(n))r=()=>U(Y(n.useExisting));else{const i=Y(n&&(n.useClass||n.provide));if(!function OR(n){return!!n.deps}(n))return si(i)||rh(i);r=()=>new i(...Ju(n.deps))}return r}(n),gl)}(e);if(ui(e)||!0!==e.multi)this.records.get(t);else{let i=this.records.get(t);i||(i=es(void 0,gl,!0),i.factory=()=>Ju(i.multi),this.records.set(t,i)),t=e,i.multi.push(e)}this.records.set(t,r)}hydrate(e,t){return t.value===gl&&(t.value=LR,t.value=t.factory()),"object"==typeof t.value&&t.value&&function PR(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Y(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}}function rh(n){const e=Oa(n),t=null!==e?e.factory:si(n);if(null!==t)return t;if(n instanceof j)throw new w(204,!1);if(n instanceof Function)return function FR(n){const e=n.length;if(e>0)throw uo(e,"?"),new w(204,!1);const t=function tI(n){return n&&(n[Pa]||n[Wg])||null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new w(204,!1)}function es(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function ih(n,e){for(const t of n)Array.isArray(t)?ih(t,e):t&&Yu(t)?ih(t.\u0275providers,e):e(t)}class BR{}class qy{}class VR{resolveComponentFactory(e){throw function UR(n){const e=Error(`No component factory found for ${Fe(n)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=n,e}(e)}}let Do=(()=>{class n{}return n.NULL=new VR,n})();function $R(){return ts(yt(),L())}function ts(n,e){return new Ct(rn(n,e))}let Ct=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=$R,n})();function HR(n){return n instanceof Ct?n.nativeElement:n}class To{}let GR=(()=>{class n{}return n.\u0275prov=G({token:n,providedIn:"root",factory:()=>null}),n})();class di{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const KR=new di("15.2.9"),sh={},oh="ngOriginalError";function ah(n){return n[oh]}class ns{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&ah(e);for(;t&&ah(t);)t=ah(t);return t||null}}function Qy(n){return n.ownerDocument.defaultView}function br(n){return n instanceof Function?n():n}function Xy(n,e,t){let r=n.length;for(;;){const i=n.indexOf(e,t);if(-1===i)return i;if(0===i||n.charCodeAt(i-1)<=32){const s=e.length;if(i+s===r||n.charCodeAt(i+s)<=32)return i}t=i+1}}const Jy="ng-template";function tL(n,e,t){let r=0,i=!0;for(;r<n.length;){let s=n[r++];if("string"==typeof s&&i){const o=n[r++];if(t&&"class"===s&&-1!==Xy(o.toLowerCase(),e,0))return!0}else{if(1===s){for(;r<n.length&&"string"==typeof(s=n[r++]);)if(s.toLowerCase()===e)return!0;return!1}"number"==typeof s&&(i=!1)}}return!1}function ev(n){return 4===n.type&&n.value!==Jy}function nL(n,e,t){return e===(4!==n.type||t?n.value:Jy)}function rL(n,e,t){let r=4;const i=n.attrs||[],s=function oL(n){for(let e=0;e<n.length;e++)if(A0(n[e]))return e;return n.length}(i);let o=!1;for(let a=0;a<e.length;a++){const l=e[a];if("number"!=typeof l){if(!o)if(4&r){if(r=2|1&r,""!==l&&!nL(n,l,t)||""===l&&1===e.length){if(Rn(r))return!1;o=!0}}else{const c=8&r?l:e[++a];if(8&r&&null!==n.attrs){if(!tL(n.attrs,c,t)){if(Rn(r))return!1;o=!0}continue}const d=iL(8&r?"class":l,i,ev(n),t);if(-1===d){if(Rn(r))return!1;o=!0;continue}if(""!==c){let h;h=d>s?"":i[d+1].toLowerCase();const f=8&r?h:null;if(f&&-1!==Xy(f,c,0)||2&r&&c!==h){if(Rn(r))return!1;o=!0}}}}else{if(!o&&!Rn(r)&&!Rn(l))return!1;if(o&&Rn(l))continue;o=!1,r=l|1&r}}return Rn(r)||o}function Rn(n){return 0==(1&n)}function iL(n,e,t,r){if(null===e)return-1;let i=0;if(r||!t){let s=!1;for(;i<e.length;){const o=e[i];if(o===n)return i;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=e[++i];for(;"string"==typeof a;)a=e[++i];continue}if(4===o)break;if(0===o){i+=4;continue}}i+=s?1:2}return-1}return function aL(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const r=n[t];if("number"==typeof r)return-1;if(r===e)return t;t++}return-1}(e,n)}function tv(n,e,t=!1){for(let r=0;r<e.length;r++)if(rL(n,e[r],t))return!0;return!1}function lL(n,e){e:for(let t=0;t<e.length;t++){const r=e[t];if(n.length===r.length){for(let i=0;i<n.length;i++)if(n[i]!==r[i])continue e;return!0}}return!1}function nv(n,e){return n?":not("+e.trim()+")":e}function cL(n){let e=n[0],t=1,r=2,i="",s=!1;for(;t<n.length;){let o=n[t];if("string"==typeof o)if(2&r){const a=n[++t];i+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""!==i&&!Rn(o)&&(e+=nv(s,i),i=""),r=o,s=s||!Rn(r);t++}return""!==i&&(e+=nv(s,i)),e}const oe={};function qn(n){rv(be(),L(),Ot()+n,!1)}function rv(n,e,t,r){if(!r)if(3==(3&e[ce])){const s=n.preOrderCheckHooks;null!==s&&Za(e,s,t)}else{const s=n.preOrderHooks;null!==s&&Xa(e,s,0,t)}oi(t)}function av(n,e=null,t=null,r){const i=lv(n,e,t,r);return i.resolveInjectorInitializers(),i}function lv(n,e=null,t=null,r,i=new Set){const s=[t||De,IR(n)];return r=r||("object"==typeof n?void 0:Fe(n)),new zy(s,e||yl(),r||null,i)}let Yn=(()=>{class n{static create(t,r){if(Array.isArray(t))return av({name:""},r,t,"");{const i=t.name??"";return av({name:i},t.parent,t.providers,i)}}}return n.THROW_IF_NOT_FOUND=Qs,n.NULL=new $y,n.\u0275prov=G({token:n,providedIn:"any",factory:()=>U(Uy)}),n.__NG_ELEMENT_ID__=-1,n})();function R(n,e=Q.Default){const t=L();return null===t?U(n,e):P0(yt(),t,Y(n),e)}function hh(){throw new Error("invalid")}function mv(n,e){const t=n.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const s=t[r+1];if(-1!==s){const o=n.data[s];dd(t[r]),o.contentQueries(2,e[s],s)}}}function bl(n,e,t,r,i,s,o,a,l,c,u){const d=e.blueprint.slice();return d[fr]=i,d[ce]=76|r,(null!==u||n&&1024&n[ce])&&(d[ce]|=1024),f0(d),d[qe]=d[Ui]=n,d[Je]=t,d[Ha]=o||n&&n[Ha],d[he]=a||n&&n[he],d[nd]=l||n&&n[nd]||null,d[$a]=c||n&&n[$a]||null,d[Tt]=s,d[ro]=function MM(){return IM++}(),d[n0]=u,d[xt]=2==e.type?n[xt]:d,d}function ss(n,e,t,r,i){let s=n.data[e];if(null===s)s=function fh(n,e,t,r,i){const s=g0(),o=ad(),l=n.data[e]=function OL(n,e,t,r,i,s){return{type:t,index:r,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,t,e,r,i);return null===n.firstChild&&(n.firstChild=l),null!==s&&(o?null==s.child&&null!==l.parent&&(s.child=l):null===s.next&&(s.next=l,l.prev=s)),l}(n,e,t,r,i),function kI(){return se.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=t,s.value=r,s.attrs=i;const o=function so(){const n=se.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return zn(s,!0),s}function xo(n,e,t,r){if(0===t)return-1;const i=e.length;for(let s=0;s<t;s++)e.push(r),n.blueprint.push(r),n.data.push(null);return i}function ph(n,e,t){hd(e);try{const r=n.viewQuery;null!==r&&Th(1,r,t);const i=n.template;null!==i&&gv(n,e,i,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&mv(n,e),n.staticViewQueries&&Th(2,n.viewQuery,t);const s=n.components;null!==s&&function LL(n,e){for(let t=0;t<e.length;t++)t1(n,e[t])}(e,s)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{e[ce]&=-5,fd()}}function _l(n,e,t,r){const i=e[ce];if(128!=(128&i)){hd(e);try{f0(e),function v0(n){return se.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&gv(n,e,t,2,r);const o=3==(3&i);if(o){const c=n.preOrderCheckHooks;null!==c&&Za(e,c,null)}else{const c=n.preOrderHooks;null!==c&&Xa(e,c,0,null),pd(e,0)}if(function JL(n){for(let e=Od(n);null!==e;e=Pd(e)){if(!e[r0])continue;const t=e[$i];for(let r=0;r<t.length;r++){const i=t[r];512&i[ce]||od(i[qe],1),i[ce]|=512}}}(e),function XL(n){for(let e=Od(n);null!==e;e=Pd(e))for(let t=Ft;t<e.length;t++){const r=e[t],i=r[H];Wa(r)&&_l(i,r,i.template,r[Je])}}(e),null!==n.contentQueries&&mv(n,e),o){const c=n.contentCheckHooks;null!==c&&Za(e,c)}else{const c=n.contentHooks;null!==c&&Xa(e,c,1),pd(e,1)}!function ML(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let r=0;r<t.length;r++){const i=t[r];if(i<0)oi(~i);else{const s=i,o=t[++r],a=t[++r];OI(o,s),a(2,e[s])}}}finally{oi(-1)}}(n,e);const a=n.components;null!==a&&function RL(n,e){for(let t=0;t<e.length;t++)e1(n,e[t])}(e,a);const l=n.viewQuery;if(null!==l&&Th(2,l,r),o){const c=n.viewCheckHooks;null!==c&&Za(e,c)}else{const c=n.viewHooks;null!==c&&Xa(e,c,2),pd(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[ce]&=-41,512&e[ce]&&(e[ce]&=-513,od(e[qe],-1))}finally{fd()}}}function gv(n,e,t,r,i){const s=Ot(),o=2&r;try{oi(-1),o&&e.length>Ne&&rv(n,e,Ne,!1),pn(o?2:0,i),t(r,i)}finally{oi(s),pn(o?3:1,i)}}function mh(n,e,t){if(id(e)){const i=e.directiveEnd;for(let s=e.directiveStart;s<i;s++){const o=n.data[s];o.contentQueries&&o.contentQueries(1,t[s],s)}}}function gh(n,e,t){m0()&&(function HL(n,e,t,r){const i=t.directiveStart,s=t.directiveEnd;io(t)&&function YL(n,e,t){const r=rn(e,n),i=yv(t),s=n[Ha],o=El(n,bl(n,i,null,t.onPush?32:16,r,e,s,s.createRenderer(r,t),null,null,null));n[e.index]=o}(e,t,n.data[i+t.componentOffset]),n.firstCreatePass||nl(t,e),St(r,e);const o=t.initialInputs;for(let a=i;a<s;a++){const l=n.data[a],c=ai(e,n,a,t);St(c,e),null!==o&&QL(0,a-i,c,l,0,o),Mn(l)&&($t(t.index,e)[Je]=ai(e,n,a,t))}}(n,e,t,rn(t,e)),64==(64&t.flags)&&Dv(n,e,t))}function yh(n,e,t=rn){const r=e.localNames;if(null!==r){let i=e.index+1;for(let s=0;s<r.length;s+=2){const o=r[s+1],a=-1===o?t(e,n):n[o];n[i++]=a}}}function yv(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=vh(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function vh(n,e,t,r,i,s,o,a,l,c){const u=Ne+r,d=u+i,h=function FL(n,e){const t=[];for(let r=0;r<e;r++)t.push(r<n?null:oe);return t}(u,d),f="function"==typeof c?c():c;return h[H]={type:n,blueprint:h,template:t,queries:null,viewQuery:a,declTNode:e,data:h.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:f,incompleteFirstPass:!1}}function vv(n,e,t,r){const i=xv(e);null===t?i.push(r):(i.push(t),n.firstCreatePass&&Sv(n).push(r,i.length-1))}function bv(n,e,t,r){for(let i in n)if(n.hasOwnProperty(i)){t=null===t?{}:t;const s=n[i];null===r?_v(t,e,i,s):r.hasOwnProperty(i)&&_v(t,e,r[i],s)}return t}function _v(n,e,t,r){n.hasOwnProperty(t)?n[t].push(e,r):n[t]=[e,r]}function bh(n,e,t,r){if(m0()){const i=null===r?null:{"":-1},s=function GL(n,e){const t=n.directiveRegistry;let r=null,i=null;if(t)for(let s=0;s<t.length;s++){const o=t[s];if(tv(e,o.selectors,!1))if(r||(r=[]),Mn(o))if(null!==o.findHostDirectiveDefs){const a=[];i=i||new Map,o.findHostDirectiveDefs(o,a,i),r.unshift(...a,o),_h(n,e,a.length)}else r.unshift(o),_h(n,e,0);else i=i||new Map,o.findHostDirectiveDefs?.(o,r,i),r.push(o)}return null===r?null:[r,i]}(n,t);let o,a;null===s?o=a=null:[o,a]=s,null!==o&&Ev(n,e,t,o,i,a),i&&function KL(n,e,t){if(e){const r=n.localNames=[];for(let i=0;i<e.length;i+=2){const s=t[e[i+1]];if(null==s)throw new w(-301,!1);r.push(e[i],s)}}}(t,r,i)}t.mergedAttrs=ao(t.mergedAttrs,t.attrs)}function Ev(n,e,t,r,i,s){for(let c=0;c<r.length;c++)_d(nl(t,e),n,r[c].type);!function WL(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}(t,n.data.length,r.length);for(let c=0;c<r.length;c++){const u=r[c];u.providersResolver&&u.providersResolver(u)}let o=!1,a=!1,l=xo(n,e,r.length,null);for(let c=0;c<r.length;c++){const u=r[c];t.mergedAttrs=ao(t.mergedAttrs,u.hostAttrs),qL(n,t,e,l,u),zL(l,u,i),null!==u.contentQueries&&(t.flags|=4),(null!==u.hostBindings||null!==u.hostAttrs||0!==u.hostVars)&&(t.flags|=64);const d=u.type.prototype;!o&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((n.preOrderHooks??(n.preOrderHooks=[])).push(t.index),o=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((n.preOrderCheckHooks??(n.preOrderCheckHooks=[])).push(t.index),a=!0),l++}!function PL(n,e,t){const i=e.directiveEnd,s=n.data,o=e.attrs,a=[];let l=null,c=null;for(let u=e.directiveStart;u<i;u++){const d=s[u],h=t?t.get(d):null,p=h?h.outputs:null;l=bv(d.inputs,u,l,h?h.inputs:null),c=bv(d.outputs,u,c,p);const m=null===l||null===o||ev(e)?null:ZL(l,u,o);a.push(m)}null!==l&&(l.hasOwnProperty("class")&&(e.flags|=8),l.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=l,e.outputs=c}(n,t,s)}function Dv(n,e,t){const r=t.directiveStart,i=t.directiveEnd,s=t.index,o=function PI(){return se.lFrame.currentDirectiveIndex}();try{oi(s);for(let a=r;a<i;a++){const l=n.data[a],c=e[a];cd(a),(null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs)&&jL(l,c)}}finally{oi(-1),cd(o)}}function jL(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function _h(n,e,t){e.componentOffset=t,(n.components??(n.components=[])).push(e.index)}function zL(n,e,t){if(t){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)t[e.exportAs[r]]=n;Mn(e)&&(t[""]=n)}}function qL(n,e,t,r,i){n.data[r]=i;const s=i.factory||(i.factory=si(i.type)),o=new oo(s,Mn(i),R);n.blueprint[r]=o,t[r]=o,function VL(n,e,t,r,i){const s=i.hostBindings;if(s){let o=n.hostBindingOpCodes;null===o&&(o=n.hostBindingOpCodes=[]);const a=~e.index;(function $L(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(o)!=a&&o.push(a),o.push(t,r,s)}}(n,e,r,xo(n,t,i.hostVars,oe),i)}function Qn(n,e,t,r,i,s){const o=rn(n,e);!function Eh(n,e,t,r,i,s,o){if(null==s)n.removeAttribute(e,i,t);else{const a=null==o?ie(s):o(s,r||"",i);n.setAttribute(e,i,a,t)}}(e[he],o,s,n.value,t,r,i)}function QL(n,e,t,r,i,s){const o=s[e];if(null!==o){const a=r.setInput;for(let l=0;l<o.length;){const c=o[l++],u=o[l++],d=o[l++];null!==a?r.setInput(t,d,c,u):t[u]=d}}}function ZL(n,e,t){let r=null,i=0;for(;i<t.length;){const s=t[i];if(0!==s)if(5!==s){if("number"==typeof s)break;if(n.hasOwnProperty(s)){null===r&&(r=[]);const o=n[s];for(let a=0;a<o.length;a+=2)if(o[a]===e){r.push(s,o[a+1],t[i+1]);break}}i+=2}else i+=2;else i+=4}return r}function Tv(n,e,t,r){return[n,!0,!1,e,null,0,r,t,null,null]}function e1(n,e){const t=$t(e,n);if(Wa(t)){const r=t[H];48&t[ce]?_l(r,t,r.template,t[Je]):t[ii]>0&&Dh(t)}}function Dh(n){for(let r=Od(n);null!==r;r=Pd(r))for(let i=Ft;i<r.length;i++){const s=r[i];if(Wa(s))if(512&s[ce]){const o=s[H];_l(o,s,o.template,s[Je])}else s[ii]>0&&Dh(s)}const t=n[H].components;if(null!==t)for(let r=0;r<t.length;r++){const i=$t(t[r],n);Wa(i)&&i[ii]>0&&Dh(i)}}function t1(n,e){const t=$t(e,n),r=t[H];(function n1(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(r,t),ph(r,t,t[Je])}function El(n,e){return n[to]?n[t0][wn]=e:n[to]=e,n[t0]=e,e}function Dl(n){for(;n;){n[ce]|=32;const e=yo(n);if(gI(n)&&!e)return n;n=e}return null}function Tl(n,e,t,r=!0){const i=e[Ha];i.begin&&i.begin();try{_l(n,e,n.template,t)}catch(o){throw r&&Av(e,o),o}finally{i.end&&i.end()}}function Th(n,e,t){dd(0),e(n,t)}function xv(n){return n[Bi]||(n[Bi]=[])}function Sv(n){return n.cleanup||(n.cleanup=[])}function Av(n,e){const t=n[$a],r=t?t.get(ns,null):null;r&&r.handleError(e)}function xh(n,e,t,r,i){for(let s=0;s<t.length;){const o=t[s++],a=t[s++],l=e[o],c=n.data[o];null!==c.setInput?c.setInput(l,i,r,a):l[a]=i}}function xl(n,e,t){let r=t?n.styles:null,i=t?n.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?s=a:1==s?i=Wu(i,a):2==s&&(r=Wu(r,a+": "+e[++o]+";"))}t?n.styles=r:n.stylesWithoutHost=r,t?n.classes=i:n.classesWithoutHost=i}function Sl(n,e,t,r,i=!1){for(;null!==t;){const s=e[t.index];if(null!==s&&r.push(gt(s)),In(s))for(let a=Ft;a<s.length;a++){const l=s[a],c=l[H].firstChild;null!==c&&Sl(l[H],l,c,r)}const o=t.type;if(8&o)Sl(n,e,t.child,r);else if(32&o){const a=kd(t,e);let l;for(;l=a();)r.push(l)}else if(16&o){const a=Ey(e,t);if(Array.isArray(a))r.push(...a);else{const l=yo(e[xt]);Sl(l[H],l,a,r,!0)}}t=i?t.projectionNext:t.next}return r}class So{get rootNodes(){const e=this._lView,t=e[H];return Sl(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Je]}set context(e){this._lView[Je]=e}get destroyed(){return 128==(128&this._lView[ce])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[qe];if(In(e)){const t=e[Ga],r=t?t.indexOf(this):-1;r>-1&&(Ud(e,r),sl(t,r))}this._attachedToViewContainer=!1}hy(this._lView[H],this._lView)}onDestroy(e){vv(this._lView[H],this._lView,null,e)}markForCheck(){Dl(this._cdRefInjectingView||this._lView)}detach(){this._lView[ce]&=-65}reattach(){this._lView[ce]|=64}detectChanges(){Tl(this._lView[H],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new w(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function KM(n,e){vo(n,e,e[he],2,null,null)}(this._lView[H],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new w(902,!1);this._appRef=e}}class r1 extends So{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;Tl(e[H],e,e[Je],!1)}checkNoChanges(){}get context(){return null}}class wv extends Do{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Ce(e);return new Co(t,this.ngModule)}}function Iv(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class o1{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,r){r=Ba(r);const i=this.injector.get(e,sh,r);return i!==sh||t===sh?i:this.parentInjector.get(e,t,r)}}class Co extends qy{get inputs(){return Iv(this.componentDef.inputs)}get outputs(){return Iv(this.componentDef.outputs)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function uL(n){return n.map(cL).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,r,i){let s=(i=i||this.ngModule)instanceof yr?i:i?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const o=s?new o1(e,s):e,a=o.get(To,null);if(null===a)throw new w(407,!1);const l=o.get(GR,null),c=a.createRenderer(null,this.componentDef),u=this.componentDef.selectors[0][0]||"div",d=r?function kL(n,e,t){return n.selectRootElement(e,t===An.ShadowDom)}(c,r,this.componentDef.encapsulation):Bd(c,u,function s1(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(u)),h=this.componentDef.onPush?288:272,f=vh(0,null,null,1,0,null,null,null,null,null),p=bl(null,f,null,h,null,null,a,c,l,o,null);let m,g;hd(p);try{const v=this.componentDef;let _,b=null;v.findHostDirectiveDefs?(_=[],b=new Map,v.findHostDirectiveDefs(v,_,b),_.push(v)):_=[v];const E=function l1(n,e){const t=n[H],r=Ne;return n[r]=e,ss(t,r,2,"#host",null)}(p,d),T=function c1(n,e,t,r,i,s,o,a){const l=i[H];!function u1(n,e,t,r){for(const i of n)e.mergedAttrs=ao(e.mergedAttrs,i.hostAttrs);null!==e.mergedAttrs&&(xl(e,e.mergedAttrs,!0),null!==t&&xy(r,t,e))}(r,n,e,o);const c=s.createRenderer(e,t),u=bl(i,yv(t),null,t.onPush?32:16,i[n.index],n,s,c,a||null,null,null);return l.firstCreatePass&&_h(l,n,r.length-1),El(i,u),i[n.index]=u}(E,d,v,_,p,a,c);g=h0(f,Ne),d&&function h1(n,e,t,r){if(r)gd(n,t,["ng-version",KR.full]);else{const{attrs:i,classes:s}=function dL(n){const e=[],t=[];let r=1,i=2;for(;r<n.length;){let s=n[r];if("string"==typeof s)2===i?""!==s&&e.push(s,n[++r]):8===i&&t.push(s);else{if(!Rn(i))break;i=s}r++}return{attrs:e,classes:t}}(e.selectors[0]);i&&gd(n,t,i),s&&s.length>0&&Ty(n,t,s.join(" "))}}(c,v,d,r),void 0!==t&&function f1(n,e,t){const r=n.projection=[];for(let i=0;i<e.length;i++){const s=t[i];r.push(null!=s?Array.from(s):null)}}(g,this.ngContentSelectors,t),m=function d1(n,e,t,r,i,s){const o=yt(),a=i[H],l=rn(o,i);Ev(a,i,o,t,null,r);for(let u=0;u<t.length;u++)St(ai(i,a,o.directiveStart+u,o),i);Dv(a,i,o),l&&St(l,i);const c=ai(i,a,o.directiveStart+o.componentOffset,o);if(n[Je]=i[Je]=c,null!==s)for(const u of s)u(c,e);return mh(a,o,n),c}(T,v,_,b,p,[p1]),ph(f,p,null)}finally{fd()}return new a1(this.componentType,m,ts(g,p),p,g)}}class a1 extends BR{constructor(e,t,r,i,s){super(),this.location=r,this._rootLView=i,this._tNode=s,this.instance=t,this.hostView=this.changeDetectorRef=new r1(i),this.componentType=e}setInput(e,t){const r=this._tNode.inputs;let i;if(null!==r&&(i=r[e])){const s=this._rootLView;xh(s[H],s,i,e,t),Dl($t(this._tNode.index,s))}}get injector(){return new Ki(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function p1(){const n=yt();Qa(L()[H],n)}function Te(n){let e=function Mv(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const r=[n];for(;e;){let i;if(Mn(n))i=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new w(903,!1);i=e.\u0275dir}if(i){if(t){r.push(i);const o=n;o.inputs=Sh(n.inputs),o.declaredInputs=Sh(n.declaredInputs),o.outputs=Sh(n.outputs);const a=i.hostBindings;a&&v1(n,a);const l=i.viewQuery,c=i.contentQueries;if(l&&g1(n,l),c&&y1(n,c),zu(n.inputs,i.inputs),zu(n.declaredInputs,i.declaredInputs),zu(n.outputs,i.outputs),Mn(i)&&i.data.animation){const u=n.data;u.animation=(u.animation||[]).concat(i.data.animation)}}const s=i.features;if(s)for(let o=0;o<s.length;o++){const a=s[o];a&&a.ngInherit&&a(n),a===Te&&(t=!1)}}e=Object.getPrototypeOf(e)}!function m1(n){let e=0,t=null;for(let r=n.length-1;r>=0;r--){const i=n[r];i.hostVars=e+=i.hostVars,i.hostAttrs=ao(i.hostAttrs,t=ao(t,i.hostAttrs))}}(r)}function Sh(n){return n===dr?{}:n===De?[]:n}function g1(n,e){const t=n.viewQuery;n.viewQuery=t?(r,i)=>{e(r,i),t(r,i)}:e}function y1(n,e){const t=n.contentQueries;n.contentQueries=t?(r,i,s)=>{e(r,i,s),t(r,i,s)}:e}function v1(n,e){const t=n.hostBindings;n.hostBindings=t?(r,i)=>{e(r,i),t(r,i)}:e}function Cl(n){return!!function Ch(n){return null!==n&&("function"==typeof n||"object"==typeof n)}(n)&&(Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n)}function At(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function Ln(n,e,t,r){const i=L();return At(i,ji(),e)&&(be(),Qn(He(),i,n,e,t,r)),Ln}function wl(n,e,t,r,i,s,o,a){const l=L(),c=be(),u=n+Ne,d=c.firstCreatePass?function w1(n,e,t,r,i,s,o,a,l){const c=e.consts,u=ss(e,n,4,o||null,Nr(c,a));bh(e,t,u,Nr(c,l)),Qa(e,u);const d=u.tView=vh(2,u,r,i,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,c);return null!==e.queries&&(e.queries.template(e,u),d.queries=e.queries.embeddedTView(u)),u}(u,c,l,e,t,r,i,s,o):c.data[u];zn(d,!1);const h=l[he].createComment("");ul(c,l,h,d),St(h,l),El(l,l[u]=Tv(h,l,h,d)),Ka(d)&&gh(c,l,d),null!=o&&yh(l,d,a)}function ms(n,e,t){const r=L();return At(r,ji(),e)&&function on(n,e,t,r,i,s,o,a){const l=rn(e,t);let u,c=e.inputs;!a&&null!=c&&(u=c[r])?(xh(n,t,u,r,i),io(e)&&function BL(n,e){const t=$t(e,n);16&t[ce]||(t[ce]|=32)}(t,e.index)):3&e.type&&(r=function NL(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(r),i=null!=o?o(i,e.value||"",r):i,s.setProperty(l,r,i))}(be(),He(),r,n,e,r[he],t,!1),ms}function Ah(n,e,t,r,i){const o=i?"class":"style";xh(n,t,e.inputs[o],o,r)}function je(n,e,t,r){const i=L(),s=be(),o=Ne+n,a=i[he],l=s.firstCreatePass?function R1(n,e,t,r,i,s){const o=e.consts,l=ss(e,n,2,r,Nr(o,i));return bh(e,t,l,Nr(o,s)),null!==l.attrs&&xl(l,l.attrs,!1),null!==l.mergedAttrs&&xl(l,l.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,l),l}(o,s,i,e,t,r):s.data[o],c=i[o]=Bd(a,e,function GI(){return se.lFrame.currentNamespace}()),u=Ka(l);return zn(l,!0),xy(a,c,l),32!=(32&l.flags)&&ul(s,i,c,l),0===function wI(){return se.lFrame.elementDepthCount}()&&St(c,i),function II(){se.lFrame.elementDepthCount++}(),u&&(gh(s,i,l),mh(s,l,i)),null!==r&&yh(i,l),je}function Be(){let n=yt();ad()?ld():(n=n.parent,zn(n,!1));const e=n;!function MI(){se.lFrame.elementDepthCount--}();const t=be();return t.firstCreatePass&&(Qa(t,n),id(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function qI(n){return 0!=(8&n.flags)}(e)&&Ah(t,e,L(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function YI(n){return 0!=(16&n.flags)}(e)&&Ah(t,e,L(),e.stylesWithoutHost,!1),Be}function fi(n,e,t,r){return je(n,e,t,r),Be(),fi}function Il(){return L()}function wo(n){return!!n&&"function"==typeof n.then}const Mh=function Gv(n){return!!n&&"function"==typeof n.subscribe};function st(n,e,t,r){const i=L(),s=be(),o=yt();return function zv(n,e,t,r,i,s,o){const a=Ka(r),c=n.firstCreatePass&&Sv(n),u=e[Je],d=xv(e);let h=!0;if(3&r.type||o){const m=rn(r,e),g=o?o(m):m,v=d.length,_=o?E=>o(gt(E[r.index])):r.index;let b=null;if(!o&&a&&(b=function F1(n,e,t,r){const i=n.cleanup;if(null!=i)for(let s=0;s<i.length-1;s+=2){const o=i[s];if(o===t&&i[s+1]===r){const a=e[Bi],l=i[s+2];return a.length>l?a[l]:null}"string"==typeof o&&(s+=2)}return null}(n,e,i,r.index)),null!==b)(b.__ngLastListenerFn__||b).__ngNextListenerFn__=s,b.__ngLastListenerFn__=s,h=!1;else{s=qv(r,e,u,s,!1);const E=t.listen(g,i,s);d.push(s,E),c&&c.push(i,_,v,v+1)}}else s=qv(r,e,u,s,!1);const f=r.outputs;let p;if(h&&null!==f&&(p=f[i])){const m=p.length;if(m)for(let g=0;g<m;g+=2){const T=e[p[g]][p[g+1]].subscribe(s),I=d.length;d.push(s,T),c&&c.push(i,r.index,I,-(I+1))}}}(s,i,i[he],o,n,e,r),st}function Wv(n,e,t,r){try{return pn(6,e,t),!1!==t(r)}catch(i){return Av(n,i),!1}finally{pn(7,e,t)}}function qv(n,e,t,r,i){return function s(o){if(o===Function)return r;Dl(n.componentOffset>-1?$t(n.index,e):e);let l=Wv(e,t,r,o),c=s.__ngNextListenerFn__;for(;c;)l=Wv(e,t,c,o)&&l,c=c.__ngNextListenerFn__;return i&&!1===l&&(o.preventDefault(),o.returnValue=!1),l}}function gs(n=1){return function BI(n){return(se.lFrame.contextLView=function UI(n,e){for(;n>0;)e=e[Ui],n--;return e}(n,se.lFrame.contextLView))[Je]}(n)}function k1(n,e){let t=null;const r=function sL(n){const e=n.attrs;if(null!=e){const t=e.indexOf(5);if(!(1&t))return e[t+1]}return null}(n);for(let i=0;i<e.length;i++){const s=e[i];if("*"!==s){if(null===r?tv(n,s,!0):lL(r,s))return i}else t=i}return t}function Ml(n,e=0,t){const r=L(),i=be(),s=ss(i,Ne+n,16,null,t||null);null===s.projection&&(s.projection=e),ld(),32!=(32&s.flags)&&function JM(n,e,t){Dy(e[he],0,e,t,fy(n,t,e),yy(t.parent||e[Tt],t,e))}(i,r,s)}function Rl(n,e){return n<<17|e<<2}function Ur(n){return n>>17&32767}function Lh(n){return 2|n}function pi(n){return(131068&n)>>2}function Fh(n,e){return-131069&n|e<<2}function kh(n){return 1|n}function sb(n,e,t,r,i){const s=n[t+1],o=null===e;let a=r?Ur(s):pi(s),l=!1;for(;0!==a&&(!1===l||o);){const u=n[a+1];V1(n[a],e)&&(l=!0,n[a+1]=r?kh(u):Lh(u)),a=r?Ur(u):pi(u)}l&&(n[t+1]=r?Lh(s):kh(s))}function V1(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&Qi(n,e)>=0}function Er(n,e){return function Fn(n,e,t,r){const i=L(),s=be(),o=function mr(n){const e=se.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}(2);s.firstUpdatePass&&function pb(n,e,t,r){const i=n.data;if(null===i[t+1]){const s=i[Ot()],o=function fb(n,e){return e>=n.expandoStartIndex}(n,t);(function vb(n,e){return 0!=(n.flags&(e?8:16))})(s,r)&&null===e&&!o&&(e=!1),e=function Y1(n,e,t,r){const i=function ud(n){const e=se.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let s=r?e.residualClasses:e.residualStyles;if(null===i)0===(r?e.classBindings:e.styleBindings)&&(t=Io(t=Oh(null,n,e,t,r),e.attrs,r),s=null);else{const o=e.directiveStylingLast;if(-1===o||n[o]!==i)if(t=Oh(i,n,e,t,r),null===s){let l=function Q1(n,e,t){const r=t?e.classBindings:e.styleBindings;if(0!==pi(r))return n[Ur(r)]}(n,e,r);void 0!==l&&Array.isArray(l)&&(l=Oh(null,n,e,l[1],r),l=Io(l,e.attrs,r),function Z1(n,e,t,r){n[Ur(t?e.classBindings:e.styleBindings)]=r}(n,e,r,l))}else s=function X1(n,e,t){let r;const i=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<i;s++)r=Io(r,n[s].hostAttrs,t);return Io(r,e.attrs,t)}(n,e,r)}return void 0!==s&&(r?e.residualClasses=s:e.residualStyles=s),t}(i,s,e,r),function B1(n,e,t,r,i,s){let o=s?e.classBindings:e.styleBindings,a=Ur(o),l=pi(o);n[r]=t;let u,c=!1;if(Array.isArray(t)?(u=t[1],(null===u||Qi(t,u)>0)&&(c=!0)):u=t,i)if(0!==l){const h=Ur(n[a+1]);n[r+1]=Rl(h,a),0!==h&&(n[h+1]=Fh(n[h+1],r)),n[a+1]=function P1(n,e){return 131071&n|e<<17}(n[a+1],r)}else n[r+1]=Rl(a,0),0!==a&&(n[a+1]=Fh(n[a+1],r)),a=r;else n[r+1]=Rl(l,0),0===a?a=r:n[l+1]=Fh(n[l+1],r),l=r;c&&(n[r+1]=Lh(n[r+1])),sb(n,u,r,!0),sb(n,u,r,!1),function U1(n,e,t,r,i){const s=i?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof e&&Qi(s,e)>=0&&(t[r+1]=kh(t[r+1]))}(e,u,n,r,s),o=Rl(a,l),s?e.classBindings=o:e.styleBindings=o}(i,s,e,t,o,r)}}(s,n,o,r),e!==oe&&At(i,o,e)&&function gb(n,e,t,r,i,s,o,a){if(!(3&e.type))return;const l=n.data,c=l[a+1],u=function N1(n){return 1==(1&n)}(c)?yb(l,e,t,i,pi(c),o):void 0;Ll(u)||(Ll(s)||function O1(n){return 2==(2&n)}(c)&&(s=yb(l,null,t,i,a,o)),function tR(n,e,t,r,i){if(e)i?n.addClass(t,r):n.removeClass(t,r);else{let s=-1===r.indexOf("-")?void 0:Ht.DashCase;null==i?n.removeStyle(t,r,s):("string"==typeof i&&i.endsWith("!important")&&(i=i.slice(0,-10),s|=Ht.Important),n.setStyle(t,r,i,s))}}(r,o,za(Ot(),t),i,s))}(s,s.data[Ot()],i,i[he],n,i[o+1]=function nF(n,e){return null==n||""===n||("string"==typeof e?n+=e:"object"==typeof n&&(n=Fe(function Br(n){return n instanceof Iy?n.changingThisBreaksApplicationSecurity:n}(n)))),n}(e,t),r,o)}(n,e,null,!0),Er}function Oh(n,e,t,r,i){let s=null;const o=t.directiveEnd;let a=t.directiveStylingLast;for(-1===a?a=t.directiveStart:a++;a<o&&(s=e[a],r=Io(r,s.hostAttrs,i),s!==n);)a++;return null!==n&&(t.directiveStylingLast=a),r}function Io(n,e,t){const r=t?1:2;let i=-1;if(null!==e)for(let s=0;s<e.length;s++){const o=e[s];"number"==typeof o?i=o:i===r&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),sn(n,o,!!t||e[++s]))}return void 0===n?null:n}function yb(n,e,t,r,i,s){const o=null===e;let a;for(;i>0;){const l=n[i],c=Array.isArray(l),u=c?l[1]:l,d=null===u;let h=t[i+1];h===oe&&(h=d?De:void 0);let f=d?xd(h,r):u===r?h:void 0;if(c&&!Ll(f)&&(f=xd(l,r)),Ll(f)&&(a=f,o))return a;const p=n[i+1];i=o?Ur(p):pi(p)}if(null!==e){let l=s?e.residualClasses:e.residualStyles;null!=l&&(a=xd(l,r))}return a}function Ll(n){return void 0!==n}function ht(n,e=""){const t=L(),r=be(),i=n+Ne,s=r.firstCreatePass?ss(r,i,1,e,null):r.data[i],o=t[i]=function Nd(n,e){return n.createText(e)}(t[he],e);ul(r,t,o,s),zn(s,!1)}function Vr(n,e,t){const r=L(),i=function as(n,e,t,r){return At(n,ji(),t)?e+ie(t)+r:oe}(r,n,e,t);return i!==oe&&function _r(n,e,t){const r=za(e,n);!function uy(n,e,t){n.setValue(e,t)}(n[he],r,t)}(r,Ot(),i),Vr}const bs="en-US";let $b=bs;class _s{}class f_{}class p_ extends _s{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new wv(this);const r=tn(e);this._bootstrapComponents=br(r.bootstrap),this._r3Injector=lv(e,t,[{provide:_s,useValue:this},{provide:Do,useValue:this.componentFactoryResolver}],Fe(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Hh extends f_{constructor(e){super(),this.moduleType=e}create(e){return new p_(this.moduleType,e)}}class Dk extends _s{constructor(e,t,r){super(),this.componentFactoryResolver=new wv(this),this.instance=null;const i=new zy([...e,{provide:_s,useValue:this},{provide:Do,useValue:this.componentFactoryResolver}],t||yl(),r,new Set(["environment"]));this.injector=i,i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function Nl(n,e,t=null){return new Dk(n,e,t).injector}let Tk=(()=>{class n{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t.id)){const r=Hy(0,t.type),i=r.length>0?Nl([r],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t.id,i)}return this.cachedInjectors.get(t.id)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}}return n.\u0275prov=G({token:n,providedIn:"environment",factory:()=>new n(U(yr))}),n})();function m_(n){n.getStandaloneInjector=e=>e.get(Tk).getOrCreateStandaloneInjector(n)}function D_(n,e,t){const r=function kt(){const n=se.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}()+n,i=L();return i[r]===oe?function Zn(n,e,t){return n[e]=t}(i,r,t?e.call(t):e()):function Ao(n,e){return n[e]}(i,r)}function Gh(n){return e=>{setTimeout(n,void 0,e)}}const Qe=class qk extends un{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,r){let i=e,s=t||(()=>null),o=r;if(e&&"object"==typeof e){const l=e;i=l.next?.bind(l),s=l.error?.bind(l),o=l.complete?.bind(l)}this.__isAsync&&(s=Gh(s),i&&(i=Gh(i)),o&&(o=Gh(o)));const a=super.subscribe({next:i,error:s,complete:o});return e instanceof Xt&&e.add(a),a}};function Yk(){return this._results[Symbol.iterator]()}class Kh{get changes(){return this._changes||(this._changes=new Qe)}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Kh.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=Yk)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const r=this;r.dirty=!1;const i=function mn(n){return n.flat(Number.POSITIVE_INFINITY)}(e);(this._changesDetected=!function sM(n,e,t){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++){let i=n[r],s=e[r];if(t&&(i=t(i),s=t(s)),s!==i)return!1}return!0}(r._results,i,t))&&(r._results=i,r.length=i.length,r.last=i[this.length-1],r.first=i[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Dr=(()=>{class n{}return n.__NG_ELEMENT_ID__=Xk,n})();const Qk=Dr,Zk=class extends Qk{constructor(e,t,r){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=r}createEmbeddedView(e,t){const r=this._declarationTContainer.tView,i=bl(this._declarationLView,r,e,16,null,r.declTNode,null,null,null,null,t||null);i[no]=this._declarationLView[this._declarationTContainer.index];const o=this._declarationLView[Kn];return null!==o&&(i[Kn]=o.createEmbeddedView(r)),ph(r,i,e),new So(i)}};function Xk(){return Bl(yt(),L())}function Bl(n,e){return 4&n.type?new Zk(e,n,ts(n,e)):null}let On=(()=>{class n{}return n.__NG_ELEMENT_ID__=Jk,n})();function Jk(){return M_(yt(),L())}const eO=On,w_=class extends eO{constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return ts(this._hostTNode,this._hostLView)}get injector(){return new Ki(this._hostTNode,this._hostLView)}get parentInjector(){const e=bd(this._hostTNode,this._hostLView);if(M0(e)){const t=el(e,this._hostLView),r=Ja(e);return new Ki(t[H].data[r+8],t)}return new Ki(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=I_(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-Ft}createEmbeddedView(e,t,r){let i,s;"number"==typeof r?i=r:null!=r&&(i=r.index,s=r.injector);const o=e.createEmbeddedView(t||{},s);return this.insert(o,i),o}createComponent(e,t,r,i,s){const o=e&&!function co(n){return"function"==typeof n}(e);let a;if(o)a=t;else{const d=t||{};a=d.index,r=d.injector,i=d.projectableNodes,s=d.environmentInjector||d.ngModuleRef}const l=o?e:new Co(Ce(e)),c=r||this.parentInjector;if(!s&&null==l.ngModule){const h=(o?c:this.parentInjector).get(yr,null);h&&(s=h)}const u=l.create(c,i,void 0,s);return this.insert(u.hostView,a),u}insert(e,t){const r=e._lView,i=r[H];if(function AI(n){return In(n[qe])}(r)){const u=this.indexOf(e);if(-1!==u)this.detach(u);else{const d=r[qe],h=new w_(d,d[Tt],d[qe]);h.detach(h.indexOf(e))}}const s=this._adjustIndex(t),o=this._lContainer;!function WM(n,e,t,r){const i=Ft+r,s=t.length;r>0&&(t[i-1][wn]=e),r<s-Ft?(e[wn]=t[i],H0(t,Ft+r,e)):(t.push(e),e[wn]=null),e[qe]=t;const o=e[no];null!==o&&t!==o&&function qM(n,e){const t=n[$i];e[xt]!==e[qe][qe][xt]&&(n[r0]=!0),null===t?n[$i]=[e]:t.push(e)}(o,e);const a=e[Kn];null!==a&&a.insertView(n),e[ce]|=64}(i,r,o,s);const a=Hd(s,o),l=r[he],c=cl(l,o[ja]);return null!==c&&function GM(n,e,t,r,i,s){r[fr]=i,r[Tt]=e,vo(n,r,t,1,i,s)}(i,o[Tt],l,r,c,a),e.attachToViewContainerRef(),H0(zh(o),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=I_(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),r=Ud(this._lContainer,t);r&&(sl(zh(this._lContainer),t),hy(r[H],r))}detach(e){const t=this._adjustIndex(e,-1),r=Ud(this._lContainer,t);return r&&null!=sl(zh(this._lContainer),t)?new So(r):null}_adjustIndex(e,t=0){return e??this.length+t}};function I_(n){return n[Ga]}function zh(n){return n[Ga]||(n[Ga]=[])}function M_(n,e){let t;const r=e[n.index];if(In(r))t=r;else{let i;if(8&n.type)i=gt(r);else{const s=e[he];i=s.createComment("");const o=rn(n,e);ci(s,cl(s,o),i,function XM(n,e){return n.nextSibling(e)}(s,o),!1)}e[n.index]=t=Tv(r,e,i,n),El(e,t)}return new w_(t,n,e)}class Wh{constructor(e){this.queryList=e,this.matches=null}clone(){return new Wh(this.queryList)}setDirty(){this.queryList.setDirty()}}class qh{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const r=null!==e.contentQueries?e.contentQueries[0]:t.length,i=[];for(let s=0;s<r;s++){const o=t.getByIndex(s);i.push(this.queries[o.indexInDeclarationView].clone())}return new qh(i)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==P_(e,t).matches&&this.queries[t].setDirty()}}class R_{constructor(e,t,r=null){this.predicate=e,this.flags=t,this.read=r}}class Yh{constructor(e=[]){this.queries=e}elementStart(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let r=0;r<this.length;r++){const i=null!==t?t.length:0,s=this.getByIndex(r).embeddedTView(e,i);s&&(s.indexInDeclarationView=r,null!==t?t.push(s):t=[s])}return null!==t?new Yh(t):null}template(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class Qh{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new Qh(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=e.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let i=0;i<r.length;i++){const s=r[i];this.matchTNodeWithReadOption(e,t,tO(t,s)),this.matchTNodeWithReadOption(e,t,rl(t,e,s,!1,!1))}else r===Dr?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,rl(t,e,r,!1,!1))}matchTNodeWithReadOption(e,t,r){if(null!==r){const i=this.metadata.read;if(null!==i)if(i===Ct||i===On||i===Dr&&4&t.type)this.addMatch(t.index,-2);else{const s=rl(t,e,i,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,r)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function tO(n,e){const t=n.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===e)return t[r+1];return null}function rO(n,e,t,r){return-1===t?function nO(n,e){return 11&n.type?ts(n,e):4&n.type?Bl(n,e):null}(e,n):-2===t?function iO(n,e,t){return t===Ct?ts(e,n):t===Dr?Bl(e,n):t===On?M_(e,n):void 0}(n,e,r):ai(n,n[H],t,e)}function L_(n,e,t,r){const i=e[Kn].queries[r];if(null===i.matches){const s=n.data,o=t.matches,a=[];for(let l=0;l<o.length;l+=2){const c=o[l];a.push(c<0?null:rO(e,s[c],o[l+1],t.metadata.read))}i.matches=a}return i.matches}function Zh(n,e,t,r){const i=n.queries.getByIndex(t),s=i.matches;if(null!==s){const o=L_(n,e,i,t);for(let a=0;a<s.length;a+=2){const l=s[a];if(l>0)r.push(o[a/2]);else{const c=s[a+1],u=e[-l];for(let d=Ft;d<u.length;d++){const h=u[d];h[no]===h[qe]&&Zh(h[H],h,c,r)}if(null!==u[$i]){const d=u[$i];for(let h=0;h<d.length;h++){const f=d[h];Zh(f[H],f,c,r)}}}}}return r}function Ul(n){const e=L(),t=be(),r=_0();dd(r+1);const i=P_(t,r);if(n.dirty&&function CI(n){return 4==(4&n[ce])}(e)===(2==(2&i.metadata.flags))){if(null===i.matches)n.reset([]);else{const s=i.crossesNgTemplate?Zh(t,e,r,[]):L_(t,e,i,r);n.reset(s,HR),n.notifyOnChanges()}return!0}return!1}function Xh(n,e,t){const r=be();r.firstCreatePass&&(function O_(n,e,t){null===n.queries&&(n.queries=new Yh),n.queries.track(new Qh(e,t))}(r,new R_(n,e,t),-1),2==(2&e)&&(r.staticViewQueries=!0)),function k_(n,e,t){const r=new Kh(4==(4&t));vv(n,e,r,r.destroy),null===e[Kn]&&(e[Kn]=new qh),e[Kn].queries.push(new Wh(r))}(r,L(),e)}function Vl(){return function sO(n,e){return n[Kn].queries[e].queryList}(L(),_0())}function P_(n,e){return n.queries.getByIndex(e)}function Hl(...n){}const jl=new j("Application Initializer");let Gl=(()=>{class n{constructor(t){this.appInits=t,this.resolve=Hl,this.reject=Hl,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,i)=>{this.resolve=r,this.reject=i})}runInitializers(){if(this.initialized)return;const t=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let i=0;i<this.appInits.length;i++){const s=this.appInits[i]();if(wo(s))t.push(s);else if(Mh(s)){const o=new Promise((a,l)=>{s.subscribe({complete:a,error:l})});t.push(o)}}Promise.all(t).then(()=>{r()}).catch(i=>{this.reject(i)}),0===t.length&&r(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(U(jl,8))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Bo=new j("AppId",{providedIn:"root",factory:function eE(){return`${sf()}${sf()}${sf()}`}});function sf(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const tE=new j("Platform Initializer"),af=new j("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Kl=new j("AnimationModuleType");let AO=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const er=new j("LocaleId",{providedIn:"root",factory:()=>de(er,Q.Optional|Q.SkipSelf)||function wO(){return typeof $localize<"u"&&$localize.locale||bs}()});class MO{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let nE=(()=>{class n{compileModuleSync(t){return new Hh(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const r=this.compileModuleSync(t),s=br(tn(t).declarations).reduce((o,a)=>{const l=Ce(a);return l&&o.push(new Co(l)),o},[]);return new MO(r,s)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const FO=(()=>Promise.resolve(0))();function lf(n){typeof Zone>"u"?FO.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Ae{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Qe(!1),this.onMicrotaskEmpty=new Qe(!1),this.onStable=new Qe(!1),this.onError=new Qe(!1),typeof Zone>"u")throw new w(908,!1);Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&t,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function kO(){let n=Pe.requestAnimationFrame,e=Pe.cancelAnimationFrame;if(typeof Zone<"u"&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function NO(n){const e=()=>{!function PO(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Pe,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,uf(n),n.isCheckStableRunning=!0,cf(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),uf(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,i,s,o,a)=>{try{return sE(n),t.invokeTask(i,s,o,a)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&e(),oE(n)}},onInvoke:(t,r,i,s,o,a,l)=>{try{return sE(n),t.invoke(i,s,o,a,l)}finally{n.shouldCoalesceRunChangeDetection&&e(),oE(n)}},onHasTask:(t,r,i,s)=>{t.hasTask(i,s),r===i&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,uf(n),cf(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,r,i,s)=>(t.handleError(i,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(i)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ae.isInAngularZone())throw new w(909,!1)}static assertNotInAngularZone(){if(Ae.isInAngularZone())throw new w(909,!1)}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,i){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+i,e,OO,Hl,Hl);try{return s.runTask(o,t,r)}finally{s.cancelTask(o)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}}const OO={};function cf(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function uf(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function sE(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function oE(n){n._nesting--,cf(n)}class BO{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Qe,this.onMicrotaskEmpty=new Qe,this.onStable=new Qe,this.onError=new Qe}run(e,t,r){return e.apply(t,r)}runGuarded(e,t,r){return e.apply(t,r)}runOutsideAngular(e){return e()}runTask(e,t,r,i){return e.apply(t,r)}}const aE=new j(""),zl=new j("");let ff,df=(()=>{class n{constructor(t,r,i){this._ngZone=t,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,ff||(function UO(n){ff=n}(i),i.addToWindow(r)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ae.assertNotInAngularZone(),lf(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())lf(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,i){let s=-1;r&&r>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==s),t(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:t,timeoutId:s,updateCb:i})}whenStable(t,r,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,r,i){return[]}}return n.\u0275fac=function(t){return new(t||n)(U(Ae),U(hf),U(zl))},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})(),hf=(()=>{class n{constructor(){this._applications=new Map}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return ff?.findTestabilityInTree(this,t,r)??null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const Tr=!1;let $r=null;const lE=new j("AllowMultipleToken"),pf=new j("PlatformDestroyListeners"),cE=new j("appBootstrapListener");class uE{constructor(e,t){this.name=e,this.token=t}}function hE(n,e,t=[]){const r=`Platform: ${e}`,i=new j(r);return(s=[])=>{let o=mf();if(!o||o.injector.get(lE,!1)){const a=[...t,...s,{provide:i,useValue:!0}];n?n(a):function HO(n){if($r&&!$r.get(lE,!1))throw new w(400,!1);$r=n;const e=n.get(pE);(function dE(n){const e=n.get(tE,null);e&&e.forEach(t=>t())})(n)}(function fE(n=[],e){return Yn.create({name:e,providers:[{provide:th,useValue:"platform"},{provide:pf,useValue:new Set([()=>$r=null])},...n]})}(a,r))}return function GO(n){const e=mf();if(!e)throw new w(401,!1);return e}()}}function mf(){return $r?.get(pE)??null}let pE=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const i=function gE(n,e){let t;return t="noop"===n?new BO:("zone.js"===n?void 0:n)||new Ae(e),t}(r?.ngZone,function mE(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(r)),s=[{provide:Ae,useValue:i}];return i.run(()=>{const o=Yn.create({providers:s,parent:this.injector,name:t.moduleType.name}),a=t.create(o),l=a.injector.get(ns,null);if(!l)throw new w(402,!1);return i.runOutsideAngular(()=>{const c=i.onError.subscribe({next:u=>{l.handleError(u)}});a.onDestroy(()=>{Wl(this._modules,a),c.unsubscribe()})}),function yE(n,e,t){try{const r=t();return wo(r)?r.catch(i=>{throw e.runOutsideAngular(()=>n.handleError(i)),i}):r}catch(r){throw e.runOutsideAngular(()=>n.handleError(r)),r}}(l,i,()=>{const c=a.injector.get(Gl);return c.runInitializers(),c.donePromise.then(()=>(function Hb(n){dn(n,"Expected localeId to be defined"),"string"==typeof n&&($b=n.toLowerCase().replace(/_/g,"-"))}(a.injector.get(er,bs)||bs),this._moduleDoBootstrap(a),a))})})}bootstrapModule(t,r=[]){const i=vE({},r);return function VO(n,e,t){const r=new Hh(t);return Promise.resolve(r)}(0,0,t).then(s=>this.bootstrapModuleFactory(s,i))}_moduleDoBootstrap(t){const r=t.injector.get(Uo);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(i=>r.bootstrap(i));else{if(!t.instance.ngDoBootstrap)throw new w(-403,!1);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new w(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const t=this._injector.get(pf,null);t&&(t.forEach(r=>r()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(U(Yn))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function vE(n,e){return Array.isArray(e)?e.reduce(vE,n):{...n,...e}}let Uo=(()=>{class n{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(t,r,i){this._zone=t,this._injector=r,this._exceptionHandler=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new Ze(a=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{a.next(this._stable),a.complete()})}),o=new Ze(a=>{let l;this._zone.runOutsideAngular(()=>{l=this._zone.onStable.subscribe(()=>{Ae.assertNotInAngularZone(),lf(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,a.next(!0))})})});const c=this._zone.onUnstable.subscribe(()=>{Ae.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{a.next(!1)}))});return()=>{l.unsubscribe(),c.unsubscribe()}});this.isStable=function zw(...n){const e=Ys(n),t=function Uw(n,e){return"number"==typeof Gu(n)?n.pop():e}(n,1/0),r=n;return r.length?1===r.length?Jt(r[0]):Oi(t)(rt(r,e)):jn}(s,o.pipe(function Ww(n={}){const{connector:e=(()=>new un),resetOnError:t=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=n;return s=>{let o,a,l,c=0,u=!1,d=!1;const h=()=>{a?.unsubscribe(),a=void 0},f=()=>{h(),o=l=void 0,u=d=!1},p=()=>{const m=o;f(),m?.unsubscribe()};return Xe((m,g)=>{c++,!d&&!u&&h();const v=l=l??e();g.add(()=>{c--,0===c&&!d&&!u&&(a=Ku(p,i))}),v.subscribe(g),!o&&c>0&&(o=new qs({next:_=>v.next(_),error:_=>{d=!0,h(),a=Ku(f,t,_),v.error(_)},complete:()=>{u=!0,h(),a=Ku(f,r),v.complete()}}),Jt(m).subscribe(o))})(s)}}()))}bootstrap(t,r){const i=t instanceof qy;if(!this._injector.get(Gl).done){!i&&function Ni(n){const e=Ce(n)||Dt(n)||Vt(n);return null!==e&&e.standalone}(t);throw new w(405,Tr)}let o;o=i?t:this._injector.get(Do).resolveComponentFactory(t),this.componentTypes.push(o.componentType);const a=function $O(n){return n.isBoundToModule}(o)?void 0:this._injector.get(_s),c=o.create(Yn.NULL,[],r||o.selector,a),u=c.location.nativeElement,d=c.injector.get(aE,null);return d?.registerApplication(u),c.onDestroy(()=>{this.detachView(c.hostView),Wl(this.components,c),d?.unregisterApplication(u)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new w(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;Wl(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const r=this._injector.get(cE,[]);r.push(...this._bootstrapListeners),r.forEach(i=>i(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>Wl(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new w(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(t){return new(t||n)(U(Ae),U(yr),U(ns))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Wl(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}let ql=(()=>{class n{}return n.__NG_ELEMENT_ID__=zO,n})();function zO(n){return function WO(n,e,t){if(io(n)&&!t){const r=$t(n.index,e);return new So(r,r)}return 47&n.type?new So(e[xt],e):null}(yt(),L(),16==(16&n))}class TE{constructor(){}supports(e){return Cl(e)}create(e){return new JO(e)}}const XO=(n,e)=>e;class JO{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||XO}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,r=this._removalsHead,i=0,s=null;for(;t||r;){const o=!r||t&&t.currentIndex<SE(r,i,s)?t:r,a=SE(o,i,s),l=o.currentIndex;if(o===r)i--,r=r._nextRemoved;else if(t=t._next,null==o.previousIndex)i++;else{s||(s=[]);const c=a-i,u=l-i;if(c!=u){for(let h=0;h<c;h++){const f=h<s.length?s[h]:s[h]=0,p=f+h;u<=p&&p<c&&(s[h]=f+1)}s[o.previousIndex]=u-c}}a!==l&&e(o,a,l)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Cl(e))throw new w(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let i,s,o,t=this._itHead,r=!1;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)s=e[a],o=this._trackByFn(a,s),null!==t&&Object.is(t.trackById,o)?(r&&(t=this._verifyReinsertion(t,s,o,a)),Object.is(t.item,s)||this._addIdentityChange(t,s)):(t=this._mismatch(t,s,o,a),r=!0),t=t._next}else i=0,function S1(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[Symbol.iterator]();let r;for(;!(r=t.next()).done;)e(r.value)}}(e,a=>{o=this._trackByFn(i,a),null!==t&&Object.is(t.trackById,o)?(r&&(t=this._verifyReinsertion(t,a,o,i)),Object.is(t.item,a)||this._addIdentityChange(t,a)):(t=this._mismatch(t,a,o,i),r=!0),t=t._next,i++}),this.length=i;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,r,i){let s;return null===e?s=this._itTail:(s=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,i)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,i))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,i)):e=this._addAfter(new eP(t,r),s,i),e}_verifyReinsertion(e,t,r,i){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==s?e=this._reinsertAfter(s,e._prev,i):e.currentIndex!=i&&(e.currentIndex=i,this._addToMoves(e,i)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const i=e._prevRemoved,s=e._nextRemoved;return null===i?this._removalsHead=s:i._nextRemoved=s,null===s?this._removalsTail=i:s._prevRemoved=i,this._insertAfter(e,t,r),this._addToMoves(e,r),e}_moveAfter(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}_addAfter(e,t,r){return this._insertAfter(e,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,r){const i=null===t?this._itHead:t._next;return e._next=i,e._prev=t,null===i?this._itTail=e:i._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new xE),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,r=e._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new xE),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class eP{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class tP{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){const t=e._prevDup,r=e._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class xE{constructor(){this.map=new Map}put(e){const t=e.trackById;let r=this.map.get(t);r||(r=new tP,this.map.set(t,r)),r.add(e)}get(e,t){const i=this.map.get(e);return i?i.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function SE(n,e,t){const r=n.previousIndex;if(null===r)return r;let i=0;return t&&r<t.length&&(i=t[r]),r+e+i}function AE(){return new Zl([new TE])}let Zl=(()=>{class n{constructor(t){this.factories=t}static create(t,r){if(null!=r){const i=r.factories.slice();t=t.concat(i)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||AE()),deps:[[n,new fo,new ho]]}}find(t){const r=this.factories.find(i=>i.supports(t));if(null!=r)return r;throw new w(901,!1)}}return n.\u0275prov=G({token:n,providedIn:"root",factory:AE}),n})();const oP=hE(null,"core",[]);let aP=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(U(Uo))},n.\u0275mod=Lt({type:n}),n.\u0275inj=Et({}),n})(),_f=null;function xr(){return _f}class uP{}const et=new j("DocumentToken");let Ef=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:function(){return function dP(){return U(IE)}()},providedIn:"platform"}),n})();const hP=new j("Location Initialized");let IE=(()=>{class n extends Ef{constructor(t){super(),this._doc=t,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return xr().getBaseHref(this._doc)}onPopState(t){const r=xr().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=xr().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,i){ME()?this._history.pushState(t,r,i):this._location.hash=i}replaceState(t,r,i){ME()?this._history.replaceState(t,r,i):this._location.hash=i}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return n.\u0275fac=function(t){return new(t||n)(U(et))},n.\u0275prov=G({token:n,factory:function(){return function fP(){return new IE(U(et))}()},providedIn:"platform"}),n})();function ME(){return!!window.history.pushState}function Df(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function RE(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function Sr(n){return n&&"?"!==n[0]?"?"+n:n}let yi=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:function(){return de(FE)},providedIn:"root"}),n})();const LE=new j("appBaseHref");let FE=(()=>{class n extends yi{constructor(t,r){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??de(et).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Df(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+Sr(this._platformLocation.search),i=this._platformLocation.hash;return i&&t?`${r}${i}`:r}pushState(t,r,i,s){const o=this.prepareExternalUrl(i+Sr(s));this._platformLocation.pushState(t,r,o)}replaceState(t,r,i,s){const o=this.prepareExternalUrl(i+Sr(s));this._platformLocation.replaceState(t,r,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return n.\u0275fac=function(t){return new(t||n)(U(Ef),U(LE,8))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),pP=(()=>{class n extends yi{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=Df(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,i,s){let o=this.prepareExternalUrl(i+Sr(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.pushState(t,r,o)}replaceState(t,r,i,s){let o=this.prepareExternalUrl(i+Sr(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return n.\u0275fac=function(t){return new(t||n)(U(Ef),U(LE,8))},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})(),Tf=(()=>{class n{constructor(t){this._subject=new Qe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const r=this._locationStrategy.getBaseHref();this._basePath=function yP(n){if(new RegExp("^(https?:)?//").test(n)){const[,t]=n.split(/\/\/[^\/]+/);return t}return n}(RE(kE(r))),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+Sr(r))}normalize(t){return n.stripTrailingSlash(function gP(n,e){if(!n||!e.startsWith(n))return e;const t=e.substring(n.length);return""===t||["/",";","?","#"].includes(t[0])?t:e}(this._basePath,kE(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",i=null){this._locationStrategy.pushState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Sr(r)),i)}replaceState(t,r="",i=null){this._locationStrategy.replaceState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Sr(r)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(i=>i(t,r))}subscribe(t,r,i){return this._subject.subscribe({next:t,error:r,complete:i})}}return n.normalizeQueryParams=Sr,n.joinWithSlash=Df,n.stripTrailingSlash=RE,n.\u0275fac=function(t){return new(t||n)(U(yi))},n.\u0275prov=G({token:n,factory:function(){return function mP(){return new Tf(U(yi))}()},providedIn:"root"}),n})();function kE(n){return n.replace(/\/index.html$/,"")}class rN{constructor(e,t,r,i){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=i}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let zE=(()=>{class n{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,r,i){this._viewContainer=t,this._template=r,this._differs=i,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=this._viewContainer;t.forEachOperation((i,s,o)=>{if(null==i.previousIndex)r.createEmbeddedView(this._template,new rN(i.item,this._ngForOf,-1,-1),null===o?void 0:o);else if(null==o)r.remove(null===s?void 0:s);else if(null!==s){const a=r.get(s);r.move(a,o),WE(a,i)}});for(let i=0,s=r.length;i<s;i++){const a=r.get(i).context;a.index=i,a.count=s,a.ngForOf=this._ngForOf}t.forEachIdentityChange(i=>{WE(r.get(i.currentIndex),i)})}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(R(On),R(Dr),R(Zl))},n.\u0275dir=J({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),n})();function WE(n,e){n.context.$implicit=e.item}let RN=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Lt({type:n}),n.\u0275inj=Et({}),n})();const ZE="browser";let PN=(()=>{class n{}return n.\u0275prov=G({token:n,providedIn:"root",factory:()=>new NN(U(et),window)}),n})();class NN{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function BN(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const r=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let i=r.currentNode;for(;i;){const s=i.shadowRoot;if(s){const o=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(o)return o}i=r.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),r=t.left+this.window.pageXOffset,i=t.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(r-s[0],i-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=XE(this.window.history)||XE(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function XE(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class hB extends uP{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Vf extends hB{static makeCurrent(){!function cP(n){_f||(_f=n)}(new Vf)}onAndCancel(e,t,r){return e.addEventListener(t,r,!1),()=>{e.removeEventListener(t,r,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function fB(){return Go=Go||document.querySelector("base"),Go?Go.getAttribute("href"):null}();return null==t?null:function pB(n){cc=cc||document.createElement("a"),cc.setAttribute("href",n);const e=cc.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Go=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function eN(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const r=t.indexOf("="),[i,s]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===e)return decodeURIComponent(s)}return null}(document.cookie,e)}}let cc,Go=null;const rD=new j("TRANSITION_ID"),gB=[{provide:jl,useFactory:function mB(n,e,t){return()=>{t.get(Gl).donePromise.then(()=>{const r=xr(),i=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<i.length;s++)r.remove(i[s])})}},deps:[rD,et,Yn],multi:!0}];let vB=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})();const uc=new j("EventManagerPlugins");let dc=(()=>{class n{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(i=>{i.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,i){return this._findPluginFor(r).addEventListener(t,r,i)}addGlobalEventListener(t,r,i){return this._findPluginFor(r).addGlobalEventListener(t,r,i)}getZone(){return this._zone}_findPluginFor(t){const r=this._eventNameToPlugin.get(t);if(r)return r;const i=this._plugins;for(let s=0;s<i.length;s++){const o=i[s];if(o.supports(t))return this._eventNameToPlugin.set(t,o),o}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(U(uc),U(Ae))},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})();class iD{constructor(e){this._doc=e}addGlobalEventListener(e,t,r){const i=xr().getGlobalEventTarget(this._doc,e);if(!i)throw new Error(`Unsupported event target ${i} for event ${t}`);return this.addEventListener(i,t,r)}}let sD=(()=>{class n{constructor(){this.usageCount=new Map}addStyles(t){for(const r of t)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(t){for(const r of t)0===this.changeUsageCount(r,-1)&&this.onStyleRemoved(r)}onStyleRemoved(t){}onStyleAdded(t){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(t,r){const i=this.usageCount;let s=i.get(t)??0;return s+=r,s>0?i.set(t,s):i.delete(t),s}ngOnDestroy(){for(const t of this.getAllStyles())this.onStyleRemoved(t);this.usageCount.clear()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})(),Ko=(()=>{class n extends sD{constructor(t){super(),this.doc=t,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(t){for(const r of this.hostNodes)this.addStyleToHost(r,t)}onStyleRemoved(t){const r=this.styleRef;r.get(t)?.forEach(s=>s.remove()),r.delete(t)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const r of this.getAllStyles())this.addStyleToHost(t,r)}removeHost(t){this.hostNodes.delete(t)}addStyleToHost(t,r){const i=this.doc.createElement("style");i.textContent=r,t.appendChild(i);const s=this.styleRef.get(r);s?s.push(i):this.styleRef.set(r,[i])}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}}return n.\u0275fac=function(t){return new(t||n)(U(et))},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})();const $f={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Hf=/%COMP%/g,lD=new j("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function cD(n,e){return e.flat(100).map(t=>t.replace(Hf,n))}function uD(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let hc=(()=>{class n{constructor(t,r,i,s){this.eventManager=t,this.sharedStylesHost=r,this.appId=i,this.removeStylesOnCompDestory=s,this.rendererByCompId=new Map,this.defaultRenderer=new jf(t)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;const i=this.getOrCreateRenderer(t,r);return i instanceof fD?i.applyToHost(t):i instanceof Gf&&i.applyStyles(),i}getOrCreateRenderer(t,r){const i=this.rendererByCompId;let s=i.get(r.id);if(!s){const o=this.eventManager,a=this.sharedStylesHost,l=this.removeStylesOnCompDestory;switch(r.encapsulation){case An.Emulated:s=new fD(o,a,r,this.appId,l);break;case An.ShadowDom:return new SB(o,a,t,r);default:s=new Gf(o,a,r,l)}s.onDestroy=()=>i.delete(r.id),i.set(r.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(U(dc),U(Ko),U(Bo),U(lD))},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})();class jf{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS($f[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){(hD(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(hD(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error(`The selector "${e}" did not match any elements`);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;const s=$f[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){const i=$f[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(Ht.DashCase|Ht.Important)?e.style.setProperty(t,r,i&Ht.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&Ht.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e[t]=r}setValue(e,t){e.nodeValue=t}listen(e,t,r){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,uD(r)):this.eventManager.addEventListener(e,t,uD(r))}}function hD(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class SB extends jf{constructor(e,t,r,i){super(e),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=cD(i.id,i.styles);for(const o of s){const a=document.createElement("style");a.textContent=o,this.shadowRoot.appendChild(a)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Gf extends jf{constructor(e,t,r,i,s=r.id){super(e),this.sharedStylesHost=t,this.removeStylesOnCompDestory=i,this.rendererUsageCount=0,this.styles=cD(s,r.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class fD extends Gf{constructor(e,t,r,i,s){const o=i+"-"+r.id;super(e,t,r,s,o),this.contentAttr=function DB(n){return"_ngcontent-%COMP%".replace(Hf,n)}(o),this.hostAttr=function TB(n){return"_nghost-%COMP%".replace(Hf,n)}(o)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){const r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}}let CB=(()=>{class n extends iD{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,i){return t.addEventListener(r,i,!1),()=>this.removeEventListener(t,r,i)}removeEventListener(t,r,i){return t.removeEventListener(r,i)}}return n.\u0275fac=function(t){return new(t||n)(U(et))},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})();const pD=["alt","control","meta","shift"],AB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},wB={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let IB=(()=>{class n extends iD{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,r,i){const s=n.parseEventName(r),o=n.eventCallback(s.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>xr().onAndCancel(t,s.domEventName,o))}static parseEventName(t){const r=t.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const s=n._normalizeKey(r.pop());let o="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),o="code."),pD.forEach(c=>{const u=r.indexOf(c);u>-1&&(r.splice(u,1),o+=c+".")}),o+=s,0!=r.length||0===s.length)return null;const l={};return l.domEventName=i,l.fullKey=o,l}static matchEventFullKeyCode(t,r){let i=AB[t.key]||t.key,s="";return r.indexOf("code.")>-1&&(i=t.code,s="code."),!(null==i||!i)&&(i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),pD.forEach(o=>{o!==i&&(0,wB[o])(t)&&(s+=o+".")}),s+=i,s===r)}static eventCallback(t,r,i){return s=>{n.matchEventFullKeyCode(s,t)&&i.runGuarded(()=>r(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(U(et))},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})();const FB=hE(oP,"browser",[{provide:af,useValue:ZE},{provide:tE,useValue:function MB(){Vf.makeCurrent()},multi:!0},{provide:et,useFactory:function LB(){return function oR(n){zd=n}(document),document},deps:[]}]),yD=new j(""),vD=[{provide:zl,useClass:class yB{addToWindow(e){Pe.getAngularTestability=(r,i=!0)=>{const s=e.findTestabilityInTree(r,i);if(null==s)throw new Error("Could not find testability for element.");return s},Pe.getAllAngularTestabilities=()=>e.getAllTestabilities(),Pe.getAllAngularRootElements=()=>e.getAllRootElements(),Pe.frameworkStabilizers||(Pe.frameworkStabilizers=[]),Pe.frameworkStabilizers.push(r=>{const i=Pe.getAllAngularTestabilities();let s=i.length,o=!1;const a=function(l){o=o||l,s--,0==s&&r(o)};i.forEach(function(l){l.whenStable(a)})})}findTestabilityInTree(e,t,r){return null==t?null:e.getTestability(t)??(r?xr().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:aE,useClass:df,deps:[Ae,hf,zl]},{provide:df,useClass:df,deps:[Ae,hf,zl]}],bD=[{provide:th,useValue:"root"},{provide:ns,useFactory:function RB(){return new ns},deps:[]},{provide:uc,useClass:CB,multi:!0,deps:[et,Ae,af]},{provide:uc,useClass:IB,multi:!0,deps:[et]},{provide:hc,useClass:hc,deps:[dc,Ko,Bo,lD]},{provide:To,useExisting:hc},{provide:sD,useExisting:Ko},{provide:Ko,useClass:Ko,deps:[et]},{provide:dc,useClass:dc,deps:[uc,Ae]},{provide:class UN{},useClass:vB,deps:[]},[]];let _D=(()=>{class n{constructor(t){}static withServerTransition(t){return{ngModule:n,providers:[{provide:Bo,useValue:t.appId},{provide:rD,useExisting:Bo},gB]}}}return n.\u0275fac=function(t){return new(t||n)(U(yD,12))},n.\u0275mod=Lt({type:n}),n.\u0275inj=Et({providers:[...bD,...vD],imports:[RN,aP]}),n})(),ED=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}}return n.\u0275fac=function(t){return new(t||n)(U(et))},n.\u0275prov=G({token:n,factory:function(t){let r=null;return r=t?new t:function OB(){return new ED(U(et))}(),r},providedIn:"root"}),n})();function W(...n){return rt(n,Ys(n))}typeof window<"u"&&window;class bn extends un{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:r}=this;if(e)throw t;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}}const fc=Ws(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:$B}=Array,{getPrototypeOf:HB,prototype:jB,keys:GB}=Object;const{isArray:zB}=Array;function Wf(...n){const e=Ys(n),t=function Vg(n){return Le(Gu(n))?n.pop():void 0}(n),{args:r,keys:i}=function xD(n){if(1===n.length){const e=n[0];if($B(e))return{args:e,keys:null};if(function KB(n){return n&&"object"==typeof n&&HB(n)===jB}(e)){const t=GB(e);return{args:t.map(r=>e[r]),keys:t}}}return{args:n,keys:null}}(n);if(0===r.length)return rt([],e);const s=new Ze(function qB(n,e,t=kr){return r=>{AD(e,()=>{const{length:i}=n,s=new Array(i);let o=i,a=i;for(let l=0;l<i;l++)AD(e,()=>{const c=rt(n[l],e);let u=!1;c.subscribe(We(r,d=>{s[l]=d,u||(u=!0,a--),a||r.next(t(s.slice()))},()=>{--o||r.complete()}))},r)},r)}}(r,e,i?o=>function CD(n,e){return n.reduce((t,r,i)=>(t[r]=e[i],t),{})}(i,o):kr));return t?s.pipe(function SD(n){return pe(e=>function WB(n,e){return zB(e)?n(...e):n(e)}(n,e))}(t)):s}function AD(n,e,t){n?cr(t,n,e):e()}function pc(...n){return function YB(){return Oi(1)}()(rt(n,Ys(n)))}function wD(n){return new Ze(e=>{Jt(n()).subscribe(e)})}function zo(n,e){const t=Le(n)?n:()=>n,r=i=>i.error(t());return new Ze(e?i=>e.schedule(r,0,i):r)}function qf(){return Xe((n,e)=>{let t=null;n._refCount++;const r=We(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(t=null);const i=n._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}class ID extends Ze{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,Sg(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Xt;const t=this.getSubject();e.add(this.source.subscribe(We(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Xt.EMPTY)}return e}refCount(){return qf()(this)}}function tr(n,e){return Xe((t,r)=>{let i=null,s=0,o=!1;const a=()=>o&&!i&&r.complete();t.subscribe(We(r,l=>{i?.unsubscribe();let c=0;const u=s++;Jt(n(l,u)).subscribe(i=We(r,d=>r.next(e?e(l,d,u,c++):d),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function vi(n){return n<=0?()=>jn:Xe((e,t)=>{let r=0;e.subscribe(We(t,i=>{++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function MD(...n){const e=Ys(n);return Xe((t,r)=>{(e?pc(n,t,e):pc(n,t)).subscribe(r)})}function Ar(n,e){return Xe((t,r)=>{let i=0;t.subscribe(We(r,s=>n.call(e,s,i++)&&r.next(s)))})}function mc(n){return Xe((e,t)=>{let r=!1;e.subscribe(We(t,i=>{r=!0,t.next(i)},()=>{r||t.next(n),t.complete()}))})}function RD(n=QB){return Xe((e,t)=>{let r=!1;e.subscribe(We(t,i=>{r=!0,t.next(i)},()=>r?t.complete():t.error(n())))})}function QB(){return new fc}function jr(n,e){const t=arguments.length>=2;return r=>r.pipe(n?Ar((i,s)=>n(i,s,r)):kr,vi(1),t?mc(e):RD(()=>new fc))}function bi(n,e){return Le(e)?mt(n,e,1):mt(n,1)}function wt(n,e,t){const r=Le(n)||e||t?{next:n,error:e,complete:t}:n;return r?Xe((i,s)=>{var o;null===(o=r.subscribe)||void 0===o||o.call(r);let a=!0;i.subscribe(We(s,l=>{var c;null===(c=r.next)||void 0===c||c.call(r,l),s.next(l)},()=>{var l;a=!1,null===(l=r.complete)||void 0===l||l.call(r),s.complete()},l=>{var c;a=!1,null===(c=r.error)||void 0===c||c.call(r,l),s.error(l)},()=>{var l,c;a&&(null===(l=r.unsubscribe)||void 0===l||l.call(r)),null===(c=r.finalize)||void 0===c||c.call(r)}))}):kr}function Gr(n){return Xe((e,t)=>{let s,r=null,i=!1;r=e.subscribe(We(t,void 0,void 0,o=>{s=Jt(n(o,Gr(n)(e))),r?(r.unsubscribe(),r=null,s.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(t))})}function LD(n,e){return Xe(function ZB(n,e,t,r,i){return(s,o)=>{let a=t,l=e,c=0;s.subscribe(We(o,u=>{const d=c++;l=a?n(l,u,d):(a=!0,u),r&&o.next(l)},i&&(()=>{a&&o.next(l),o.complete()})))}}(n,e,arguments.length>=2,!0))}function Yf(n){return n<=0?()=>jn:Xe((e,t)=>{let r=[];e.subscribe(We(t,i=>{r.push(i),n<r.length&&r.shift()},()=>{for(const i of r)t.next(i);t.complete()},void 0,()=>{r=null}))})}function FD(n,e){const t=arguments.length>=2;return r=>r.pipe(n?Ar((i,s)=>n(i,s,r)):kr,Yf(1),t?mc(e):RD(()=>new fc))}function Qf(n){return Xe((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}const ae="primary",Wo=Symbol("RouteTitle");class e2{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function xs(n){return new e2(n)}function t2(n,e,t){const r=t.path.split("/");if(r.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||r.length<n.length))return null;const i={};for(let s=0;s<r.length;s++){const o=r[s],a=n[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function nr(n,e){const t=n?Object.keys(n):void 0,r=e?Object.keys(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!kD(n[i],e[i]))return!1;return!0}function kD(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}return n===e}function OD(n){return Array.prototype.concat.apply([],n)}function PD(n){return n.length>0?n[n.length-1]:null}function bt(n,e){for(const t in n)n.hasOwnProperty(t)&&e(n[t],t)}function Kr(n){return Mh(n)?n:wo(n)?rt(Promise.resolve(n)):W(n)}const gc=!1,r2={exact:function UD(n,e,t){if(!_i(n.segments,e.segments)||!yc(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const r in e.children)if(!n.children[r]||!UD(n.children[r],e.children[r],t))return!1;return!0},subset:VD},ND={exact:function s2(n,e){return nr(n,e)},subset:function o2(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>kD(n[t],e[t]))},ignored:()=>!0};function BD(n,e,t){return r2[t.paths](n.root,e.root,t.matrixParams)&&ND[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function VD(n,e,t){return $D(n,e,e.segments,t)}function $D(n,e,t,r){if(n.segments.length>t.length){const i=n.segments.slice(0,t.length);return!(!_i(i,t)||e.hasChildren()||!yc(i,t,r))}if(n.segments.length===t.length){if(!_i(n.segments,t)||!yc(n.segments,t,r))return!1;for(const i in e.children)if(!n.children[i]||!VD(n.children[i],e.children[i],r))return!1;return!0}{const i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!!(_i(n.segments,i)&&yc(n.segments,i,r)&&n.children[ae])&&$D(n.children[ae],e,s,r)}}function yc(n,e,t){return e.every((r,i)=>ND[t](n[i].parameters,r.parameters))}class zr{constructor(e=new fe([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=xs(this.queryParams)),this._queryParamMap}toString(){return c2.serialize(this)}}class fe{constructor(e,t){this.segments=e,this.children=t,this.parent=null,bt(t,(r,i)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return vc(this)}}class qo{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=xs(this.parameters)),this._parameterMap}toString(){return GD(this)}}function _i(n,e){return n.length===e.length&&n.every((t,r)=>t.path===e[r].path)}let Yo=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:function(){return new Zf},providedIn:"root"}),n})();class Zf{parse(e){const t=new v2(e);return new zr(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${Qo(e.root,!0)}`,r=function h2(n){const e=Object.keys(n).map(t=>{const r=n[t];return Array.isArray(r)?r.map(i=>`${bc(t)}=${bc(i)}`).join("&"):`${bc(t)}=${bc(r)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${r}${"string"==typeof e.fragment?`#${function u2(n){return encodeURI(n)}(e.fragment)}`:""}`}}const c2=new Zf;function vc(n){return n.segments.map(e=>GD(e)).join("/")}function Qo(n,e){if(!n.hasChildren())return vc(n);if(e){const t=n.children[ae]?Qo(n.children[ae],!1):"",r=[];return bt(n.children,(i,s)=>{s!==ae&&r.push(`${s}:${Qo(i,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function l2(n,e){let t=[];return bt(n.children,(r,i)=>{i===ae&&(t=t.concat(e(r,i)))}),bt(n.children,(r,i)=>{i!==ae&&(t=t.concat(e(r,i)))}),t}(n,(r,i)=>i===ae?[Qo(n.children[ae],!1)]:[`${i}:${Qo(r,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[ae]?`${vc(n)}/${t[0]}`:`${vc(n)}/(${t.join("//")})`}}function HD(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function bc(n){return HD(n).replace(/%3B/gi,";")}function Xf(n){return HD(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function _c(n){return decodeURIComponent(n)}function jD(n){return _c(n.replace(/\+/g,"%20"))}function GD(n){return`${Xf(n.path)}${function d2(n){return Object.keys(n).map(e=>`;${Xf(e)}=${Xf(n[e])}`).join("")}(n.parameters)}`}const f2=/^[^\/()?;=#]+/;function Ec(n){const e=n.match(f2);return e?e[0]:""}const p2=/^[^=?&#]+/,g2=/^[^&#]+/;class v2{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new fe([],{}):new fe([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[ae]=new fe(e,t)),r}parseSegment(){const e=Ec(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new w(4009,gc);return this.capture(e),new qo(_c(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=Ec(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const i=Ec(this.remaining);i&&(r=i,this.capture(r))}e[_c(t)]=_c(r)}parseQueryParam(e){const t=function m2(n){const e=n.match(p2);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const o=function y2(n){const e=n.match(g2);return e?e[0]:""}(this.remaining);o&&(r=o,this.capture(r))}const i=jD(t),s=jD(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Ec(this.remaining),i=this.remaining[r.length];if("/"!==i&&")"!==i&&";"!==i)throw new w(4010,gc);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=ae);const o=this.parseChildren();t[s]=1===Object.keys(o).length?o[ae]:new fe([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new w(4011,gc)}}function Jf(n){return n.segments.length>0?new fe([],{[ae]:n}):n}function Dc(n){const e={};for(const r of Object.keys(n.children)){const s=Dc(n.children[r]);(s.segments.length>0||s.hasChildren())&&(e[r]=s)}return function b2(n){if(1===n.numberOfChildren&&n.children[ae]){const e=n.children[ae];return new fe(n.segments.concat(e.segments),e.children)}return n}(new fe(n.segments,e))}function Ei(n){return n instanceof zr}const ep=!1;function _2(n,e,t,r,i){if(0===t.length)return Ss(e.root,e.root,e.root,r,i);const s=function YD(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new qD(!0,0,n);let e=0,t=!1;const r=n.reduce((i,s,o)=>{if("object"==typeof s&&null!=s){if(s.outlets){const a={};return bt(s.outlets,(l,c)=>{a[c]="string"==typeof l?l.split("/"):l}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return"string"!=typeof s?[...i,s]:0===o?(s.split("/").forEach((a,l)=>{0==l&&"."===a||(0==l&&""===a?t=!0:".."===a?e++:""!=a&&i.push(a))}),i):[...i,s]},[]);return new qD(t,e,r)}(t);return s.toRoot()?Ss(e.root,e.root,new fe([],{}),r,i):function o(l){const c=function D2(n,e,t,r){if(n.isAbsolute)return new Cs(e.root,!0,0);if(-1===r)return new Cs(t,t===e.root,0);return function QD(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new w(4005,ep&&"Invalid number of '../'");i=r.segments.length}return new Cs(r,!1,i-s)}(t,r+(Zo(n.commands[0])?0:1),n.numberOfDoubleDots)}(s,e,n.snapshot?._urlSegment,l),u=c.processChildren?As(c.segmentGroup,c.index,s.commands):tp(c.segmentGroup,c.index,s.commands);return Ss(e.root,c.segmentGroup,u,r,i)}(n.snapshot?._lastPathIndex)}function Zo(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function Xo(n){return"object"==typeof n&&null!=n&&n.outlets}function Ss(n,e,t,r,i){let o,s={};r&&bt(r,(l,c)=>{s[c]=Array.isArray(l)?l.map(u=>`${u}`):`${l}`}),o=n===e?t:WD(n,e,t);const a=Jf(Dc(o));return new zr(a,s,i)}function WD(n,e,t){const r={};return bt(n.children,(i,s)=>{r[s]=i===e?t:WD(i,e,t)}),new fe(n.segments,r)}class qD{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Zo(r[0]))throw new w(4003,ep&&"Root segment cannot have matrix parameters");const i=r.find(Xo);if(i&&i!==PD(r))throw new w(4004,ep&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Cs{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}}function tp(n,e,t){if(n||(n=new fe([],{})),0===n.segments.length&&n.hasChildren())return As(n,e,t);const r=function x2(n,e,t){let r=0,i=e;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;const o=n.segments[i],a=t[r];if(Xo(a))break;const l=`${a}`,c=r<t.length-1?t[r+1]:null;if(i>0&&void 0===l)break;if(l&&c&&"object"==typeof c&&void 0===c.outlets){if(!XD(l,c,o))return s;r+=2}else{if(!XD(l,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){const s=new fe(n.segments.slice(0,r.pathIndex),{});return s.children[ae]=new fe(n.segments.slice(r.pathIndex),n.children),As(s,0,i)}return r.match&&0===i.length?new fe(n.segments,{}):r.match&&!n.hasChildren()?np(n,e,t):r.match?As(n,0,i):np(n,e,t)}function As(n,e,t){if(0===t.length)return new fe(n.segments,{});{const r=function T2(n){return Xo(n[0])?n[0].outlets:{[ae]:n}}(t),i={};if(!r[ae]&&n.children[ae]&&1===n.numberOfChildren&&0===n.children[ae].segments.length){const s=As(n.children[ae],e,t);return new fe(n.segments,s.children)}return bt(r,(s,o)=>{"string"==typeof s&&(s=[s]),null!==s&&(i[o]=tp(n.children[o],e,s))}),bt(n.children,(s,o)=>{void 0===r[o]&&(i[o]=s)}),new fe(n.segments,i)}}function np(n,e,t){const r=n.segments.slice(0,e);let i=0;for(;i<t.length;){const s=t[i];if(Xo(s)){const l=S2(s.outlets);return new fe(r,l)}if(0===i&&Zo(t[0])){r.push(new qo(n.segments[e].path,ZD(t[0]))),i++;continue}const o=Xo(s)?s.outlets[ae]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&Zo(a)?(r.push(new qo(o,ZD(a))),i+=2):(r.push(new qo(o,{})),i++)}return new fe(r,{})}function S2(n){const e={};return bt(n,(t,r)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[r]=np(new fe([],{}),0,t))}),e}function ZD(n){const e={};return bt(n,(t,r)=>e[r]=`${t}`),e}function XD(n,e,t){return n==t.path&&nr(e,t.parameters)}const Jo="imperative";class rr{constructor(e,t){this.id=e,this.url=t}}class rp extends rr{constructor(e,t,r="imperative",i=null){super(e,t),this.type=0,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Di extends rr{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Tc extends rr{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class xc extends rr{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=16}}class ip extends rr{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class C2 extends rr{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class A2 extends rr{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class w2 extends rr{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class I2 extends rr{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class M2 extends rr{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class R2{constructor(e){this.route=e,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class L2{constructor(e){this.route=e,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class F2{constructor(e){this.snapshot=e,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class k2{constructor(e){this.snapshot=e,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class O2{constructor(e){this.snapshot=e,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class P2{constructor(e){this.snapshot=e,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class JD{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let U2=(()=>{class n{createUrlTree(t,r,i,s,o,a){return _2(t||r.root,i,s,o,a)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})(),$2=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:function(e){return U2.\u0275fac(e)},providedIn:"root"}),n})();class eT{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=sp(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){const t=sp(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=op(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return op(e,this._root).map(t=>t.value)}}function sp(n,e){if(n===e.value)return e;for(const t of e.children){const r=sp(n,t);if(r)return r}return null}function op(n,e){if(n===e.value)return[e];for(const t of e.children){const r=op(n,t);if(r.length)return r.unshift(e),r}return[]}class wr{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function ws(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class tT extends eT{constructor(e,t){super(e),this.snapshot=t,ap(this,e)}toString(){return this.snapshot.toString()}}function nT(n,e){const t=function H2(n,e){const o=new Sc([],{},{},"",{},ae,e,null,n.root,-1,{});return new iT("",new wr(o,[]))}(n,e),r=new bn([new qo("",{})]),i=new bn({}),s=new bn({}),o=new bn({}),a=new bn(""),l=new Ti(r,i,o,a,s,ae,e,t.root);return l.snapshot=t.root,new tT(new wr(l,[]),t)}class Ti{constructor(e,t,r,i,s,o,a,l){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.title=this.data?.pipe(pe(c=>c[Wo]))??W(void 0),this._futureSnapshot=l}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(pe(e=>xs(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(pe(e=>xs(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function rT(n,e="emptyOnly"){const t=n.pathFromRoot;let r=0;if("always"!==e)for(r=t.length-1;r>=1;){const i=t[r],s=t[r-1];if(i.routeConfig&&""===i.routeConfig.path)r--;else{if(s.component)break;r--}}return function j2(n){return n.reduce((e,t)=>({params:{...e.params,...t.params},data:{...e.data,...t.data},resolve:{...t.data,...e.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(r))}class Sc{get title(){return this.data?.[Wo]}constructor(e,t,r,i,s,o,a,l,c,u,d){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=l,this._urlSegment=c,this._lastPathIndex=u,this._resolve=d}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=xs(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=xs(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class iT extends eT{constructor(e,t){super(t),this.url=e,ap(this,t)}toString(){return sT(this._root)}}function ap(n,e){e.value._routerState=n,e.children.forEach(t=>ap(n,t))}function sT(n){const e=n.children.length>0?` { ${n.children.map(sT).join(", ")} } `:"";return`${n.value}${e}`}function lp(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,nr(e.queryParams,t.queryParams)||n.queryParams.next(t.queryParams),e.fragment!==t.fragment&&n.fragment.next(t.fragment),nr(e.params,t.params)||n.params.next(t.params),function n2(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!nr(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.url.next(t.url),nr(e.data,t.data)||n.data.next(t.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function cp(n,e){const t=nr(n.params,e.params)&&function a2(n,e){return _i(n,e)&&n.every((t,r)=>nr(t.parameters,e[r].parameters))}(n.url,e.url);return t&&!(!n.parent!=!e.parent)&&(!n.parent||cp(n.parent,e.parent))}function ea(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=e.value;const i=function K2(n,e,t){return e.children.map(r=>{for(const i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return ea(n,r,i);return ea(n,r)})}(n,e,t);return new wr(r,i)}{if(n.shouldAttach(e.value)){const s=n.retrieve(e.value);if(null!==s){const o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>ea(n,a)),o}}const r=function z2(n){return new Ti(new bn(n.url),new bn(n.params),new bn(n.queryParams),new bn(n.fragment),new bn(n.data),n.outlet,n.component,n)}(e.value),i=e.children.map(s=>ea(n,s));return new wr(r,i)}}const up="ngNavigationCancelingError";function oT(n,e){const{redirectTo:t,navigationBehaviorOptions:r}=Ei(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=aT(!1,0,e);return i.url=t,i.navigationBehaviorOptions=r,i}function aT(n,e,t){const r=new Error("NavigationCancelingError: "+(n||""));return r[up]=!0,r.cancellationCode=e,t&&(r.url=t),r}function lT(n){return cT(n)&&Ei(n.url)}function cT(n){return n&&n[up]}class W2{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new ta,this.attachRef=null}}let ta=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(t,r){const i=this.getOrCreateContext(t);i.outlet=r,this.contexts.set(t,i)}onChildOutletDestroyed(t){const r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new W2,this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Cc=!1;let dp=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=ae,this.activateEvents=new Qe,this.deactivateEvents=new Qe,this.attachEvents=new Qe,this.detachEvents=new Qe,this.parentContexts=de(ta),this.location=de(On),this.changeDetector=de(ql),this.environmentInjector=de(yr)}ngOnChanges(t){if(t.name){const{firstChange:r,previousValue:i}=t.name;if(r)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new w(4012,Cc);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new w(4012,Cc);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new w(4012,Cc);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new w(4013,Cc);this._activatedRoute=t;const i=this.location,o=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new q2(t,a,i.injector);if(r&&function Y2(n){return!!n.resolveComponentFactory}(r)){const c=r.resolveComponentFactory(o);this.activated=i.createComponent(c,i.length,l)}else this.activated=i.createComponent(o,{index:i.length,injector:l,environmentInjector:r??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=J({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[fn]}),n})();class q2{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===Ti?this.route:e===ta?this.childContexts:this.parent.get(e,t)}}let hp=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=eo({type:n,selectors:[["ng-component"]],standalone:!0,features:[m_],decls:1,vars:0,template:function(t,r){1&t&&fi(0,"router-outlet")},dependencies:[dp],encapsulation:2}),n})();function uT(n,e){return n.providers&&!n._injector&&(n._injector=Nl(n.providers,e,`Route: ${n.path}`)),n._injector??e}function pp(n){const e=n.children&&n.children.map(pp),t=e?{...n,children:e}:{...n};return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==ae&&(t.component=hp),t}function _n(n){return n.outlet||ae}function dT(n,e){const t=n.filter(r=>_n(r)===e);return t.push(...n.filter(r=>_n(r)!==e)),t}function na(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class eU{constructor(e,t,r,i){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i}activate(e){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),lp(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){const i=ws(t);e.children.forEach(s=>{const o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),bt(i,(s,o)=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){const i=e.value,s=t?t.value:null;if(i===s)if(i.component){const o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=ws(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],i);if(r&&r.outlet){const o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){const r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=ws(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(e,t,r){const i=ws(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new P2(s.value.snapshot))}),e.children.length&&this.forwardEvent(new k2(e.value.snapshot))}activateRoutes(e,t,r){const i=e.value,s=t?t.value:null;if(lp(i),i===s)if(i.component){const o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){const o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),lp(a.route.value),this.activateChildRoutes(e,null,o.children)}else{const a=na(i.snapshot),l=a?.get(Do)??null;o.attachRef=null,o.route=i,o.resolver=l,o.injector=a,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}}class hT{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Ac{constructor(e,t){this.component=e,this.route=t}}function tU(n,e,t){const r=n._root;return ra(r,e?e._root:null,t,[r.value])}function Is(n,e){const t=Symbol(),r=e.get(n,t);return r===t?"function"!=typeof n||function eI(n){return null!==Oa(n)}(n)?e.get(n):n:r}function ra(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=ws(e);return n.children.forEach(o=>{(function rU(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const l=function iU(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!_i(n.url,e.url);case"pathParamsOrQueryParamsChange":return!_i(n.url,e.url)||!nr(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!cp(n,e)||!nr(n.queryParams,e.queryParams);default:return!cp(n,e)}}(o,s,s.routeConfig.runGuardsAndResolvers);l?i.canActivateChecks.push(new hT(r)):(s.data=o.data,s._resolvedData=o._resolvedData),ra(n,e,s.component?a?a.children:null:t,r,i),l&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new Ac(a.outlet.component,o))}else o&&ia(e,a,i),i.canActivateChecks.push(new hT(r)),ra(n,null,s.component?a?a.children:null:t,r,i)})(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),bt(s,(o,a)=>ia(o,t.getContext(a),i)),i}function ia(n,e,t){const r=ws(n),i=n.value;bt(r,(s,o)=>{ia(s,i.component?e?e.children.getContext(o):null:e,t)}),t.canDeactivateChecks.push(new Ac(i.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,i))}function sa(n){return"function"==typeof n}function mp(n){return n instanceof fc||"EmptyError"===n?.name}const wc=Symbol("INITIAL_VALUE");function Ms(){return tr(n=>Wf(n.map(e=>e.pipe(vi(1),MD(wc)))).pipe(pe(e=>{for(const t of e)if(!0!==t){if(t===wc)return wc;if(!1===t||t instanceof zr)return t}return!0}),Ar(e=>e!==wc),vi(1)))}function fT(n){return function rw(...n){return Dg(n)}(wt(e=>{if(Ei(e))throw oT(0,e)}),pe(e=>!0===e))}const gp={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function pT(n,e,t,r,i){const s=yp(n,e,t);return s.matched?function EU(n,e,t,r){const i=e.canMatch;return i&&0!==i.length?W(i.map(o=>{const a=Is(o,n);return Kr(function uU(n){return n&&sa(n.canMatch)}(a)?a.canMatch(e,t):n.runInContext(()=>a(e,t)))})).pipe(Ms(),fT()):W(!0)}(r=uT(e,r),e,t).pipe(pe(o=>!0===o?s:{...gp})):W(s)}function yp(n,e,t){if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?{...gp}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const i=(e.matcher||t2)(t,n,e);if(!i)return{...gp};const s={};bt(i.posParams,(a,l)=>{s[l]=a.path});const o=i.consumed.length>0?{...s,...i.consumed[i.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function Ic(n,e,t,r){if(t.length>0&&function xU(n,e,t){return t.some(r=>Mc(n,e,r)&&_n(r)!==ae)}(n,t,r)){const s=new fe(e,function TU(n,e,t,r){const i={};i[ae]=r,r._sourceSegment=n,r._segmentIndexShift=e.length;for(const s of t)if(""===s.path&&_n(s)!==ae){const o=new fe([],{});o._sourceSegment=n,o._segmentIndexShift=e.length,i[_n(s)]=o}return i}(n,e,r,new fe(t,n.children)));return s._sourceSegment=n,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:[]}}if(0===t.length&&function SU(n,e,t){return t.some(r=>Mc(n,e,r))}(n,t,r)){const s=new fe(n.segments,function DU(n,e,t,r,i){const s={};for(const o of r)if(Mc(n,t,o)&&!i[_n(o)]){const a=new fe([],{});a._sourceSegment=n,a._segmentIndexShift=e.length,s[_n(o)]=a}return{...i,...s}}(n,e,t,r,n.children));return s._sourceSegment=n,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:t}}const i=new fe(n.segments,n.children);return i._sourceSegment=n,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:t}}function Mc(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function mT(n,e,t,r){return!!(_n(n)===r||r!==ae&&Mc(e,t,n))&&("**"===n.path||yp(e,n,t).matched)}function gT(n,e,t){return 0===e.length&&!n.children[t]}const Rc=!1;class Lc{constructor(e){this.segmentGroup=e||null}}class yT{constructor(e){this.urlTree=e}}function oa(n){return zo(new Lc(n))}function vT(n){return zo(new yT(n))}class IU{constructor(e,t,r,i,s){this.injector=e,this.configLoader=t,this.urlSerializer=r,this.urlTree=i,this.config=s,this.allowRedirects=!0}apply(){const e=Ic(this.urlTree.root,[],[],this.config).segmentGroup,t=new fe(e.segments,e.children);return this.expandSegmentGroup(this.injector,this.config,t,ae).pipe(pe(s=>this.createUrlTree(Dc(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Gr(s=>{if(s instanceof yT)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof Lc?this.noMatchError(s):s}))}match(e){return this.expandSegmentGroup(this.injector,this.config,e.root,ae).pipe(pe(i=>this.createUrlTree(Dc(i),e.queryParams,e.fragment))).pipe(Gr(i=>{throw i instanceof Lc?this.noMatchError(i):i}))}noMatchError(e){return new w(4002,Rc)}createUrlTree(e,t,r){const i=Jf(e);return new zr(i,t,r)}expandSegmentGroup(e,t,r,i){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(e,t,r).pipe(pe(s=>new fe([],s))):this.expandSegment(e,r,t,r.segments,i,!0)}expandChildren(e,t,r){const i=[];for(const s of Object.keys(r.children))"primary"===s?i.unshift(s):i.push(s);return rt(i).pipe(bi(s=>{const o=r.children[s],a=dT(t,s);return this.expandSegmentGroup(e,a,o,s).pipe(pe(l=>({segment:l,outlet:s})))}),LD((s,o)=>(s[o.outlet]=o.segment,s),{}),FD())}expandSegment(e,t,r,i,s,o){return rt(r).pipe(bi(a=>this.expandSegmentAgainstRoute(e,t,r,a,i,s,o).pipe(Gr(c=>{if(c instanceof Lc)return W(null);throw c}))),jr(a=>!!a),Gr((a,l)=>{if(mp(a))return gT(t,i,s)?W(new fe([],{})):oa(t);throw a}))}expandSegmentAgainstRoute(e,t,r,i,s,o,a){return mT(i,t,s,o)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(e,t,i,s,o):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o):oa(t):oa(t)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,r,i,o):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,r,i){const s=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?vT(s):this.lineralizeSegments(r,s).pipe(mt(o=>{const a=new fe(o,{});return this.expandSegment(e,a,t,o,i,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){const{matched:a,consumedSegments:l,remainingSegments:c,positionalParamSegments:u}=yp(t,i,s);if(!a)return oa(t);const d=this.applyRedirectCommands(l,i.redirectTo,u);return i.redirectTo.startsWith("/")?vT(d):this.lineralizeSegments(i,d).pipe(mt(h=>this.expandSegment(e,t,r,h.concat(c),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){return"**"===r.path?(e=uT(r,e),r.loadChildren?(r._loadedRoutes?W({routes:r._loadedRoutes,injector:r._loadedInjector}):this.configLoader.loadChildren(e,r)).pipe(pe(a=>(r._loadedRoutes=a.routes,r._loadedInjector=a.injector,new fe(i,{})))):W(new fe(i,{}))):pT(t,r,i,e).pipe(tr(({matched:o,consumedSegments:a,remainingSegments:l})=>o?this.getChildConfig(e=r._injector??e,r,i).pipe(mt(u=>{const d=u.injector??e,h=u.routes,{segmentGroup:f,slicedSegments:p}=Ic(t,a,l,h),m=new fe(f.segments,f.children);if(0===p.length&&m.hasChildren())return this.expandChildren(d,h,m).pipe(pe(b=>new fe(a,b)));if(0===h.length&&0===p.length)return W(new fe(a,{}));const g=_n(r)===s;return this.expandSegment(d,m,h,p,g?ae:s,!0).pipe(pe(_=>new fe(a.concat(_.segments),_.children)))})):oa(t)))}getChildConfig(e,t,r){return t.children?W({routes:t.children,injector:e}):t.loadChildren?void 0!==t._loadedRoutes?W({routes:t._loadedRoutes,injector:t._loadedInjector}):function _U(n,e,t,r){const i=e.canLoad;return void 0===i||0===i.length?W(!0):W(i.map(o=>{const a=Is(o,n);return Kr(function oU(n){return n&&sa(n.canLoad)}(a)?a.canLoad(e,t):n.runInContext(()=>a(e,t)))})).pipe(Ms(),fT())}(e,t,r).pipe(mt(i=>i?this.configLoader.loadChildren(e,t).pipe(wt(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):function AU(n){return zo(aT(Rc,3))}())):W({routes:[],injector:e})}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),0===i.numberOfChildren)return W(r);if(i.numberOfChildren>1||!i.children[ae])return e.redirectTo,zo(new w(4e3,Rc));i=i.children[ae]}}applyRedirectCommands(e,t,r){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r)}applyRedirectCreateUrlTree(e,t,r,i){const s=this.createSegmentGroup(e,t.root,r,i);return new zr(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const r={};return bt(e,(i,s)=>{if("string"==typeof i&&i.startsWith(":")){const a=i.substring(1);r[s]=t[a]}else r[s]=i}),r}createSegmentGroup(e,t,r,i){const s=this.createSegments(e,t.segments,r,i);let o={};return bt(t.children,(a,l)=>{o[l]=this.createSegmentGroup(e,a,r,i)}),new fe(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){const i=r[t.path.substring(1)];if(!i)throw new w(4001,Rc);return i}findOrReturn(e,t){let r=0;for(const i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}}class RU{}class kU{constructor(e,t,r,i,s,o,a){this.injector=e,this.rootComponentType=t,this.config=r,this.urlTree=i,this.url=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a}recognize(){const e=Ic(this.urlTree.root,[],[],this.config.filter(t=>void 0===t.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,e,ae).pipe(pe(t=>{if(null===t)return null;const r=new Sc([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},ae,this.rootComponentType,null,this.urlTree.root,-1,{}),i=new wr(r,t),s=new iT(this.url,i);return this.inheritParamsAndData(s._root),s}))}inheritParamsAndData(e){const t=e.value,r=rT(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),e.children.forEach(i=>this.inheritParamsAndData(i))}processSegmentGroup(e,t,r,i){return 0===r.segments.length&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i)}processChildren(e,t,r){return rt(Object.keys(r.children)).pipe(bi(i=>{const s=r.children[i],o=dT(t,i);return this.processSegmentGroup(e,o,s,i)}),LD((i,s)=>i&&s?(i.push(...s),i):null),function XB(n,e=!1){return Xe((t,r)=>{let i=0;t.subscribe(We(r,s=>{const o=n(s,i++);(o||e)&&r.next(s),!o&&r.complete()}))})}(i=>null!==i),mc(null),FD(),pe(i=>{if(null===i)return null;const s=_T(i);return function OU(n){n.sort((e,t)=>e.value.outlet===ae?-1:t.value.outlet===ae?1:e.value.outlet.localeCompare(t.value.outlet))}(s),s}))}processSegment(e,t,r,i,s){return rt(t).pipe(bi(o=>this.processSegmentAgainstRoute(o._injector??e,o,r,i,s)),jr(o=>!!o),Gr(o=>{if(mp(o))return gT(r,i,s)?W([]):W(null);throw o}))}processSegmentAgainstRoute(e,t,r,i,s){if(t.redirectTo||!mT(t,r,i,s))return W(null);let o;if("**"===t.path){const a=i.length>0?PD(i).parameters:{},l=DT(r)+i.length;o=W({snapshot:new Sc(i,a,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,TT(t),_n(t),t.component??t._loadedComponent??null,t,ET(r),l,xT(t)),consumedSegments:[],remainingSegments:[]})}else o=pT(r,t,i,e).pipe(pe(({matched:a,consumedSegments:l,remainingSegments:c,parameters:u})=>{if(!a)return null;const d=DT(r)+l.length;return{snapshot:new Sc(l,u,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,TT(t),_n(t),t.component??t._loadedComponent??null,t,ET(r),d,xT(t)),consumedSegments:l,remainingSegments:c}}));return o.pipe(tr(a=>{if(null===a)return W(null);const{snapshot:l,consumedSegments:c,remainingSegments:u}=a;e=t._injector??e;const d=t._loadedInjector??e,h=function PU(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(t),{segmentGroup:f,slicedSegments:p}=Ic(r,c,u,h.filter(g=>void 0===g.redirectTo));if(0===p.length&&f.hasChildren())return this.processChildren(d,h,f).pipe(pe(g=>null===g?null:[new wr(l,g)]));if(0===h.length&&0===p.length)return W([new wr(l,[])]);const m=_n(t)===s;return this.processSegment(d,h,f,p,m?ae:s).pipe(pe(g=>null===g?null:[new wr(l,g)]))}))}}function NU(n){const e=n.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function _T(n){const e=[],t=new Set;for(const r of n){if(!NU(r)){e.push(r);continue}const i=e.find(s=>r.value.routeConfig===s.value.routeConfig);void 0!==i?(i.children.push(...r.children),t.add(i)):e.push(r)}for(const r of t){const i=_T(r.children);e.push(new wr(r.value,i))}return e.filter(r=>!t.has(r))}function ET(n){let e=n;for(;e._sourceSegment;)e=e._sourceSegment;return e}function DT(n){let e=n,t=e._segmentIndexShift??0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift??0;return t-1}function TT(n){return n.data||{}}function xT(n){return n.resolve||{}}function ST(n){return"string"==typeof n.title||null===n.title}function vp(n){return tr(e=>{const t=n(e);return t?rt(t).pipe(pe(()=>e)):W(e)})}const Rs=new j("ROUTES");let bp=(()=>{class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=de(nE)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return W(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const r=Kr(t.loadComponent()).pipe(pe(AT),wt(s=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=s}),Qf(()=>{this.componentLoaders.delete(t)})),i=new ID(r,()=>new un).pipe(qf());return this.componentLoaders.set(t,i),i}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return W({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const s=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(pe(a=>{this.onLoadEndListener&&this.onLoadEndListener(r);let l,c,u=!1;Array.isArray(a)?c=a:(l=a.create(t).injector,c=OD(l.get(Rs,[],Q.Self|Q.Optional)));return{routes:c.map(pp),injector:l}}),Qf(()=>{this.childrenLoaders.delete(r)})),o=new ID(s,()=>new un).pipe(qf());return this.childrenLoaders.set(r,o),o}loadModuleFactoryOrRoutes(t){return Kr(t()).pipe(pe(AT),mt(r=>r instanceof f_||Array.isArray(r)?W(r):rt(this.compiler.compileModuleAsync(r))))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function AT(n){return function KU(n){return n&&"object"==typeof n&&"default"in n}(n)?n.default:n}let kc=(()=>{class n{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new un,this.configLoader=de(bp),this.environmentInjector=de(yr),this.urlSerializer=de(Yo),this.rootContexts=de(ta),this.navigationId=0,this.afterPreactivation=()=>W(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=i=>this.events.next(new L2(i)),this.configLoader.onLoadStartListener=i=>this.events.next(new R2(i))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:r})}setupNavigations(t){return this.transitions=new bn({id:0,targetPageId:0,currentUrlTree:t.currentUrlTree,currentRawUrl:t.currentUrlTree,extractedUrl:t.urlHandlingStrategy.extract(t.currentUrlTree),urlAfterRedirects:t.urlHandlingStrategy.extract(t.currentUrlTree),rawUrl:t.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Jo,restoredState:null,currentSnapshot:t.routerState.snapshot,targetSnapshot:null,currentRouterState:t.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ar(r=>0!==r.id),pe(r=>({...r,extractedUrl:t.urlHandlingStrategy.extract(r.rawUrl)})),tr(r=>{let i=!1,s=!1;return W(r).pipe(wt(o=>{this.currentNavigation={id:o.id,initialUrl:o.rawUrl,extractedUrl:o.extractedUrl,trigger:o.source,extras:o.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),tr(o=>{const a=t.browserUrlTree.toString(),l=!t.navigated||o.extractedUrl.toString()!==a||a!==t.currentUrlTree.toString();if(!l&&"reload"!==(o.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const u="";return this.events.next(new xc(o.id,t.serializeUrl(r.rawUrl),u,0)),t.rawUrlTree=o.rawUrl,o.resolve(null),jn}if(t.urlHandlingStrategy.shouldProcessUrl(o.rawUrl))return wT(o.source)&&(t.browserUrlTree=o.extractedUrl),W(o).pipe(tr(u=>{const d=this.transitions?.getValue();return this.events.next(new rp(u.id,this.urlSerializer.serialize(u.extractedUrl),u.source,u.restoredState)),d!==this.transitions?.getValue()?jn:Promise.resolve(u)}),function MU(n,e,t,r){return tr(i=>function wU(n,e,t,r,i){return new IU(n,e,t,r,i).apply()}(n,e,t,i.extractedUrl,r).pipe(pe(s=>({...i,urlAfterRedirects:s}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,t.config),wt(u=>{this.currentNavigation={...this.currentNavigation,finalUrl:u.urlAfterRedirects},r.urlAfterRedirects=u.urlAfterRedirects}),function UU(n,e,t,r,i){return mt(s=>function FU(n,e,t,r,i,s,o="emptyOnly"){return new kU(n,e,t,r,i,o,s).recognize().pipe(tr(a=>null===a?function LU(n){return new Ze(e=>e.error(n))}(new RU):W(a)))}(n,e,t,s.urlAfterRedirects,r.serialize(s.urlAfterRedirects),r,i).pipe(pe(o=>({...s,targetSnapshot:o}))))}(this.environmentInjector,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),wt(u=>{if(r.targetSnapshot=u.targetSnapshot,"eager"===t.urlUpdateStrategy){if(!u.extras.skipLocationChange){const h=t.urlHandlingStrategy.merge(u.urlAfterRedirects,u.rawUrl);t.setBrowserUrl(h,u)}t.browserUrlTree=u.urlAfterRedirects}const d=new C2(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(d)}));if(l&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){const{id:u,extractedUrl:d,source:h,restoredState:f,extras:p}=o,m=new rp(u,this.urlSerializer.serialize(d),h,f);this.events.next(m);const g=nT(d,this.rootComponentType).snapshot;return W(r={...o,targetSnapshot:g,urlAfterRedirects:d,extras:{...p,skipLocationChange:!1,replaceUrl:!1}})}{const u="";return this.events.next(new xc(o.id,t.serializeUrl(r.extractedUrl),u,1)),t.rawUrlTree=o.rawUrl,o.resolve(null),jn}}),wt(o=>{const a=new A2(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(a)}),pe(o=>r={...o,guards:tU(o.targetSnapshot,o.currentSnapshot,this.rootContexts)}),function hU(n,e){return mt(t=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return 0===o.length&&0===s.length?W({...t,guardsResult:!0}):function fU(n,e,t,r){return rt(n).pipe(mt(i=>function bU(n,e,t,r,i){const s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||0===s.length)return W(!0);const o=s.map(a=>{const l=na(e)??i,c=Is(a,l);return Kr(function cU(n){return n&&sa(n.canDeactivate)}(c)?c.canDeactivate(n,e,t,r):l.runInContext(()=>c(n,e,t,r))).pipe(jr())});return W(o).pipe(Ms())}(i.component,i.route,t,e,r)),jr(i=>!0!==i,!0))}(o,r,i,n).pipe(mt(a=>a&&function sU(n){return"boolean"==typeof n}(a)?function pU(n,e,t,r){return rt(e).pipe(bi(i=>pc(function gU(n,e){return null!==n&&e&&e(new F2(n)),W(!0)}(i.route.parent,r),function mU(n,e){return null!==n&&e&&e(new O2(n)),W(!0)}(i.route,r),function vU(n,e,t){const r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>function nU(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(o)).filter(o=>null!==o).map(o=>wD(()=>W(o.guards.map(l=>{const c=na(o.node)??t,u=Is(l,c);return Kr(function lU(n){return n&&sa(n.canActivateChild)}(u)?u.canActivateChild(r,n):c.runInContext(()=>u(r,n))).pipe(jr())})).pipe(Ms())));return W(s).pipe(Ms())}(n,i.path,t),function yU(n,e,t){const r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||0===r.length)return W(!0);const i=r.map(s=>wD(()=>{const o=na(e)??t,a=Is(s,o);return Kr(function aU(n){return n&&sa(n.canActivate)}(a)?a.canActivate(e,n):o.runInContext(()=>a(e,n))).pipe(jr())}));return W(i).pipe(Ms())}(n,i.route,t))),jr(i=>!0!==i,!0))}(r,s,n,e):W(a)),pe(a=>({...t,guardsResult:a})))})}(this.environmentInjector,o=>this.events.next(o)),wt(o=>{if(r.guardsResult=o.guardsResult,Ei(o.guardsResult))throw oT(0,o.guardsResult);const a=new w2(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot,!!o.guardsResult);this.events.next(a)}),Ar(o=>!!o.guardsResult||(t.restoreHistory(o),this.cancelNavigationTransition(o,"",3),!1)),vp(o=>{if(o.guards.canActivateChecks.length)return W(o).pipe(wt(a=>{const l=new I2(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(l)}),tr(a=>{let l=!1;return W(a).pipe(function VU(n,e){return mt(t=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return W(t);let s=0;return rt(i).pipe(bi(o=>function $U(n,e,t,r){const i=n.routeConfig,s=n._resolve;return void 0!==i?.title&&!ST(i)&&(s[Wo]=i.title),function HU(n,e,t,r){const i=function jU(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===i.length)return W({});const s={};return rt(i).pipe(mt(o=>function GU(n,e,t,r){const i=na(e)??r,s=Is(n,i);return Kr(s.resolve?s.resolve(e,t):i.runInContext(()=>s(e,t)))}(n[o],e,t,r).pipe(jr(),wt(a=>{s[o]=a}))),Yf(1),function JB(n){return pe(()=>n)}(s),Gr(o=>mp(o)?jn:zo(o)))}(s,n,e,r).pipe(pe(o=>(n._resolvedData=o,n.data=rT(n,t).resolve,i&&ST(i)&&(n.data[Wo]=i.title),null)))}(o.route,r,n,e)),wt(()=>s++),Yf(1),mt(o=>s===i.length?W(t):jn))})}(t.paramsInheritanceStrategy,this.environmentInjector),wt({next:()=>l=!0,complete:()=>{l||(t.restoreHistory(a),this.cancelNavigationTransition(a,"",2))}}))}),wt(a=>{const l=new M2(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(l)}))}),vp(o=>{const a=l=>{const c=[];l.routeConfig?.loadComponent&&!l.routeConfig._loadedComponent&&c.push(this.configLoader.loadComponent(l.routeConfig).pipe(wt(u=>{l.component=u}),pe(()=>{})));for(const u of l.children)c.push(...a(u));return c};return Wf(a(o.targetSnapshot.root)).pipe(mc(),vi(1))}),vp(()=>this.afterPreactivation()),pe(o=>{const a=function G2(n,e,t){const r=ea(n,e._root,t?t._root:void 0);return new tT(r,e)}(t.routeReuseStrategy,o.targetSnapshot,o.currentRouterState);return r={...o,targetRouterState:a}}),wt(o=>{t.currentUrlTree=o.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(o.urlAfterRedirects,o.rawUrl),t.routerState=o.targetRouterState,"deferred"===t.urlUpdateStrategy&&(o.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,o),t.browserUrlTree=o.urlAfterRedirects)}),((n,e,t)=>pe(r=>(new eU(e,r.targetRouterState,r.currentRouterState,t).activate(n),r)))(this.rootContexts,t.routeReuseStrategy,o=>this.events.next(o)),vi(1),wt({next:o=>{i=!0,this.lastSuccessfulNavigation=this.currentNavigation,t.navigated=!0,this.events.next(new Di(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(t.currentUrlTree))),t.titleStrategy?.updateTitle(o.targetRouterState.snapshot),o.resolve(!0)},complete:()=>{i=!0}}),Qf(()=>{i||s||this.cancelNavigationTransition(r,"",1),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),Gr(o=>{if(s=!0,cT(o)){lT(o)||(t.navigated=!0,t.restoreHistory(r,!0));const a=new Tc(r.id,this.urlSerializer.serialize(r.extractedUrl),o.message,o.cancellationCode);if(this.events.next(a),lT(o)){const l=t.urlHandlingStrategy.merge(o.url,t.rawUrlTree),c={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===t.urlUpdateStrategy||wT(r.source)};t.scheduleNavigation(l,Jo,null,c,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{t.restoreHistory(r,!0);const a=new ip(r.id,this.urlSerializer.serialize(r.extractedUrl),o,r.targetSnapshot??void 0);this.events.next(a);try{r.resolve(t.errorHandler(o))}catch(l){r.reject(l)}}return jn}))}))}cancelNavigationTransition(t,r,i){const s=new Tc(t.id,this.urlSerializer.serialize(t.extractedUrl),r,i);this.events.next(s),t.resolve(!1)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function wT(n){return n!==Jo}let IT=(()=>{class n{buildTitle(t){let r,i=t.root;for(;void 0!==i;)r=this.getResolvedTitleForRoute(i)??r,i=i.children.find(s=>s.outlet===ae);return r}getResolvedTitleForRoute(t){return t.data[Wo]}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:function(){return de(zU)},providedIn:"root"}),n})(),zU=(()=>{class n extends IT{constructor(t){super(),this.title=t}updateTitle(t){const r=this.buildTitle(t);void 0!==r&&this.title.setTitle(r)}}return n.\u0275fac=function(t){return new(t||n)(U(ED))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),WU=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:function(){return de(YU)},providedIn:"root"}),n})();class qU{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}let YU=(()=>{class n extends qU{}return n.\u0275fac=function(){let e;return function(r){return(e||(e=function vt(n){return ur(()=>{const e=n.prototype.constructor,t=e[hr]||Ed(e),r=Object.prototype;let i=Object.getPrototypeOf(n.prototype).constructor;for(;i&&i!==r;){const s=i[hr]||Ed(i);if(s&&s!==t)return s;i=Object.getPrototypeOf(i)}return s=>new s})}(n)))(r||n)}}(),n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Oc=new j("",{providedIn:"root",factory:()=>({})});let ZU=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:function(){return de(XU)},providedIn:"root"}),n})(),XU=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function JU(n){throw n}function eV(n,e,t){return e.parse("/")}const tV={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},nV={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Kt=(()=>{class n{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=de(AO),this.isNgZoneEnabled=!1,this.options=de(Oc,{optional:!0})||{},this.errorHandler=this.options.errorHandler||JU,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||eV,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=de(ZU),this.routeReuseStrategy=de(WU),this.urlCreationStrategy=de($2),this.titleStrategy=de(IT),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=OD(de(Rs,{optional:!0})??[]),this.navigationTransitions=de(kc),this.urlSerializer=de(Yo),this.location=de(Tf),this.isNgZoneEnabled=de(Ae)instanceof Ae&&Ae.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new zr,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=nT(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId??0},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Jo,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const r="popstate"===t.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,r,t.state)},0)}))}navigateToSyncWithBrowser(t,r,i){const s={replaceUrl:!0},o=i?.navigationId?i:null;if(i){const l={...i};delete l.navigationId,delete l.\u0275routerPageId,0!==Object.keys(l).length&&(s.state=l)}const a=this.parseUrl(t);this.scheduleNavigation(a,r,o,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(t){this.config=t.map(pp),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,r={}){const{relativeTo:i,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:l}=r,c=l?this.currentUrlTree.fragment:o;let u=null;switch(a){case"merge":u={...this.currentUrlTree.queryParams,...s};break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=s||null}return null!==u&&(u=this.removeEmptyProps(u)),this.urlCreationStrategy.createUrlTree(i,this.routerState,this.currentUrlTree,t,u,c??null)}navigateByUrl(t,r={skipLocationChange:!1}){const i=Ei(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(s,Jo,null,r)}navigate(t,r={skipLocationChange:!1}){return function rV(n){for(let e=0;e<n.length;e++){const t=n[e];if(null==t)throw new w(4008,false)}}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let r;try{r=this.urlSerializer.parse(t)}catch(i){r=this.malformedUriErrorHandler(i,this.urlSerializer,t)}return r}isActive(t,r){let i;if(i=!0===r?{...tV}:!1===r?{...nV}:r,Ei(t))return BD(this.currentUrlTree,t,i);const s=this.parseUrl(t);return BD(this.currentUrlTree,s,i)}removeEmptyProps(t){return Object.keys(t).reduce((r,i)=>{const s=t[i];return null!=s&&(r[i]=s),r},{})}scheduleNavigation(t,r,i,s,o){if(this.disposed)return Promise.resolve(!1);let a,l,c,u;return o?(a=o.resolve,l=o.reject,c=o.promise):c=new Promise((d,h)=>{a=d,l=h}),u="computed"===this.canceledNavigationResolution?i&&i.\u0275routerPageId?i.\u0275routerPageId:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:u,source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:s,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}setBrowserUrl(t,r){const i=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl){const o={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(i,"",o)}else{const s={...r.extras.state,...this.generateNgRouterState(r.id,r.targetPageId)};this.location.go(i,"",s)}}restoreHistory(t,r=!1){if("computed"===this.canceledNavigationResolution){const s=this.currentPageId-(this.browserPageId??this.currentPageId);0!==s?this.location.historyGo(s):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===s&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class MT{}let oV=(()=>{class n{constructor(t,r,i,s,o){this.router=t,this.injector=i,this.preloadingStrategy=s,this.loader=o}setUpPreloading(){this.subscription=this.router.events.pipe(Ar(t=>t instanceof Di),bi(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const i=[];for(const s of r){s.providers&&!s._injector&&(s._injector=Nl(s.providers,t,`Route: ${s.path}`));const o=s._injector??t,a=s._loadedInjector??o;(s.loadChildren&&!s._loadedRoutes&&void 0===s.canLoad||s.loadComponent&&!s._loadedComponent)&&i.push(this.preloadConfig(o,s)),(s.children||s._loadedRoutes)&&i.push(this.processRoutes(a,s.children??s._loadedRoutes))}return rt(i).pipe(Oi())}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>{let i;i=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(t,r):W(null);const s=i.pipe(mt(o=>null===o?W(void 0):(r._loadedRoutes=o.routes,r._loadedInjector=o.injector,this.processRoutes(o.injector??t,o.routes))));return r.loadComponent&&!r._loadedComponent?rt([s,this.loader.loadComponent(r)]).pipe(Oi()):s})}}return n.\u0275fac=function(t){return new(t||n)(U(Kt),U(nE),U(yr),U(MT),U(bp))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Dp=new j("");let RT=(()=>{class n{constructor(t,r,i,s,o={}){this.urlSerializer=t,this.transitions=r,this.viewportScroller=i,this.zone=s,this.options=o,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},o.scrollPositionRestoration=o.scrollPositionRestoration||"disabled",o.anchorScrolling=o.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof rp?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Di&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof JD&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new JD(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return n.\u0275fac=function(t){hh()},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})();var an=(()=>((an=an||{})[an.COMPLETE=0]="COMPLETE",an[an.FAILED=1]="FAILED",an[an.REDIRECTING=2]="REDIRECTING",an))();const Ls=!1;function Wr(n,e){return{\u0275kind:n,\u0275providers:e}}const Tp=new j("",{providedIn:"root",factory:()=>!1});function FT(){const n=de(Yn);return e=>{const t=n.get(Uo);if(e!==t.components[0])return;const r=n.get(Kt),i=n.get(kT);1===n.get(xp)&&r.initialNavigation(),n.get(OT,null,Q.Optional)?.setUpPreloading(),n.get(Dp,null,Q.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}const kT=new j(Ls?"bootstrap done indicator":"",{factory:()=>new un}),xp=new j(Ls?"initial navigation":"",{providedIn:"root",factory:()=>1});function dV(){let n=[];return n=Ls?[{provide:ml,multi:!0,useFactory:()=>{const e=de(Kt);return()=>e.events.subscribe(t=>{console.group?.(`Router Event: ${t.constructor.name}`),console.log(function N2(n){if(!("type"in n))return`Unknown Router Event: ${n.constructor.name}`;switch(n.type){case 14:return`ActivationEnd(path: '${n.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${n.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${n.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${n.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state}, shouldActivate: ${n.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 2:return`NavigationCancel(id: ${n.id}, url: '${n.url}')`;case 16:return`NavigationSkipped(id: ${n.id}, url: '${n.url}')`;case 1:return`NavigationEnd(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${n.id}, url: '${n.url}', error: ${n.error})`;case 0:return`NavigationStart(id: ${n.id}, url: '${n.url}')`;case 6:return`ResolveEnd(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 5:return`ResolveStart(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 10:return`RouteConfigLoadEnd(path: ${n.route.path})`;case 9:return`RouteConfigLoadStart(path: ${n.route.path})`;case 4:return`RoutesRecognized(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 15:return`Scroll(anchor: '${n.anchor}', position: '${n.position?`${n.position[0]}, ${n.position[1]}`:null}')`}}(t)),console.log(t),console.groupEnd?.()})}}]:[],Wr(1,n)}const OT=new j(Ls?"router preloader":"");function hV(n){return Wr(0,[{provide:OT,useExisting:oV},{provide:MT,useExisting:n}])}const aa=!1,PT=new j(aa?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),fV=[Tf,{provide:Yo,useClass:Zf},Kt,ta,{provide:Ti,useFactory:function LT(n){return n.routerState.root},deps:[Kt]},bp,aa?{provide:Tp,useValue:!0}:[]];function pV(){return new uE("Router",Kt)}let NT=(()=>{class n{constructor(t){}static forRoot(t,r){return{ngModule:n,providers:[fV,aa&&r?.enableTracing?dV().\u0275providers:[],{provide:Rs,multi:!0,useValue:t},{provide:PT,useFactory:vV,deps:[[Kt,new ho,new fo]]},{provide:Oc,useValue:r||{}},r?.useHash?{provide:yi,useClass:pP}:{provide:yi,useClass:FE},{provide:Dp,useFactory:()=>{const n=de(PN),e=de(Ae),t=de(Oc),r=de(kc),i=de(Yo);return t.scrollOffset&&n.setOffset(t.scrollOffset),new RT(i,r,n,e,t)}},r?.preloadingStrategy?hV(r.preloadingStrategy).\u0275providers:[],{provide:uE,multi:!0,useFactory:pV},r?.initialNavigation?bV(r):[],[{provide:BT,useFactory:FT},{provide:cE,multi:!0,useExisting:BT}]]}}static forChild(t){return{ngModule:n,providers:[{provide:Rs,multi:!0,useValue:t}]}}}return n.\u0275fac=function(t){return new(t||n)(U(PT,8))},n.\u0275mod=Lt({type:n}),n.\u0275inj=Et({imports:[hp]}),n})();function vV(n){if(aa&&n)throw new w(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function bV(n){return["disabled"===n.initialNavigation?Wr(3,[{provide:jl,multi:!0,useFactory:()=>{const e=de(Kt);return()=>{e.setUpLocationChangeListener()}}},{provide:xp,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?Wr(2,[{provide:xp,useValue:0},{provide:jl,multi:!0,deps:[Yn],useFactory:e=>{const t=e.get(hP,Promise.resolve());return()=>t.then(()=>new Promise(r=>{const i=e.get(Kt),s=e.get(kT);(function aV(n,e){n.events.pipe(Ar(t=>t instanceof Di||t instanceof Tc||t instanceof ip||t instanceof xc),pe(t=>t instanceof Di||t instanceof xc?an.COMPLETE:t instanceof Tc&&(0===t.code||1===t.code)?an.REDIRECTING:an.FAILED),Ar(t=>t!==an.REDIRECTING),vi(1)).subscribe(()=>{e()})})(i,()=>{r(!0)}),e.get(kc).afterPreactivation=()=>(r(!0),s.closed?W(void 0):s),i.initialNavigation()}))}}]).\u0275providers:[]]}const BT=new j(aa?"Router Initializer":"");let UT=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275cmp=eo({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(r,i){1&r&&fi(0,"router-outlet")},dependencies:[dp]}),e})();function EV(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var r,i,s,o,a,VT={exports:{}};r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,VT.exports=a={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),!(c=c.trim())){if(!u.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var h=a.parseURL(c);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return u.alwaysNormalize?(h.path=a.normalizePath(h.path),a.buildURLFromParts(h)):c;var f=a.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&"/"!==f.path[0]){var p=i.exec(f.path);f.netLoc=p[1],f.path=p[2]}f.netLoc&&!f.path&&(f.path="/");var m={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(m.netLoc=f.netLoc,"/"!==h.path[0]))if(h.path){var g=f.path,v=g.substring(0,g.lastIndexOf("/")+1)+h.path;m.path=a.normalizePath(v)}else m.path=f.path,h.params||(m.params=f.params,h.query||(m.query=f.query));return null===m.path&&(m.path=u.alwaysNormalize?a.normalizePath(h.path):h.path),a.buildURLFromParts(m)},parseURL:function(l){var c=r.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};var Sp=VT.exports;function $T(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function zt(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?$T(Object(t),!0).forEach(function(r){DV(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):$T(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function DV(n,e,t){return e=function xV(n){var e=function TV(n,e){if("object"!=typeof n||null===n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var r=t.call(n,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(n)}(n,"string");return"symbol"==typeof e?e:String(e)}(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function dt(){return dt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},dt.apply(this,arguments)}const z=Number.isFinite||function(n){return"number"==typeof n&&isFinite(n)};let y=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n}({}),X=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),x=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.UNKNOWN="unknown",n}({});const xi=function(){},Cp={trace:xi,debug:xi,log:xi,warn:xi,info:xi,error:xi};let la=Cp;const D=la,wV=/^(\d+)x(\d+)$/,HT=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Ke{constructor(e){"string"==typeof e&&(e=Ke.parseAttrList(e));for(const t in e)e.hasOwnProperty(t)&&("X-"===t.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const r=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){const t=wV.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const r={};for(HT.lastIndex=0;null!==(t=HT.exec(e));){let s=t[2];0===s.indexOf('"')&&s.lastIndexOf('"')===s.length-1&&(s=s.slice(1,-1)),r[t[1].trim()]=s}return r}}function MV(n){return"SCTE35-OUT"===n||"SCTE35-IN"===n}class jT{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const r=t.attr;for(const i in r)if(Object.prototype.hasOwnProperty.call(e,i)&&e[i]!==r[i]){D.warn(`DATERANGE tag attribute: "${i}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=i;break}e=dt(new Ke({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=new Date(this.attr["END-DATE"]);z(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(z(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&z(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class Pc{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var we={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class GT{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[we.AUDIO]:null,[we.VIDEO]:null,[we.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const r=e.split("@",2),i=[];i[0]=1===r.length?t?t.byteRangeEndOffset:0:parseInt(r[1]),i[1]=parseInt(r[0])+i[0],this._byteRange=i}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Sp.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class Ap extends GT{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new Pc,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(1===r.length)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime||!z(this.programDateTime))return null;const e=z(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),r=t.length;if(r>1||1===r&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,r,i,s,o=!1){const{elementaryStreams:a}=this,l=a[e];l?(l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,i),l.endDTS=Math.max(l.endDTS,s)):a[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:s,partial:o}}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[we.AUDIO]=null,e[we.VIDEO]=null,e[we.AUDIOVIDEO]=null}}class RV extends GT{constructor(e,t,r,i,s){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new Pc,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}class FV{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.misses=this.updated||this.advanced?Math.floor(.6*e.misses):e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&z(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function wp(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function KT(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}var ze={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Wt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function zT(n){switch(n){case Wt.FAIRPLAY:return ze.FAIRPLAY;case Wt.PLAYREADY:return ze.PLAYREADY;case Wt.WIDEVINE:return ze.WIDEVINE;case Wt.CLEARKEY:return ze.CLEARKEY}}var WT_WIDEVINE="edef8ba979d64acea3c827dcd51d21ed";function qT(n){switch(n){case ze.FAIRPLAY:return Wt.FAIRPLAY;case ze.PLAYREADY:return Wt.PLAYREADY;case ze.WIDEVINE:return Wt.WIDEVINE;case ze.CLEARKEY:return Wt.CLEARKEY}}function Ip(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[ze.FAIRPLAY,ze.WIDEVINE,ze.PLAYREADY,ze.CLEARKEY].filter(i=>!!e[i]):[];return!r[ze.WIDEVINE]&&t&&r.push(ze.WIDEVINE),r}const YT=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function Si(n,e,t){return Uint8Array.prototype.slice?n.slice(e,t):new Uint8Array(Array.prototype.slice.call(n,e,t))}const Mp=(n,e)=>e+10<=n.length&&73===n[e]&&68===n[e+1]&&51===n[e+2]&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,QT=(n,e)=>e+10<=n.length&&51===n[e]&&68===n[e+1]&&73===n[e+2]&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,Nc=(n,e)=>{const t=e;let r=0;for(;Mp(n,e);)r+=10,r+=Bc(n,e+6),QT(n,e+10)&&(r+=10),e+=r;if(r>0)return n.subarray(t,t+r)},Bc=(n,e)=>{let t=0;return t=(127&n[e])<<21,t|=(127&n[e+1])<<14,t|=(127&n[e+2])<<7,t|=127&n[e+3],t},VV=(n,e)=>Mp(n,e)&&Bc(n,e+6)+10<=n.length-e,ZT=n=>n&&"PRIV"===n.key&&"com.apple.streaming.transportStreamTimestamp"===n.info,HV=n=>{const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Bc(n,4);return{type:e,size:t,data:n.subarray(10,10+t)}},XT=n=>{let e=0;const t=[];for(;Mp(n,e);){const r=Bc(n,e+6);e+=10;const i=e+r;for(;e+8<i;){const s=HV(n.subarray(e)),o=jV(s);o&&t.push(o),e+=s.size+10}QT(n,e)&&(e+=10)}return t},jV=n=>"PRIV"===n.type?GV(n):"W"===n.type[0]?zV(n):KV(n),GV=n=>{if(n.size<2)return;const e=ir(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}},KV=n=>{if(n.size<2)return;if("TXXX"===n.type){let t=1;const r=ir(n.data.subarray(t),!0);t+=r.length+1;const i=ir(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=ir(n.data.subarray(1));return{key:n.type,data:e}},zV=n=>{if("WXXX"===n.type){if(n.size<2)return;let t=1;const r=ir(n.data.subarray(t),!0);t+=r.length+1;const i=ir(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=ir(n.data);return{key:n.type,data:e}},WV=n=>{if(8===n.data.byteLength){const e=new Uint8Array(n.data);let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,1&e[3]&&(r+=47721858.84),Math.round(r)}},ir=(n,e=!1)=>{const t=function qV(){return!Rp&&typeof self.TextDecoder<"u"&&(Rp=new self.TextDecoder("utf-8")),Rp}();if(t){const c=t.decode(n);if(e){const u=c.indexOf("\0");return-1!==u?c.substring(0,u):c}return c.replace(/\0/g,"")}const r=n.length;let i,s,o,a="",l=0;for(;l<r;){if(i=n[l++],0===i&&e)return a;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:s=n[l++],a+=String.fromCharCode((31&i)<<6|63&s);break;case 14:s=n[l++],o=n[l++],a+=String.fromCharCode((15&i)<<12|(63&s)<<6|(63&o)<<0)}}return a};let Rp;const sr_hexDump=function(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e},Uc=Math.pow(2,32)-1,YV=[].push,JT={video:1,audio:2,id3:3,text:4};function _t(n){return String.fromCharCode.apply(null,n)}function ex(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function ne(n,e){const t=tx(n,e);return t<0?4294967296+t:t}function tx(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function Lp(n,e,t){n[e]=t>>24,n[e+1]=t>>16&255,n[e+2]=t>>8&255,n[e+3]=255&t}function _e(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let i=0;i<r;){const s=ne(n,i),a=s>1?i+s:r;if(_t(n.subarray(i+4,i+8))===e[0])if(1===e.length)t.push(n.subarray(i+8,a));else{const l=_e(n.subarray(i+8,a),e.slice(1));l.length&&YV.apply(t,l)}i=a}return t}function QV(n){const e=[],t=n[0];let r=8;const i=ne(n,r);r+=4,r+=0===t?8:16,r+=2;let a=n.length+0;const l=ex(n,r);r+=2;for(let c=0;c<l;c++){let u=r;const d=ne(n,u);u+=4;const h=2147483647&d;if((2147483648&d)>>>31==1)return D.warn("SIDX has hierarchical references (not supported)"),null;const p=ne(n,u);u+=4,e.push({referenceSize:h,subsegmentDuration:p,info:{duration:p/i,start:a,end:a+h-1}}),a+=h,u+=4,r=u}return{earliestPresentationTime:0,timescale:i,version:t,referencesCount:l,references:e}}function nx(n){const e=[],t=_e(n,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],o=_e(s,["tkhd"])[0];if(o){let a=o[0],l=0===a?12:20;const c=ne(o,l),u=_e(s,["mdia","mdhd"])[0];if(u){a=u[0],l=0===a?12:20;const d=ne(u,l),h=_e(s,["mdia","hdlr"])[0];if(h){const f=_t(h.subarray(8,12)),p={soun:we.AUDIO,vide:we.VIDEO}[f];if(p){const m=_e(s,["mdia","minf","stbl","stsd"])[0];let g;m&&(g=_t(m.subarray(12,16))),e[c]={timescale:d,type:p},e[p]={timescale:d,id:c,codec:g}}}}}}return _e(n,["moov","mvex","trex"]).forEach(i=>{const s=ne(i,4),o=e[s];o&&(o.default={duration:ne(i,12),flags:ne(i,20)})}),e}function rx(n){const e=_e(n,["schm"])[0];if(e){const t=_t(e.subarray(4,8));if("cbcs"===t||"cenc"===t)return _e(n,["schi","tenc"])[0]}return D.error("[eme] missing 'schm' box"),null}function e$(n){const e=ne(n,0);let t=8;1&e&&(t+=4),4&e&&(t+=4);let r=0;const i=ne(n,4);for(let s=0;s<i;s++)256&e&&(r+=ne(n,t),t+=4),512&e&&(t+=4),1024&e&&(t+=4),2048&e&&(t+=4);return r}function Ci(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function ix(n,e){const t=[],r=e.samples,i=e.timescale,s=e.id;let o=!1;return _e(r,["moof"]).map(l=>{const c=l.byteOffset-8;_e(l,["traf"]).map(d=>{const h=_e(d,["tfdt"]).map(f=>{const p=f[0];let m=ne(f,4);return 1===p&&(m*=Math.pow(2,32),m+=ne(f,8)),m/i})[0];return void 0!==h&&(n=h),_e(d,["tfhd"]).map(f=>{const p=ne(f,4),m=16777215&ne(f,0);let b=0;const E=0!=(16&m);let T=0;const I=0!=(32&m);let C=8;p===s&&(0!=(1&m)&&(C+=8),0!=(2&m)&&(C+=4),0!=(8&m)&&(b=ne(f,C),C+=4),E&&(T=ne(f,C),C+=4),I&&(C+=4),"video"===e.type&&(o=function r$(n){if(!n)return!1;const e=n.indexOf("."),t=e<0?n:n.substring(0,e);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}(e.codec)),_e(d,["trun"]).map(k=>{const N=k[0],S=16777215&ne(k,0),K=0!=(1&S);let $=0;const ve=0!=(4&S),pt=0!=(256&S);let Re=0;const O=0!=(512&S);let B=0;const M=0!=(1024&S),P=0!=(2048&S);let re=0;const ge=ne(k,4);let le=8;K&&($=ne(k,le),le+=4),ve&&(le+=4);let Ie=$+c;for(let ye=0;ye<ge;ye++){if(pt?(Re=ne(k,le),le+=4):Re=b,O?(B=ne(k,le),le+=4):B=T,M&&(le+=4),P&&(re=0===N?ne(k,le):tx(k,le),le+=4),e.type===we.VIDEO){let Qt=0;for(;Qt<B;){const Zt=ne(r,Ie);Ie+=4,i$(o,r[Ie])&&sx(r.subarray(Ie,Ie+Zt),o?2:1,n+re/i,t),Ie+=Zt,Qt+=Zt+4}}n+=Re/i}}))})})}),t}function i$(n,e){if(n){const t=e>>1&63;return 39===t||40===t}return 6==(31&e)}function sx(n,e,t,r){const i=ox(n);let s=0;s+=e;let o=0,a=0,l=!1,c=0;for(;s<i.length;){o=0;do{if(s>=i.length)break;c=i[s++],o+=c}while(255===c);a=0;do{if(s>=i.length)break;c=i[s++],a+=c}while(255===c);const u=i.length-s;if(!l&&4===o&&s<i.length){if(l=!0,181===i[s++]){const h=ex(i,s);if(s+=2,49===h){const f=ne(i,s);if(s+=4,1195456820===f){const p=i[s++];if(3===p){const m=i[s++],v=64&m,_=v?2+3*(31&m):0,b=new Uint8Array(_);if(v){b[0]=m;for(let E=1;E<_;E++)b[E]=i[s++]}r.push({type:p,payloadType:o,pts:t,bytes:b})}}}}}else if(5===o&&a<u){if(l=!0,a>16){const d=[];for(let p=0;p<16;p++){const m=i[s++].toString(16);d.push(1==m.length?"0"+m:m),(3===p||5===p||7===p||9===p)&&d.push("-")}const h=a-16,f=new Uint8Array(h);for(let p=0;p<h;p++)f[p]=i[s++];r.push({payloadType:o,pts:t,uuid:d.join(""),userData:ir(f),userDataBytes:f})}}else if(a<u)s+=a;else if(a>u)break}}function ox(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)0===n[r]&&0===n[r+1]&&3===n[r+2]?(t.push(r+2),r+=2):r++;if(0===t.length)return n;const i=e-t.length,s=new Uint8Array(i);let o=0;for(r=0;r<i;o++,r++)o===t[0]&&(o++,t.shift()),s[r]=n[o];return s}let Vc={};class ca{static clearKeyUriToKeyIdMap(){Vc={}}constructor(e,t,r,i=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=s,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case Wt.FAIRPLAY:case Wt.WIDEVINE:case Wt.PLAYREADY:case Wt.CLEARKEY:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"===this.method&&!this.iv&&D.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=function c$(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}(e);return new ca(this.method,this.uri,"identity",this.keyFormatVersions,r)}const t=function PV(n){const e=n.split(":");let t=null;if("data"===e[0]&&2===e.length){const r=e[1].split(";"),i=r[r.length-1].split(",");if(2===i.length){const o=i[1];"base64"===i[0]?(r.splice(-1,1),t=wp(o)):t=function kV(n){const e=KT(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}(o)}}return t}(this.uri);if(t)switch(this.keyFormat){case Wt.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Wt.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function a$(n,e,t){if(16!==n.byteLength)throw new RangeError("Invalid system id");let r,i,s;if(e){r=1,i=new Uint8Array(16*e.length);for(let a=0;a<e.length;a++){const l=e[a];if(16!==l.byteLength)throw new RangeError("Invalid key");i.set(l,16*a)}}else r=0,i=new Uint8Array;r>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),function o$(n,...e){const t=e.length;let r=8,i=t;for(;i--;)r+=e[i].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=255&r,s.set(n,4),i=0,r=8;i<t;i++)s.set(e[i],r),r+=e[i].byteLength;return s}([112,115,115,104],new Uint8Array([r,0,0,0]),n,s,i,o,t||new Uint8Array)}(r,null,t);const i=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),s=String.fromCharCode.apply(null,Array.from(i)),o=s.substring(s.indexOf("<"),s.length),c=(new DOMParser).parseFromString(o,"text/xml").getElementsByTagName("KID")[0];if(c){const u=c.childNodes[0]?c.childNodes[0].nodeValue:c.getAttribute("VALUE");if(u){const d=wp(u).subarray(0,16);(function OV(n){const e=function(r,i,s){const o=r[i];r[i]=r[s],r[s]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)})(d),this.keyId=d}}break}default:{let r=t.subarray(0,16);if(16!==r.length){const i=new Uint8Array(16);i.set(r,16-r.length),r=i}this.keyId=r;break}}if(!this.keyId||16!==this.keyId.byteLength){let r=Vc[this.uri];if(!r){const i=Object.keys(Vc).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,i),Vc[this.uri]=r}this.keyId=r}return this}}const ax=/\{\$([a-zA-Z0-9-_]+)\}/g;function lx(n){return ax.test(n)}function qt(n,e,t){if(null!==n.variableList||n.hasVariableRefs)for(let r=t.length;r--;){const i=t[r],s=e[i];s&&(e[i]=Fp(n,s))}}function Fp(n,e){if(null!==n.variableList||n.hasVariableRefs){const t=n.variableList;return e.replace(ax,r=>{const i=r.substring(2,r.length-1),s=t?.[i];return void 0===s?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),r):s})}return e}function cx(n,e,t){let i,s,r=n.variableList;if(r||(n.variableList=r={}),"QUERYPARAM"in e){i=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(!o.has(i))throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`);s=o.get(i)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else i=e.NAME,s=e.VALUE;i in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):r[i]=s||""}function u$(n,e,t){const r=e.IMPORT;if(t&&r in t){let i=n.variableList;i||(n.variableList=i={}),i[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}function $c(){if(!(typeof self>"u"))return self.MediaSource||self.WebKitMediaSource}const d$={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},ux=$c();function kp(n,e){var t;return null!=(t=ux?.isTypeSupported(`${e||"video"}/mp4;codecs="${n}"`))&&t}const dx=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,hx=/#EXT-X-MEDIA:(.*)/g,f$=/^#EXT(?:INF|-X-TARGETDURATION):/m,fx=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),p$=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Un{static findGroup(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(i.id===t)return i}}static convertAVC1ToAVCOTI(e){const t=e.split(".");if(t.length>2){let r=t.shift()+".";return r+=parseInt(t.shift()).toString(16),r+=("000"+parseInt(t.shift()).toString(16)).slice(-4),r}return e}static resolve(e,t){return Sp.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return f$.test(e)}static parseMasterPlaylist(e,t){const i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:lx(e)},s=[];let o;for(dx.lastIndex=0;null!=(o=dx.exec(e));)if(o[1]){var a;const c=new Ke(o[1]);qt(i,c,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const u=Fp(i,o[2]),d={attrs:c,bitrate:c.decimalInteger("AVERAGE-BANDWIDTH")||c.decimalInteger("BANDWIDTH"),name:c.NAME,url:Un.resolve(u,t)},h=c.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),m$((c.CODECS||"").split(/[ ,]+/).filter(f=>f),d),d.videoCodec&&-1!==d.videoCodec.indexOf("avc1")&&(d.videoCodec=Un.convertAVC1ToAVCOTI(d.videoCodec)),null!=(a=d.unknownCodecs)&&a.length||s.push(d),i.levels.push(d)}else if(o[3]){const u=o[4];switch(o[3]){case"SESSION-DATA":{const d=new Ke(u);qt(i,d,["DATA-ID","LANGUAGE","VALUE","URI"]);const h=d["DATA-ID"];h&&(null===i.sessionData&&(i.sessionData={}),i.sessionData[h]=d);break}case"SESSION-KEY":{const d=px(u,t,i);d.encrypted&&d.isSupported()?(null===i.sessionKeys&&(i.sessionKeys=[]),i.sessionKeys.push(d)):D.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{const d=new Ke(u);qt(i,d,["NAME","VALUE","QUERYPARAM"]),cx(i,d,t)}break;case"CONTENT-STEERING":{const d=new Ke(u);qt(i,d,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:Un.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":i.startTimeOffset=mx(u)}}return i.levels=s.length>0&&s.length<i.levels.length?s:i.levels,0===i.levels.length&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,r){let i;const s={},o=r.levels,a={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(hx.lastIndex=0;null!==(i=hx.exec(e));){const c=new Ke(i[1]),u=c.TYPE;if(u){const d=a[u],h=s[u]||[];s[u]=h,qt(r,c,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const f={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?Un.resolve(c.URI,t):""};if(null!=d&&d.length){const p=Un.findGroup(d,f.groupId)||d[0];gx(f,p,"audioCodec"),gx(f,p,"textCodec")}h.push(f)}}return s}static parseLevelPlaylist(e,t,r,i,s,o){const a=new FV(t),l=a.fragments;let g,v,_,c=null,u=0,d=0,h=0,f=0,p=null,m=new Ap(i,t),b=-1,E=!1;for(fx.lastIndex=0,a.m3u8=e,a.hasVariableRefs=lx(e);null!==(g=fx.exec(e));){E&&(E=!1,m=new Ap(i,t),m.start=h,m.sn=u,m.cc=f,m.level=r,c&&(m.initSegment=c,m.rawProgramDateTime=c.rawProgramDateTime,c.rawProgramDateTime=null));const k=g[1];if(k){m.duration=parseFloat(k);const N=(" "+g[2]).slice(1);m.title=N||null,m.tagList.push(N?["INF",k,N]:["INF",k])}else if(g[3]){if(z(m.duration)){m.start=h,_&&bx(m,_,a),m.sn=u,m.level=r,m.cc=f,m.urlId=s,l.push(m);const N=(" "+g[3]).slice(1);m.relurl=Fp(a,N),yx(m,p),p=m,h+=m.duration,u++,d=0,E=!0}}else if(g[4]){const N=(" "+g[4]).slice(1);p?m.setByteRange(N,p):m.setByteRange(N)}else if(g[5])m.rawProgramDateTime=(" "+g[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]),-1===b&&(b=l.length);else{if(g=g[0].match(p$),!g){D.warn("No matches on slow regex match for level playlist!");continue}for(v=1;v<g.length&&!(typeof g[v]<"u");v++);const N=(" "+g[v]).slice(1),S=(" "+g[v+1]).slice(1),K=g[v+2]?(" "+g[v+2]).slice(1):"";switch(N){case"PLAYLIST-TYPE":a.type=S.toUpperCase();break;case"MEDIA-SEQUENCE":u=a.startSN=parseInt(S);break;case"SKIP":{const $=new Ke(S);qt(a,$,["RECENTLY-REMOVED-DATERANGES"]);const ve=$.decimalInteger("SKIPPED-SEGMENTS");if(z(ve)){a.skippedSegments=ve;for(let Re=ve;Re--;)l.unshift(null);u+=ve}const pt=$.enumeratedString("RECENTLY-REMOVED-DATERANGES");pt&&(a.recentlyRemovedDateranges=pt.split("\t"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(S),1);break;case"VERSION":a.version=parseInt(S);break;case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(S||K)&&m.tagList.push(K?[S,K]:[S]);break;case"DISCONTINUITY":f++,m.tagList.push(["DIS"]);break;case"GAP":m.gap=!0,m.tagList.push([N]);break;case"BITRATE":m.tagList.push([N,S]);break;case"DATERANGE":{const $=new Ke(S);qt(a,$,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),qt(a,$,$.clientAttrs);const ve=new jT($,a.dateRanges[$.ID]);ve.isValid||a.skippedSegments?a.dateRanges[ve.id]=ve:D.warn(`Ignoring invalid DATERANGE tag: "${S}"`),m.tagList.push(["EXT-X-DATERANGE",S]);break}case"DEFINE":{const $=new Ke(S);qt(a,$,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in $?u$(a,$,o):cx(a,$,t)}break;case"DISCONTINUITY-SEQUENCE":f=parseInt(S);break;case"KEY":{const $=px(S,t,a);if($.isSupported()){if("NONE"===$.method){_=void 0;break}_||(_={}),_[$.keyFormat]&&(_=dt({},_)),_[$.keyFormat]=$}else D.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${S}"`);break}case"START":a.startTimeOffset=mx(S);break;case"MAP":{const $=new Ke(S);if(qt(a,$,["BYTERANGE","URI"]),m.duration){const ve=new Ap(i,t);vx(ve,$,r,_),c=ve,m.initSegment=c,c.rawProgramDateTime&&!m.rawProgramDateTime&&(m.rawProgramDateTime=c.rawProgramDateTime)}else vx(m,$,r,_),c=m,E=!0;break}case"SERVER-CONTROL":{const $=new Ke(S);a.canBlockReload=$.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=$.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&$.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=$.optionalFloat("PART-HOLD-BACK",0),a.holdBack=$.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const $=new Ke(S);a.partTarget=$.decimalFloatingPoint("PART-TARGET");break}case"PART":{let $=a.partList;$||($=a.partList=[]);const ve=d>0?$[$.length-1]:void 0,pt=d++,Re=new Ke(S);qt(a,Re,["BYTERANGE","URI"]);const O=new RV(Re,m,t,pt,ve);$.push(O),m.duration+=O.duration;break}case"PRELOAD-HINT":{const $=new Ke(S);qt(a,$,["URI"]),a.preloadHint=$;break}case"RENDITION-REPORT":{const $=new Ke(S);qt(a,$,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push($);break}default:D.warn(`line parsed but not handled: ${g}`)}}}p&&!p.relurl?(l.pop(),h-=p.duration,a.partList&&(a.fragmentHint=p)):a.partList&&(yx(m,p),m.cc=f,a.fragmentHint=m,_&&bx(m,_,a));const T=l.length,I=l[0],C=l[T-1];if(h+=a.skippedSegments*a.targetduration,h>0&&T&&C){a.averagetargetduration=h/T;const k=C.sn;a.endSN="initSegment"!==k?k:0,a.live||(C.endList=!0),I&&(a.startCC=I.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(h+=a.fragmentHint.duration),a.totalduration=h,a.endCC=f,b>0&&function g$(n,e){let t=n[e];for(let r=e;r--;){const i=n[r];if(!i)return;i.programDateTime=t.programDateTime-1e3*i.duration,t=i}}(l,b),a}}function px(n,e,t){var r,i;const s=new Ke(n);qt(t,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const o=null!=(r=s.METHOD)?r:"",a=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,u=null!=(i=s.KEYFORMAT)?i:"identity";a&&s.IV&&!l&&D.error(`Invalid IV: ${s.IV}`);const d=a?Un.resolve(a,e):"",h=(c||"1").split("/").map(Number).filter(Number.isFinite);return new ca(o,d,u,h,l)}function mx(n){const t=new Ke(n).decimalFloatingPoint("TIME-OFFSET");return z(t)?t:null}function m$(n,e){["video","audio","text"].forEach(t=>{const r=n.filter(i=>function h$(n,e){const t=d$[e];return!!t&&!0===t[n.slice(0,4)]}(i,t));if(r.length){const i=r.filter(s=>0===s.lastIndexOf("avc1",0)||0===s.lastIndexOf("mp4a",0));e[`${t}Codec`]=i.length>0?i[0]:r[0],n=n.filter(s=>-1===r.indexOf(s))}}),e.unknownCodecs=n}function gx(n,e,t){const r=e[t];r&&(n[t]=r)}function yx(n,e){n.rawProgramDateTime?n.programDateTime=Date.parse(n.rawProgramDateTime):null!=e&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime),z(n.programDateTime)||(n.programDateTime=null,n.rawProgramDateTime=null)}function vx(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function bx(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&r.push(n)}var Ee={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},te={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function _x(n){const{type:e}=n;switch(e){case Ee.AUDIO_TRACK:return te.AUDIO;case Ee.SUBTITLE_TRACK:return te.SUBTITLE;default:return te.MAIN}}function Op(n,e){let t=n.url;return(void 0===t||0===t.indexOf("data:"))&&(t=e.url),t}class y${constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,o=new(t.pLoader||t.loader)(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ee.MANIFEST,url:r,deliveryDirectives:null})}onLevelLoading(e,t){const{id:r,level:i,url:s,deliveryDirectives:o}=t;this.load({id:r,level:i,responseType:"text",type:Ee.LEVEL,url:s,deliveryDirectives:o})}onAudioTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:Ee.AUDIO_TRACK,url:s,deliveryDirectives:o})}onSubtitleTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:Ee.SUBTITLE_TRACK,url:s,deliveryDirectives:o})}load(e){var t;const r=this.hls.config;let s,i=this.getInternalLoader(e);if(i){const c=i.context;if(c&&c.url===e.url)return void D.trace("[playlist-loader]: playlist request ongoing");D.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}if(s=e.type===Ee.MANIFEST?r.manifestLoadPolicy.default:dt({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),null!=(t=e.deliveryDirectives)&&t.part){let c;if(e.type===Ee.LEVEL&&null!==e.level?c=this.hls.levels[e.level].details:e.type===Ee.AUDIO_TRACK&&null!==e.id?c=this.hls.audioTracks[e.id].details:e.type===Ee.SUBTITLE_TRACK&&null!==e.id&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,d=c.targetduration;if(u&&d){const h=1e3*Math.max(3*u,.8*d);s=dt({},s,{maxTimeToFirstByteMs:Math.min(h,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,s.maxTimeToFirstByteMs)})}}}const o=s.errorRetry||s.timeoutRetry||{};i.load(e,{loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},{onSuccess:(c,u,d,h)=>{const f=this.getInternalLoader(d);this.resetInternalLoader(d.type);const p=c.data;0===p.indexOf("#EXTM3U")?(u.parsing.start=performance.now(),Un.isMediaPlaylist(p)?this.handleTrackOrLevelPlaylist(c,u,d,h||null,f):this.handleMasterPlaylist(c,u,d,h)):this.handleManifestParsingError(c,d,new Error("no EXTM3U delimiter"),h||null,u)},onError:(c,u,d,h)=>{this.handleNetworkError(u,d,!1,c,h)},onTimeout:(c,u,d)=>{this.handleNetworkError(u,d,!0,void 0,c)}})}handleMasterPlaylist(e,t,r,i){const s=this.hls,o=e.data,a=Op(e,r),l=Un.parseMasterPlaylist(o,a);if(l.playlistParsingError)return void this.handleManifestParsingError(e,r,l.playlistParsingError,i,t);const{contentSteering:c,levels:u,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:p}=l;this.variableList=p;const{AUDIO:m=[],SUBTITLES:g,"CLOSED-CAPTIONS":v}=Un.parseMasterPlaylistMedia(o,a,l);m.length&&!m.some(b=>!b.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(D.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ke({}),bitrate:0,url:""})),s.trigger(y.MANIFEST_LOADED,{levels:u,audioTracks:m,subtitles:g,captions:v,contentSteering:c,url:a,stats:t,networkDetails:i,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:p})}handleTrackOrLevelPlaylist(e,t,r,i,s){const o=this.hls,{id:a,level:l,type:c}=r,u=Op(e,r),d=z(a)?a:0,h=z(l)?l:d,f=_x(r),p=Un.parseLevelPlaylist(e.data,u,h,f,d,this.variableList);if(c===Ee.MANIFEST){const m={attrs:new Ke({}),bitrate:0,details:p,name:"",url:u};o.trigger(y.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:u,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=p,this.handlePlaylistLoaded(p,e,t,r,i,s)}handleManifestParsingError(e,t,r,i,s){this.hls.trigger(y.ERROR,{type:X.NETWORK_ERROR,details:x.MANIFEST_PARSING_ERROR,fatal:t.type===Ee.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,r=!1,i,s){let o=`A network ${r?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===Ee.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===Ee.AUDIO_TRACK||e.type===Ee.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);D.warn(`[playlist-loader]: ${o}`);let l=x.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case Ee.MANIFEST:l=r?x.MANIFEST_LOAD_TIMEOUT:x.MANIFEST_LOAD_ERROR,c=!0;break;case Ee.LEVEL:l=r?x.LEVEL_LOAD_TIMEOUT:x.LEVEL_LOAD_ERROR,c=!1;break;case Ee.AUDIO_TRACK:l=r?x.AUDIO_TRACK_LOAD_TIMEOUT:x.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case Ee.SUBTITLE_TRACK:l=r?x.SUBTITLE_TRACK_LOAD_TIMEOUT:x.SUBTITLE_LOAD_ERROR,c=!1}u&&this.resetInternalLoader(e.type);const d={type:X.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:a,networkDetails:t,stats:s};i&&(d.response=zt({url:t?.url||e.url,data:void 0},i)),this.hls.trigger(y.ERROR,d)}handlePlaylistLoaded(e,t,r,i,s,o){const a=this.hls,{type:l,level:c,id:u,groupId:d,deliveryDirectives:h}=i,f=Op(t,i),p=_x(i),m="number"==typeof i.level&&p===te.MAIN?c:void 0;if(!e.fragments.length){const v=new Error("No Segments found in Playlist");return void a.trigger(y.ERROR,{type:X.NETWORK_ERROR,details:x.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:v,reason:v.message,response:t,context:i,level:m,parent:p,networkDetails:s,stats:r})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const g=e.playlistParsingError;if(g)a.trigger(y.ERROR,{type:X.NETWORK_ERROR,details:x.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:g,reason:g.message,response:t,context:i,level:m,parent:p,networkDetails:s,stats:r});else switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case Ee.MANIFEST:case Ee.LEVEL:a.trigger(y.LEVEL_LOADED,{details:e,level:m||0,id:u||0,stats:r,networkDetails:s,deliveryDirectives:h});break;case Ee.AUDIO_TRACK:a.trigger(y.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:d||"",stats:r,networkDetails:s,deliveryDirectives:h});break;case Ee.SUBTITLE_TRACK:a.trigger(y.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:d||"",stats:r,networkDetails:s,deliveryDirectives:h})}}}function Ex(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function Dx(n,e){const t=n.mode;if("disabled"===t&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){D.debug(`[texttrack-utils]: ${r}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,n.addCue(i)}catch(i){D.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}"disabled"===t&&(n.mode=t)}function Fs(n){const e=n.mode;if("disabled"===e&&(n.mode="hidden"),n.cues)for(let t=n.cues.length;t--;)n.removeCue(n.cues[t]);"disabled"===e&&(n.mode=e)}function Pp(n,e,t,r){const i=n.mode;if("disabled"===i&&(n.mode="hidden"),n.cues&&n.cues.length>0){const s=function b$(n,e,t){const r=[],i=function v$(n,e){if(e<n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,i=t;for(;r<=i;){const s=Math.floor((i+r)/2);if(e<n[s].startTime)i=s-1;else{if(!(e>n[s].startTime&&r<t))return s;r=s+1}}return n[r].startTime-e<e-n[i].startTime?r:i}(n,e);if(i>-1)for(let s=i,o=n.length;s<o;s++){const a=n[s];if(a.startTime>=e&&a.endTime<=t)r.push(a);else if(a.startTime>t)return r}return r}(n.cues,e,t);for(let o=0;o<s.length;o++)(!r||r(s[o]))&&n.removeCue(s[o])}"disabled"===i&&(n.mode=i)}var Vn_emsg="https://aomedia.org/emsg/ID3";function Np(){if(!(typeof self>"u"))return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}const Hc=(()=>{const n=Np();try{new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function Bp(n,e){return n.getTime()/1e3-e}function E$(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class D${constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(Fs(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if("metadata"===r.kind&&"id3"===r.label)return Ex(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:i}}}=this;if(!r&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Np();for(let a=0;a<s.length;a++){const l=s[a].type;if(l===Vn_emsg&&!r||!i)continue;const c=XT(s[a].data);if(c){const u=s[a].pts;let d=u+s[a].duration;d>Hc&&(d=Hc),d-u<=0&&(d=u+.25);for(let f=0;f<c.length;f++){const p=c[f];if(!ZT(p)){this.updateId3CueEnds(u,l);const m=new o(u,d,"");m.value=p,l&&(m.type=l),this.id3Track.addCue(m)}}}}}updateId3CueEnds(e,t){var r;const i=null==(r=this.id3Track)?void 0:r.cues;if(i)for(let s=i.length;s--;){const o=i[s];o.type===t&&o.startTime<e&&o.endTime===Hc&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:i}){const{id3Track:s,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(s&&(a||l)){let c;c="audio"===i?u=>"org.id3"===u.type&&l:"video"===i?u=>u.type===Vn_emsg&&a:u=>"org.id3"===u.type&&l||u.type===Vn_emsg&&a,Pp(s,t,r,c)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:r,id3Track:i}=this,{dateRanges:s}=t,o=Object.keys(s);if(i){const u=Object.keys(r).filter(d=>!o.includes(d));for(let d=u.length;d--;){const h=u[d];Object.keys(r[h].cues).forEach(f=>{i.removeCue(r[h].cues[f])}),delete r[h]}}const a=t.fragments[t.fragments.length-1];if(0===o.length||!z(a?.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=a.programDateTime/1e3-a.start,c=Np();for(let u=0;u<o.length;u++){const d=o[u],h=s[d],f=r[d],p=f?.cues||{};let m=f?.durationKnown||!1;const g=Bp(h.startDate,l);let v=Hc;const _=h.endDate;if(_)v=Bp(_,l),m=!0;else if(h.endOnNext&&!m){const E=o.reduce((T,I)=>{const C=s[I];return C.class===h.class&&C.id!==I&&C.startDate>h.startDate&&T.push(C),T},[]).sort((T,I)=>T.startDate.getTime()-I.startDate.getTime())[0];E&&(v=Bp(E.startDate,l),m=!0)}const b=Object.keys(h.attr);for(let E=0;E<b.length;E++){const T=b[E];if("ID"===(n=T)||"CLASS"===n||"START-DATE"===n||"DURATION"===n||"END-DATE"===n||"END-ON-NEXT"===n)continue;let I=p[T];if(I)m&&!f.durationKnown&&(I.endTime=v);else{let C=h.attr[T];I=new c(g,v,""),MV(T)&&(C=E$(C)),I.value={key:T,data:C},I.type="com.apple.quicktime.HLS",I.id=d,this.id3Track.addCue(I),p[T]=I}}r[d]={cues:p,dateRange:h,durationKnown:m}}var n}}class T${constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(null===e)return null;const{holdBack:t,partHoldBack:r,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let c=a&&r||t;return(l.liveSyncDuration||l.liveSyncDurationCount||0===c)&&(c=void 0!==s?s:o*i),c+Math.min(1*this.stallCount,i)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(null===e||null===t||null===r)return null;const i=r.edge,a=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(i-r.totalduration,e-t-this.edgeStalled),a)}get drift(){const{levelDetails:e}=this;return null===e?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;return null===e?0:Math.max(e.age-3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration),0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(y.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(y.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var r;t.details===x.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(r=this.levelDetails)&&r.live&&D.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(null===r)return;this._latency=r;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:s}=this.config;if(!i||1===s)return;const o=this.targetLatency;if(null===o)return;const a=r-o,l=Math.min(this.maxLatency,o+t.targetduration);if(t.live&&a<l&&a>.05&&this.forwardBufferLength>1){const u=Math.min(2,Math.max(1,s)),d=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;e.playbackRate=Math.min(u,Math.max(1,d))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}const Up=["NONE","TYPE-0","TYPE-1",null];var ua_No="",ua_Yes="YES",ua_v2="v2";class Tx{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class da{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>t).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){const t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}get audioGroupId(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}get textGroupId(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}}function Vp(n,e){const t=e.startPTS;if(z(t)){let i,r=0;e.sn>n.sn?(r=t-n.start,i=n):(r=n.start-t,i=e),i.duration!==r&&(i.duration=r)}else e.start=e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?n.start+(n.minEndPTS-n.start):n.start+n.duration:Math.max(n.start-e.duration,0)}function xx(n,e,t,r,i,s){r-t<=0&&(D.warn("Fragment should have a positive duration",e),r=t+e.duration,s=i+e.duration);let a=t,l=r;const c=e.startPTS,u=e.endPTS;if(z(c)){const g=Math.abs(c-t);e.deltaPTS=z(e.deltaPTS)?Math.max(g,e.deltaPTS):g,a=Math.max(t,c),t=Math.min(t,c),i=Math.min(i,e.startDTS),l=Math.min(r,u),r=Math.max(r,u),s=Math.max(s,e.endDTS)}const d=t-e.start;0!==e.start&&(e.start=t),e.duration=r-e.start,e.startPTS=t,e.maxStartPTS=a,e.startDTS=i,e.endPTS=r,e.minEndPTS=l,e.endDTS=s;const h=e.sn;if(!n||h<n.startSN||h>n.endSN)return 0;let f;const p=h-n.startSN,m=n.fragments;for(m[p]=e,f=p;f>0;f--)Vp(m[f],m[f-1]);for(f=p;f<m.length-1;f++)Vp(m[f],m[f+1]);return n.fragmentHint&&Vp(m[m.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,d}function Sx(n,e){const t=e.startSN+e.skippedSegments-n.startSN,r=n.fragments;t<0||t>=r.length||$p(e,r[t].start)}function $p(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].start+=e;n.fragmentHint&&(n.fragmentHint.start+=e)}}function Cx(n,e,t){var r;return null!=n&&n.details?Ax(null==(r=n.details)?void 0:r.partList,e,t):null}function Ax(n,e,t){if(n)for(let r=n.length;r--;){const i=n[r];if(i.index===t&&i.fragment.sn===e)return i}return null}function jc(n){switch(n.details){case x.FRAG_LOAD_TIMEOUT:case x.KEY_LOAD_TIMEOUT:case x.LEVEL_LOAD_TIMEOUT:case x.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function wx(n,e){const t=jc(e);return n.default[(t?"timeout":"error")+"Retry"]}function Hp(n,e){const t="linear"===n.backoff?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function Ix(n){return zt(zt({},n),{errorRetry:null,timeoutRetry:null})}function Gc(n,e,t,r){return!!n&&e<n.maxNumRetry&&(function R$(n){return 0===n&&!1===navigator.onLine||!!n&&(n<400||n>499)}(r)||!!t)}const Mx={search:function(n,e){let t=0,r=n.length-1,i=null,s=null;for(;t<=r;){i=(t+r)/2|0,s=n[i];const o=e(s);if(o>0)t=i+1;else{if(!(o<0))return s;r=i-1}}return null}};function ha(n,e,t=0,r=0){let i=null;if(n?i=e[n.sn-e[0].sn+1]||null:0===t&&0===e[0].start&&(i=e[0]),i&&0===jp(t,r,i))return i;const s=Mx.search(e,jp.bind(null,t,r));return!s||s===n&&i?i:s}function jp(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function F$(n,e,t){const r=1e3*Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return(t.endProgramDateTime||0)-r>n}const O$=3e5;function N$(n,e,t){if(performance.now()-n.lastErrorPerfMs>O$)return!0;const r=n.details;if(e.details===x.FRAG_GAP&&r&&e.frag){const s=ha(null,r.fragments,e.frag.start);if(s&&!s.gap)return!0}if(t&&n.errors.length<t.errors.length){const i=n.errors[n.errors.length-1];if(r&&i.frag&&e.frag&&Math.abs(i.frag.start-e.frag.start)>3*r.targetduration)return!0}return!1}class Gp{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=D.log.bind(D,`${t}:`),this.warn=D.warn.bind(D,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t){const r=t?.renditionReports;if(r){let i=-1;for(let s=0;s<r.length;s++){const o=r[s];let a;try{a=new self.URL(o.URI,t.url).href}catch(l){D.warn(`Could not construct new URL for Rendition Report: ${l}`),a=o.URI||""}if(a===e){i=s;break}a===e.substring(0,a.length)&&(i=s)}if(-1!==i){const s=r[i],o=parseInt(s["LAST-MSN"])||t?.lastPartSn;let a=parseInt(s["LAST-PART"])||t?.lastPartIndex;if(this.hls.config.lowLatencyMode){const l=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&l>t.partTarget&&(a+=1)}return new Tx(o,a>=0?a:void 0,ua_No)}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,r){const{details:i,stats:s}=t,o=self.performance.now(),a=s.loading.first?Math.max(0,o-s.loading.first):0;if(i.advancedDateTime=Date.now()-a,i.live||null!=r&&r.live){if(i.reloaded(r),r&&this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),r&&i.fragments.length>0&&function S$(n,e){let t=null;const r=n.fragments;for(let l=r.length-1;l>=0;l--){const c=r[l].initSegment;if(c){t=c;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let s,i=0;if(function w$(n,e,t){const r=e.skippedSegments,i=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let c=i;c<=s;c++){const u=l[o+c];let d=a[c];r&&!d&&c<r&&(d=e.fragments[c]=u),u&&d&&t(u,d)}}(n,e,(l,c)=>{l.relurl&&(i=l.cc-c.cc),z(l.startPTS)&&z(l.endPTS)&&(c.start=c.startPTS=l.startPTS,c.startDTS=l.startDTS,c.maxStartPTS=l.maxStartPTS,c.endPTS=l.endPTS,c.endDTS=l.endDTS,c.minEndPTS=l.minEndPTS,c.duration=l.endPTS-l.startPTS,c.duration&&(s=c),e.PTSKnown=e.alignedSliding=!0),c.elementaryStreams=l.elementaryStreams,c.loader=l.loader,c.stats=l.stats,c.urlId=l.urlId,l.initSegment&&(c.initSegment=l.initSegment,t=l.initSegment)}),t&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(c=>{var u;(!c.initSegment||c.initSegment.relurl===(null==(u=t)?void 0:u.relurl))&&(c.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(l=>!l),e.deltaUpdateFailed){D.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=e.skippedSegments;l--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=function C$(n,e,t){const r=dt({},n);return t&&t.forEach(i=>{delete r[i]}),Object.keys(e).forEach(i=>{const s=new jT(e[i].attr,r[i]);s.isValid?r[i]=s:D.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[i].attr)}"`)}),r}(n.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const o=e.fragments;if(i){D.warn("discontinuity sliding from playlist, take drift into account");for(let l=0;l<o.length;l++)o[l].cc+=i}e.skippedSegments&&(e.startCC=e.fragments[0].cc),function A$(n,e,t){if(n&&e){let r=0;for(let i=0,s=n.length;i<=s;i++){const o=n[i],a=e[i+r];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):r--}}}(n.partList,e.partList,(l,c)=>{c.elementaryStreams=l.elementaryStreams,c.stats=l.stats}),s?xx(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):Sx(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const a=e.advancedDateTime;if(e.advanced&&a){const l=e.edge;e.driftStart||(e.driftStartTime=a,e.driftStart=l),e.driftEndTime=a,e.driftEnd=l}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime}(r,i),!this.canLoad||!i.live)return;let l,c,u;if(i.canBlockReload&&i.endSN&&i.advanced){const g=this.hls.config.lowLatencyMode,v=i.lastPartSn,_=i.endSN,b=i.lastPartIndex,T=v===_;-1!==b?(c=T?_+1:v,u=T?g?0:b:b+1):c=_+1;const C=i.age;let N=Math.min(C+i.ageHeader-i.partTarget,1.5*i.targetduration);if(N>0){if(r&&N>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${N} with playlist age: ${i.age}`),N=0;else{const S=Math.floor(N/i.targetduration);c+=S,void 0!==u&&(u+=Math.round(N%i.targetduration/i.partTarget)),this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${C.toFixed(2)}s goal: ${N} skip sn ${S} to part ${u}`)}i.tuneInGoal=N}if(l=this.getDeliveryDirectives(i,t.deliveryDirectives,c,u),g||!T)return void this.loadPlaylist(l)}else(i.canBlockReload||i.canSkipUntil)&&(l=this.getDeliveryDirectives(i,t.deliveryDirectives,c,u));const d=this.hls.mainForwardBufferInfo,p=function I$(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&4*t>e){const s=1e3*r[r.length-1].duration;s<t&&(t=s)}}else t/=2;return Math.round(t)}(i,1e3*(i.edge-(d?d.end-d.len:0)));i.updated&&o>this.requestScheduled+p&&(this.requestScheduled=s.loading.start),void 0!==c&&i.canBlockReload?this.requestScheduled=s.loading.first+p-(1e3*i.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+p<o?this.requestScheduled=o:this.requestScheduled-o<=0&&(this.requestScheduled+=p);let m=this.requestScheduled-o;m=Math.max(0,m),this.log(`reload live playlist ${e} in ${Math.round(m)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),m)}else this.clearTimer()}getDeliveryDirectives(e,t,r,i){let s=function x$(n,e){const{canSkipUntil:t,canSkipDateRanges:r,endSN:i}=n;return t&&(void 0!==e?e-i:0)<t?r?ua_v2:ua_Yes:ua_No}(e,r);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,s=ua_No),new Tx(r,i,s)}checkRetry(e){const t=e.details,r=jc(e),i=e.errorAction,{action:s,retryCount:o=0,retryConfig:a}=i||{},l=!!i&&!!a&&(5===s||!i.resolved&&2===s);if(l){var c;if(this.requestScheduled=-1,o>=a.maxNumRetry)return!1;if(r&&null!=(c=e.context)&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=Hp(a,o);this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,i.resolved=!0}return l}}let Kp;class B$ extends Gp{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=[],i={};let s;t.levels.forEach(o=>{var a;const l=o.attrs;-1!==(null==(a=o.audioCodec)?void 0:a.indexOf("mp4a.40.34"))&&(Kp||(Kp=/chrome|firefox/i.test(navigator.userAgent)),Kp&&(o.audioCodec=void 0));const{AUDIO:c,CODECS:u,"FRAME-RATE":d,"PATHWAY-ID":h,RESOLUTION:f,SUBTITLES:p}=l,g=`${h||"."}-${o.bitrate}-${f}-${d}-${u}`;s=i[g],s?s.addFallback(o):(s=new da(o),i[g]=s,r.push(s)),Kc(s,"audio",c),Kc(s,"text",p)}),this.filterAndSortMediaOptions(r,t)}filterAndSortMediaOptions(e,t){let r=[],i=[],s=!1,o=!1,a=!1,l=e.filter(({audioCodec:f,videoCodec:p,width:m,height:g,unknownCodecs:v})=>(s||(s=!(!m||!g)),o||(o=!!p),a||(a=!!f),!(null!=v&&v.length)&&(!f||kp(f,"audio"))&&(!p||kp(p,"video"))));if((s||o)&&a&&(l=l.filter(({videoCodec:f,width:p,height:m})=>!!f||!(!p||!m))),0===l.length)return void Promise.resolve().then(()=>{if(this.hls){const f=new Error("no level with compatible codecs found in manifest");this.hls.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:f,reason:f.message})}});t.audioTracks&&(r=t.audioTracks.filter(f=>!f.audioCodec||kp(f.audioCodec,"audio")),Rx(r)),t.subtitles&&(i=t.subtitles,Rx(i));const c=l.slice(0);l.sort((f,p)=>f.attrs["HDCP-LEVEL"]!==p.attrs["HDCP-LEVEL"]?(f.attrs["HDCP-LEVEL"]||"")>(p.attrs["HDCP-LEVEL"]||"")?1:-1:f.bitrate!==p.bitrate?f.bitrate-p.bitrate:f.attrs["FRAME-RATE"]!==p.attrs["FRAME-RATE"]?f.attrs.decimalFloatingPoint("FRAME-RATE")-p.attrs.decimalFloatingPoint("FRAME-RATE"):f.attrs.SCORE!==p.attrs.SCORE?f.attrs.decimalFloatingPoint("SCORE")-p.attrs.decimalFloatingPoint("SCORE"):s&&f.height!==p.height?f.height-p.height:0);let u=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length))for(let f=0;f<c.length;f++)if(c[f].pathwayId===l[0].pathwayId){u=c[f];break}this._levels=l;for(let f=0;f<l.length;f++)if(l[f]===u){this._firstLevel=f,this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${u.bitrate}`);break}const h={levels:l,audioTracks:r,subtitleTracks:i,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:a,video:o,altAudio:!(a&&!o)&&r.some(f=>!!f.url)};this.hls.trigger(y.MANIFEST_PARSED,h),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(y.ERROR,{type:X.OTHER_ERROR,details:x.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:u,reason:u.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&o.details&&i&&s===a)return;this.log(`Switching to level ${e}${a?" with Pathway "+a:""} from level ${r}${s?" with Pathway "+s:""}`);const l=dt({},o,{level:e,maxBitrate:o.maxBitrate,attrs:o.attrs,uri:o.uri,urlId:o.urlId});delete l._attrs,delete l._urlId,this.hls.trigger(y.LEVEL_SWITCHING,l);const c=o.details;if(!c||c.live){const u=this.switchParams(o.uri,i?.details);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===Ee.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragLoaded(e,{frag:t}){if(void 0!==t&&t.type===te.MAIN){const r=this._levels[t.level];void 0!==r&&(r.loadError=0)}}onLevelLoaded(e,t){var r;const{level:i,details:s}=t,o=this._levels[i];var a;if(!o)return this.warn(`Invalid level index ${i}`),void(null!=(a=t.deliveryDirectives)&&a.skip&&(s.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===o.fragmentError&&(o.loadError=0),this.playlistLoaded(i,t,o.details)):null!=(r=t.deliveryDirectives)&&r.skip&&(s.deltaUpdateFailed=!0)}onAudioTrackSwitched(e,t){const r=this.currentLevel;if(!r)return;const i=this.hls.audioTracks[t.id].groupId;if(r.audioGroupIds&&r.audioGroupId!==i){let s=-1;for(let o=0;o<r.audioGroupIds.length;o++)if(r.audioGroupIds[o]===i){s=o;break}-1!==s&&s!==r.urlId&&(r.urlId=s,this.canLoad&&this.startLoad())}}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){const i=r.urlId;let s=r.uri;if(e)try{s=e.addDirectives(s)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}const o=r.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${void 0!==e?.msn?" at sn "+e.msn+" part "+e.part:""} with${o?" Pathway "+o:""} URI ${i+1}/${r.url.length} ${s}`),this.clearTimer(),this.hls.trigger(y.LEVEL_LOADING,{url:s,level:t,id:i,deliveryDirectives:e||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e,t){const r=(s,o)=>o!==t,i=this._levels.filter((s,o)=>o!==e||(s.url.length>1&&void 0!==t?(s.url=s.url.filter(r),s.audioGroupIds&&(s.audioGroupIds=s.audioGroupIds.filter(r)),s.textGroupIds&&(s.textGroupIds=s.textGroupIds.filter(r)),s.urlId=0,!0):(this.steering&&this.steering.removeLevel(s),!1)));this.hls.trigger(y.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){t.forEach((r,i)=>{const{details:s}=r;null!=s&&s.fragments&&s.fragments.forEach(o=>{o.level=i})}),this._levels=t}}function Kc(n,e,t){t&&("audio"===e?(n.audioGroupIds||(n.audioGroupIds=[]),n.audioGroupIds[n.url.length-1]=t):"text"===e&&(n.textGroupIds||(n.textGroupIds=[]),n.textGroupIds[n.url.length-1]=t))}function Rx(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}class U${constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(y.BUFFER_APPENDED,this.onBufferAppended,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.BUFFER_APPENDED,this.onBufferAppended,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let i=r.length;i--;){const s=r[i];if(!s)break;const o=s.end;if(s.start<=e&&null!==o&&e<=o)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:r}=this,i=Object.keys(r);for(let s=i.length;s--;){const o=r[i[s]];if(o?.body.type===t&&o.buffered){const a=o.body;if(a.start<=e&&e<=a.end)return a}}return null}detectEvictedFragments(e,t,r,i){this.timeRanges&&(this.timeRanges[e]=t);const s=i?.fragment.sn||-1;Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a||s>=a.body.sn)return;if(!a.buffered&&!a.loaded)return void(a.body.type===r&&this.removeFragment(a.body));const l=a.range[e];l&&l.time.some(c=>{const u=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return u&&this.removeFragment(a.body),u})})}detectPartialFragments(e){const t=this.timeRanges,{frag:r,part:i}=e;if(!t||"initSegment"===r.sn)return;const s=ks(r),o=this.fragments[s];if(!o||o.buffered&&r.gap)return;const a=!r.relurl;Object.keys(t).forEach(l=>{const c=r.elementaryStreams[l];c&&(o.range[l]=this.getBufferedTimes(r,i,a||!0===c.partial,t[l]))}),o.loaded=null,Object.keys(o.range).length?(o.buffered=!0,(o.body.endList=r.endList||o.body.endList)&&(this.endListFragments[o.body.type]=o),zc(o)||this.removeParts(r.sn-1,r.type)):this.removeFragment(o.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter(i=>i.fragment.sn>=e))}fragBuffered(e,t){const r=ks(e);let i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,r,i){const s={time:[],partial:r},o=e.start,a=e.end,l=e.minEndPTS||a,c=e.maxStartPTS||o;for(let u=0;u<i.length;u++){const d=i.start(u)-this.bufferPadding,h=i.end(u)+this.bufferPadding;if(c>=d&&l<=h){s.time.push({startPTS:Math.max(o,i.start(u)),endPTS:Math.min(a,i.end(u))});break}if(o<h&&a>d)s.partial=!0,s.time.push({startPTS:Math.max(o,i.start(u)),endPTS:Math.min(a,i.end(u))});else if(a<=d)break}return s}getPartialFragment(e){let r,i,s,t=null,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&zc(u)&&(i=u.body.start-a,s=u.body.end+a,e>=i&&e<=s&&(r=Math.min(e-i,s-e),o<=r&&(t=u.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||zc(t))}getState(e){const t=ks(e),r=this.fragments[t];return r?r.buffered?zc(r)?"PARTIAL":"OK":"APPENDING":"NOT_LOADED"}isTimeBuffered(e,t,r){let i,s;for(let o=0;o<r.length;o++){if(i=r.start(o)-this.bufferPadding,s=r.end(o)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onFragLoaded(e,t){const{frag:r,part:i}=t;if("initSegment"===r.sn||r.bitrateTest)return;const s=i?null:t,o=ks(r);this.fragments[o]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:i,timeRanges:s}=t;if("initSegment"===r.sn)return;const o=r.type;if(i){let a=this.activePartLists[o];a||(this.activePartLists[o]=a=[]),a.push(i)}this.timeRanges=s,Object.keys(s).forEach(a=>{this.detectEvictedFragments(a,s[a],o,i)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=ks(e);return!!this.fragments[t]}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,r,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==r||i&&!l.gap||l.start<t&&l.end>e&&(a.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const t=ks(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const i=e.sn;this.activePartLists[e.type]=r.filter(s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function zc(n){var e,t,r;return n.buffered&&(n.body.gap||(null==(e=n.range.video)?void 0:e.partial)||(null==(t=n.range.audio)?void 0:t.partial)||(null==(r=n.range.audiovideo)?void 0:r.partial))}function ks(n){return`${n.type}_${n.level}_${n.urlId}_${n.sn}`}const Lx=Math.pow(2,17);class V${constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new Ir({type:X.NETWORK_ERROR,details:x.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(r?"part list":"url")),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,o=i.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(f=>"GAP"===f[0]))return void l(kx(e));e.gap=!1}const c=this.loader=e.loader=s?new s(i):new o(i),u=Fx(e),d=Ix(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:Lx};e.stats=c.stats,c.load(u,h,{onSuccess:(f,p,m,g)=>{this.resetLoader(e,c);let v=f.data;m.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(v.slice(0,16)),v=v.slice(16)),a({frag:e,part:null,payload:v,networkDetails:g})},onError:(f,p,m,g)=>{this.resetLoader(e,c),l(new Ir({type:X.NETWORK_ERROR,details:x.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:zt({url:r,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:m,stats:g}))},onAbort:(f,p,m)=>{this.resetLoader(e,c),l(new Ir({type:X.NETWORK_ERROR,details:x.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:m,stats:f}))},onTimeout:(f,p,m)=>{this.resetLoader(e,c),l(new Ir({type:X.NETWORK_ERROR,details:x.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:m,stats:f}))},onProgress:(f,p,m,g)=>{t&&t({frag:e,part:null,payload:m,networkDetails:g})}})})}loadPart(e,t,r){this.abort();const i=this.config,s=i.fLoader,o=i.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void l(kx(e,t));const c=this.loader=e.loader=s?new s(i):new o(i),u=Fx(e,t),d=Ix(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Lx};t.stats=c.stats,c.load(u,h,{onSuccess:(f,p,m,g)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const v={frag:e,part:t,payload:f.data,networkDetails:g};r(v),a(v)},onError:(f,p,m,g)=>{this.resetLoader(e,c),l(new Ir({type:X.NETWORK_ERROR,details:x.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:zt({url:u.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:m,stats:g}))},onAbort:(f,p,m)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new Ir({type:X.NETWORK_ERROR,details:x.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:m,stats:f}))},onTimeout:(f,p,m)=>{this.resetLoader(e,c),l(new Ir({type:X.NETWORK_ERROR,details:x.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:m,stats:f}))}})})}updateStatsFromPart(e,t){const r=e.stats,i=t.stats,s=i.total;if(r.loaded+=i.loaded,s){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(r.loaded/s),l),d=(l-c)*Math.round(r.loaded/c);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const o=r.loading,a=i.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Fx(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(z(i)&&z(s)){var o;let a=i,l=s;if("initSegment"===n.sn&&"AES-128"===(null==(o=n.decryptdata)?void 0:o.method)){const c=s-i;c%16&&(l=s+(16-c%16)),0!==i&&(r.resetIV=!0,a=i-16)}r.rangeStart=a,r.rangeEnd=l}return r}function kx(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:X.MEDIA_ERROR,details:x.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new Ir(r)}class Ir extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class $${constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const t in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[t].loader;if(r){if(e&&e!==r.context.frag.type)return;r.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=x.KEY_LOAD_ERROR,r,i,s){return new Ir({type:X.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:r,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:i}=e;for(let s=0;s<t.length;s++){const o=t[s];if(i<=o.cc&&("initSegment"===r||"initSegment"===o.sn||r<o.sn)){this.emeController.selectKeySystemFormat(o).then(a=>{o.setKeyFormat(a)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,x.KEY_LOAD_ERROR,c))}const o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,x.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let a=this.keyUriToKeyInfo[o];if(null!=(r=a)&&r.decryptdata.key)return s.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});var l;if(null!=(i=a)&&i.keyLoadPromise)switch(null==(l=a.mediaKeySessionContext)?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(c=>(s.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:a}))}switch(a=this.keyUriToKeyInfo[o]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===s.keyFormat?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,x.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then(s=>(e.mediaKeySessionContext=s,r))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=new(0,r.loader)(r);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=r.keyLoadPolicy.default;s.load(l,{loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},{onSuccess:(h,f,p,m)=>{const{frag:g,keyInfo:v,url:_}=p;if(!g.decryptdata||v!==this.keyUriToKeyInfo[_])return a(this.createKeyLoadError(g,x.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),m));v.decryptdata.key=g.decryptdata.key=new Uint8Array(h.data),g.keyLoader=null,v.loader=null,o({frag:g,keyInfo:v})},onError:(h,f,p,m)=>{this.resetLoader(f),a(this.createKeyLoadError(t,x.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),p,zt({url:l.url,data:void 0},h)))},onTimeout:(h,f,p)=>{this.resetLoader(f),a(this.createKeyLoadError(t,x.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(h,f,p)=>{this.resetLoader(f),a(this.createKeyLoadError(t,x.INTERNAL_ABORTED,new Error("key loading aborted"),p))}})})}resetLoader(e){const{frag:t,keyInfo:r,url:i}=e,s=r.loader;t.keyLoader===s&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],s&&s.destroy()}}class H${constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const j$={length:0,start:()=>0,end:()=>0};class Ue{static isBuffered(e,t){try{if(e){const r=Ue.getBuffered(e);for(let i=0;i<r.length;i++)if(t>=r.start(i)&&t<=r.end(i))return!0}}catch{}return!1}static bufferInfo(e,t,r){try{if(e){const i=Ue.getBuffered(e),s=[];let o;for(o=0;o<i.length;o++)s.push({start:i.start(o),end:i.end(o)});return this.bufferedInfo(s,t,r)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.sort(function(c,u){return c.start-u.start||u.end-c.end});let i=[];if(r)for(let c=0;c<e.length;c++){const u=i.length;if(u){const d=i[u-1].end;e[c].start-d<r?e[c].end>d&&(i[u-1].end=e[c].end):i.push(e[c])}else i.push(e[c])}else i=e;let o,s=0,a=t,l=t;for(let c=0;c<i.length;c++){const u=i[c].start,d=i[c].end;if(t+r>=u&&t<d)a=u,l=d,s=l-t;else if(t+r<u){o=u;break}}return{len:s,start:a||0,end:l||0,nextStart:o}}static getBuffered(e){try{return e.buffered}catch(t){return D.log("failed to get media.buffered",t),j$}}}class zp{constructor(e,t,r,i=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=s,this.partial=o}}function Ox(n,e){let t=null;for(let r=0,i=n.length;r<i;r++){const s=n[r];if(s&&s.cc===e){t=s;break}}return t}function Px(n,e){if(n){const t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function Wp(n,e){const t=e.fragments;for(let r=0,i=t.length;r<i;r++)Px(t[r],n);e.fragmentHint&&Px(e.fragmentHint,n),e.alignedSliding=!0}function Nx(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;const s=r[Math.round(r.length/2)-1],o=Ox(t,s.cc)||t[Math.round(t.length/2)-1],a=s.programDateTime,l=o.programDateTime;null!==a&&null!==l&&Wp((l-a)/1e3-(o.start-s.start),n)}class Y${constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class Q${constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class X${constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let i=0;i<4;i++)r[i]=t.getUint32(4*i);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],s=r[1],o=r[2],a=r[3],l=this.invSubMix,c=l[0],u=l[1],d=l[2],h=l[3],f=new Uint32Array(256);let p=0,m=0,g=0;for(g=0;g<256;g++)f[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let v=m^m<<1^m<<2^m<<3^m<<4;v=v>>>8^255&v^99,e[p]=v,t[v]=p;const _=f[p],b=f[_],E=f[b];let T=257*f[v]^16843008*v;i[p]=T<<24|T>>>8,s[p]=T<<16|T>>>16,o[p]=T<<8|T>>>24,a[p]=T,T=16843009*E^65537*b^257*_^16843008*p,c[v]=T<<24|T>>>8,u[v]=T<<16|T>>>16,d[v]=T<<8|T>>>24,h[v]=T,p?(p=_^f[f[f[E^_]]],m^=f[f[m]]):p=m=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,i=0;for(;i<t.length&&r;)r=t[i]===this.key[i],i++;if(r)return;this.key=t;const s=this.keySize=t.length;if(4!==s&&6!==s&&8!==s)throw new Error("Invalid aes key size="+s);const o=this.ksRows=4*(s+6+1);let a,l;const c=this.keySchedule=new Uint32Array(o),u=this.invKeySchedule=new Uint32Array(o),d=this.sBox,h=this.rcon,f=this.invSubMix,p=f[0],m=f[1],g=f[2],v=f[3];let _,b;for(a=0;a<o;a++)a<s?_=c[a]=t[a]:(b=_,a%s==0?(b=b<<8|b>>>24,b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[255&b],b^=h[a/s|0]<<24):s>6&&a%s==4&&(b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[255&b]),c[a]=_=(c[a-s]^b)>>>0);for(l=0;l<o;l++)a=o-l,b=3&l?c[a]:c[a-4],u[l]=l<4||a<=4?b:p[d[b>>>24]]^m[d[b>>>16&255]]^g[d[b>>>8&255]]^v[d[255&b]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,r){const i=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],c=a[1],u=a[2],d=a[3],h=this.uint8ArrayToUint32Array_(r);let f=h[0],p=h[1],m=h[2],g=h[3];const v=new Int32Array(e),_=new Int32Array(v.length);let b,E,T,I,C,k,N,S,K,$,ve,pt,Re,O;const B=this.networkToHostOrderSwap;for(;t<v.length;){for(K=B(v[t]),$=B(v[t+1]),ve=B(v[t+2]),pt=B(v[t+3]),C=K^s[0],k=pt^s[1],N=ve^s[2],S=$^s[3],Re=4,O=1;O<i;O++)b=l[C>>>24]^c[k>>16&255]^u[N>>8&255]^d[255&S]^s[Re],E=l[k>>>24]^c[N>>16&255]^u[S>>8&255]^d[255&C]^s[Re+1],T=l[N>>>24]^c[S>>16&255]^u[C>>8&255]^d[255&k]^s[Re+2],I=l[S>>>24]^c[C>>16&255]^u[k>>8&255]^d[255&N]^s[Re+3],C=b,k=E,N=T,S=I,Re+=4;b=o[C>>>24]<<24^o[k>>16&255]<<16^o[N>>8&255]<<8^o[255&S]^s[Re],E=o[k>>>24]<<24^o[N>>16&255]<<16^o[S>>8&255]<<8^o[255&C]^s[Re+1],T=o[N>>>24]<<24^o[S>>16&255]<<16^o[C>>8&255]<<8^o[255&k]^s[Re+2],I=o[S>>>24]<<24^o[C>>16&255]<<16^o[k>>8&255]<<8^o[255&N]^s[Re+3],_[t]=B(b^f),_[t+1]=B(I^p),_[t+2]=B(T^m),_[t+3]=B(E^g),f=K,p=$,m=ve,g=pt,t+=4}return _.buffer}}class qp{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}null===this.subtle&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function Z$(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?Si(n,0,e-t):n}(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r){return this.useSoftware?new Promise((i,s)=>{this.softwareDecrypt(new Uint8Array(e),t,r);const o=this.flush();o?i(o.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r)}softwareDecrypt(e,t,r){const{currentIV:i,currentResult:s,remainderData:o}=this;this.logOnce("JS AES decrypt"),o&&(e=Ci(o,e),this.remainderData=null);const a=this.getValidChunk(e);if(!a.length)return null;i&&(r=i);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new X$),l.expandKey(t);const c=s;return this.currentResult=l.decrypt(a.buffer,0,r),this.currentIV=Si(a,-16).buffer,c||null}webCryptoDecrypt(e,t,r){const i=this.subtle;return(this.key!==t||!this.fastAesKey)&&(this.key=t,this.fastAesKey=new Q$(i,t)),this.fastAesKey.expandKey().then(s=>i?(this.logOnce("WebCrypto AES decrypt"),new Y$(i,new Uint8Array(r)).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(D.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,r)))}onWebCryptoError(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);const i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%16;return r!==e.length&&(t=Si(e,0,r),this.remainderData=Si(e,r)),t}logOnce(e){this.logEnabled&&(D.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}class Yp extends H${constructor(e,t,r,i,s){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state="STOPPED",this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=s,this.logPrefix=i,this.log=D.log.bind(D,`${i}:`),this.warn=D.warn.bind(D,`${i}:`),this.hls=e,this.fragmentLoader=new V$(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new qp(e.config),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state="STOPPED"}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const r=t.partList;if(null!=r&&r.length){const s=r[r.length-1];return Ue.isBuffered(this.media,s.start+s.duration/2)}return this.fragmentTracker.isEndListAppended(t.fragments[t.fragments.length-1].type)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levels[this.levelLastLoaded])?void 0:e.details}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);const i=this.config;this.levels&&i.autoStartLoad&&"STOPPED"===this.state&&this.startLoad(i.startPosition)}onMediaDetaching(){const e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:r,mediaBuffer:i,state:s}=this,o=r?r.currentTime:0,a=Ue.bufferInfo(i||r,o,e.maxBufferHole);if(this.log(`media seeking to ${z(o)?o.toFixed(3):o}, state: ${s}`),"ENDED"===this.state)this.resetLoadingState();else if(t){const l=e.maxFragLookUpTolerance,c=t.start-l,u=t.start+t.duration+l;if(!a.len||u<a.start||c>a.end){const d=o>u;(o<c||d)&&(d&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(o,1/0,this.playlistType,!0),this.lastCurrentTime=o),!this.loadedmetadata&&!a.len&&(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state="STOPPED",this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){this._doFragLoad(e,t,r,s=>{if(this.fragContextChanged(e))return this.warn(`Fragment ${e.sn}${s.part?" p: "+s.part.index:""} of level ${e.level} was dropped during download.`),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(s)}).then(s=>{if(!s)return;const o=this.state;this.fragContextChanged(e)?("FRAG_LOADING"===o||!this.fragCurrent&&"PARSING"===o)&&(this.fragmentTracker.removeFragment(e),this.state="IDLE"):("payload"in s&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(y.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s))}).catch(s=>{"STOPPED"===this.state||"ERROR"===this.state||(this.warn(s),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if("APPENDING"===r.getState(e)){const o=this.getFwdBufferInfo(this.mediaBuffer,e.type),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength);this.reduceMaxBufferLength(a)&&r.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),"PARTIAL"===r.getState(e)&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,r=null){e-t&&this.hls.trigger(y.BUFFER_FLUSHING,{startOffset:e,endOffset:t,type:r})}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{if(!r||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:i}=this,{payload:s}=r,o=e.decryptdata;if(s&&s.byteLength>0&&o&&o.key&&o.iv&&"AES-128"===o.method){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(s),o.key.buffer,o.iv.buffer).catch(l=>{throw i.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:e}),l}).then(l=>{const c=self.performance.now();return i.trigger(y.FRAG_DECRYPTED,{frag:e,payload:l,stats:{tstart:a,tdecrypt:c}}),r.payload=l,r})}return r}).then(r=>{const{fragCurrent:i,hls:s,levels:o}=this;if(!o)throw new Error("init load aborted, missing levels");const a=e.stats;this.state="IDLE",t.fragmentError=0,e.data=new Uint8Array(r.payload),a.parsing.start=a.buffering.start=self.performance.now(),a.parsing.end=a.buffering.end=self.performance.now(),r.frag===i&&s.trigger(y.FRAG_BUFFERED,{stats:a,frag:i,part:null,id:e.type}),this.tick()}).catch(r=>{"STOPPED"===this.state||"ERROR"===this.state||(this.warn(r),this.resetFragmentLoading(e))})}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}fragBufferedComplete(e,t){var r,i,s,o;const a=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===te.MAIN?"level":"track"} ${e.level} (frag:[${(null!=(r=e.startPTS)?r:NaN).toFixed(3)}-${(null!=(i=e.endPTS)?i:NaN).toFixed(3)}] > buffer:${a?function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}(Ue.getBuffered(a)):"(detached)"})`),this.state="IDLE",a&&(!this.loadedmetadata&&e.type==te.MAIN&&a.buffered.length&&(null==(s=this.fragCurrent)?void 0:s.sn)===(null==(o=this.fragPrevious)?void 0:o.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:i,partsLoaded:s}=e,o=!s||0===s.length||s.some(l=>!l),a=new zp(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,i){var s;const o=t?.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(!e.encrypted||null!=(s=e.decryptdata)&&s.key?!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state="KEY_LOADING",this.fragCurrent=e,a=this.keyLoader.load(e).then(u=>{if(!this.fragContextChanged(u.frag))return this.hls.trigger(y.KEY_LOADED,u),"KEY_LOADING"===this.state&&(this.state="IDLE"),u}),this.hls.trigger(y.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){const u=o.partList;if(u&&i){r>e.end&&o.fragmentHint&&(e=o.fragmentHint);const d=this.getNextPart(u,e,r);if(d>-1){const h=u[d];let f;return this.log(`Loading part sn: ${e.sn} p: ${h.index} cc: ${e.cc} of playlist [${o.startSN}-${o.endSN}] parts [0-${d}-${u.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=h.start+h.duration,this.state="FRAG_LOADING",f=a?a.then(p=>!p||this.fragContextChanged(p.frag)?null:this.doFragPartsLoad(e,h,t,i)).catch(p=>this.handleFragLoadError(p)):this.doFragPartsLoad(e,h,t,i).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(y.FRAG_LOADING,{frag:e,part:h,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):f}if(!e.url||this.loadedEndOfParts(u,r))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${o?"of ["+o.startSN+"-"+o.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),z(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state="FRAG_LOADING";const l=this.config.progressive;let c;return c=l&&a?a.then(u=>!u||this.fragContextChanged(u?.frag)?null:this.fragmentLoader.load(e,i)).catch(u=>this.handleFragLoadError(u)):Promise.all([this.fragmentLoader.load(e,l?i:void 0),a]).then(([u])=>(!l&&u&&i&&i(u),u)).catch(u=>this.handleFragLoadError(u)),this.hls.trigger(y.FRAG_LOADING,{frag:e,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,r,i){return new Promise((s,o)=>{var a;const l=[],c=null==(a=r.details)?void 0:a.partList,u=d=>{this.fragmentLoader.loadPart(e,d,i).then(h=>{l[d.index]=h;const f=h.part;this.hls.trigger(y.FRAG_LOADED,h);const p=Cx(r,e.sn,d.index+1)||Ax(c,e.sn,d.index+1);if(!p)return s({frag:e,part:f,partsLoaded:l});u(p)}).catch(o)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===x.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(y.ERROR,t)}else this.hls.trigger(y.ERROR,{type:X.OTHER_ERROR,details:x.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||"PARSING"!==this.state)return void(!this.fragCurrent&&"STOPPED"!==this.state&&"ERROR"!==this.state&&(this.state="IDLE"));const{frag:r,part:i,level:s}=t,o=self.performance.now();r.stats.parsing.end=o,i&&(i.stats.parsing.end=o),this.updateLevelTiming(r,i,s,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:i,sn:s,part:o}=e;if(null==t||!t[i])return this.warn(`Levels object was unset while buffering fragment ${s} of level ${i}. The current chunk will not be buffered.`),null;const a=t[i],l=o>-1?Cx(a,s,o):null,c=l?l.fragment:function M$(n,e,t){if(null==n||!n.details)return null;const r=n.details;let i=r.fragments[e-r.startSN];return i||(i=r.fragmentHint,i&&i.sn===e)?i:e<r.startSN&&t&&t.sn===e?t:null}(a,s,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:l,level:a}):null}bufferFragmentData(e,t,r,i,s){var o;if(!e||"PARSING"!==this.state)return;const{data1:a,data2:l}=e;let c=a;if(a&&l&&(c=Ci(a,l)),null!=(o=c)&&o.length&&(this.hls.trigger(y.BUFFER_APPENDING,{type:e.type,frag:t,part:r,chunkMeta:i,parent:t.type,data:c}),e.dropped&&e.independent&&!r)){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ue.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const r=t.currentTime,i=Ue.bufferInfo(t,r,0),o=Math.min(2*this.config.maxFragLookUpTolerance,.25*e.duration),a=Math.max(Math.min(e.start-o,i.end-o),r+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){const r=this.getLoadPosition();return z(r)?this.getFwdBufferInfoAtPos(e,r,t):null}getFwdBufferInfoAtPos(e,t,r){const{config:{maxBufferHole:i}}=this,s=Ue.bufferInfo(e,t,i);if(0===s.len&&void 0!==s.nextStart){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&s.nextStart<o.end)return Ue.bufferInfo(e,t,Math.max(s.nextStart,i))}return s}getMaxBufferLength(e){const{config:t}=this;let r;return r=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config;return t.maxMaxBufferLength>=(e||t.maxBufferLength)&&(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0)}getAppendedFrag(e,t=te.MAIN){const r=this.fragmentTracker.getAppendedFrag(e,te.MAIN);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,i=r.length;if(!i)return null;const{config:s}=this,o=r[0].start;let a;if(t.live){const l=s.initialLiveManifestSize;if(i<l)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${l})`),null;!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition&&(a=this.getInitialLiveFragment(t,r),this.startPosition=a?this.hls.liveSyncPosition||a.start:e)}else e<=o&&(a=r[0]);return a||(a=this.getFragmentAtPosition(e,s.lowLatencyMode?t.partEnd:t.fragmentEnd,t)),this.mapToInitFragWhenRequired(a)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return("OK"===r||"PARTIAL"===r&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,i,s){const o=e.gap,a=this.getNextFragment(this.nextLoadPosition,t);if(null===a)return a;if(e=a,o&&e&&!e.gap&&r.nextStart){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,i);if(null!==l&&r.len+l.len>=s)return this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,r){let i=-1,s=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const c=e[a];if(o=o&&!c.independent,i>-1&&r<c.start)break;const u=c.loaded;u?i=-1:(s||c.independent||o)&&c.fragment===t&&(i=a),s=u}return i}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){const r=this.fragPrevious;let i=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),i=function L$(n,e,t){if(null===e||!Array.isArray(n)||!n.length||!z(e))return null;if(e<(n[0].programDateTime||0))return null;if(e>=(n[n.length-1].endProgramDateTime||0))return null;t=t||0;for(let s=0;s<n.length;++s){const o=n[s];if(F$(e,t,o))return o}return null}(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=r.sn+1;if(s>=e.startSN&&s<=e.endSN){const o=t[s-e.startSN];r.cc===o.cc&&(i=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=function k$(n,e){return Mx.search(n,t=>t.cc<e?1:t.cc>e?-1:0)}(t,r.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;null!==s&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,r){const{config:i}=this;let{fragPrevious:s}=this,{fragments:o,endSN:a}=r;const{fragmentHint:l}=r,c=i.maxFragLookUpTolerance,u=r.partList,d=!!(i.lowLatencyMode&&null!=u&&u.length&&l);let h;if(d&&l&&!this.bitrateTest&&(o=o.concat(l),a=l.sn),h=e<t?ha(s,o,e,e>t-c?0:c):o[o.length-1],h){const f=h.sn-r.startSN,p=this.fragmentTracker.getState(h);if(("OK"===p||"PARTIAL"===p&&h.gap)&&(s=h),s&&h.sn===s.sn&&(!d||u[0].fragment.sn>h.sn)&&s&&h.level===s.level){const g=o[f+1];h=h.sn<a&&"OK"!==this.fragmentTracker.getState(g)?g:null}}return h}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const i=this.hls.liveSyncPosition,s=r.currentTime,a=e.edge,l=s>=e.fragments[0].start-t.maxFragLookUpTolerance&&s<=a;null!==i&&r.duration>i&&(s<i||!l)&&(!l&&r.readyState<4||s<a-(void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration))&&(this.loadedmetadata||(this.nextLoadPosition=i),r.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${i.toFixed(3)}`),r.currentTime=i))}alignPlaylists(e,t){const{levels:r,levelLastLoaded:i,fragPrevious:s}=this,o=null!==i?r[i]:null,a=e.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;const l=e.fragments[0].start,c=!t,u=e.alignedSliding&&z(l);if(c||!u&&!l){!function z$(n,e,t){e&&(function W$(n,e,t){if(function G$(n,e,t){return!(!e.details||!(t.endCC>t.startCC||n&&n.cc<t.startCC))}(n,t,e)){const r=function K$(n,e,t=0){const r=n.fragments,i=e.fragments;if(!i.length||!r.length)return void D.log("No fragments to align");const s=Ox(r,i[0].cc);if(s&&(!s||s.startPTS))return s;D.log("No frag in previous level to align on")}(t.details,e);r&&z(r.start)&&(D.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),Wp(r.start,e))}}(n,t,e),!t.alignedSliding&&e.details&&function q$(n,e){if(!e.fragments.length||!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=e.fragments[0].programDateTime,r=n.fragments[0].programDateTime,i=(r-t)/1e3+e.fragments[0].start;i&&z(i)&&(D.log(`Adjusting PTS using programDateTime delta ${r-t}ms, sliding:${i.toFixed(3)} ${n.url} `),Wp(i,n))}(t,e.details),!t.alignedSliding&&e.details&&!t.skippedSegments&&Sx(e.details,t))}(s,o,e);const d=e.fragments[0].start;return this.log(`Live playlist sliding: ${d.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${s?s.sn:"na"} fragments: ${a}`),d}return l}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){const i=null!==this.startTimeOffset,s=i?this.startTimeOffset:e.startTimeOffset;null!==s&&z(s)?(r=t+s,s<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Start time offset ${s} found in ${i?"multivariant":"media"} playlist, adjust startPosition to ${r}`),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&"FRAG_LOADING_WAITING_RETRY"!==this.state)&&(this.state="IDLE")}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const d=this.getCurrentContext(t.chunkMeta);d&&(t.frag=d.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;var i;if(this.fragContextChanged(r))return void this.warn(`Frag load error must match current frag to retry ${r.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);const s=t.details===x.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(r,!0);const o=t.errorAction,{action:a,retryCount:l=0,retryConfig:c}=o||{};if(o&&5===a&&c){var u;this.resetStartWhenNotLoaded(null!=(u=this.levelLastLoaded)?u:r.level);const d=Hp(c,l);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${l+1}/${c.maxNumRetry} in ${d}ms`),o.resolved=!0,this.retryDate=self.performance.now()+d,this.state="FRAG_LOADING_WAITING_RETRY"}else c&&o?(this.resetFragmentErrors(e),l<c.maxNumRetry?s||(o.resolved=!0):D.warn(`${t.details} reached or exceeded max retry (${l})`)):this.state=2===o?.action?"WAITING_LEVEL":"ERROR";this.tickImmediate()}reduceLengthAndFlushBuffer(e){if("PARSING"===this.state||"PARSED"===this.state){const t=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,t),i=r&&r.len>.5;i&&this.reduceMaxBufferLength(r.len);const s=!i;return s&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(e){e===te.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),"STOPPED"!==this.state&&(this.state="IDLE")}afterBufferFlushed(e,t,r){if(!e)return;const i=Ue.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),"ENDED"===this.state&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state="IDLE"}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=this.levels?this.levels[e].details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){var t;this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(null!=(t=this.levelLastLoaded)?t:e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,i){var s;const o=r.details;if(o){if(Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const d=u.endPTS-u.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${d})`),l||!1;const h=i?0:xx(o,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS);return this.hls.trigger(y.LEVEL_PTS_UPDATED,{details:o,level:r,drift:h,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1))r.fragmentError=0;else if(null===(null==(s=this.transmuxer)?void 0:s.error)){const l=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(0===r.fragmentError&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(l.message),this.hls.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of level "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state="PARSED",this.hls.trigger(y.FRAG_PARSED,{frag:e,part:t})}else this.warn("level.details undefined")}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){var t,r,i;"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(null!=(t=null!=(r=this.levelLastLoaded)?r:null==(i=this.fragCurrent)?void 0:i.level)?t:0),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Bx(){return self.SourceBuffer||self.WebKitSourceBuffer}function or(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Ux{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Ci(this.cachedData,e),this.cachedData=null);let s,r=Nc(e,0),i=r?r.length:0;const o=this._audioTrack,a=this._id3Track,l=r?(n=>{const e=XT(n);for(let t=0;t<e.length;t++){const r=e[t];if(ZT(r))return WV(r)}})(r):void 0,c=e.length;for((null===this.basePTS||0===this.frameIndex&&z(l))&&(this.basePTS=o8(l,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:"org.id3",duration:Number.POSITIVE_INFINITY});i<c;){if(this.canParse(e,i)){const u=this.appendFrame(o,e,i);u?(this.frameIndex++,this.lastPTS=u.sample.pts,i+=u.length,s=i):i=c}else VV(e,i)?(r=Nc(e,i),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:"org.id3",duration:Number.POSITIVE_INFINITY}),i+=r.length,s=i):i++;if(i===c&&s!==c){const u=Si(e,s);this.cachedData=this.cachedData?Ci(this.cachedData,u):u}}return{audioTrack:o,videoTrack:or(),id3Track:a,textTrack:or()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:or(),id3Track:this._id3Track,textTrack:or()}}destroy(){}}const o8=(n,e,t)=>z(n)?90*n:9e4*e+(t?9e4*t.baseTime/t.timescale:0);function Vx(n,e){return 255===n[e]&&240==(246&n[e+1])}function $x(n,e){return 1&n[e+1]?7:9}function Qp(n,e){return(3&n[e+3])<<11|n[e+4]<<3|(224&n[e+5])>>>5}function qc(n,e){return e+1<n.length&&Vx(n,e)}function u8(n,e){if(qc(n,e)){const t=$x(n,e);if(e+t>=n.length)return!1;const r=Qp(n,e);if(r<=t)return!1;const i=e+r;return i===n.length||qc(n,i)}return!1}function Hx(n,e,t,r,i){if(!n.samplerate){const s=function a8(n,e,t,r){let i,s,o,a;const l=navigator.userAgent.toLowerCase(),c=r,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=1+((192&e[t+2])>>>6);const d=(60&e[t+2])>>>2;if(!(d>u.length-1))return o=(1&e[t+2])<<2,o|=(192&e[t+3])>>>6,D.log(`manifest codec:${r}, ADTS type:${i}, samplingIndex:${d}`),/firefox/i.test(l)?d>=6?(i=5,a=new Array(4),s=d-3):(i=2,a=new Array(2),s=d):-1!==l.indexOf("android")?(i=2,a=new Array(2),s=d):(i=5,a=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&d>=6?s=d-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(d>=6&&1===o||/vivaldi/i.test(l))||!r&&1===o)&&(i=2,a=new Array(2)),s=d)),a[0]=i<<3,a[0]|=(14&d)>>1,a[1]|=(1&d)<<7,a[1]|=o<<3,5===i&&(a[1]|=(14&s)>>1,a[2]=(1&s)<<7,a[2]|=8,a[3]=0),{config:a,samplerate:u[d],channelCount:o,codec:"mp4a.40."+i,manifestCodec:c};n.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${d}`})}(e,t,r,i);if(!s)return;n.config=s.config,n.samplerate=s.samplerate,n.channelCount=s.channelCount,n.codec=s.codec,n.manifestCodec=s.manifestCodec,D.log(`parsed codec:${n.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function jx(n){return 9216e4/n}function Gx(n,e,t,r,i){const o=r+i*jx(n.samplerate),a=function d8(n,e){const t=$x(n,e);if(e+t<=n.length){const r=Qp(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}(e,t);let l;if(a){const{frameLength:d,headerLength:h}=a,f=h+d,p=Math.max(0,t+f-e.length);p?(l=new Uint8Array(f-h),l.set(e.subarray(t+h,e.length),0)):l=e.subarray(t+h,t+f);const m={unit:l,pts:o};return p||n.samples.push(m),{sample:m,length:f,missing:p}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:c,missing:-1}}const f8=/\/emsg[-/]ID3/i;let Yc=null;const m8=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],g8=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],y8=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],v8=[0,1,1,4];function Kx(n,e,t,r,i){if(t+24>e.length)return;const s=zx(e,t);if(s&&t+s.frameLength<=e.length){const a=r+i*(9e4*s.samplesPerFrame/s.sampleRate),l={unit:e.subarray(t,t+s.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function zx(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,i=n[e+2]>>4&15,s=n[e+2]>>2&3;if(1!==t&&0!==i&&15!==i&&3!==s){const a=n[e+3]>>6,c=1e3*m8[14*(3===t?3-r:3===r?3:4)+i-1],d=g8[3*(3===t?0:2===t?1:2)+s],h=3===a?1:2,f=y8[t][r],p=v8[r],m=8*f*p,g=Math.floor(f*c/d+(n[e+2]>>1&1))*p;if(null===Yc){const b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Yc=b?parseInt(b[1]):0}return!!Yc&&Yc<=87&&2===r&&c>=224e3&&0===a&&(n[e+3]=128|n[e+3]),{sampleRate:d,channelCount:h,frameLength:g,samplesPerFrame:m}}}function Zp(n,e){return 255===n[e]&&224==(224&n[e+1])&&0!=(6&n[e+1])}function Wx(n,e){return e+1<n.length&&Zp(n,e)}function _8(n,e){if(e+1<n.length&&Zp(n,e)){const r=zx(n,e);let i=4;null!=r&&r.frameLength&&(i=r.frameLength);const s=e+i;return s===n.length||Wx(n,s)}return!1}class qx{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(0===s)throw new Error("no bytes available");i.set(e.subarray(r,r+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*s,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&D.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let i,t=8,r=8;for(let s=0;s<e;s++)0!==r&&(i=this.readEG(),r=(t+i+256)%256),t=0===r?t:r}readSPS(){let s,o,a,e=0,t=0,r=0,i=0;const l=this.readUByte.bind(this),c=this.readBits.bind(this),u=this.readUEG.bind(this),d=this.readBoolean.bind(this),h=this.skipBits.bind(this),f=this.skipEG.bind(this),p=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);l();const g=l();if(c(5),h(3),l(),p(),100===g||110===g||122===g||244===g||44===g||83===g||86===g||118===g||128===g){const I=u();if(3===I&&h(1),p(),p(),h(1),d())for(o=3!==I?8:12,a=0;a<o;a++)d()&&m(a<6?16:64)}p();const v=u();if(0===v)u();else if(1===v)for(h(1),f(),f(),s=u(),a=0;a<s;a++)f();p(),h(1);const _=u(),b=u(),E=c(1);0===E&&h(1),h(1),d()&&(e=u(),t=u(),r=u(),i=u());let T=[1,1];if(d()&&d())switch(l()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[l()<<8|l(),l()<<8|l()]}return{width:Math.ceil(16*(_+1)-2*e-2*t),height:(2-E)*(b+1)*16-(E?2:4)*(r+i),pixelRatio:T}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class E8{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new qp(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,r){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);i.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,r),this.decrypter.isSync())))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)r.set(e.subarray(s,s+16),i);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(r.subarray(i,i+16),s);return e}decryptAvcSample(e,t,r,i,s){const o=ox(s.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,i)})}decryptAvcSamples(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void i();const s=e[t].units;for(;!(r>=s.length);r++){const o=s[r];if(!(o.data.length<=48||1!==o.type&&5!==o.type||(this.decryptAvcSample(e,t,r,i,o),this.decrypter.isSync())))return}}}}const Mt=188;class qr{constructor(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}static probe(e){const t=qr.syncOffset(e);return t>0&&D.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(e){const t=e.length;let r=Math.min(940,e.length-Mt)+1,i=0;for(;i<r;){let s=!1,o=-1,a=0;for(let l=i;l<t;l+=Mt){if(71!==e[l]){if(a)return-1;break}if(a++,-1===o&&(o=l,0!==o&&(r=Math.min(o+18612,e.length-Mt)+1)),s||(s=0===Xp(e,l)),s&&a>1&&(0===o&&a>2||l+Mt>r))return o}i++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:JT[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=qr.createTrack("video"),this._audioTrack=qr.createTrack("audio",i),this._id3Track=qr.createTrack("id3"),this._txtTrack=qr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_avcTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(e,t,r=!1,i=!1){let s;r||(this.sampleAes=null);const o=this._avcTrack,a=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=o.pid,d=o.pesData,h=a.pid,f=l.pid,p=a.pesData,m=l.pesData,g=null,v=this.pmtParsed,_=this._pmtId,b=e.length;if(this.remainderData&&(b=(e=Ci(this.remainderData,e)).length,this.remainderData=null),b<Mt&&!i)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};const E=Math.max(0,qr.syncOffset(e));b-=(b-E)%Mt,b<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,b,e.buffer.byteLength-b));let T=0;for(let C=E;C<b;C+=Mt)if(71===e[C]){const k=!!(64&e[C+1]),N=Xp(e,C);let K;if((48&e[C+3])>>4>1){if(K=C+5+e[C+4],K===C+Mt)continue}else K=C+4;switch(N){case u:k&&(d&&(s=Os(d))&&this.parseAVCPES(o,c,s,!1),d={data:[],size:0}),d&&(d.data.push(e.subarray(K,C+Mt)),d.size+=C+Mt-K);break;case h:if(k){if(p&&(s=Os(p)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s)}p={data:[],size:0}}p&&(p.data.push(e.subarray(K,C+Mt)),p.size+=C+Mt-K);break;case f:k&&(m&&(s=Os(m))&&this.parseID3PES(l,s),m={data:[],size:0}),m&&(m.data.push(e.subarray(K,C+Mt)),m.size+=C+Mt-K);break;case 0:k&&(K+=e[K]+1),_=this._pmtId=D8(e,K);break;case _:{k&&(K+=e[K]+1);const $=T8(e,K,this.typeSupported,r);u=$.avc,u>0&&(o.pid=u),h=$.audio,h>0&&(a.pid=h,a.segmentCodec=$.segmentCodec),f=$.id3,f>0&&(l.pid=f),null!==g&&!v&&(D.warn(`MPEG-TS PMT found at ${C} after unknown PID '${g}'. Backtracking to sync byte @${E} to parse all TS packets.`),g=null,C=E-188),v=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=N}}else T++;if(T>0){const C=new Error(`Found ${T} TS packet/s that do not start with 0x47`);this.observer.emit(y.ERROR,y.ERROR,{type:X.MEDIA_ERROR,details:x.FRAG_PARSING_ERROR,fatal:!1,error:C,reason:C.message})}o.pesData=d,a.pesData=p,l.pesData=m;const I={audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};return i&&this.extractRemainingSamples(I),I}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:i,textTrack:s}=e,o=r.pesData,a=t.pesData,l=i.pesData;let c;if(o&&(c=Os(o))?(this.parseAVCPES(r,s,c,!0),r.pesData=null):r.pesData=o,a&&(c=Os(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c)}t.pesData=null}else null!=a&&a.size&&D.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(c=Os(l))?(this.parseID3PES(i,c),i.pesData=null):i.pesData=l}demuxSampleAes(e,t,r){const i=this.demux(e,r,!0,!this.config.progressive),s=this.sampleAes=new E8(this.observer,this.config,t);return this.decrypt(i,s)}decrypt(e,t){return new Promise(r=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{r(e)}):r(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{r(e)})})}destroy(){this._duration=0}parseAVCPES(e,t,r,i){const s=this.parseAVCNALu(e,r.data);let a,o=this.avcSample,l=!1;r.data=null,o&&s.length&&!e.audFound&&(fa(o,e),o=this.avcSample=Qc(!1,r.pts,r.dts,"")),s.forEach(c=>{var u;switch(c.type){case 1:{let h=!1;a=!0;const f=c.data;if(l&&f.length>4){const p=new qx(f).readSliceType();(2===p||4===p||7===p||9===p)&&(h=!0)}var d;h&&null!=(d=o)&&d.frame&&!o.key&&(fa(o,e),o=this.avcSample=null),o||(o=this.avcSample=Qc(!0,r.pts,r.dts,"")),o.frame=!0,o.key=h;break}case 5:a=!0,null!=(u=o)&&u.frame&&!o.key&&(fa(o,e),o=this.avcSample=null),o||(o=this.avcSample=Qc(!0,r.pts,r.dts,"")),o.key=!0,o.frame=!0;break;case 6:a=!0,sx(c.data,1,r.pts,t.samples);break;case 7:if(a=!0,l=!0,!e.sps){const h=c.data,p=new qx(h).readSPS();e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.sps=[h],e.duration=this._duration;const m=h.subarray(1,4);let g="avc1.";for(let v=0;v<3;v++){let _=m[v].toString(16);_.length<2&&(_="0"+_),g+=_}e.codec=g}break;case 8:a=!0,e.pps||(e.pps=[c.data]);break;case 9:a=!1,e.audFound=!0,o&&fa(o,e),o=this.avcSample=Qc(!1,r.pts,r.dts,"");break;case 12:a=!0;break;default:a=!1,o&&(o.debug+="unknown NAL "+c.type+" ")}o&&a&&o.units.push(c)}),i&&o&&(fa(o,e),this.avcSample=null)}getLastNalUnit(e){var t;let i,r=this.avcSample;if((!r||0===r.units.length)&&(r=e[e.length-1]),null!=(t=r)&&t.units){const s=r.units;i=s[s.length-1]}return i}parseAVCNALu(e,t){const r=t.byteLength;let i=e.naluState||0;const s=i,o=[];let l,c,u,a=0,d=-1,h=0;for(-1===i&&(d=0,h=31&t[0],i=0,a=1);a<r;)if(l=t[a++],i)if(1!==i)if(l)if(1===l){if(d>=0){const f={data:t.subarray(d,a-i-1),type:h};o.push(f)}else{const f=this.getLastNalUnit(e.samples);if(f&&(s&&a<=4-s&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-s)),c=a-i-1,c>0)){const p=new Uint8Array(f.data.byteLength+c);p.set(f.data,0),p.set(t.subarray(0,c),f.data.byteLength),f.data=p,f.state=0}}a<r?(u=31&t[a],d=a,h=u,i=0):i=-1}else i=0;else i=3;else i=l?0:2;else i=l?0:1;if(d>=0&&i>=0){const f={data:t.subarray(d,r),type:h,state:i};o.push(f)}if(0===o.length){const f=this.getLastNalUnit(e.samples);if(f){const p=new Uint8Array(f.data.byteLength+t.byteLength);p.set(f.data,0),p.set(t,f.data.byteLength),f.data=p}}return e.naluState=i,o}parseAACPES(e,t){let r=0;const i=this.aacOverFlow;let o,a,l,s=t.data;if(i){this.aacOverFlow=null;const d=i.missing,h=i.sample.unit.byteLength;if(-1===d){const f=new Uint8Array(h+s.byteLength);f.set(i.sample.unit,0),f.set(s,h),s=f}else{const f=h-d;i.sample.unit.set(s.subarray(0,d),f),e.samples.push(i.sample),r=i.missing}}for(o=r,a=s.length;o<a-1&&!qc(s,o);o++);if(o!==r){let d;const h=o<a-1;d=h?`AAC PES did not start with ADTS header,offset:${o}`:"No ADTS header found in AAC PES";const f=new Error(d);if(D.warn(`parsing error: ${d}`),this.observer.emit(y.ERROR,y.ERROR,{type:X.MEDIA_ERROR,details:x.FRAG_PARSING_ERROR,fatal:!1,levelRetry:h,error:f,reason:d}),!h)return}if(Hx(e,this.observer,s,o,this.audioCodec),void 0!==t.pts)l=t.pts;else{if(!i)return void D.warn("[tsdemuxer]: AAC PES unknown PTS");{const d=jx(e.samplerate);l=i.sample.pts+d}}let u,c=0;for(;o<a;){if(u=Gx(e,s,o,l,c),o+=u.length,u.missing){this.aacOverFlow=u;break}for(c++;o<a-1&&!qc(s,o);o++);}}parseMPEGPES(e,t){const r=t.data,i=r.length;let s=0,o=0;const a=t.pts;if(void 0!==a)for(;o<i;)if(Wx(r,o)){const l=Kx(e,r,o,a,s);if(!l)break;o+=l.length,s++}else o++;else D.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseID3PES(e,t){if(void 0===t.pts)return void D.warn("[tsdemuxer]: ID3 PES unknown PTS");const r=dt({},t,{type:this._avcTrack?Vn_emsg:"org.id3",duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function Qc(n,e,t,r){return{key:n,frame:!1,pts:e,dts:t,units:[],debug:r,length:0}}function Xp(n,e){return((31&n[e+1])<<8)+n[e+2]}function D8(n,e){return(31&n[e+10])<<8|n[e+11]}function T8(n,e,t,r){const i={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},o=e+3+((15&n[e+1])<<8|n[e+2])-4;for(e+=12+((15&n[e+10])<<8|n[e+11]);e<o;){const l=Xp(n,e);switch(n[e]){case 207:if(!r){D.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===i.audio&&(i.audio=l);break;case 21:-1===i.id3&&(i.id3=l);break;case 219:if(!r){D.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===i.avc&&(i.avc=l);break;case 3:case 4:!0!==t.mpeg&&!0!==t.mp3?D.log("MPEG audio found, not supported in this browser"):-1===i.audio&&(i.audio=l,i.segmentCodec="mp3");break;case 36:D.warn("Unsupported HEVC stream type found")}e+=5+((15&n[e+3])<<8|n[e+4])}return i}function Os(n){let t,r,i,s,o,e=0;const a=n.data;if(!n||0===n.size)return null;for(;a[0].length<19&&a.length>1;){const c=new Uint8Array(a[0].length+a[1].length);c.set(a[0]),c.set(a[1],a[0].length),a[0]=c,a.splice(1,1)}if(t=a[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(r=(t[4]<<8)+t[5],r&&r>n.size-6)return null;const c=t[7];192&c&&(s=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&c?(o=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,s-o>54e5&&(D.warn(`${Math.round((s-o)/9e4)}s delta between PTS and DTS, align them`),s=o)):o=s),i=t[8];let u=i+9;if(n.size<=u)return null;n.size-=u;const d=new Uint8Array(n.size);for(let h=0,f=a.length;h<f;h++){t=a[h];let p=t.byteLength;if(u){if(u>p){u-=p;continue}t=t.subarray(u),p-=u,u=0}d.set(t,e),e+=p}return r&&(r-=i+3),{data:d,pts:s,dts:o,len:r}}return null}function fa(n,e){if(n.units.length&&n.frame){if(void 0===n.pts){const t=e.samples,r=t.length;if(!r)return void e.dropped++;{const i=t[r-1];n.pts=i.pts,n.dts=i.dts}}e.samples.push(n)}n.debug.length&&D.log(n.pts+"/"+n.dts+":"+n.debug)}class Yx{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const Yr=Math.pow(2,32)-1;let Ps=(()=>{class n{static init(){let t;for(t in n.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},n.types)n.types.hasOwnProperty(t)&&(n.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);n.HDLR_TYPES={video:r,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);n.STTS=n.STSC=n.STCO=o,n.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),n.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),n.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),n.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);n.FTYP=n.box(n.types.ftyp,a,c,a,l),n.DINF=n.box(n.types.dinf,n.box(n.types.dref,s))}static box(t,...r){let i=8,s=r.length;const o=s;for(;s--;)i+=r[s].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(t,4),s=0,i=8;s<o;s++)a.set(r[s],i),i+=r[s].byteLength;return a}static hdlr(t){return n.box(n.types.hdlr,n.HDLR_TYPES[t])}static mdat(t){return n.box(n.types.mdat,t)}static mdhd(t,r){r*=t;const i=Math.floor(r/(Yr+1)),s=Math.floor(r%(Yr+1));return n.box(n.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s,85,196,0,0]))}static mdia(t){return n.box(n.types.mdia,n.mdhd(t.timescale,t.duration),n.hdlr(t.type),n.minf(t))}static mfhd(t){return n.box(n.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}static minf(t){return n.box(n.types.minf,"audio"===t.type?n.box(n.types.smhd,n.SMHD):n.box(n.types.vmhd,n.VMHD),n.DINF,n.stbl(t))}static moof(t,r,i){return n.box(n.types.moof,n.mfhd(t),n.traf(i,r))}static moov(t){let r=t.length;const i=[];for(;r--;)i[r]=n.trak(t[r]);return n.box.apply(null,[n.types.moov,n.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(n.mvex(t)))}static mvex(t){let r=t.length;const i=[];for(;r--;)i[r]=n.trex(t[r]);return n.box.apply(null,[n.types.mvex,...i])}static mvhd(t,r){r*=t;const i=Math.floor(r/(Yr+1)),s=Math.floor(r%(Yr+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n.box(n.types.mvhd,o)}static sdtp(t){const r=t.samples||[],i=new Uint8Array(4+r.length);let s,o;for(s=0;s<r.length;s++)o=r[s].flags,i[s+4]=o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy;return n.box(n.types.sdtp,i)}static stbl(t){return n.box(n.types.stbl,n.stsd(t),n.box(n.types.stts,n.STTS),n.box(n.types.stsc,n.STSC),n.box(n.types.stsz,n.STSZ),n.box(n.types.stco,n.STCO))}static avc1(t){let s,o,a,r=[],i=[];for(s=0;s<t.sps.length;s++)o=t.sps[s],a=o.byteLength,r.push(a>>>8&255),r.push(255&a),r=r.concat(Array.prototype.slice.call(o));for(s=0;s<t.pps.length;s++)o=t.pps[s],a=o.byteLength,i.push(a>>>8&255),i.push(255&a),i=i.concat(Array.prototype.slice.call(o));const l=n.box(n.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(i))),c=t.width,u=t.height,d=t.pixelRatio[0],h=t.pixelRatio[1];return n.box(n.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,n.box(n.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),n.box(n.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,h>>24,h>>16&255,h>>8&255,255&h])))}static esds(t){const r=t.config.length;return new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t.config).concat([6,1,2]))}static mp4a(t){const r=t.samplerate;return n.box(n.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),n.box(n.types.esds,n.esds(t)))}static mp3(t){const r=t.samplerate;return n.box(n.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))}static stsd(t){return n.box(n.types.stsd,n.STSD,"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?n.mp3(t):n.mp4a(t):n.avc1(t))}static tkhd(t){const r=t.id,i=t.duration*t.timescale,s=t.width,o=t.height,a=Math.floor(i/(Yr+1)),l=Math.floor(i%(Yr+1));return n.box(n.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,o>>8&255,255&o,0,0]))}static traf(t,r){const i=n.sdtp(t),s=t.id,o=Math.floor(r/(Yr+1)),a=Math.floor(r%(Yr+1));return n.box(n.types.traf,n.box(n.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),n.box(n.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])),n.trun(t,i.length+16+20+8+16+8+8),i)}static trak(t){return t.duration=t.duration||4294967295,n.box(n.types.trak,n.tkhd(t),n.mdia(t))}static trex(t){const r=t.id;return n.box(n.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,r){const i=t.samples||[],s=i.length,o=12+16*s,a=new Uint8Array(o);let l,c,u,d,h,f;for(a.set(["video"===t.type?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,255&s,(r+=8+o)>>>24&255,r>>>16&255,r>>>8&255,255&r],0),l=0;l<s;l++)c=i[l],u=c.duration,d=c.size,h=c.flags,f=c.cts,a.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,d>>>24&255,d>>>16&255,d>>>8&255,255&d,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*l);return n.box(n.types.trun,a)}static initSegment(t){n.types||n.init();const r=n.moov(t),i=new Uint8Array(n.FTYP.byteLength+r.byteLength);return i.set(n.FTYP),i.set(r,n.FTYP.byteLength),i}}return n.types=void 0,n.HDLR_TYPES=void 0,n.STTS=void 0,n.STSC=void 0,n.STCO=void 0,n.STSZ=void 0,n.VMHD=void 0,n.SMHD=void 0,n.STSD=void 0,n.FTYP=void 0,n.DINF=void 0,n})();const Qx=9e4;function Jp(n,e,t=1,r=!1){const i=n*e*t;return r?Math.round(i):i}function pa(n,e=!1){return Jp(n,1e3,1/Qx,e)}let Mr,Zc=null,em=null;class tm{constructor(e,t,r,i=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===Zc){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Zc=o?parseInt(o[1]):0}if(null===em){const s=navigator.userAgent.match(/Safari\/(\d+)/i);em=s?parseInt(s[1]):0}}destroy(){}resetTimeStamp(e){D.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){D.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){D.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let t=!1;const r=e.reduce((i,s)=>{const o=s.pts-i;return o<-4294967296?(t=!0,Dn(i,s.pts)):o>0?i:s.pts},e[0].pts);return t&&D.debug("PTS rollover detected"),r}remux(e,t,r,i,s,o,a,l){let c,u,d,h,f,p,m=s,g=s;const _=t.pid>-1,b=t.samples.length,E=e.samples.length>0,T=a&&b>0||b>1;if((!(e.pid>-1)||E)&&(!_||T)||this.ISGenerated||a){this.ISGenerated||(d=this.generateIS(e,t,s,o));const C=this.isVideoContiguous;let N,k=-1;if(T&&(k=function I8(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}(t.samples),!C&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,k>0){D.warn(`[mp4-remuxer]: Dropped ${k} out of ${b} video samples due to a missing keyframe`);const S=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(k),t.dropped+=k,g+=(t.samples[0].pts-S)/t.inputTimeScale,N=g}else-1===k&&(D.warn(`[mp4-remuxer]: No keyframe found out of ${b} video samples`),p=!1);if(this.ISGenerated){if(E&&T){const S=this.getVideoStartPts(t.samples),$=(Dn(e.samples[0].pts,S)-S)/t.inputTimeScale;m+=Math.max(0,$),g+=Math.max(0,-$)}if(E){if(e.samplerate||(D.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,s,o)),u=this.remuxAudio(e,m,this.isAudioContiguous,o,_||T||l===te.AUDIO?g:void 0),T){const S=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(D.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,s,o)),c=this.remuxVideo(t,g,C,S)}}else T&&(c=this.remuxVideo(t,g,C,0));c&&(c.firstKeyFrame=k,c.independent=-1!==k,c.firstKeyFramePTS=N)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(f=Xx(r,s,this._initPTS,this._initDTS)),i.samples.length&&(h=Jx(i,s,this._initPTS))),{audio:u,video:c,initSegment:d,independent:p,text:h,id3:f}}generateIS(e,t,r,i){const s=e.samples,o=t.samples,a=this.typeSupported,l={},c=this._initPTS;let h,f,p,u=!c||i,d="audio/mp4";if(u&&(h=f=1/0),e.config&&s.length&&("mp3"===(e.timescale=e.samplerate,e.segmentCodec)&&(a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3")),l.audio={id:"audio",container:d,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):Ps.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(p=e.inputTimeScale,c&&p===c.timescale?u=!1:h=f=s[0].pts-Math.round(p*r))),t.sps&&t.pps&&o.length&&(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Ps.initSegment([t]),metadata:{width:t.width,height:t.height}},u))if(p=t.inputTimeScale,c&&p===c.timescale)u=!1;else{const m=this.getVideoStartPts(o),g=Math.round(p*r);f=Math.min(f,Dn(o[0].dts,m)-g),h=Math.min(h,m-g)}if(Object.keys(l).length)return this.ISGenerated=!0,u?(this._initPTS={baseTime:h,timescale:p},this._initDTS={baseTime:f,timescale:p}):h=p=void 0,{tracks:l,initPTS:h,timescale:p}}remuxVideo(e,t,r,i){const s=e.inputTimeScale,o=e.samples,a=[],l=o.length,c=this._initPTS;let f,p,u=this.nextAvcDts,d=8,h=this.videoSampleDuration,m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,v=!1;r&&null!==u||(u=t*s-(o[0].pts-Dn(o[0].dts,o[0].pts)));const _=c.baseTime*s/c.timescale;for(let M=0;M<l;M++){const P=o[M];P.pts=Dn(P.pts-_,u),P.dts=Dn(P.dts-_,u),P.dts<o[M>0?M-1:M].dts&&(v=!0)}v&&o.sort(function(M,P){return M.dts-P.dts||M.pts-P.pts}),f=o[0].dts,p=o[o.length-1].dts;const b=p-f,E=b?Math.round(b/(l-1)):h||e.inputTimeScale/30;if(r){const M=f-u,P=M>E,re=M<-1;if((P||re)&&(D.warn(P?`AVC: ${pa(M,!0)} ms (${M}dts) hole between fragments detected, filling it`:`AVC: ${pa(-M,!0)} ms (${M}dts) overlapping between fragments detected`),!re||u>=o[0].pts)){f=u;const ge=o[0].pts-M;o[0].dts=f,o[0].pts=ge,D.log(`Video: First PTS/DTS adjusted: ${pa(ge,!0)}/${pa(f,!0)}, delta: ${pa(M,!0)} ms`)}}f=Math.max(0,f);let T=0,I=0;for(let M=0;M<l;M++){const P=o[M],re=P.units,ge=re.length;let le=0;for(let Ie=0;Ie<ge;Ie++)le+=re[Ie].data.length;I+=le,T+=ge,P.length=le,P.dts=Math.max(P.dts,f),m=Math.min(P.pts,m),g=Math.max(P.pts,g)}p=o[l-1].dts;const C=I+4*T+8;let k;try{k=new Uint8Array(C)}catch(M){return void this.observer.emit(y.ERROR,y.ERROR,{type:X.MUX_ERROR,details:x.REMUX_ALLOC_ERROR,fatal:!1,error:M,bytes:C,reason:`fail allocating video mdat ${C}`})}const N=new DataView(k.buffer);N.setUint32(0,C),k.set(Ps.types.mdat,4);let S=!1,K=Number.POSITIVE_INFINITY,$=Number.POSITIVE_INFINITY,ve=Number.NEGATIVE_INFINITY,pt=Number.NEGATIVE_INFINITY;for(let M=0;M<l;M++){const P=o[M],re=P.units;let le,ge=0;for(let ye=0,Qt=re.length;ye<Qt;ye++){const Zt=re[ye],$e=Zt.data,Hn=Zt.data.byteLength;N.setUint32(d,Hn),d+=4,k.set($e,d),d+=Hn,ge+=4+Hn}if(M<l-1)h=o[M+1].dts-P.dts,le=o[M+1].pts-P.pts;else{const ye=this.config,Qt=M>0?P.dts-o[M-1].dts:E;if(le=M>0?P.pts-o[M-1].pts:E,ye.stretchShortVideoTrack&&null!==this.nextAudioPts){const Zt=Math.floor(ye.maxBufferHole*s),$e=(i?m+i*s:this.nextAudioPts)-P.pts;$e>Zt?(h=$e-Qt,h<0?h=Qt:S=!0,D.log(`[mp4-remuxer]: It is approximately ${$e/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=Qt}else h=Qt}const Ie=Math.round(P.pts-P.dts);K=Math.min(K,h),ve=Math.max(ve,h),$=Math.min($,le),pt=Math.max(pt,le),a.push(new eS(P.key,h,ge,Ie))}if(a.length)if(Zc){if(Zc<70){const M=a[0].flags;M.dependsOn=2,M.isNonSync=0}}else if(em&&pt-$<ve-K&&E/ve<.025&&0===a[0].cts){D.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let M=f;for(let P=0,re=a.length;P<re;P++){const ge=M+a[P].duration;a[P].duration=P<re-1?ge+a[P+1].cts-(M+a[P].cts):P?a[P-1].duration:E,a[P].cts=0,M=ge}}h=S||!h?E:h,this.nextAvcDts=u=p+h,this.videoSampleDuration=h,this.isVideoContiguous=!0;const B={data1:Ps.moof(e.sequenceNumber++,f,dt({},e,{samples:a})),data2:k,startPTS:m/s,endPTS:(g+h)/s,startDTS:f/s,endDTS:u/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,B}remuxAudio(e,t,r,i,s){const o=e.inputTimeScale,l=o/(e.samplerate?e.samplerate:o),c="aac"===e.segmentCodec?1024:1152,u=c*l,d=this._initPTS,h="mp3"===e.segmentCodec&&this.typeSupported.mpeg,f=[],p=void 0!==s;let m=e.samples,g=h?0:8,v=this.nextAudioPts||-1;const _=t*o,b=d.baseTime*o/d.timescale;if(this.isAudioContiguous=r=r||m.length&&v>0&&(i&&Math.abs(_-v)<9e3||Math.abs(Dn(m[0].pts-b,_)-v)<20*u),m.forEach(function(O){O.pts=Dn(O.pts-b,_)}),!r||v<0){if(m=m.filter(O=>O.pts>=0),!m.length)return;v=0===s?0:i&&!p?Math.max(0,_):m[0].pts}if("aac"===e.segmentCodec){const O=this.config.maxAudioFramesDrift;for(let B=0,M=v;B<m.length;B++){const P=m[B],re=P.pts,ge=re-M,le=Math.abs(1e3*ge/o);if(ge<=-O*u&&p)0===B&&(D.warn(`Audio frame @ ${(re/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*ge/o)} ms.`),this.nextAudioPts=v=M=re);else if(ge>=O*u&&le<1e4&&p){let Ie=Math.round(ge/u);M=re-Ie*u,M<0&&(Ie--,M+=u),0===B&&(this.nextAudioPts=v=M),D.warn(`[mp4-remuxer]: Injecting ${Ie} audio frame @ ${(M/o).toFixed(3)}s due to ${Math.round(1e3*ge/o)} ms gap.`);for(let ye=0;ye<Ie;ye++){const Qt=Math.max(M,0);let Zt=Yx.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);Zt||(D.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Zt=P.unit.subarray()),m.splice(B,0,{unit:Zt,pts:Qt}),M+=u,B++}}P.pts=M,M+=u}}let I,E=null,T=null,C=0,k=m.length;for(;k--;)C+=m[k].unit.byteLength;for(let O=0,B=m.length;O<B;O++){const M=m[O],P=M.unit;let re=M.pts;if(null!==T)f[O-1].duration=Math.round((re-T)/l);else{if(r&&"aac"===e.segmentCodec&&(re=v),E=re,!(C>0))return;C+=g;try{I=new Uint8Array(C)}catch(le){return void this.observer.emit(y.ERROR,y.ERROR,{type:X.MUX_ERROR,details:x.REMUX_ALLOC_ERROR,fatal:!1,error:le,bytes:C,reason:`fail allocating audio mdat ${C}`})}h||(new DataView(I.buffer).setUint32(0,C),I.set(Ps.types.mdat,4))}I.set(P,g);const ge=P.byteLength;g+=ge,f.push(new eS(!0,c,ge,0)),T=re}const N=f.length;if(!N)return;this.nextAudioPts=v=T+l*f[f.length-1].duration;const K=h?new Uint8Array(0):Ps.moof(e.sequenceNumber++,E/l,dt({},e,{samples:f}));e.samples=[];const $=E/o,ve=v/o,Re={data1:K,data2:I,startPTS:$,endPTS:ve,startDTS:$,endDTS:ve,type:"audio",hasAudio:!0,hasVideo:!1,nb:N};return this.isAudioContiguous=!0,Re}remuxEmptyAudio(e,t,r,i){const s=e.inputTimeScale,l=this.nextAudioPts,c=this._initDTS,u=9e4*c.baseTime/c.timescale,d=(null!==l?l:i.startDTS*s)+u,f=s/(e.samplerate?e.samplerate:s)*1024,p=Math.ceil((i.endDTS*s+u-d)/f),m=Yx.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(D.warn("[mp4-remuxer]: remux empty Audio"),!m)return void D.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const g=[];for(let v=0;v<p;v++){const _=d+v*f;g.push({unit:m,pts:_,dts:_})}return e.samples=g,this.remuxAudio(e,t,r,!1)}}function Dn(n,e){let t;if(null===e)return n;for(t=e<n?-8589934592:8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function Xx(n,e,t,r){const i=n.samples.length;if(!i)return;const s=n.inputTimeScale;for(let a=0;a<i;a++){const l=n.samples[a];l.pts=Dn(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=Dn(l.dts-r.baseTime*s/r.timescale,e*s)/s}const o=n.samples;return n.samples=[],{samples:o}}function Jx(n,e,t){const r=n.samples.length;if(!r)return;const i=n.inputTimeScale;for(let o=0;o<r;o++){const a=n.samples[o];a.pts=Dn(a.pts-t.baseTime*i/t.timescale,e*i)/i}n.samples.sort((o,a)=>o.pts-a.pts);const s=n.samples;return n.samples=[],{samples:s}}class eS{constructor(e,t,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=i,this.flags=new M8(e)}}class M8{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}}function tS(n,e){const t=n?.codec;return t&&t.length>4?t:"hvc1"===t||"hev1"===t?"hvc1.1.6.L120.90":"av01"===t?"av01.0.04M.08":"avc1"===t||e===we.VIDEO?"avc1.42e01e":"mp4a.40.5"}try{Mr=self.performance.now.bind(self.performance)}catch{D.debug("Unable to use Performance API on this environment"),Mr=typeof self<"u"&&self.Date.now}const nm=[{demux:class p8{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,i){const s=this.videoTrack=or("video",1),o=this.audioTrack=or("audio",1),a=this.txtTrack=or("text",1);if(this.id3Track=or("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const l=nx(e);if(l.video){const{id:c,timescale:u,codec:d}=l.video;s.id=c,s.timescale=a.timescale=u,s.codec=d}if(l.audio){const{id:c,timescale:u,codec:d}=l.audio;o.id=c,o.timescale=u,o.codec=d}a.id=JT.text,s.sampleDuration=0,s.duration=o.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return _e(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0}demux(e,t){this.timeOffset=t;let r=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Ci(this.remainderData,e));const a=function n$(n){const e={valid:null,remainder:null},t=_e(n,["moof"]);if(!t)return e;if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=Si(n,0,r.byteOffset-8),e.remainder=Si(n,r.byteOffset-8),e}(r);this.remainderData=a.remainder,i.samples=a.valid||new Uint8Array}else i.samples=r;const o=this.extractID3Track(i,t);return s.samples=ix(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return r.samples=ix(e,t),{videoTrack:t,audioTrack:or(),id3Track:i,textTrack:or()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const i=_e(e.samples,["emsg"]);i&&i.forEach(s=>{const o=function s$(n){const e=n[0];let t="",r="",i=0,s=0,o=0,a=0,l=0,c=0;if(0===e){for(;"\0"!==_t(n.subarray(c,c+1));)t+=_t(n.subarray(c,c+1)),c+=1;for(t+=_t(n.subarray(c,c+1)),c+=1;"\0"!==_t(n.subarray(c,c+1));)r+=_t(n.subarray(c,c+1)),c+=1;r+=_t(n.subarray(c,c+1)),c+=1,i=ne(n,12),s=ne(n,16),a=ne(n,20),l=ne(n,24),c=28}else if(1===e){c+=4,i=ne(n,c),c+=4;const d=ne(n,c);c+=4;const h=ne(n,c);for(c+=4,o=2**32*d+h,Number.isSafeInteger(o)||(o=Number.MAX_SAFE_INTEGER,D.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=ne(n,c),c+=4,l=ne(n,c),c+=4;"\0"!==_t(n.subarray(c,c+1));)t+=_t(n.subarray(c,c+1)),c+=1;for(t+=_t(n.subarray(c,c+1)),c+=1;"\0"!==_t(n.subarray(c,c+1));)r+=_t(n.subarray(c,c+1)),c+=1;r+=_t(n.subarray(c,c+1)),c+=1}return{schemeIdUri:t,value:r,timeScale:i,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:n.subarray(c,n.byteLength)}}(s);if(f8.test(o.schemeIdUri)){const a=z(o.presentationTime)?o.presentationTime/o.timeScale:t+o.presentationTimeDelta/o.timeScale;let l=4294967295===o.eventDuration?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=o.payload;r.samples.push({data:c,len:c.byteLength,dts:a,pts:a,type:Vn_emsg,duration:l})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class R8{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function ZV(n,e){if(!n||!e)return n;const t=e.keyId;return t&&e.isCommonEncryption&&_e(n,["moov","trak"]).forEach(i=>{const o=_e(i,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=_e(o,["enca"]);const l=a.length>0;l||(a=_e(o,["encv"])),a.forEach(c=>{_e(c.subarray(l?28:78),["sinf"]).forEach(h=>{const f=rx(h);if(f){const p=f.subarray(8,24);p.some(m=>0!==m)||(D.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${sr_hexDump(p)} -> ${sr_hexDump(t)}`),f.set(t,8))}})})}),n}(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const i=this.initData=nx(e);t||(t=tS(i.audio,we.AUDIO)),r||(r=tS(i.video,we.VIDEO));const s={};i.audio&&i.video?s.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?s.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:D.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,r,i,s,o){var a,l;let{initPTS:c,lastEndTime:u}=this;const d={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};z(u)||(u=this.lastEndTime=s||0);const h=t.samples;if(null==h||!h.length)return d;const f={initPTS:void 0,timescale:1};let p=this.initData;if(null!=(a=p)&&a.length||(this.generateInitSegment(h),p=this.initData),null==(l=p)||!l.length)return D.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const m=function JV(n,e){let t=0,r=0,i=0;const s=_e(n,["moof","traf"]);for(let o=0;o<s.length;o++){const a=s[o],l=_e(a,["tfhd"])[0],u=e[ne(l,4)];if(!u)continue;const d=u.default,h=ne(l,0)|d?.flags;let f=d?.duration;8&h&&(f=ne(l,2&h?12:8));const p=u.timescale||9e4,m=_e(a,["trun"]);for(let g=0;g<m.length;g++)t=e$(m[g]),!t&&f&&(t=f*ne(m[g],4)),u.type===we.VIDEO?r+=t/p:u.type===we.AUDIO&&(i+=t/p)}if(0===r&&0===i){let o=0;const a=_e(n,["sidx"]);for(let l=0;l<a.length;l++){const c=QV(a[l]);null!=c&&c.references&&(o+=c.references.reduce((u,d)=>u+d.info.duration||0,0))}return o}return r||i}(h,p),g=function XV(n,e){return _e(e,["moof","traf"]).reduce((t,r)=>{const i=_e(r,["tfdt"])[0],s=i[0],o=_e(r,["tfhd"]).reduce((a,l)=>{const c=ne(l,4),u=n[c];if(u){let d=ne(i,4);if(1===s){if(d===Uc)return D.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),a;d*=Uc+1,d+=ne(i,8)}const f=d/(u.timescale||9e4);if(isFinite(f)&&(null===a||f<a))return f}return a},null);return null!==o&&isFinite(o)&&(null===t||o<t)?o:t},null)}(p,h),v=null===g?s:g;(function L8(n,e,t,r){if(null===n)return!0;const i=Math.max(r,1);return Math.abs(e-n.baseTime/n.timescale-t)>i}(c,v,s,m)||f.timescale!==c.timescale&&o)&&(f.initPTS=v-s,c&&1===c.timescale&&D.warn("Adjusting initPTS by "+(f.initPTS-c.baseTime)),this.initPTS=c={baseTime:f.initPTS,timescale:1});const _=e?v-c.baseTime/c.timescale:u,b=_+m;(function t$(n,e,t){_e(e,["moof","traf"]).forEach(r=>{_e(r,["tfhd"]).forEach(i=>{const s=ne(i,4),o=n[s];if(!o)return;const a=o.timescale||9e4;_e(r,["tfdt"]).forEach(l=>{const c=l[0];let u=ne(l,4);if(0===c)u-=t*a,u=Math.max(u,0),Lp(l,4,u);else{u*=Math.pow(2,32),u+=ne(l,8),u-=t*a,u=Math.max(u,0);const d=Math.floor(u/(Uc+1)),h=Math.floor(u%(Uc+1));Lp(l,4,d),Lp(l,8,h)}})})})})(p,h,c.baseTime/c.timescale),m>0?this.lastEndTime=b:(D.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const E=!!p.audio,T=!!p.video;let I="";E&&(I+="audio"),T&&(I+="video");const C={data1:h,startPTS:_,startDTS:_,endPTS:b,endDTS:b,type:I,hasAudio:E,hasVideo:T,nb:1,dropped:0};return d.audio="audio"===C.type?C:void 0,d.video="audio"!==C.type?C:void 0,d.initSegment=f,d.id3=Xx(r,s,c,c),i.samples.length&&(d.text=Jx(i,s,c)),d}}},{demux:qr,remux:tm},{demux:class h8 extends Ux{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let r=(Nc(e,0)||[]).length;for(let i=e.length;r<i;r++)if(u8(e,r))return D.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function c8(n,e){return function l8(n,e){return e+5<n.length}(n,e)&&Vx(n,e)&&Qp(n,e)<=n.length-e}(e,t)}appendFrame(e,t,r){Hx(e,this.observer,t,r,e.manifestCodec);const i=Gx(e,t,r,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}},remux:tm},{demux:class x8 extends Ux{resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let r=(Nc(e,0)||[]).length;for(let i=e.length;r<i;r++)if(_8(e,r))return D.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function b8(n,e){return Zp(n,e)&&4<=n.length-e}(e,t)}appendFrame(e,t,r){if(null!==this.basePTS)return Kx(e,t,r,this.basePTS,this.frameIndex)}},remux:tm}];class nS{constructor(e,t,r,i,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i,this.id=s}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,i){const s=r.transmuxing;s.executeStart=Mr();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;i&&(this.currentTransmuxState=i);const{contiguous:c,discontinuity:u,trackSwitch:d,accurateTimeOffset:h,timeOffset:f,initSegmentChange:p}=i||a,{audioCodec:m,videoCodec:g,defaultInitPts:v,duration:_,initSegmentData:b}=l,E=function F8(n,e){let t=null;return n.byteLength>0&&null!=e&&null!=e.key&&null!==e.iv&&null!=e.method&&(t=e),t}(o,t);if(E&&"AES-128"===E.method){const k=this.getDecrypter();if(!k.isSync())return this.decryptionPromise=k.webCryptoDecrypt(o,E.key.buffer,E.iv.buffer).then(N=>{const S=this.push(N,null,r);return this.decryptionPromise=null,S}),this.decryptionPromise;{let N=k.softwareDecrypt(o,E.key.buffer,E.iv.buffer);if(r.part>-1&&(N=k.flush()),!N)return s.executeEnd=Mr(),rm(r);o=new Uint8Array(N)}}const T=this.needsProbing(u,d);if(T){const k=this.configureTransmuxer(o);if(k)return D.warn(`[transmuxer] ${k.message}`),this.observer.emit(y.ERROR,y.ERROR,{type:X.MEDIA_ERROR,details:x.FRAG_PARSING_ERROR,fatal:!1,error:k,reason:k.message}),s.executeEnd=Mr(),rm(r)}(u||d||p||T)&&this.resetInitSegment(b,m,g,_,t),(u||p||T)&&this.resetInitialTimestamp(v),c||this.resetContiguity();const I=this.transmux(o,E,f,h,r),C=this.currentTransmuxState;return C.contiguous=!0,C.discontinuity=!1,C.trackSwitch=!1,s.executeEnd=Mr(),I}flush(e){const t=e.transmuxing;t.executeStart=Mr();const{decrypter:r,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return s.then(()=>this.flush(e));const o=[],{timeOffset:a}=i;if(r){const d=r.flush();d&&o.push(this.push(d,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c)return t.executeEnd=Mr(),[rm(e)];const u=l.flush(a);return Xc(u)?u.then(d=>(this.flushRemux(o,d,e),o)):(this.flushRemux(o,u,e),o)}flushRemux(e,t,r){const{audioTrack:i,videoTrack:s,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;D.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${r.part>-1?" p: "+r.part:""} of level ${r.level}`);const u=this.remuxer.remux(i,s,o,a,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:r}),r.transmuxing.executeEnd=Mr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,i,s){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,r,i),a.resetInitSegment(e,t,r,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,i,s){let o;return o=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,i,s):this.transmuxUnencrypted(e,r,i,s),o}transmuxUnencrypted(e,t,r,i){const{audioTrack:s,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,a,l,t,r,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,r,i,s){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:i,vendor:s}=this;let o;for(let d=0,h=nm.length;d<h;d++)if(nm[d].demux.probe(e)){o=nm[d];break}if(!o)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,c=o.remux,u=o.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(r,t,i,s)),(!a||!(a instanceof u))&&(this.demuxer=new u(r,t,i),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new qp(this.config)),e}}const rm=n=>({remuxResult:{},chunkMeta:n});function Xc(n){return"then"in n&&n.then instanceof Function}class k8{constructor(e,t,r,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=s||null}}class O8{constructor(e,t,r,i,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=o}}var rS={exports:{}};!function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}function i(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function s(l,c,u,d,h){if("function"!=typeof u)throw new TypeError("The listener must be a function");var f=new i(u,d||l,h),p=t?t+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function o(l,c){0==--l._eventsCount?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(t=!1)),a.prototype.eventNames=function(){var u,d,c=[];if(0===this._eventsCount)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var d=this._events[t?t+c:c];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,p=new Array(f);h<f;h++)p[h]=d[h].fn;return p},a.prototype.listenerCount=function(c){var d=this._events[t?t+c:c];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,u,d,h,f,p){var m=t?t+c:c;if(!this._events[m])return!1;var _,b,g=this._events[m],v=arguments.length;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),v){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,h),!0;case 5:return g.fn.call(g.context,u,d,h,f),!0;case 6:return g.fn.call(g.context,u,d,h,f,p),!0}for(b=1,_=new Array(v-1);b<v;b++)_[b-1]=arguments[b];g.fn.apply(g.context,_)}else{var T,E=g.length;for(b=0;b<E;b++)switch(g[b].once&&this.removeListener(c,g[b].fn,void 0,!0),v){case 1:g[b].fn.call(g[b].context);break;case 2:g[b].fn.call(g[b].context,u);break;case 3:g[b].fn.call(g[b].context,u,d);break;case 4:g[b].fn.call(g[b].context,u,d,h);break;default:if(!_)for(T=1,_=new Array(v-1);T<v;T++)_[T-1]=arguments[T];g[b].fn.apply(g[b].context,_)}}return!0},a.prototype.on=function(c,u,d){return s(this,c,u,d,!1)},a.prototype.once=function(c,u,d){return s(this,c,u,d,!0)},a.prototype.removeListener=function(c,u,d,h){var f=t?t+c:c;if(!this._events[f])return this;if(!u)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!h||p.once)&&(!d||p.context===d)&&o(this,f);else{for(var m=0,g=[],v=p.length;m<v;m++)(p[m].fn!==u||h&&!p[m].once||d&&p[m].context!==d)&&g.push(p[m]);g.length?this._events[f]=1===g.length?g[0]:g:o(this,f)}return this},a.prototype.removeAllListeners=function(c){var u;return c?this._events[u=t?t+c:c]&&o(this,u):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(rS);var im=EV(rS.exports);const sm=$c()||{isTypeSupported:()=>!1};class iS{constructor(e,t,r,i){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;const o=(c,u)=>{(u=u||{}).frag=this.frag,u.id=this.id,c===y.ERROR&&(this.error=u.error),this.hls.trigger(c,u)};this.observer=new im,this.observer.on(y.FRAG_DECRYPTED,o),this.observer.on(y.ERROR,o);const a={mp4:sm.isTypeSupported("video/mp4"),mpeg:sm.isTypeSupported("audio/mpeg"),mp3:sm.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(s.workerPath||function r8(){return"function"==typeof __HLS_WORKER_BUNDLE__}()))try{s.workerPath?(D.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=function s8(n){const e=new self.URL(n,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}(s.workerPath)):(D.log(`injecting Web Worker for "${t}"`),this.workerContext=function i8(){const n=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(n);return{worker:new self.Worker(e),objectURL:e}}()),this.onwmsg=d=>this.onWorkerMessage(d);const{worker:u}=this.workerContext;u.addEventListener("message",this.onwmsg),u.onerror=d=>{const h=new Error(`${d.message}  (${d.filename}:${d.lineno})`);s.enableWorker=!1,D.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(y.ERROR,{type:X.OTHER_ERROR,details:x.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:h})},u.postMessage({cmd:"init",typeSupported:a,vendor:l,id:t,config:JSON.stringify(s)})}catch(u){D.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.resetWorker(),this.error=null,this.transmuxer=new nS(this.observer,a,s,l,t)}else this.transmuxer=new nS(this.observer,a,s,l,t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,r,i,s,o,a,l,c,u){var d,h;c.transmuxing.start=self.performance.now();const{transmuxer:f}=this,p=o?o.start:s.start,m=s.decryptdata,g=this.frag,v=!(g&&s.cc===g.cc),_=!(g&&c.level===g.level),b=g?c.sn-g.sn:-1,E=this.part?c.part-this.part.index:-1,I=!_&&(1===b||0===b&&(1===E||0===b&&c.id>1&&c.id===g?.stats.chunkCount&&E<=0)),C=self.performance.now();(_||b||0===s.stats.parsing.start)&&(s.stats.parsing.start=C),o&&(E||!I)&&(o.stats.parsing.start=C);const k=!(g&&(null==(d=s.initSegment)?void 0:d.url)===(null==(h=g.initSegment)?void 0:h.url)),N=new O8(v,I,l,_,p,k);if(!I||v||k){D.log(`[transmuxer-interface, ${s.type}]: Starting new transmux session for sn: ${c.sn} p: ${c.part} level: ${c.level} id: ${c.id}\n        discontinuity: ${v}\n        trackSwitch: ${_}\n        contiguous: ${I}\n        accurateTimeOffset: ${l}\n        timeOffset: ${p}\n        initSegmentChange: ${k}`);const S=new k8(r,i,t,a,u);this.configureTransmuxer(S)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:m,chunkMeta:c,state:N},e instanceof ArrayBuffer?[e]:[]);else if(f){const S=f.push(e,m,c,N);Xc(S)?(f.async=!0,S.then(K=>{this.handleTransmuxComplete(K)}).catch(K=>{this.transmuxerError(K,c,"transmuxer-interface push error")})):(f.async=!1,this.handleTransmuxComplete(S))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let r=t.flush(e);Xc(r)||t.async?(Xc(r)||(r=Promise.resolve(r)),r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")})):this.handleFlushResult(r,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data,r=this.hls;switch(t.event){case"init":{var i;const s=null==(i=this.workerContext)?void 0:i.objectURL;s&&self.URL.revokeObjectURL(s);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":D[t.data.logType]&&D[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class V8{constructor(e,t,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:r,media:i,stalled:s}=this;if(null===i)return;const{currentTime:o,seeking:a}=i,l=this.seeking&&!a,c=!this.seeking&&a;if(this.seeking=a,o!==e){if(this.moved=!0,null!==s){if(this.stallReported){const v=self.performance.now()-s;D.warn(`playback not stuck anymore @${o}, after ${Math.round(v)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(c||l)return void(this.stalled=null);if(i.paused&&!a||i.ended||0===i.playbackRate||!Ue.getBuffered(i).length)return;const u=Ue.bufferInfo(i,o,0),h=u.nextStart||0;if(!(u.len>0||h))return;if(a){const v=u.len>2,_=!h||t&&t.start<=o||h-o>2&&!this.fragmentTracker.getPartialFragment(o);if(v||_)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var f;const v=Math.max(h,u.start||0)-o,_=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,E=(null==_||null==(f=_.details)?void 0:f.live)?2*_.details.targetduration:2,T=this.fragmentTracker.getPartialFragment(o);if(v>0&&(v<=E||T))return void this._trySkipBufferHole(T)}const p=self.performance.now();if(null===s)return void(this.stalled=p);const m=p-s;if(!a&&m>=250&&(this._reportStall(u),!this.media))return;const g=Ue.bufferInfo(i,o,r.maxBufferHole);this._tryFixBufferStall(g,m)}_tryFixBufferStall(e,t){const{config:r,fragmentTracker:i,media:s}=this;if(null===s)return;const o=s.currentTime,a=i.getPartialFragment(o);a&&(this._trySkipBufferHole(a)||!this.media)||(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-o<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(D.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:r,stallReported:i}=this;if(!i&&r){this.stallReported=!0;const s=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${JSON.stringify(e)})`);D.warn(s.message),t.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:r,media:i}=this;if(null===i)return 0;const s=i.currentTime,o=Ue.bufferInfo(i,s,0),a=s<o.start?o.start:o.nextStart;if(a){const u=a-s;if(u>0&&(o.len<=t.maxBufferHole||o.len>0&&o.len<1&&i.readyState<3)){if(u>t.maxBufferHole){const{fragmentTracker:h}=this;let f=!1;if(0===s){const p=h.getAppendedFrag(0,te.MAIN);p&&a<p.end&&(f=!0)}if(!f){const p=e||h.getAppendedFrag(s,te.MAIN);if(p){let m=!1,g=p.end;for(;g<a;){const v=h.getPartialFragment(g);if(!v){m=!0;break}g+=v.duration}if(m)return 0}}}const d=Math.max(a+.05,s+.1);if(D.warn(`skipping hole, adjusting currentTime from ${s} to ${d}`),this.moved=!0,this.stalled=null,i.currentTime=d,e&&!e.gap){const h=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${d}`);r.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:e})}return d}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:r,nudgeRetry:i}=this;if(null===r)return;const s=r.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){const o=s+(i+1)*e.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${s} to ${o}`);D.warn(a.message),r.currentTime=o,t.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{const o=new Error(`Playhead still not moving while enough data buffered @${s} after ${e.nudgeMaxRetry} nudges`);D.error(o.message),t.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.BUFFER_STALLED_ERROR,error:o,fatal:!0})}}}class H8 extends Yp{constructor(e,t,r){super(e,t,r,"[stream-controller]",te.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(y.ERROR,this.onError,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(y.ERROR,this.onError,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:r}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let i=r.startLevel;-1===i&&(r.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=r.nextAutoLevel),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state="IDLE",this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state="STOPPED"}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case"WAITING_LEVEL":{var e;const{levels:r,level:i}=this,s=null==r||null==(e=r[i])?void 0:e.details;if(s&&(!s.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(s))break;this.state="IDLE";break}if(this.hls.nextLoadLevel!==this.level){this.state="IDLE";break}break}case"FRAG_LOADING_WAITING_RETRY":{var t;const r=self.performance.now(),i=this.retryDate;(!i||r>=i||null!=(t=this.media)&&t.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state="IDLE")}}"IDLE"===this.state&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:i}=this,{config:s,nextLoadLevel:o}=e;if(null===t||!i&&(this.startFragRequested||!s.startFragPrefetch)||this.altAudio&&this.audioOnly||null==r||!r[o])return;const a=r[o],l=this.getMainFwdBufferInfo();if(null===l)return;const c=this.getLevelDetails();if(c&&this._streamEnded(l,c)){const g={};return this.altAudio&&(g.type="video"),this.hls.trigger(y.BUFFER_EOS,g),void(this.state="ENDED")}e.loadLevel!==o&&-1===e.manualLevel&&this.log(`Adapting to level ${o} from level ${this.level}`),this.level=e.nextLoadLevel=o;const u=a.details;if(!u||"WAITING_LEVEL"===this.state||u.live&&this.levelLastLoaded!==o)return this.level=o,void(this.state="WAITING_LEVEL");const d=l.len,h=this.getMaxBufferLength(a.maxBitrate);if(d>=h)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:l.end;let p=this.getNextFragment(f,u);if(this.couldBacktrack&&!this.fragPrevious&&p&&"initSegment"!==p.sn&&"OK"!==this.fragmentTracker.getState(p)){var m;const v=(null!=(m=this.backtrackFragment)?m:p).sn-u.startSN,_=u.fragments[v-1];_&&p.cc===_.cc&&(p=_,this.fragmentTracker.removeFragment(_))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,f)){if(!p.gap){const v=this.audioOnly&&!this.altAudio?we.AUDIO:we.VIDEO,_=(v===we.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;_&&this.afterBufferFlushed(_,v,te.MAIN)}p=this.getNextFragmentLoopLoading(p,u,l,te.MAIN,h)}p&&(p.initSegment&&!p.initSegment.data&&!this.bitrateTest&&(p=p.initSegment),this.loadFragment(p,a,f))}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);this.fragCurrent=e,"NOT_LOADED"===i||"PARTIAL"===i?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,te.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let r;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(null!=s&&s.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<2*s.targetduration)return}if(!t.paused&&e){const c=this.fragLastKbps;r=c&&this.fragCurrent?this.fragCurrent.duration*e[this.hls.nextLoadLevel].maxBitrate/(1e3*c)+1:0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const c=a.duration,u=Math.max(o.end,(a.maxStartPTS?a.maxStartPTS:a.start)+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,.5*c),.75*c));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case"KEY_LOADING":case"FRAG_LOADING":case"FRAG_LOADING_WAITING_RETRY":case"PARSING":case"PARSED":this.state="IDLE"}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new V8(this.config,r,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;z(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const r=this.getMainFwdBufferInfo();null!==r&&0!==r.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${r?r.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(y.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(e,t){let s,r=!1,i=!1;t.levels.forEach(o=>{s=o.audioCodec,s&&(-1!==s.indexOf("mp4a.40.2")&&(r=!0),-1!==s.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=r&&i&&!function n8(){var n;const e=Bx();return"function"==typeof(null==e||null==(n=e.prototype)?void 0:n.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||"IDLE"!==this.state)return;const i=r[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(i.details))&&(this.state="WAITING_LEVEL")}onLevelLoaded(e,t){var r;const{levels:i}=this,s=t.level,o=t.details,a=o.totalduration;if(!i)return void this.warn(`Levels were reset while loading level ${s}`);this.log(`Level ${s} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${a}`);const l=i[s],c=this.fragCurrent;c&&("FRAG_LOADING"===this.state||"FRAG_LOADING_WAITING_RETRY"===this.state)&&(c.level!==t.level||c.urlId!==l.urlId)&&c.loader&&this.abortCurrentFrag();let u=0;if(o.live||null!=(r=l.details)&&r.live){if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;u=this.alignPlaylists(o,l.details)}if(l.details=o,this.levelLastLoaded=s,this.hls.trigger(y.LEVEL_UPDATED,{details:o,level:s}),"WAITING_LEVEL"===this.state){if(this.waitForCdnTuneIn(o))return;this.state="IDLE"}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,u),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:i,payload:s}=e,{levels:o}=this;if(!o)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const a=o[r.level],l=a.details;if(!l)return this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),void this.fragmentTracker.removeFragment(r);const c=a.videoCodec,u=l.PTSKnown||!l.live,d=null==(t=r.initSegment)?void 0:t.data,h=this._getAudioCodec(a),f=this.transmuxer=this.transmuxer||new iS(this.hls,te.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=i?i.index:-1,g=new zp(r.level,r.sn,r.stats.chunkCount,s.byteLength,p,-1!==p);f.push(s,d,h,c,r,i,l.totalduration,u,g,this.initPTS[r.cc])}onAudioTrackSwitching(e,t){const r=this.altAudio;if(!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const s=this.hls;r&&(s.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),s.trigger(y.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=!!this.hls.audioTracks[t.id].url;if(i){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i,this.tick()}onBufferCreated(e,t){const r=t.tracks;let i,s,o=!1;for(const a in r){const l=r[a];if("main"===l.id){if(s=a,i=l,"video"===a){const c=r[a];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r&&r.type!==te.MAIN)return;if(this.fragContextChanged(r))return this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),void("PARSED"===this.state&&(this.state="IDLE"));const s=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}onError(e,t){var r;if(t.fatal)this.state="ERROR";else switch(t.details){case x.FRAG_GAP:case x.FRAG_PARSING_ERROR:case x.FRAG_DECRYPT_ERROR:case x.FRAG_LOAD_ERROR:case x.FRAG_LOAD_TIMEOUT:case x.KEY_LOAD_ERROR:case x.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(te.MAIN,t);break;case x.LEVEL_LOAD_ERROR:case x.LEVEL_LOAD_TIMEOUT:case x.LEVEL_PARSING_ERROR:!t.levelRetry&&"WAITING_LEVEL"===this.state&&(null==(r=t.context)?void 0:r.type)===Ee.LEVEL&&(this.state="IDLE");break;case x.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case x.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}checkBuffer(){const{media:e,gapController:t}=this;e&&t&&e.readyState&&(!this.loadedmetadata&&Ue.getBuffered(e).length||t.poll(this.lastCurrentTime,"IDLE"!==this.state?this.fragCurrent:null),this.lastCurrentTime=e.currentTime)}onFragLoadEmergencyAborted(){this.state="IDLE",this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){(t!==we.AUDIO||this.audioOnly&&!this.altAudio)&&this.afterBufferFlushed((t===we.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,t,te.MAIN)}onLevelsUpdated(e,t){this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void this.log(`could not seek to ${r}, already seeking at ${t}`);const i=Ue.getBuffered(e),o=(i.length?i.start(0):0)-r;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${o} to match buffer start`),r+=o,this.startPosition=r),this.log(`seek to target start position ${r} from current time ${t}`),e.currentTime=r}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:i}=this;if(!r||this.fragContextChanged(e))return;t.fragmentError=0,this.state="IDLE",this.startFragRequested=!1,this.bitrateTest=!1;const s=e.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),i.trigger(y.FRAG_LOADED,r),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const r="main",{hls:i}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a)return void this.resetWhenMissingContext(o);const{frag:l,part:c,level:u}=a,{video:d,text:h,id3:f,initSegment:p}=s,{details:m}=u,g=this.altAudio?void 0:s.audio;if(this.fragContextChanged(l))this.fragmentTracker.removeFragment(l);else{if(this.state="PARSING",p){if(null!=p&&p.tracks){const b=l.initSegment||l;this._bufferInitSegment(u,p.tracks,b,o),i.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:b,id:r,tracks:p.tracks})}const v=p.initPTS,_=p.timescale;z(v)&&(this.initPTS[l.cc]={baseTime:v,timescale:_},i.trigger(y.INIT_PTS_FOUND,{frag:l,id:r,initPTS:v,timescale:_}))}if(d&&m&&"initSegment"!==l.sn){const v=m.fragments[l.sn-1-m.startSN],_=l.sn===m.startSN,b=!v||l.cc>v.cc;if(!1!==s.independent){const{startPTS:E,endPTS:T,startDTS:I,endDTS:C}=d;if(c)c.elementaryStreams[d.type]={startPTS:E,endPTS:T,startDTS:I,endDTS:C};else if(d.firstKeyFrame&&d.independent&&1===o.id&&!b&&(this.couldBacktrack=!0),d.dropped&&d.independent){const k=this.getMainFwdBufferInfo(),N=(k?k.end:this.getLoadPosition())+this.config.maxBufferHole;if(!_&&N<(d.firstKeyFramePTS?d.firstKeyFramePTS:E)-this.config.maxBufferHole&&!b)return void this.backtrack(l);b&&(l.gap=!0),l.setElementaryStreamInfo(d.type,l.start,T,l.start,C,!0)}l.setElementaryStreamInfo(d.type,E,T,I,C),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(d,l,c,o,_||b)}else{if(!_&&!b)return void this.backtrack(l);l.gap=!0}}if(g){const{startPTS:v,endPTS:_,startDTS:b,endDTS:E}=g;c&&(c.elementaryStreams[we.AUDIO]={startPTS:v,endPTS:_,startDTS:b,endDTS:E}),l.setElementaryStreamInfo(we.AUDIO,v,_,b,E),this.bufferFragmentData(g,l,c,o)}m&&null!=f&&null!=(t=f.samples)&&t.length&&i.trigger(y.FRAG_PARSING_METADATA,{id:r,frag:l,details:m,samples:f.samples}),m&&h&&i.trigger(y.FRAG_PARSING_USERDATA,{id:r,frag:l,details:m,samples:h.samples})}}_bufferInitSegment(e,t,r,i){if("PARSING"!==this.state)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:s,video:o,audiovideo:a}=t;if(s){let l=e.audioCodec;const c=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==s.metadata.channelCount&&-1===c.indexOf("firefox")&&(l="mp4a.40.5")),-1!==c.indexOf("android")&&"audio/mpeg"!==s.container&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),e.audioCodec&&e.audioCodec!==l&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${l}"`),s.levelCodec=l,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${l||""}/${e.audioCodec||""}/${s.codec}]`)}o&&(o.levelCodec=e.videoCodec,o.id="main",this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${o.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.attrs.CODECS||""}/${a.codec}]`),this.hls.trigger(y.BUFFER_CODECS,t),Object.keys(t).forEach(l=>{const u=t[l].initSegment;null!=u&&u.byteLength&&this.hls.trigger(y.BUFFER_APPENDING,{type:l,data:u,frag:r,part:null,chunkMeta:i,parent:r.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,te.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state="IDLE"}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const r=e.currentTime;if(Ue.isBuffered(e,r)?t=this.getAppendedFrag(r):Ue.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s||t.urlId!==i.urlId)&&(this.fragPlaying=t,this.hls.trigger(y.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(y.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,r=this.currentFrag;if(r&&z(t)&&z(r.programDateTime))return new Date(r.programDateTime+1e3*(t-r.start))}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Ns{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class j8{constructor(e,t,r,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ns(e),this.fast_=new Ns(t),this.defaultTTFB_=i,this.ttfb_=new Ns(e)}update(e,t){const{slow_:r,fast_:i,ttfb_:s}=this;r.halfLife!==e&&(this.slow_=new Ns(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Ns(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Ns(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){const i=(e=Math.max(e,this.minDelayMs_))/1e3,s=8*t/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class sS{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;return e.length?(r=1===e.length?e[0]:function K8(n,e){const t=new Uint8Array(e);let r=0;for(let i=0;i<n.length;i++){const s=n[i];t.set(s,r),r+=s.length}return t}(e,t),this.reset(),r):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function aS(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!q8(n[t].attrs,e[t].attrs))return!1;return!0}function q8(n,e){const t=n["STABLE-RENDITION-ID"];return t?t===e["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(r=>n[r]!==e[r])}class Q8{constructor(e){this.buffered=void 0;const t=(r,i,s)=>{if((i>>>=0)>s-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][r]};this.buffered={get length(){return e.length},end:r=>t("end",r,e.length),start:r=>t("start",r,e.length)}}}function am(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];("subtitles"===r.kind||"captions"===r.kind)&&r.label&&e.push(n[t])}return e}class X8{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t){const r=this.queues[t];r.push(e),1===r.length&&this.buffers[t]&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const r=new Promise(s=>{t=s});return this.append({execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}},e),r}executeNext(e){const{buffers:t,queues:r}=this,i=t[e],s=r[e];if(s.length){const o=s[0];try{o.execute()}catch(a){D.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),o.onError(a),null!=i&&i.updating||(s.shift(),this.executeNext(e))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const cS=$c(),uS=/([ha]vc.)(?:\.[^.,]+)+/,dS={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},hS=function(e){let t=e;return dS.hasOwnProperty(e)&&(t=dS[e]),String.fromCharCode(t)},Rr=100,eH={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},tH={17:2,18:4,21:6,22:8,23:10,19:13,20:15},nH={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rH={25:2,26:4,29:6,30:8,31:10,27:13,28:15},iH=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class sH{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r="function"==typeof t?t():t;D.log(`${this.time} [${e}] ${r}`)}}}const Ai=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class fS{constructor(e,t,r,i,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=i||"black",this.flash=s||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class oH{constructor(e,t,r,i,s,o){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new fS(t,r,i,s,o)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class aH{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let t=0;t<Rr;t++)this.chars.push(new oH);this.logger=e,this.pos=0,this.currPenState=new fS}equals(e){let t=!0;for(let r=0;r<Rr;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t}copy(e){for(let t=0;t<Rr;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Rr;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Rr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Rr)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=hS(e);this.pos>=Rr?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<Rr;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<Rr;r++){const i=this.chars[r].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class lm{constructor(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let t=0;t<15;t++)this.rows.push(new aH(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<15;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let r=0;r<15;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<15;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<15;a++)this.rows[a].clear();const s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[s].cueStartTime,l=this.logger.time;if(a&&null!==l&&a<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(o.rows[s+c])}}this.currRow=t;const r=this.rows[this.currRow];if(null!==e.indent){const o=Math.max(e.indent-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}this.setPen({foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1})}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const t=this.rows.splice(this.currRow+1-this.nrRollUpRows,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",i=-1;for(let s=0;s<15;s++){const o=this.rows[s].getTextString();o&&(i=s+1,t.push(e?"Row "+i+": '"+o+"'":o.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}getTextAndFormat(){return this.rows}}class pS{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new lm(r),this.nonDisplayedMemory=new lm(r),this.lastOutputScreen=new lm(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class mS{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const i=new sH;this.channels=[null,new pS(e,t,i),new pS(e+1,r,i)],this.cmdHistory={a:null,b:null},this.logger=i}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let r,i,s,o=!1;this.logger.time=e;for(let a=0;a<t.length;a+=2)if(i=127&t[a],s=127&t[a+1],0!==i||0!==s){if(this.logger.log(3,"["+Ai([t[a],t[a+1]])+"] -> ("+Ai([i,s])+")"),r=this.parseCmd(i,s),r||(r=this.parseMidrow(i,s)),r||(r=this.parsePAC(i,s)),r||(r=this.parseBackgroundAttributes(i,s)),!r&&(o=this.parseChars(i,s),o)){const l=this.currentChannel;l&&l>0?this.channels[l].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!r&&!o&&this.logger.log(2,"Couldn't parse cleaned data "+Ai([i,s])+" orig: "+Ai([t[a],t[a+1]]))}}parseCmd(e,t){const{cmdHistory:r}=this;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;if(gS(e,t,r))return Bs(null,null,r),this.logger.log(3,"Repeated command ("+Ai([e,t])+") is dropped"),!0;const o=20===e||21===e||23===e?1:2,a=this.channels[o];return 20===e||21===e||28===e||29===e?32===t?a.ccRCL():33===t?a.ccBS():34===t?a.ccAOF():35===t?a.ccAON():36===t?a.ccDER():37===t?a.ccRU(2):38===t?a.ccRU(3):39===t?a.ccRU(4):40===t?a.ccFON():41===t?a.ccRDC():42===t?a.ccTR():43===t?a.ccRTD():44===t?a.ccEDM():45===t?a.ccCR():46===t?a.ccENM():47===t&&a.ccEOC():a.ccTO(t-32),Bs(e,t,r),this.currentChannel=o,!0}parseMidrow(e,t){let r=0;if((17===e||25===e)&&t>=32&&t<=47){if(r=17===e?1:2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[r];return!!i&&(i.ccMIDROW(t),this.logger.log(3,"MIDROW ("+Ai([e,t])+")"),!0)}return!1}parsePAC(e,t){let r;const i=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;if(gS(e,t,i))return Bs(null,null,i),!0;const a=e<=23?1:2;r=t>=64&&t<=95?1===a?eH[e]:nH[e]:1===a?tH[e]:rH[e];const l=this.channels[a];return!!l&&(l.setPAC(this.interpretPAC(r,t)),Bs(e,t,i),this.currentChannel=a,!0)}interpretPAC(e,t){let r;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=1==(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i}parseChars(e,t){let r,i=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),s>=17&&s<=19){let o;o=17===s?t+80:18===s?t+112:t+144,this.logger.log(2,"Special char '"+hS(o)+"' in channel "+r),i=[o]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);if(i){const o=Ai(i);this.logger.log(3,"Char codes =  "+o.join(",")),Bs(e,t,this.cmdHistory)}return i}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;let s;const o={};return 16===e||24===e?(s=Math.floor((t-32)/2),o.background=iH[s],t%2==1&&(o.background=o.background+"_semi")):45===t?o.background="transparent":(o.foreground="black",47===t&&(o.underline=!0)),this.channels[e<=23?1:2].setBkgData(o),Bs(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Bs(n,e,t){t.a=n,t.b=e}function gS(n,e,t){return t.a===n&&t.b===e}class Jc{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var cm=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if("string"!=typeof l||!Array.isArray(a))return!1;const c=l.toLowerCase();return!!~a.indexOf(c)&&c}function i(a){return t(e,a)}function s(a,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const d in u)a[d]=u[d]}return a}function o(a,l,c){const u=this,d={enumerable:!0};u.hasBeenReset=!1;let h="",f=!1,p=a,m=l,g=c,v=null,_="",b=!0,E="auto",T="start",I=50,C="middle",k=50,N="middle";Object.defineProperty(u,"id",s({},d,{get:function(){return h},set:function(S){h=""+S}})),Object.defineProperty(u,"pauseOnExit",s({},d,{get:function(){return f},set:function(S){f=!!S}})),Object.defineProperty(u,"startTime",s({},d,{get:function(){return p},set:function(S){if("number"!=typeof S)throw new TypeError("Start time must be set to a number.");p=S,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",s({},d,{get:function(){return m},set:function(S){if("number"!=typeof S)throw new TypeError("End time must be set to a number.");m=S,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",s({},d,{get:function(){return g},set:function(S){g=""+S,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",s({},d,{get:function(){return v},set:function(S){v=S,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",s({},d,{get:function(){return _},set:function(S){const K=function r(a){return t(n,a)}(S);if(!1===K)throw new SyntaxError("An invalid or illegal string was specified.");_=K,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",s({},d,{get:function(){return b},set:function(S){b=!!S,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",s({},d,{get:function(){return E},set:function(S){if("number"!=typeof S&&"auto"!==S)throw new SyntaxError("An invalid number or illegal string was specified.");E=S,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",s({},d,{get:function(){return T},set:function(S){const K=i(S);if(!K)throw new SyntaxError("An invalid or illegal string was specified.");T=K,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",s({},d,{get:function(){return I},set:function(S){if(S<0||S>100)throw new Error("Position must be between 0 and 100.");I=S,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",s({},d,{get:function(){return C},set:function(S){const K=i(S);if(!K)throw new SyntaxError("An invalid or illegal string was specified.");C=K,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",s({},d,{get:function(){return k},set:function(S){if(S<0||S>100)throw new Error("Size must be between 0 and 100.");k=S,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",s({},d,{get:function(){return N},set:function(S){const K=i(S);if(!K)throw new SyntaxError("An invalid or illegal string was specified.");N=K,this.hasBeenReset=!0}})),u.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class lH{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function vS(n){function e(r,i,s,o){return 3600*(0|r)+60*(0|i)+(0|s)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class cH{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&""!==t&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function bS(n,e,t,r){const i=r?n.split(r):[n];for(const s in i){if("string"!=typeof i[s])continue;const o=i[s].split(t);2===o.length&&e(o[0],o[1])}}const um=new cm(0,0,""),eu="middle"===um.align?"middle":"center";function uH(n,e,t){const r=n;function i(){const a=vS(n);if(null===a)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=i(),o(),"--\x3e"!==n.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);n=n.slice(3),o(),e.endTime=i(),o(),function s(a,l){const c=new cH;bS(a,function(h,f){let p;switch(h){case"region":for(let m=t.length-1;m>=0;m--)if(t[m].id===f){c.set(h,t[m].region);break}break;case"vertical":c.alt(h,f,["rl","lr"]);break;case"line":p=f.split(","),c.integer(h,p[0]),c.percent(h,p[0])&&c.set("snapToLines",!1),c.alt(h,p[0],["auto"]),2===p.length&&c.alt("lineAlign",p[1],["start",eu,"end"]);break;case"position":p=f.split(","),c.percent(h,p[0]),2===p.length&&c.alt("positionAlign",p[1],["start",eu,"end","line-left","line-right","auto"]);break;case"size":c.percent(h,f);break;case"align":c.alt(h,f,["start",eu,"end","left","right"])}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");"auto"===u&&-1===um.line&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",eu);let d=c.get("position","auto");"auto"===d&&50===um.position&&(d="start"===l.align||"left"===l.align?0:"end"===l.align||"right"===l.align?100:50),l.position=d}(n,e)}function _S(n){return n.replace(/<br(?: \/)?>/gi,"\n")}class dH{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new lH,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function r(){let s=t.buffer,o=0;for(s=_S(s);o<s.length&&"\r"!==s[o]&&"\n"!==s[o];)++o;const a=s.slice(0,o);return"\r"===s[o]&&++o,"\n"===s[o]&&++o,t.buffer=s.slice(o),a}function i(s){bS(s,function(o,a){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let s="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;s=r();const a=s.match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(null==a||!a[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:s=r(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new cm(0,0,""),t.state="CUE",-1===s.indexOf("--\x3e")){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{uH(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=-1!==s.indexOf("--\x3e");if(!s||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const hH=/\r\n|\n\r|\n|\r/g,dm=function(e,t,r=0){return e.slice(r,r+t.length)===t},fH=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(z(t)&&z(r)&&z(i)&&z(s)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=6e4*i,t+=36e5*s,t},hm=function(e){let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()};function fm(n,e,t){return hm(n.toString())+hm(e.toString())+hm(t)}const pH=function(e,t,r){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;null!=(o=s)&&o.new;){var o;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=r};const pm="stpp.ttml.im1t",ES=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,DS=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,gH={left:"start",center:"center",right:"end",start:"start",end:"end"};function TS(n,e,t,r){const i=_e(new Uint8Array(n),["mdat"]);if(0===i.length)return void r(new Error("Could not parse IMSC1 mdat"));const s=i.map(a=>ir(a)),o=function S8(n,e,t=1,r=!1){return Jp(n,e,1/t,r)}(e.baseTime,1,e.timescale);try{s.forEach(a=>t(function yH(n,e){const i=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((d,h)=>(d[h]=i.getAttribute(`ttp:${h}`)||s[h],d),{}),a="preserve"!==i.getAttribute("xml:space"),l=xS(mm(i,"styling","style")),c=xS(mm(i,"layout","region")),u=mm(i,"body","[begin]");return[].map.call(u,d=>{const h=SS(d,a);if(!h||!d.hasAttribute("begin"))return null;const f=ym(d.getAttribute("begin"),o),p=ym(d.getAttribute("dur"),o);let m=ym(d.getAttribute("end"),o);if(null===f)throw CS(d);if(null===m){if(null===p)throw CS(d);m=f+p}const g=new cm(f-e,m-e,h);g.id=fm(g.startTime,g.endTime,g.text);const b=function vH(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let i=null;const o=null!=n&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(i=t[o]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((a,l)=>{const c=gm(e,r,l)||gm(n,r,l)||gm(i,r,l);return c&&(a[l]=c),a},{})}(c[d.getAttribute("region")],l[d.getAttribute("style")],l),{textAlign:E}=b;if(E){const T=gH[E];T&&(g.lineAlign=T),g.align=E}return dt(g,b),g}).filter(d=>null!==d)}(a,o)))}catch(a){r(a)}}function mm(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function xS(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function SS(n,e){return[].slice.call(n.childNodes).reduce((t,r,i)=>{var s;return"br"===r.nodeName&&i?t+"\n":null!=(s=r.childNodes)&&s.length?SS(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function gm(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function CS(n){return new Error(`Could not parse ttml timestamp ${n}`)}function ym(n,e){if(!n)return null;let t=vS(n);return null===t&&(ES.test(n)?t=function bH(n,e){const t=ES.exec(n);return 3600*(0|t[1])+60*(0|t[2])+(0|t[3])+((0|t[4])+(0|t[5])/e.subFrameRate)/e.frameRate}(n,e):DS.test(n)&&(t=function _H(n,e){const t=DS.exec(n),r=Number(t[1]);switch(t[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}(n,e))),t}function DH(n,e){return!!n&&n.label===e.name&&!(n.textTrack1||n.textTrack2)}function TH(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}class vm{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const e=this.hls.levels;if(e.length){const t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,vm.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(null==e||!e.length)return-1;const i=(o,a)=>!a||o.width!==a.width||o.height!==a.height;let s=e.length-1;for(let o=0;o<e.length;o+=1){const a=e[o];if((a.width>=t||a.height>=r)&&i(a,e[o+1])){s=o;break}}return s}}const tu="[eme]";let SH=(()=>{class n{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=n.CDMCleanupPromise?[n.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=D.debug.bind(D,tu),this.log=D.log.bind(D,tu),this.warn=D.warn.bind(D,tu),this.error=D.error.bind(D,tu),this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(y.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(t){const{drmSystems:r,widevineLicenseUrl:i}=this.config,s=r[t];if(s)return s.licenseUrl;if(t===ze.WIDEVINE&&i)return i;throw new Error(`no license server URL configured for key-system "${t}"`)}getServerCertificateUrl(t){const{drmSystems:r}=this.config,i=r[t];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const r=this.hls.levels,i=(a,l,c)=>!!a&&c.indexOf(a)===l,s=r.map(a=>a.audioCodec).filter(i),o=r.map(a=>a.videoCodec).filter(i);return s.length+o.length===0&&o.push("avc1.42e01e"),new Promise((a,l)=>{const c=u=>{const d=u.shift();this.getMediaKeysPromise(d,s,o).then(h=>a({keySystem:d,mediaKeys:h})).catch(h=>{u.length?c(u):l(h instanceof Tn?h:new Tn({type:X.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_NO_ACCESS,error:h,fatal:!0},h.message))})};c(t)})}requestMediaKeySystemAccess(t,r){const{requestMediaKeySystemAccessFunc:i}=this.config;if("function"!=typeof i){let s=`Configured requestMediaKeySystemAccess is not a function ${i}`;return null===YT&&"http:"===self.location.protocol&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return i(t,r)}getMediaKeysPromise(t,r,i){const s=function BV(n,e,t,r){let i;switch(n){case ze.FAIRPLAY:i=["cenc","sinf"];break;case ze.WIDEVINE:case ze.PLAYREADY:i=["cenc"];break;case ze.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return function UV(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"not-allowed",distinctiveIdentifier:r.distinctiveIdentifier||"not-allowed",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs="${s}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs="${s}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}(i,e,t,r)}(t,r,i,this.config.drmSystemOptions),o=this.keySystemAccessPromises[t];let a=o?.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${t}" key-system access with config: ${JSON.stringify(s)}`),a=this.requestMediaKeySystemAccess(t,s);const l=this.keySystemAccessPromises[t]={keySystemAccess:a};return a.catch(c=>{this.log(`Failed to obtain access to key-system "${t}": ${c}`)}),a.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const u=this.fetchServerCertificate(t);return this.log(`Create media-keys for "${t}"`),l.mediaKeys=c.createMediaKeys().then(d=>(this.log(`Media-keys created for "${t}"`),u.then(h=>h?this.setMediaKeysServerCertificate(d,t,h):d))),l.mediaKeys.catch(d=>{this.error(`Failed to create media-keys for "${t}"}: ${d}`)}),l.mediaKeys})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:r,mediaKeys:i}){this.log(`Creating key-system session "${r}" keyId: ${sr_hexDump(t.keyId||[])}`);const s=i.createSession(),o={decryptdata:t,keySystem:r,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o}renewKeySession(t){const r=t.decryptdata;if(r.pssh){const i=this.createMediaKeySessionContext(t),s=this.getKeyIdString(r);this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,"cenc",r.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}getKeyIdString(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(null===t.keyId)throw new Error("keyId is null");return sr_hexDump(t.keyId)}updateKeySession(t,r){var i;const s=t.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${sr_hexDump((null==(i=t.decryptdata)?void 0:i.keyId)||[])}\n      } (data length: ${r&&r.byteLength})`),s.update(r)}selectKeySystemFormat(t){const r=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)),this.keyFormatPromise}getKeyFormatPromise(t){return new Promise((r,i)=>{const s=Ip(this.config),o=t.map(zT).filter(a=>!!a&&-1!==s.indexOf(a));return this.getKeySystemSelectionPromise(o).then(({keySystem:a})=>{const l=qT(a);l?r(l):i(new Error(`Unable to find format for key-system "${a}"`))}).catch(i)})}loadKey(t){const r=t.keyInfo.decryptdata,i=this.getKeyIdString(r),s=`(keyId: ${i} format: "${r.keyFormat}" method: ${r.method} uri: ${r.uri})`;this.log(`Starting session for key ${s}`);let o=this.keyIdToKeySessionPromise[i];return o||(o=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(r).then(({keySystem:a,mediaKeys:l})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${s}`),this.attemptSetMediaKeys(a,l).then(()=>{this.throwIfDestroyed();const c=this.createMediaKeySessionContext({keySystem:a,mediaKeys:l,decryptdata:r});return this.generateRequestWithPreferredKeySession(c,"cenc",r.pssh,"playlist-key")}))),o.catch(a=>this.handleError(a))),o}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t){this.hls&&(this.error(t.message),this.hls.trigger(y.ERROR,t instanceof Tn?t.data:{type:X.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))}getKeySystemForKeyPromise(t){const r=this.getKeyIdString(t),i=this.keyIdToKeySessionPromise[r];if(!i){const s=zT(t.keyFormat),o=s?[s]:Ip(this.config);return this.attemptKeySystemAccess(o)}return i}getKeySystemSelectionPromise(t){if(t.length||(t=Ip(this.config)),0===t.length)throw new Tn({type:X.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}_onMediaEncrypted(t){const{initDataType:r,initData:i}=t;if(this.debug(`"${t.type}" event: init data type: "${r}"`),null===i)return;let s,o;if("sinf"===r&&this.config.drmSystems[ze.FAIRPLAY]){const d=_t(new Uint8Array(i));try{const h=wp(JSON.parse(d).sinf),f=rx(new Uint8Array(h));if(!f)return;s=f.subarray(8,24),o=ze.FAIRPLAY}catch{return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{const d=function l$(n){if(!(n instanceof ArrayBuffer)||n.byteLength<32)return null;const e={version:0,systemId:"",kids:null,data:null},t=new DataView(n),r=t.getUint32(0);if(n.byteLength!==r&&r>44||1886614376!==t.getUint32(4)||(e.version=t.getUint32(8)>>>24,e.version>1))return null;e.systemId=sr_hexDump(new Uint8Array(n,12,16));const s=t.getUint32(28);if(0===e.version){if(r-32<s)return null;e.data=new Uint8Array(n,32,s)}else if(1===e.version){e.kids=[];for(let o=0;o<s;o++)e.kids.push(new Uint8Array(n,32+16*o,16))}return e}(i);if(null===d)return;0===d.version&&d.systemId===WT_WIDEVINE&&d.data&&(s=d.data.subarray(8,24)),o=function NV(n){if(n===WT_WIDEVINE)return ze.WIDEVINE}(d.systemId)}if(!o||!s)return;const a=sr_hexDump(s),{keyIdToKeySessionPromise:l,mediaKeySessions:c}=this;let u=l[a];for(let d=0;d<c.length;d++){const h=c[d],f=h.decryptdata;if(f.pssh||!f.keyId)continue;const p=sr_hexDump(f.keyId);if(a===p||-1!==f.uri.replace(/-/g,"").indexOf(a)){u=l[p],delete l[p],f.pssh=new Uint8Array(i),f.keyId=s,u=l[a]=u.then(()=>this.generateRequestWithPreferredKeySession(h,r,i,"encrypted-event-key-match"));break}}u||(u=l[a]=this.getKeySystemSelectionPromise([o]).then(({keySystem:d,mediaKeys:h})=>{var f;this.throwIfDestroyed();const p=new ca("ISO-23001-7",a,null!=(f=qT(d))?f:"");return p.pssh=new Uint8Array(i),p.keyId=s,this.attemptSetMediaKeys(d,h).then(()=>{this.throwIfDestroyed();const m=this.createMediaKeySessionContext({decryptdata:p,keySystem:d,mediaKeys:h});return this.generateRequestWithPreferredKeySession(m,r,i,"encrypted-event-no-match")})})),u.catch(d=>this.handleError(d))}_onWaitingForKey(t){this.log(`"${t.type}" event`)}attemptSetMediaKeys(t,r){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const s=Promise.all(i).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(r)});return this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${t}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(o=>-1===i.indexOf(o))})}generateRequestWithPreferredKeySession(t,r,i,s){var o,a;const l=null==(o=this.config.drmSystems)||null==(a=o[t.keySystem])?void 0:a.generateRequest;if(l)try{const f=l.call(this.hls,r,i,t);if(!f)throw new Error("Invalid response from configured generateRequest filter");r=f.initDataType,i=t.decryptdata.pssh=f.initData?new Uint8Array(f.initData):null}catch(f){var c;if(this.warn(f.message),null!=(c=this.hls)&&c.config.debug)throw f}if(null===i)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(t);const u=this.getKeyIdString(t.decryptdata);this.log(`Generating key-session request for "${s}": ${u} (init data type: ${r} length: ${i?i.byteLength:null})`);const d=new im;t.mediaKeysSession.onmessage=f=>{const p=t.mediaKeysSession;if(!p)return void d.emit("error",new Error("invalid state"));const{messageType:m,message:g}=f;this.log(`"${m}" message event for session "${p.sessionId}" message size: ${g.byteLength}`),"license-request"===m||"license-renewal"===m?this.renewLicense(t,g).catch(v=>{this.handleError(v),d.emit("error",v)}):"license-release"===m?t.keySystem===ze.FAIRPLAY&&(this.updateKeySession(t,KT("acknowledged")),this.removeSession(t)):this.warn(`unhandled media key message type "${m}"`)},t.mediaKeysSession.onkeystatuseschange=f=>{if(!t.mediaKeysSession)return void d.emit("error",new Error("invalid state"));this.onKeyStatusChange(t);const m=t.keyStatus;d.emit("keyStatus",m),"expired"===m&&(this.warn(`${t.keySystem} expired for key ${u}`),this.renewKeySession(t))};const h=new Promise((f,p)=>{d.on("error",p),d.on("keyStatus",m=>{m.startsWith("usable")?f():"output-restricted"===m?p(new Tn({type:X.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===m?p(new Tn({type:X.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${m}"`)):"expired"===m?p(new Error("key expired while generating request")):this.warn(`unhandled key status change "${m}"`)})});return t.mediaKeysSession.generateRequest(r,i).then(()=>{var f;this.log(`Request generated for key-session "${null==(f=t.mediaKeysSession)?void 0:f.sessionId}" keyId: ${u}`)}).catch(f=>{throw new Tn({type:X.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_NO_SESSION,error:f,fatal:!1},`Error generating key-session request: ${f}`)}).then(()=>h).catch(f=>{throw d.removeAllListeners(),this.removeSession(t),f}).then(()=>(d.removeAllListeners(),t))}onKeyStatusChange(t){t.mediaKeysSession.keyStatuses.forEach((r,i)=>{this.log(`key status change "${r}" for keyStatuses keyId: ${sr_hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${sr_hexDump(new Uint8Array(t.decryptdata.keyId||[]))} uri: ${t.decryptdata.uri}`),t.keyStatus=r})}fetchServerCertificate(t){const r=this.config,s=new(0,r.loader)(r),o=this.getServerCertificateUrl(t);return o?(this.log(`Fetching serverCertificate for "${t}"`),new Promise((a,l)=>{const c={responseType:"arraybuffer",url:o},u=r.certLoadPolicy.default;s.load(c,{loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},{onSuccess:(f,p,m,g)=>{a(f.data)},onError:(f,p,m,g)=>{l(new Tn({type:X.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:zt({url:c.url,data:void 0},f)},`"${t}" certificate request failed (${o}). Status: ${f.code} (${f.text})`))},onTimeout:(f,p,m)=>{l(new Tn({type:X.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:c.url,data:void 0}},`"${t}" certificate request timed out (${o})`))},onAbort:(f,p,m)=>{l(new Error("aborted"))}})})):Promise.resolve()}setMediaKeysServerCertificate(t,r,i){return new Promise((s,o)=>{t.setServerCertificate(i).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${i?.byteLength}) on "${r}"`),s(t)}).catch(a=>{o(new Tn({type:X.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(t,r){return this.requestLicense(t,new Uint8Array(r)).then(i=>this.updateKeySession(t,new Uint8Array(i)).catch(s=>{throw new Tn({type:X.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}setupLicenseXHR(t,r,i,s){const o=this.config.licenseXhrSetup;return o?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return o.call(this.hls,t,r,i,s)}).catch(a=>{if(!i.decryptdata)throw a;return t.open("POST",r,!0),o.call(this.hls,t,r,i,s)}).then(a=>(t.readyState||t.open("POST",r,!0),{xhr:t,licenseChallenge:a||s})):(t.open("POST",r,!0),Promise.resolve({xhr:t,licenseChallenge:s}))}requestLicense(t,r){const i=this.config.keyLoadPolicy.default;return new Promise((s,o)=>{const a=this.getLicenseServerUrl(t.keySystem);this.log(`Sending license request to URL: ${a}`);const l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return o(new Error("invalid state"));if(4===l.readyState)if(200===l.status){this._requestLicenseFailureCount=0;let c=l.response;this.log(`License received ${c instanceof ArrayBuffer?c.byteLength:c}`);const u=this.config.licenseResponseCallback;if(u)try{c=u.call(this.hls,l,a,t)}catch(d){this.error(d)}s(c)}else{const c=i.errorRetry,u=c?c.maxNumRetry:0;this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||l.status>=400&&l.status<500?o(new Tn({type:X.KEY_SYSTEM_ERROR,details:x.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:l,response:{url:a,data:void 0,code:l.status,text:l.statusText}},`License Request XHR failed (${a}). Status: ${l.status} (${l.statusText})`)):(this.warn(`Retrying license request, ${u-this._requestLicenseFailureCount+1} attempts left`),this.requestLicense(t,r).then(s,o))}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=l,this.setupLicenseXHR(l,a,t,r).then(({xhr:c,licenseChallenge:u})=>{c.send(u)})})}onMediaAttached(t,r){if(!this.config.emeEnabled)return;const i=r.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const t=this.media,r=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},ca.clearKeyUriToKeyIdMap();const i=r.length;n.CDMCleanupPromise=Promise.all(r.map(s=>this.removeSession(s)).concat(t?.setMediaKeys(null).catch(s=>{this.log(`Could not clear media keys: ${s}. media.src: ${t?.src}`)}))).then(()=>{i&&(this.log("finished closing key sessions and clearing media keys"),r.length=0)}).catch(s=>{this.log(`Could not close sessions and clear media keys: ${s}. media.src: ${t?.src}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(t,{sessionKeys:r}){if(r&&this.config.emeEnabled&&!this.keyFormatPromise){const i=r.reduce((s,o)=>(-1===s.indexOf(o.keyFormat)&&s.push(o.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(t){const{mediaKeysSession:r,licenseXhr:i}=t;if(r){this.log(`Remove licenses and keys and close session ${r.sessionId}`),r.onmessage=null,r.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(t);return s>-1&&this.mediaKeySessions.splice(s,1),r.remove().catch(o=>{this.log(`Could not remove session: ${o}`)}).then(()=>r.close()).catch(o=>{this.log(`Could not close session: ${o}`)})}}}return n.CDMCleanupPromise=void 0,n})();class Tn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class Qr{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:"m",su:!this.initialized})}catch(s){D.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const s=i.frag,o=this.hls.levels[s.level],a=this.getObjectType(s),l={d:1e3*s.duration,ot:a};("v"===a||"a"===a||"av"==a)&&(l.br=o.bitrate/1e3,l.tb=this.getTopBandwidth(a)/1e3,l.bl=this.getBufferLength(a)),this.apply(i,l)}catch(s){D.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;null!=r&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||Qr.uuid(),this.cid=r.contentId,this.useHeaders=!0===r.useHeaders,this.registerListeners())}registerListeners(){const e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHED,this.onMediaDetached,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHED,this.onMediaDetached,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,i;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}createData(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){if(dt(t,this.createData()),this.starved&&("i"===t.ot||"v"===t.ot||"av"===t.ot)&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering),this.useHeaders){const i=Qr.toHeaders(t);if(!Object.keys(i).length)return;e.headers||(e.headers={}),dt(e.headers,i)}else{const i=Qr.toQuery(t);if(!i)return;e.url=Qr.appendQueryToUri(e.url,i)}}getObjectType(e){const{type:t}=e;return"subtitle"===t?"tt":"initSegment"===e.sn?"i":"audio"===t?"a":"main"===t?this.hls.audioTracks.length?"v":"av":void 0}getTopBandwidth(e){let r,t=0;const i=this.hls;if("a"===e)r=i.audioTracks;else{const s=i.maxAutoLevel;r=i.levels.slice(0,s>-1?s+1:i.levels.length)}for(const s of r)s.bitrate>t&&(t=s.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,r="a"===e?this.audioBuffer:this.videoBuffer;return r&&t?1e3*Ue.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}static uuid(){const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}static serialize(e){const t=[],r=c=>!Number.isNaN(c)&&null!=c&&""!==c&&!1!==c,i=c=>Math.round(c),s=c=>100*i(c/100),a={br:i,d:i,bl:s,dl:s,mtp:s,nor:c=>encodeURIComponent(c),rtp:s,tb:i},l=Object.keys(e||{}).sort();for(const c of l){let u=e[c];if(!r(u)||"v"===c&&1===u||"pr"==c&&1===u)continue;const d=a[c];d&&(u=d(u));const h=typeof u;let f;f="ot"===c||"sf"===c||"st"===c?`${c}=${u}`:"boolean"===h?c:"number"===h?`${c}=${u}`:`${c}=${JSON.stringify(u)}`,t.push(f)}return t.join(",")}static toHeaders(e){const t=Object.keys(e),r={},i=["Object","Request","Session","Status"],s=[{},{},{},{}],o={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const a of t)s[null!=o[a]?o[a]:1][a]=e[a];for(let a=0;a<s.length;a++){const l=Qr.serialize(s[a]);l&&(r[`CMCD-${i[a]}`]=l)}return r}static toQuery(e){return`CMCD=${encodeURIComponent(Qr.serialize(e))}`}static appendQueryToUri(e,t){if(!t)return e;const r=e.includes("?")?"&":"?";return`${e}${r}${t}`}}function wS(n,e,t,r){n&&Object.keys(e).forEach(i=>{const s=n.filter(o=>o.groupId===i).map(o=>{const a=dt({},o);return a.details=void 0,a.attrs=new Ke(a.attrs),a.url=a.attrs.URI=IS(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[i],a.attrs["PATHWAY-ID"]=r,a});n.push(...s)})}function IS(n,e,t,r){const{HOST:i,PARAMS:s,[t]:o}=r;let a;e&&(a=o?.[e],a&&(n=a));const l=new self.URL(n);return i&&!a&&(l.host=i),s&&Object.keys(s).sort().forEach(c=>{c&&l.searchParams.set(c,s[c])}),l.href}const MH=/^age:\s*[\d.]+\s*$/im;class MS{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Pc,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e)return;const r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!this.stats.aborted)return s(r,t.url)}).catch(o=>(r.open("GET",t.url,!0),s(r,t.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{this.callbacks.onError({code:r.status,text:o.message},t,r,i)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const i=this.context.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=r.loadPolicy;if(i)for(const a in i)e.setRequestHeader(a,i[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=s&&z(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!r.aborted&&i>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const o=t.status,a="text"!==t.responseType;if(o>=200&&o<300&&(a&&t.response||null!==t.responseText)){r.loading.end=Math.max(self.performance.now(),r.loading.first);const l=a?t.response:t.responseText;if(r.loaded=r.total="arraybuffer"===t.responseType?l.byteLength:l.length,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;const u=this.callbacks.onProgress;if(u&&u(r,e,l,t),!this.callbacks)return;this.callbacks.onSuccess({url:t.responseURL,data:l,code:o},r,e,t)}else{const l=s.loadPolicy.errorRetry;Gc(l,r.retry,!1,o)?this.retry(l):(D.error(`${o} while loading ${e.url}`),this.callbacks.onError({code:o,text:t.statusText},e,t,r))}}}loadtimeout(){var e;const t=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry;if(Gc(t,this.stats.retry,!0))this.retry(t);else{D.warn(`timeout while loading ${this.context.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=Hp(e,r.retry),r.retry++,D.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&MH.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const LH=/(\d+)-(\d+)\/(\d+)/;class RS{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||PH,this.controller=new self.AbortController,this.stats=new Pc}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=function FH(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(dt({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}(e,this.controller.signal),o=r.onProgress,a="arraybuffer"===e.responseType,l=a?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=c&&z(c)?c:u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(i,e,this.response)},t.timeout),self.fetch(this.request).then(d=>{this.response=this.loader=d;const h=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(i,e,this.response)},u-(h-i.loading.start)),!d.ok){const{status:f,statusText:p}=d;throw new NH(p||"fetch, bad network response",f,d)}return i.loading.first=h,i.total=function OH(n){const e=n.get("Content-Range");if(e){const r=function kH(n){const e=LH.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}(e);if(z(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}(d.headers)||i.total,o&&z(t.highWaterMark)?this.loadProgressively(d,i,e,t.highWaterMark,o):a?d.arrayBuffer():"json"===e.responseType?d.json():d.text()}).then(d=>{const{response:h}=this;self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const f=d[l];f&&(i.loaded=i.total=f);const p={url:h.url,data:d,code:h.status};o&&!z(t.highWaterMark)&&o(i,e,d,h),r.onSuccess(p,i,e,h)}).catch(d=>{self.clearTimeout(this.requestTimeout),i.aborted||r.onError({code:d&&d.code||0,text:d?d.message:null},e,d?d.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,i=0,s){const o=new sS,a=e.body.getReader(),l=()=>a.read().then(c=>{if(c.done)return o.dataLength&&s(t,r,o.flush(),e),Promise.resolve(new ArrayBuffer(0));const u=c.value,d=u.length;return t.loaded+=d,d<i||o.dataLength?(o.push(u),o.dataLength>=i&&s(t,r,o.flush(),e)):s(t,r,u,e),l()}).catch(()=>Promise.reject());return l()}}function PH(n,e){return new self.Request(n.url,e)}class NH extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const BH=/\s/,UH={newCue(n,e,t,r){const i=[];let s,o,a,l,c;const u=self.VTTCue||self.TextTrackCue;for(let h=0;h<r.rows.length;h++)if(s=r.rows[h],a=!0,l=0,c="",!s.isEmpty()){var d;for(let m=0;m<s.chars.length;m++)BH.test(s.chars[m].uchar)&&a?l++:(c+=s.chars[m].uchar,a=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const f=_S(c.trim()),p=fm(e,t,f);null!=n&&null!=(d=n.cues)&&d.getCueById(p)||(o=new u(e,t,f),o.id=p,o.line=h+1,o.align="left",o.position=10+Math.min(80,10*Math.floor(8*l/32)),i.push(o))}return n&&i.length&&(i.sort((h,f)=>"auto"===h.line||"auto"===f.line?0:h.line>8&&f.line>8?f.line-h.line:h.line-f.line),i.forEach(h=>Dx(n,h))),i}},$H=zt(zt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:MS,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class G8{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;const t=e.config;this.bwEstimator=new j8(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:e}=this;e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,t){var r;const i=t.frag;this.ignoreFragment(i)||(this.fragCurrent=i,this.partCurrent=null!=(r=t.part)?r:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,t){this.clearTimer()}getTimeToLoadFrag(e,t,r,i){return e+r/t+(i?this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const r=this.hls.config,{total:i,bwEstimate:s}=t.stats;z(i)&&z(s)&&(this.lastLevelLoadSec=8*i/s),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{autoLevelEnabled:i,media:s}=r;if(!e||!s)return;const o=performance.now(),a=t?t.stats:e.stats,l=t?t.duration:e.duration,c=o-a.loading.start;if(a.aborted||a.loaded&&a.loaded===a.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!i||s.paused||!s.playbackRate||!s.readyState)return;const u=r.mainForwardBufferInfo;if(null===u)return;const d=this.bwEstimator.getEstimateTTFB(),h=Math.abs(s.playbackRate);if(c<=Math.max(d,l/(2*h)*1e3))return;const f=u.len/h;if(f>=2*l/h)return;const p=a.loading.first?a.loading.first-a.loading.start:-1,m=a.loaded&&p>-1,g=this.bwEstimator.getEstimate(),{levels:v,minAutoLevel:_}=r,E=a.total||Math.max(a.loaded,Math.round(l*v[e.level].maxBitrate/8));let T=c-p;T<1&&m&&(T=Math.min(c,8*a.loaded/g));const I=m?1e3*a.loaded/T:0,C=I?(E-a.loaded)/I:8*E/g+d/1e3;if(C<=f)return;const k=I?8*I:g;let S,N=Number.POSITIVE_INFINITY;for(S=e.level-1;S>_&&(N=this.getTimeToLoadFrag(d/1e3,k,l*v[S].maxBitrate,!v[S].details),!(N<f));S--);N>=C||N>10*l||(r.nextLoadLevel=S,m?this.bwEstimator.sample(c-Math.min(d,p),a.loaded):this.bwEstimator.sampleTTFB(c),this.clearTimer(),D.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;\n      Time to underbuffer: ${f.toFixed(3)} s\n      Estimated load time for current fragment: ${C.toFixed(3)} s\n      Estimated load time for down switch fragment: ${N.toFixed(3)} s\n      TTFB estimate: ${p}\n      Current BW estimate: ${z(g)?(g/1024).toFixed(3):"Unknown"} Kb/s\n      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s\n      Aborting and switching to level ${S}`),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),r.trigger(y.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:a}))}onFragLoaded(e,{frag:t,part:r}){const i=r?r.stats:t.stats;if(t.type===te.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+i.loaded,l=(o.loaded?o.loaded.duration:0)+(r?r.duration:t.duration);o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}t.bitrateTest&&(this.onFragBuffered(y.FRAG_BUFFERED,{stats:i,frag:t,part:r,id:t.type}),t.bitrateTest=!1)}}onFragBuffered(e,t){const{frag:r,part:i}=t,s=null!=i&&i.stats.loaded?i.stats:r.stats;if(s.aborted||this.ignoreFragment(r))return;const o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.bwEstimator.getEstimate(),this.bitrateTestDelay=r.bitrateTest?o/1e3:0}ignoreFragment(e){return e.type!==te.MAIN||"initSegment"===e.sn}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const e=this._nextAutoLevel;if(-1!==e&&!this.bwEstimator.canEstimate())return e;let r=this.getNextABRAutoLevel();if(-1!==e){const i=this.hls.levels;if(i.length>Math.max(e,r)&&i[e].loadError<=i[r].loadError)return e}return-1!==e&&(r=Math.min(e,r)),r}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{maxAutoLevel:i,config:s,minAutoLevel:o,media:a}=r,l=t?t.duration:e?e.duration:0,c=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,d=r.mainForwardBufferInfo,h=(d?d.len:0)/c;let f=this.findBestLevel(u,o,i,h,s.abrBandWidthFactor,s.abrBandWidthUpFactor);if(f>=0)return f;D.trace(`[abr] ${h?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let p=l?Math.min(l,s.maxStarvationDelay):s.maxStarvationDelay,m=s.abrBandWidthFactor,g=s.abrBandWidthUpFactor;if(!h){const v=this.bitrateTestDelay;v&&(p=(l?Math.min(l,s.maxLoadingDelay):s.maxLoadingDelay)-v,D.trace(`[abr] bitrate test took ${Math.round(1e3*v)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),m=g=1)}return f=this.findBestLevel(u,o,i,h+p,m,g),Math.max(f,0)}findBestLevel(e,t,r,i,s,o){var a;const{fragCurrent:l,partCurrent:c,lastLoadedFragLevel:u}=this,{levels:d}=this.hls,h=d[u],f=!(null==h||null==(a=h.details)||!a.live),p=h?.codecSet,m=c?c.duration:l?l.duration:0,g=this.bwEstimator.getEstimateTTFB()/1e3;let v=t,_=-1;for(let b=r;b>=t;b--){const E=d[b];if(!E||p&&E.codecSet!==p){E&&(v=Math.min(b,v),_=Math.max(b,_));continue}-1!==_&&D.trace(`[abr] Skipped level(s) ${v}-${_} with CODECS:"${d[_].attrs.CODECS}"; not compatible with "${h.attrs.CODECS}"`);const T=E.details,I=(c?T?.partTarget:T?.averagetargetduration)||m;let C;C=b<=u?s*e:o*e;const k=d[b].maxBitrate,N=this.getTimeToLoadFrag(g,C,k*I,void 0===T);if(D.trace(`[abr] level:${b} adjustedbw-bitrate:${Math.round(C-k)} avgDuration:${I.toFixed(1)} maxFetchDuration:${i.toFixed(1)} fetchDuration:${N.toFixed(1)}`),C>k&&(0===N||!z(N)||f&&!this.bitrateTestDelay||N<i))return b}return-1}set nextAutoLevel(e){this._nextAutoLevel=e}},bufferController:class J8{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:t,mediaSource:r}=this;D.log("[buffer-controller]: Media source opened"),t&&(t.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(y.MEDIA_ATTACHED,{media:t})),r&&r.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{D.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{D.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:t,_objectUrl:r}=this;t&&t.src!==r&&D.error(`Media element src was set while attaching MediaSource (${r} > ${t.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_APPENDING,this.onBufferAppending,this),e.on(y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(y.BUFFER_EOS,this.onBufferEos,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.FRAG_PARSED,this.onFragParsed,this),e.on(y.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_APPENDING,this.onBufferAppending,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.BUFFER_EOS,this.onBufferEos,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.FRAG_PARSED,this.onFragParsed,this),e.off(y.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new X8(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,D.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const r=this.media=t.media;if(r&&cS){const i=this.mediaSource=new cS;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(i),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:r}=this;if(t){if(D.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(i){D.warn(`[buffer-controller]: onMediaDetaching: ${i.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):D.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(y.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{const t=this.sourceBuffer[e];try{t&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(t),this.sourceBuffer[e]=void 0)}catch(r){D.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,r)}}),this._initSourceBuffer()}onBufferCodecs(e,t){const r=this.getSourceBufferTypes().length;Object.keys(t).forEach(i=>{if(r){const s=this.tracks[i];if(s&&"function"==typeof s.buffer.changeType){const{id:o,codec:a,levelCodec:l,container:c,metadata:u}=t[i],d=(s.levelCodec||s.codec).replace(uS,"$1"),h=(l||a).replace(uS,"$1");d!==h&&(this.appendChangeType(i,`${c};codecs=${l||a}`),D.log(`[buffer-controller]: switching codec ${d} to ${h}`),this.tracks[i]={buffer:s.buffer,codec:a,container:c,levelCodec:l,metadata:u,id:o})}}else this.pendingTracks[i]=t[i]}),!r&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())}appendChangeType(e,t){const{operationQueue:r}=this,i={execute:()=>{const s=this.sourceBuffer[e];s&&(D.log(`[buffer-controller]: changing ${e} sourceBuffer type to ${t}`),s.changeType(t)),r.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:s=>{D.warn(`[buffer-controller]: Failed to change ${e} SourceBuffer type`,s)}};r.append(i,e)}onBufferAppending(e,t){const{hls:r,operationQueue:i,tracks:s}=this,{data:o,type:a,frag:l,part:c,chunkMeta:u}=t,d=u.buffering[a],h=self.performance.now();d.start=h;const f=l.stats.buffering,p=c?c.stats.buffering:null;0===f.start&&(f.start=h),p&&0===p.start&&(p.start=h);let g=!1;"audio"===a&&"audio/mpeg"===s.audio?.container&&(g=!this.lastMpegAudioChunk||1===u.id||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const v=l.start;i.append({execute:()=>{if(d.executeStart=self.performance.now(),g){const b=this.sourceBuffer[a];if(b){const E=v-b.timestampOffset;Math.abs(E)>=.1&&(D.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${v} (delta: ${E}) sn: ${l.sn})`),b.timestampOffset=v)}}this.appendExecutor(o,a)},onStart:()=>{},onComplete:()=>{const b=self.performance.now();d.executeEnd=d.end=b,0===f.first&&(f.first=b),p&&0===p.first&&(p.first=b);const{sourceBuffer:E}=this,T={};for(const I in E)T[I]=Ue.getBuffered(E[I]);this.appendError=0,this.hls.trigger(y.BUFFER_APPENDED,{type:a,frag:l,part:c,chunkMeta:u,parent:l.type,timeRanges:T})},onError:b=>{D.error(`[buffer-controller]: Error encountered while trying to append to the ${a} SourceBuffer`,b);const E={type:X.MEDIA_ERROR,parent:l.type,details:x.BUFFER_APPEND_ERROR,frag:l,part:c,chunkMeta:u,error:b,err:b,fatal:!1};b.code===DOMException.QUOTA_EXCEEDED_ERR?E.details=x.BUFFER_FULL_ERROR:(this.appendError++,E.details=x.BUFFER_APPEND_ERROR,this.appendError>r.config.appendErrorMaxRetry&&(D.error(`[buffer-controller]: Failed ${r.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),E.fatal=!0)),r.trigger(y.ERROR,E)}},a)}onBufferFlushing(e,t){const{operationQueue:r}=this,i=s=>({execute:this.removeExecutor.bind(this,s,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(y.BUFFER_FLUSHED,{type:s})},onError:o=>{D.warn(`[buffer-controller]: Failed to remove from ${s} SourceBuffer`,o)}});t.type?r.append(i(t.type),t.type):this.getSourceBufferTypes().forEach(s=>{r.append(i(s),s)})}onFragParsed(e,t){const{frag:r,part:i}=t,s=[],o=i?i.elementaryStreams:r.elementaryStreams;o[we.AUDIOVIDEO]?s.push("audiovideo"):(o[we.AUDIO]&&s.push("audio"),o[we.VIDEO]&&s.push("video")),0===s.length&&D.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(()=>{const l=self.performance.now();r.stats.buffering.end=l,i&&(i.stats.buffering.end=l),this.hls.trigger(y.FRAG_BUFFERED,{frag:r,part:i,stats:i?i.stats:r.stats,id:r.type})},s)}onFragChanged(e,t){this.flushBackBuffer()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((i,s)=>{const o=this.sourceBuffer[s];return o&&(!t.type||t.type===s)&&(o.ending=!0,o.ended||(o.ended=!0,D.log(`[buffer-controller]: ${s} sourceBuffer now EOS`))),i&&!(o&&!o.ended)},!0)&&(D.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(s=>{const o=this.sourceBuffer[s];o&&(o.ending=!1)});const{mediaSource:i}=this;i&&"open"===i.readyState?(D.log("[buffer-controller]: Calling mediaSource.endOfStream()"),i.endOfStream()):i&&D.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${i.readyState}`)}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:e,details:t,media:r,sourceBuffer:i}=this;if(!r||null===t)return;const s=this.getSourceBufferTypes();if(!s.length)return;const o=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(!z(o)||o<0)return;const a=r.currentTime,l=t.levelTargetDuration,c=Math.max(o,l),u=Math.floor(a/l)*l-c;s.forEach(d=>{const h=i[d];if(h){const f=Ue.getBuffered(h);if(f.length>0&&u>f.start(0)){if(e.trigger(y.BACK_BUFFER_REACHED,{bufferEnd:u}),t.live)e.trigger(y.LIVE_BACK_BUFFER_REACHED,{bufferEnd:u});else if(h.ended&&f.end(f.length-1)-a<2*l)return void D.info(`[buffer-controller]: Cannot flush ${d} back buffer while SourceBuffer is in ended state`);e.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:u,type:d})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{details:e,hls:t,media:r,mediaSource:i}=this,s=e.fragments[0].start+e.totalduration,o=r.duration,a=z(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(D.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=1/0,this.updateSeekableRange(e)):(s>a&&s>o||!z(o))&&(D.log(`[buffer-controller]: Updating Media Source duration to ${s.toFixed(3)}`),i.duration=s)}updateSeekableRange(e){const t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&null!=t&&t.setLiveSeekableRange){const s=Math.max(0,r[0].start),o=Math.max(s,s+e.totalduration);t.setLiveSeekableRange(s,o)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:r}=this,i=Object.keys(r).length;if(i&&!e||2===i){this.createSourceBuffers(r),this.pendingTracks={};const s=this.getSourceBufferTypes();if(s.length)this.hls.trigger(y.BUFFER_CREATED,{tracks:this.tracks}),s.forEach(o=>{t.executeNext(o)});else{const o=new Error("could not create source buffer for media codec(s)");this.hls.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:o,reason:o.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(const i in e)if(!t[i]){const s=e[i];if(!s)throw Error(`source buffer exists for track ${i}, however track does not`);const o=s.levelCodec||s.codec,a=`${s.container};codecs=${o}`;D.log(`[buffer-controller]: creating sourceBuffer(${a})`);try{const l=t[i]=r.addSourceBuffer(a),c=i;this.addBufferListener(c,"updatestart",this._onSBUpdateStart),this.addBufferListener(c,"updateend",this._onSBUpdateEnd),this.addBufferListener(c,"error",this._onSBUpdateError),this.tracks[i]={buffer:l,codec:o,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id}}catch(l){D.error(`[buffer-controller]: error while trying to add sourceBuffer: ${l.message}`),this.hls.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:l,mimeType:a})}}}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){const{operationQueue:t}=this;t.current(e).onComplete(),t.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){const r=new Error(`${e} SourceBuffer error`);D.error(`[buffer-controller]: ${r}`,t),this.hls.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.BUFFER_APPENDING_ERROR,error:r,fatal:!1});const i=this.operationQueue.current(e);i&&i.onError(t)}removeExecutor(e,t,r){const{media:i,mediaSource:s,operationQueue:o,sourceBuffer:a}=this,l=a[e];if(!i||!s||!l)return D.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void o.shiftAndExecuteNext(e);const c=z(i.duration)?i.duration:1/0,u=z(s.duration)?s.duration:1/0,d=Math.max(0,t),h=Math.min(r,c,u);h>d&&!l.ending?(l.ended=!1,D.log(`[buffer-controller]: Removing [${d},${h}] from the ${e} SourceBuffer`),l.remove(d,h)):o.shiftAndExecuteNext(e)}appendExecutor(e,t){const{operationQueue:r,sourceBuffer:i}=this,s=i[t];if(!s)return D.warn(`[buffer-controller]: Attempting to append to the ${t} SourceBuffer, but it does not exist`),void r.shiftAndExecuteNext(t);s.ended=!1,s.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length)return D.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);const{operationQueue:r}=this,i=t.map(s=>r.appendBlocker(s));Promise.all(i).then(()=>{e(),t.forEach(s=>{const o=this.sourceBuffer[s];null!=o&&o.updating||r.shiftAndExecuteNext(s)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,r){const i=this.sourceBuffer[e];if(!i)return;const s=r.bind(this,e);this.listeners[e].push({event:t,listener:s}),i.addEventListener(t,s)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(r=>{t.removeEventListener(r.event,r.listener)})}},capLevelController:vm,errorController:class P${constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=D.log.bind(D,"[info]:"),this.warn=D.warn.bind(D,"[warning]:"),this.error=D.error.bind(D,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(y.ERROR,this.onError,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(y.ERROR,this.onError,this),e.off(y.ERROR,this.onErrorOut,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return e?.type===te.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r,i;if(t.fatal)return;const s=this.hls,o=t.context;switch(t.details){case x.FRAG_LOAD_ERROR:case x.FRAG_LOAD_TIMEOUT:case x.KEY_LOAD_ERROR:case x.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case x.FRAG_PARSING_ERROR:if(null!=(r=t.frag)&&r.gap)return void(t.errorAction={action:0,flags:0});case x.FRAG_GAP:case x.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=2);case x.LEVEL_EMPTY_ERROR:case x.LEVEL_PARSING_ERROR:{var a,l;const c=t.parent===te.MAIN?t.level:s.loadLevel;t.details===x.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(l=a.levelDetails)&&l.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,c):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,c))}return;case x.LEVEL_LOAD_ERROR:case x.LEVEL_LOAD_TIMEOUT:return void("number"==typeof o?.level&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.level)));case x.AUDIO_TRACK_LOAD_ERROR:case x.AUDIO_TRACK_LOAD_TIMEOUT:case x.SUBTITLE_LOAD_ERROR:case x.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){const c=s.levels[s.loadLevel];if(c&&(o.type===Ee.AUDIO_TRACK&&o.groupId===c.audioGroupId||o.type===Ee.SUBTITLE_TRACK&&o.groupId===c.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=2,void(t.errorAction.flags=1)}return;case x.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const u=s.levels[s.loadLevel]?.attrs["HDCP-LEVEL"];u&&(t.errorAction={action:2,flags:2,hdcpLevel:u})}return;case x.BUFFER_ADD_CODEC_ERROR:case x.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(i=t.level)?i:s.loadLevel));case x.INTERNAL_EXCEPTION:case x.BUFFER_APPENDING_ERROR:case x.BUFFER_APPEND_ERROR:case x.BUFFER_FULL_ERROR:case x.LEVEL_SWITCH_ERROR:case x.BUFFER_STALLED_ERROR:case x.BUFFER_SEEK_OVER_HOLE:case x.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:0,flags:0})}if(t.type===X.KEY_SYSTEM_ERROR){const c=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,c))}}getPlaylistRetryOrSwitchAction(e,t){var r;const s=wx(this.hls.config.playlistLoadPolicy,e),o=this.playlistError++,a=null==(r=e.response)?void 0:r.code;if(Gc(s,o,jc(e),a))return{action:5,flags:0,retryConfig:s,retryCount:o};const c=this.getLevelSwitchAction(e,t);return s&&(c.retryConfig=s,c.retryCount=o),c}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],{fragLoadPolicy:s,keyLoadPolicy:o}=t.config,a=wx(e.details.startsWith("key")?o:s,e),l=t.levels.reduce((d,h)=>d+h.fragmentError,0);if(i){var c;e.details!==x.FRAG_GAP&&i.fragmentError++;const d=null==(c=e.response)?void 0:c.code;if(Gc(a,l,jc(e),d))return{action:5,flags:0,retryConfig:a,retryCount:l}}const u=this.getLevelSwitchAction(e,r);return a&&(u.retryConfig=a,u.retryCount=l),u}getLevelSwitchAction(e,t){const r=this.hls;null==t&&(t=r.loadLevel);const i=this.hls.levels[t];if(i&&(i.loadError++,r.autoLevelEnabled)){var s,o;let a=-1;const{levels:l,loadLevel:c,minAutoLevel:u,maxAutoLevel:d}=r,h=null==(s=e.frag)?void 0:s.type,{type:f,groupId:p}=null!=(o=e.context)?o:{};for(let m=l.length;m--;){const g=(m+c)%l.length;if(g!==c&&g>=u&&g<=d&&0===l[g].loadError){const v=l[g];if(e.details===x.FRAG_GAP&&e.frag){const _=l[g].details;if(_){const b=ha(e.frag,_.fragments,e.frag.start);if(null!=b&&b.gap)continue}}else{if(f===Ee.AUDIO_TRACK&&p===v.audioGroupId||f===Ee.SUBTITLE_TRACK&&p===v.textGroupId)continue;if(h===te.AUDIO&&i.audioGroupId===v.audioGroupId||h===te.SUBTITLE&&i.textGroupId===v.textGroupId)continue}a=g;break}}if(a>-1&&r.loadLevel!==a)return e.levelRetry=!0,this.playlistError=0,{action:2,flags:0,nextAutoLevel:a}}return{action:2,flags:1}}onErrorOut(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case 0:break;case 2:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==x.FRAG_GAP&&(t.fatal=!0)}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:i,hdcpLevel:s,nextAutoLevel:o}=r;switch(i){case 0:this.switchLevel(e,o);break;case 1:r.resolved||(r.resolved=this.redundantFailover(e));break;case 2:s&&(t.maxHdcpLevel=Up[Up.indexOf(s)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}r.resolved||this.switchLevel(e,o)}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(e){const{hls:t,penalizedRenditions:r}=this,i=e.parent===te.MAIN?e.level:t.loadLevel,s=t.levels[i],o=s.url.length,a=e.frag?e.frag.urlId:s.urlId;s.urlId===a&&(!e.frag||s.details)&&this.penalizeRendition(s,e);for(let l=1;l<o;l++){const c=(a+l)%o,u=r[c];if(!u||N$(u,e,r[a]))return this.warn(`Switching to Redundant Stream ${c+1}/${o}: "${s.url[c]}" after ${e.details}`),this.playlistError=0,t.levels.forEach(d=>{d.urlId=c}),t.nextLoadLevel=i,!0}return!1}penalizeRendition(e,t){const{penalizedRenditions:r}=this,i=r[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};i.lastErrorPerfMs=performance.now(),i.errors.push(t),i.details=e.details,r[e.urlId]=i}},fpsController:class xH{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&"function"==typeof i.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,r){const i=performance.now();if(t){if(this.lastTime){const o=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/(i-this.lastTime),c=this.hls;if(c.trigger(y.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:r}),l>0&&o>c.config.fpsDroppedMonitoringThreshold*a){let u=c.currentLevel;D.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=u)&&(u-=1,c.trigger(y.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:YT,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},function HH(){return{cueHandler:UH,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}()),{},{subtitleStreamController:class Y8 extends Yp{constructor(e,t,r){super(e,t,r,"[subtitle-stream-controller]",te.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.ERROR,this.onError,this),e.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.ERROR,this.onError,this),e.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state="IDLE",this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:i}=t;if(this.fragPrevious=r,this.state="IDLE",!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o;const a=r.start;for(let c=0;c<s.length;c++)if(a>=s[c].start&&a<=s[c].end){o=s[c];break}const l=r.start+r.duration;o?o.end=l:(o={start:a,end:l},s.push(o)),this.fragmentTracker.fragBuffered(r)}onBufferFlushing(e,t){const{startOffset:r,endOffset:i}=t;if(0===r&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;)if(o[a].end<=s)o.shift();else{if(!(o[a].start<s))break;o[a].start=s,a++}}),this.fragmentTracker.removeFragmentsInRange(r,s,te.SUBTITLE)}}onFragBuffered(e,t){var r;this.loadedmetadata||t.frag.type!==te.MAIN||null!=(r=this.media)&&r.buffered.length&&(this.loadedmetadata=!0)}onError(e,t){t.frag?.type===te.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),"STOPPED"!==this.state&&(this.state="IDLE"))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){aS(this.levels,t)?this.levels=t.map(r=>new da(r)):(this.tracksBuffered=[],this.levels=t.map(r=>{const i=new da(r);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,te.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){if(this.currentTrackId=t.id,!this.levels.length||-1===this.currentTrackId)return void this.clearInterval();const r=this.levels[this.currentTrackId];this.mediaBuffer=null!=r&&r.details?this.mediaBufferTimeRanges:null,r&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var r;const{details:i,id:s}=t,{currentTrackId:o,levels:a}=this;if(!a.length)return;const l=a[o];if(s>=a.length||s!==o||!l)return;this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(i.live||null!=(r=l.details)&&r.live){const u=this.mainDetails;if(i.deltaUpdateFailed||!u)return;const d=u.fragments[0];l.details?(c=this.alignPlaylists(i,l.details),0===c&&d&&(c=d.start,$p(i,c))):i.hasProgramDateTime&&u.hasProgramDateTime?(Nx(i,u),c=i.fragments[0].start):d&&(c=d.start,$p(i,c))}l.details=i,this.levelLastLoaded=s,!this.startFragRequested&&(this.mainDetails||!i.live)&&this.setStartPosition(l.details,c),this.tick(),i.live&&!this.fragCurrent&&this.media&&"IDLE"===this.state&&(ha(null,i.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&i&&i.key&&i.iv&&"AES-128"===i.method){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer).catch(a=>{throw s.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();s.trigger(y.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state="IDLE"})}}doTick(){if(this.media){if("IDLE"===this.state){const{currentTrackId:e,levels:t}=this,r=t[e];if(!t.length||!r||!r.details)return;const{config:i}=this,s=this.getLoadPosition(),o=Ue.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:a,len:l}=o,c=this.getFwdBufferInfo(this.media,te.MAIN),u=r.details;if(l>this.getMaxBufferLength(c?.len)+u.levelTargetDuration)return;const h=u.fragments,f=h.length,p=u.edge;let m=null;const g=this.fragPrevious;if(a<p){const v=i.maxFragLookUpTolerance,_=a>p-v?0:v;m=ha(g,h,Math.max(h[0].start,a),_),!m&&g&&g.start<h[0].start&&(m=h[0])}else m=h[f-1];if(!m)return;if(m=this.mapToInitFragWhenRequired(m),"initSegment"!==m.sn){const _=h[m.sn-u.startSN-1];_&&_.cc===m.cc&&"NOT_LOADED"===this.fragmentTracker.getState(_)&&(m=_)}"NOT_LOADED"===this.fragmentTracker.getState(m)&&this.loadFragment(m,r,a)}}else this.state="IDLE"}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,r){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,r))}get mediaBufferTimeRanges(){return new Q8(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class Z8 extends Gp{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),am(this.media.textTracks).forEach(t=>{Fs(t)}),this.subtitleTrack=-1,this.media=null)}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,details:i}=t,{trackId:s}=this,o=this.tracksInGroup[s];if(!o)return void this.warn(`Invalid subtitle track id ${r}`);const a=o.details;o.details=t.details,this.log(`subtitle track ${r} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.textGroupIds)return;const r=t.textGroupIds[t.urlId],i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==r){const s=this.tracks.filter(l=>!r||l.groupId===r);this.tracksInGroup=s;const o=this.findTrackId(i?.name)||this.findTrackId();this.groupId=r||null;const a={subtitleTracks:s};this.log(`Updating subtitle tracks, ${s.length} track(s) found in "${r}" group-id`),this.hls.trigger(y.SUBTITLE_TRACKS_UPDATED,a),-1!==o&&this.setSubtitleTrack(o,i)}else this.shouldReloadPlaylist(i)&&this.setSubtitleTrack(this.trackId,i)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if((!this.selectDefaultTrack||i.default)&&(!e||e===i.name))return i.id}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Ee.SUBTITLE_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e,this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0)}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const r=t.id,i=t.groupId;let s=t.url;if(e)try{s=e.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`Loading subtitle playlist for id ${r}`),this.hls.trigger(y.SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:e||null})}}toggleTrackModes(e){const{media:t,trackId:r}=this;if(!t)return;const i=am(t.textTracks),s=i.filter(a=>a.groupId===this.groupId);if(-1===e)[].slice.call(i).forEach(a=>{a.mode="disabled"});else{const a=s[r];a&&(a.mode="disabled")}const o=s[e];o&&(o.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(e,t){var r;const i=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(this.trackId!==e&&this.toggleTrackModes(e),this.trackId===e&&(-1===e||null!=(r=i[e])&&r.details)||e<-1||e>=i.length)return;this.clearTimer();const s=i[e];if(this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:"")),this.trackId=e,s){const{id:o,groupId:a="",name:l,type:c,url:u}=s;this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:c,url:u});const d=this.switchParams(s.url,t?.details);this.loadPlaylist(d)}else this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:e})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=-1;const t=am(this.media.textTracks);for(let r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},timelineController:class EH{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const t=new Jc(this,"textTrack1"),r=new Jc(this,"textTrack2"),i=new Jc(this,"textTrack3"),s=new Jc(this,"textTrack4");this.cea608Parser1=new mS(1,t,r),this.cea608Parser2=new mS(3,i,s)}e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(y.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(y.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(e,t,r,i,s){let o=!1;for(let a=s.length;a--;){const l=s[a],c=TH(l[0],l[1],t,r);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),o=!0,c/(r-t)>.5))return}if(o||s.push([t,r]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[e],t,r,i);else{const a=this.Cues.newCue(null,t,r,i);this.hls.trigger(y.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){const{unparsedVttFrags:o}=this;"main"===r&&(this.initPTS[t.cc]={baseTime:i,timescale:s}),o.length&&(this.unparsedVttFrags=[],o.forEach(a=>{this.onFragLoaded(y.FRAG_LOADED,a)}))}getExistingTrack(e){const{media:t}=this;if(t)for(let r=0;r<t.textTracks.length;r++){const i=t.textTracks[r];if(i[e])return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:i}=this,{label:s,languageCode:o}=t[e],a=this.getExistingTrack(e);if(a)r[e]=a,Fs(r[e]),Ex(r[e],i);else{const l=this.createTextTrack("captions",s,o);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,r){const i=this.media;if(i)return i.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{Fs(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Fs(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],i=r.some(s=>s.textCodec===pm);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(aS(this.tracks,r))return void(this.tracks=r);if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media?this.media.textTracks:null;this.tracks.forEach((a,l)=>{let c;if(o&&l<o.length){let u=null;for(let d=0;d<o.length;d++)if(DH(o[d],a)){u=o[d];break}u&&(c=u)}if(c)Fs(c);else{const u=this._captionsOrSubtitlesFromCharacteristics(a);c=this.createTextTrack(u,a.name,a.lang),c&&(c.mode="disabled")}c&&(c.groupId=a.groupId,this.textTracks.push(c))})}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){const t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&r)return"captions"}return"subtitles"}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const i=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!i)return;const o=this.captionsProperties[`textTrack${i[1]}`];o&&(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){return this.hls.levels[e.level]?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){const{cea608Parser1:r,cea608Parser2:i,lastSn:s,lastPartIndex:o}=this;if(this.enabled&&r&&i&&t.frag.type===te.MAIN){var a,l;const c=t.frag.sn,u=null!=(a=null==t||null==(l=t.part)?void 0:l.index)?a:-1;c===s+1||c===s&&u===o+1||(r.reset(),i.reset()),this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:r,payload:i}=t;if(r.type===te.SUBTITLE)if(i.byteLength){const s=r.decryptdata;if(null==s||!s.encrypted||"stats"in t){const a=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),a&&a.textCodec===pm?this._parseIMSC1(r,i):this._parseVTTs(t)}}else this.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;TS(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),r.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{D.log(`Failed to parse IMSC1: ${i}`),r.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:r,payload:i}=e,{initPTS:s,unparsedVttFrags:o}=this,a=s.length-1;if(!s[r.cc]&&-1===a)return void o.push(e);const l=this.hls;!function mH(n,e,t,r,i,s,o){const a=new dH,l=ir(new Uint8Array(n)).trim().replace(hH,"\n").split("\n"),c=[],u=e?function C8(n,e=1){return Jp(n,Qx,1/e)}(e.baseTime,e.timescale):0;let p,d="00:00.000",h=0,f=0,m=!0;a.oncue=function(g){const v=t[r];let _=t.ccOffset;const b=(h-u)/9e4;if(null!=v&&v.new&&(void 0!==f?_=t.ccOffset=v.start:pH(t,r,b)),b){if(!e)return void(p=new Error("Missing initPTS for VTT MPEGTS"));_=b-t.presentationOffset}const E=g.endTime-g.startTime,T=Dn(9e4*(g.startTime+_-f),9e4*i)/9e4;g.startTime=Math.max(T,0),g.endTime=Math.max(T+E,0);const I=g.text.trim();g.text=decodeURIComponent(encodeURIComponent(I)),g.id||(g.id=fm(g.startTime,g.endTime,I)),g.endTime>0&&c.push(g)},a.onparsingerror=function(g){p=g},a.onflush=function(){p?o(p):s(c)},l.forEach(g=>{if(m){if(dm(g,"X-TIMESTAMP-MAP=")){m=!1,g.slice(16).split(",").forEach(v=>{dm(v,"LOCAL:")?d=v.slice(6):dm(v,"MPEGTS:")&&(h=parseInt(v.slice(7)))});try{f=fH(d)/1e3}catch(v){p=v}return}""===g&&(m=!1)}a.parse(g+"\n")}),a.flush()}(null!=(t=r.initSegment)&&t.data?Ci(r.initSegment.data,new Uint8Array(i)):i,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,u=>{this._appendCues(u,r.level),l.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},u=>{const d="Missing initPTS for VTT MPEGTS"===u.message;d?o.push(e):this._fallbackToIMSC1(r,i),D.log(`Failed to parse VTT cue: ${u}`),!(d&&a>r.cc)&&l.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:u})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||TS(t,this.initPTS[e.cc],()=>{r.textCodec=pm,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||"disabled"===i.mode)return;e.forEach(s=>Dx(i,s))}else{const i=this.tracks[t];if(!i)return;r.trigger(y.CUES_PARSED,{type:"subtitles",cues:e,track:i.default?"default":"subtitles"+t})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===te.SUBTITLE&&this.onFragLoaded(y.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){const{cea608Parser1:r,cea608Parser2:i}=this;if(!this.enabled||!r||!i)return;const{frag:s,samples:o}=t;if(s.type!==te.MAIN||"NONE"!==this.closedCaptionsForLevel(s))for(let a=0;a<o.length;a++){const l=o[a].bytes;if(l){const c=this.extractCea608Data(l);r.addData(o[a].pts,c[0]),i.addData(o[a].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:i,type:s}){const{media:o}=this;if(o&&!(o.currentTime<r)){if(!s||"video"===s){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>Pp(a[l],t,r))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==i){const{textTracks:a}=this;Object.keys(a).forEach(l=>Pp(a[l],t,i))}}}extractCea608Data(e){const t=[[],[]],r=31&e[0];let i=2;for(let s=0;s<r;s++){const o=e[i++],a=127&e[i++],l=127&e[i++];if((0!==a||0!==l)&&0!=(4&o)){const u=3&o;(0===u||1===u)&&(t[u].push(a),t[u].push(l))}}return t}},audioStreamController:class z8 extends Yp{constructor(e,t,r){super(e,t,r,"[audio-stream-controller]",te.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.ERROR,this.onError,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.ERROR,this.onError,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){if("main"===r){const o=t.cc;this.initPTS[t.cc]={baseTime:i,timescale:s},this.log(`InitPTS for cc: ${o} found from main: ${i}`),this.videoTrackCC=o,"WAITING_INIT_PTS"===this.state&&this.tick()}}startLoad(e){if(!this.levels)return this.startPosition=e,void(this.state="STOPPED");const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state="IDLE"):(this.loadedmetadata=!1,this.state="WAITING_TRACK"),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case"IDLE":this.doTickIdle();break;case"WAITING_TRACK":{var e;const{levels:r,trackId:i}=this,s=null==r||null==(e=r[i])?void 0:e.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state="WAITING_INIT_PTS"}break}case"FRAG_LOADING_WAITING_RETRY":{var t;const r=performance.now(),i=this.retryDate;(!i||r>=i||null!=(t=this.media)&&t.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state="IDLE");break}case"WAITING_INIT_PTS":{const r=this.waitingData;if(r){const{frag:i,part:s,cache:o,complete:a}=r;if(void 0!==this.initPTS[i.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state="FRAG_LOADING";const c={frag:i,part:s,payload:o.flush(),networkDetails:null};this._handleFragmentLoadProgress(c),a&&super._handleFragmentLoadComplete(c)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${i.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const l=this.getLoadPosition(),c=Ue.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);jp(c.end,this.config.maxFragLookUpTolerance,i)<0&&(this.log(`Waiting fragment cc (${i.cc}) @ ${i.start} cancelled because another fragment at ${c.end} is needed`),this.clearWaitingFragment())}}else this.state="IDLE"}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state="IDLE")}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:r,trackId:i}=this;if(null==t||!t[i]||!r&&(this.startFragRequested||!e.config.startFragPrefetch))return;const o=t[i],a=o.details;if(!a||a.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(a))return void(this.state="WAITING_TRACK");const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,we.AUDIO,te.AUDIO));const c=this.getFwdBufferInfo(l,te.AUDIO);if(null===c)return;const{bufferedTrack:u,switchingTrack:d}=this;if(!d&&this._streamEnded(c,a))return e.trigger(y.BUFFER_EOS,{type:"audio"}),void(this.state="ENDED");const h=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,te.MAIN),f=c.len,p=this.getMaxBufferLength(h?.len);if(f>=p&&!d)return;const g=a.fragments[0].start;let v=c.end;if(d&&r){const T=this.getLoadPosition();u&&d.attrs!==u.attrs&&(v=T),a.PTSKnown&&T<g&&(c.end>g||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=g+.05)}let _=this.getNextFragment(v,a),b=!1;if(_&&this.isLoopLoading(_,v)&&(b=!!_.gap,_=this.getNextFragmentLoopLoading(_,a,c,te.MAIN,p)),!_)return void(this.bufferFlushed=!0);const E=h&&_.start>h.end+a.targetduration;if(E||(null==h||!h.len)&&c.len){const T=this.getAppendedFrag(_.start,te.MAIN);if(null===T||(b||(b=!!T.gap||!!E&&0===h.len),E&&!b||b&&c.nextStart&&c.nextStart<T.end))return}this.loadFragment(_,o,v)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new da(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state="IDLE"):(this.switchingTrack=null,this.bufferedTrack=t,this.state="STOPPED"),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(y.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var r;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=t);const{levels:i}=this,{details:s,id:o}=t;if(!i)return void this.warn(`Audio tracks were reset while loading level ${o}`);this.log(`Track ${o} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const a=i[o];let l=0;if(s.live||null!=(r=a.details)&&r.live){this.checkLiveUpdate(s);const c=this.mainDetails;if(s.deltaUpdateFailed||!c)return;!a.details&&s.hasProgramDateTime&&c.hasProgramDateTime?(Nx(s,c),l=s.fragments[0].start):l=this.alignPlaylists(s,a.details)}a.details=s,this.levelLastLoaded=o,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(a.details,l),"WAITING_TRACK"===this.state&&!this.waitForCdnTuneIn(s)&&(this.state="IDLE"),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:i,payload:s}=e,{config:o,trackId:a,levels:l}=this;if(!l)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const c=l[a];if(!c)return void this.warn("Audio track is undefined on fragment load progress");const u=c.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(r.start);const d=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new iS(this.hls,te.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[r.cc],p=null==(t=r.initSegment)?void 0:t.data;if(void 0!==f){const g=i?i.index:-1,_=new zp(r.level,r.sn,r.stats.chunkCount,s.byteLength,g,-1!==g);h.push(s,p,d,"",r,i,u.totalduration,!1,_,f)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:m}=this.waitingData=this.waitingData||{frag:r,part:i,cache:new sS,complete:!1};m.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state="WAITING_INIT_PTS"}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r.type===te.AUDIO)if(this.fragContextChanged(r))this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==r.sn){this.fragPrevious=r;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(y.AUDIO_TRACK_SWITCHED,zt({},s)))}this.fragBufferedComplete(r,i)}else if(!this.loadedmetadata&&r.type===te.MAIN){const s=this.videoBuffer||this.media;s&&Ue.getBuffered(s).length&&(this.loadedmetadata=!0)}}onError(e,t){var r;if(t.fatal)this.state="ERROR";else switch(t.details){case x.FRAG_GAP:case x.FRAG_PARSING_ERROR:case x.FRAG_DECRYPT_ERROR:case x.FRAG_LOAD_ERROR:case x.FRAG_LOAD_TIMEOUT:case x.KEY_LOAD_ERROR:case x.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(te.AUDIO,t);break;case x.AUDIO_TRACK_LOAD_ERROR:case x.AUDIO_TRACK_LOAD_TIMEOUT:case x.LEVEL_PARSING_ERROR:!t.levelRetry&&"WAITING_TRACK"===this.state&&(null==(r=t.context)?void 0:r.type)===Ee.AUDIO_TRACK&&(this.state="IDLE");break;case x.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case x.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushed(e,{type:t}){t===we.AUDIO&&(this.bufferFlushed=!0,"ENDED"===this.state&&(this.state="IDLE"))}_handleTransmuxComplete(e){var t;const r="audio",{hls:i}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a)return void this.resetWhenMissingContext(o);const{frag:l,part:c,level:u}=a,{details:d}=u,{audio:h,text:f,id3:p,initSegment:m}=s;if(!this.fragContextChanged(l)&&d){if(this.state="PARSING",this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=m&&m.tracks){const g=l.initSegment||l;this._bufferInitSegment(m.tracks,g,o),i.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:g,id:r,tracks:m.tracks})}if(h){const{startPTS:g,endPTS:v,startDTS:_,endDTS:b}=h;c&&(c.elementaryStreams[we.AUDIO]={startPTS:g,endPTS:v,startDTS:_,endDTS:b}),l.setElementaryStreamInfo(we.AUDIO,g,v,_,b),this.bufferFragmentData(h,l,c,o)}if(null!=p&&null!=(t=p.samples)&&t.length){const g=dt({id:r,frag:l,details:d},p);i.trigger(y.FRAG_PARSING_METADATA,g)}if(f){const g=dt({id:r,frag:l,details:d},f);i.trigger(y.FRAG_PARSING_USERDATA,g)}}else this.fragmentTracker.removeFragment(l)}_bufferInitSegment(e,t,r){if("PARSING"!==this.state)return;e.video&&delete e.video;const i=e.audio;if(!i)return;i.levelCodec=i.codec,i.id="audio",this.log(`Init audio buffer, container:${i.container}, codecs[parsed]=[${i.codec}]`),this.hls.trigger(y.BUFFER_CODECS,e);const s=i.initSegment;null!=s&&s.byteLength&&this.hls.trigger(y.BUFFER_APPENDING,{type:"audio",frag:t,part:null,chunkMeta:r,parent:t.type,data:s}),this.tick()}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);var s;this.fragCurrent=e,this.switchingTrack||"NOT_LOADED"===i||"PARTIAL"===i?"initSegment"===e.sn?this._loadInitSegment(e,t):null!=(s=t.details)&&s.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state="WAITING_INIT_PTS"):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){const{hls:t,media:r,bufferedTrack:i}=this,s=i?.attrs,o=e.attrs;r&&s&&(s.CHANNELS!==o.CHANNELS||s.NAME!==o.NAME||s.LANGUAGE!==o.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(y.AUDIO_TRACK_SWITCHED,zt({},e))}},audioTrackController:class W8 extends Gp{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==i)return void this.warn(`Track with id:${r} and group:${i} not found in active group ${o.groupId}`);const a=o.details;o.details=t.details,this.log(`audio-track ${r} "${o.name}" lang:${o.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.audioGroupIds)return;const r=t.audioGroupIds[t.urlId];if(this.groupId!==r){this.groupId=r||null;const i=this.tracks.filter(o=>!r||o.groupId===r);this.selectDefaultTrack&&!i.some(o=>o.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;const s={audioTracks:i};this.log(`Updating audio tracks, ${i.length} track(s) found in group:${r}`),this.hls.trigger(y.AUDIO_TRACKS_UPDATED,s),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===Ee.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid id passed to audio-track controller");this.clearTimer();const r=this.currentTrack,i=t[e],{groupId:s,name:o}=i;if(this.log(`Switching to audio-track ${e} "${o}" lang:${i.lang} group:${s}`),this.trackId=e,this.currentTrack=i,this.selectDefaultTrack=!1,this.hls.trigger(y.AUDIO_TRACK_SWITCHING,zt({},i)),i.details&&!i.details.live)return;const a=this.switchParams(i.url,r?.details);this.loadPlaylist(a)}selectInitialTrack(){const e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(-1!==t)this.setAudioTrack(t);else{const r=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${e.length}`);this.warn(r.message),this.hls.trigger(y.ERROR,{type:X.MEDIA_ERROR,details:x.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:r})}}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if((!this.selectDefaultTrack||i.default)&&(!e||void 0!==e.attrs["STABLE-RENDITION-ID"]&&e.attrs["STABLE-RENDITION-ID"]===i.attrs["STABLE-RENDITION-ID"]||e.name===i.name&&e.lang===i.lang))return i.id}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const r=t.id,i=t.groupId;let s=t.url;if(e)try{s=e.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`loading audio-track playlist ${r} "${t.name}" lang:${t.lang} group:${i}`),this.clearTimer(),this.hls.trigger(y.AUDIO_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:e||null})}}},emeController:SH,cmcdController:Qr,contentSteeringController:class IH{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=D.log.bind(D,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if(2===r?.action&&1===r.flags){let i=this.pathwayPriority;const s=this.pathwayId;this.penalizedPathways[s]||(this.penalizedPathways[s]=performance.now()),!i&&this.levels&&(i=this.levels.reduce((o,a)=>(-1===o.indexOf(a.pathwayId)&&o.push(a.pathwayId),o),[])),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==s)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this.pathwayPriority=e;const r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(s=>{i-r[s]>3e5&&delete r[s]});for(let s=0;s<e.length;s++){const o=e[s];if(r[o])continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,this.hls.trigger(y.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[a];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=a);break}}}clonePathways(e){const t=this.levels;if(!t)return;const r={},i={};e.forEach(s=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=s;if(t.some(u=>u.pathwayId===o))return;const c=this.getLevelsForPathway(a).map(u=>{const d=dt({},u);d.details=void 0,d.url=IS(u.uri,u.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l);const h=new Ke(u.attrs);h["PATHWAY-ID"]=o;const f=h.AUDIO&&`${h.AUDIO}_clone_${o}`,p=h.SUBTITLES&&`${h.SUBTITLES}_clone_${o}`;f&&(r[h.AUDIO]=f,h.AUDIO=f),p&&(i[h.SUBTITLES]=p,h.SUBTITLES=p),d.attrs=h;const m=new da(d);return Kc(m,"audio",f),Kc(m,"text",p),m});t.push(...c),wS(this.audioTracks,r,l,o),wS(this.subtitleTracks,i,l,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;let i;this.loader&&this.loader.destroy(),this.loader=new r(t);try{i=new self.URL(e)}catch{return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==i.protocol){const u=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+u)}const s={responseType:"json",url:i.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(u,d,h,f)=>{this.log(`Loaded steering manifest: "${i}"`);const p=u.data;if(1!==p.VERSION)return void this.log(`Steering VERSION ${p.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":m,"PATHWAY-CLONES":g,"PATHWAY-PRIORITY":v}=p;if(m)try{this.uri=new self.URL(m,i).href}catch{return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${m}`)}this.scheduleRefresh(this.uri||h.url),g&&this.clonePathways(g),v&&this.updatePathwayPriority(v)},onError:(u,d,h,f)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${d.url})`),this.stopLoad(),410===u.code)return this.enabled=!1,void this.log(`Steering manifest ${d.url} no longer available`);let p=1e3*this.timeToLoad;if(429!==u.code)this.scheduleRefresh(this.uri||d.url,p);else{const m=this.loader;if("function"==typeof m?.getResponseHeader){const g=m.getResponseHeader("Retry-After");g&&(p=1e3*parseFloat(g))}this.log(`Steering manifest ${d.url} rate limited`)}},onTimeout:(u,d,h)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,l,c)}scheduleRefresh(e,t=1e3*this.timeToLoad){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(e)},t)}}});function bm(n){return n&&"object"==typeof n?Array.isArray(n)?n.map(bm):Object.keys(n).reduce((e,t)=>(e[t]=bm(n[t]),e),{}):n}let Em,_m=(()=>{class n{static get version(){return"1.4.12"}static isSupported(){return function t8(){const n=$c();if(!n)return!1;const e=Bx();return!(!n||"function"!=typeof n.isTypeSupported||!n.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')||e&&(!e.prototype||"function"!=typeof e.prototype.appendBuffer||"function"!=typeof e.prototype.remove))}()}static get Events(){return y}static get ErrorTypes(){return X}static get ErrorDetails(){return x}static get DefaultConfig(){return n.defaultConfig?n.defaultConfig:$H}static set DefaultConfig(t){n.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new im,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,function AV(n,e){if(self.console&&!0===n||"object"==typeof n){!function CV(n,...e){e.forEach(function(t){la[t]=n[t]?n[t].bind(n):function SV(n){const e=self.console[n];return e?e.bind(self.console,`[${n}] >`):xi}(t)})}(n,"debug","log","info","warn","error");try{la.log(`Debug logs enabled for "${e}" in hls.js version 1.4.12`)}catch{la=Cp}}else la=Cp}(t.debug||!1,"Hls instance");const r=this.config=function jH(n,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=bm(n),i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(s=>{const o=`${"level"===s?"playlist":s}LoadPolicy`,a=void 0===e[o],l=[];i.forEach(c=>{const u=`${s}Loading${c}`,d=e[u];if(void 0!==d&&a){l.push(u);const h=t[o].default;switch(e[o]={default:h},c){case"TimeOut":h.maxLoadTimeMs=d,h.maxTimeToFirstByteMs=d;break;case"MaxRetry":h.errorRetry.maxNumRetry=d,h.timeoutRetry.maxNumRetry=d;break;case"RetryDelay":h.errorRetry.retryDelayMs=d,h.timeoutRetry.retryDelayMs=d;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=d,h.timeoutRetry.maxRetryDelayMs=d}}}),l.length&&D.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${o}": ${JSON.stringify(e[o])}`)}),zt(zt({},t),e)}(n.DefaultConfig,t);this.userConfig=t,this._autoLevelCapping=-1,r.progressive&&function GH(n){const e=n.loader;e!==RS&&e!==MS?(D.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):function RH(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(n.loader=RS,n.progressive=!0,n.enableSoftwareAES=!0,D.log("[config]: Progressive streaming enabled, using FetchLoader"))}(r);const{abrController:i,bufferController:s,capLevelController:o,errorController:a,fpsController:l}=r,c=new a(this),u=this.abrController=new i(this),d=this.bufferController=new s(this),h=this.capLevelController=new o(this),f=new l(this),p=new y$(this),m=new D$(this),g=r.contentSteeringController,v=g?new g(this):null,_=this.levelController=new B$(this,v),b=new U$(this),E=new $$(this.config),T=this.streamController=new H8(this,b,E);h.setStreamController(T),f.setStreamController(T);const I=[p,_,T];v&&I.splice(1,0,v),this.networkControllers=I;const C=[u,d,h,f,m,b];this.audioTrackController=this.createController(r.audioTrackController,I);const k=r.audioStreamController;k&&I.push(new k(this,b,E)),this.subtitleTrackController=this.createController(r.subtitleTrackController,I);const N=r.subtitleStreamController;N&&I.push(new N(this,b,E)),this.createController(r.timelineController,C),E.emeController=this.emeController=this.createController(r.emeController,C),this.cmcdController=this.createController(r.cmcdController,C),this.latencyController=this.createController(T$,C),this.coreComponents=C,I.push(c);const S=c.onErrorOut;"function"==typeof S&&this.on(y.ERROR,S,c)}createController(t,r){if(t){const i=new t(this);return r&&r.push(i),i}return null}on(t,r,i=this){this._emitter.on(t,r,i)}once(t,r,i=this){this._emitter.once(t,r,i)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,r,i=this,s){this._emitter.off(t,r,i,s)}listeners(t){return this._emitter.listeners(t)}emit(t,r,i){return this._emitter.emit(t,r,i)}trigger(t,r){if(this.config.debug)return this.emit(t,t,r);try{return this.emit(t,t,r)}catch(i){D.error("An internal error happened while handling event "+t+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.trigger(y.ERROR,{type:X.OTHER_ERROR,details:x.INTERNAL_EXCEPTION,fatal:!1,event:t,error:i})}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){D.log("destroy"),this.trigger(y.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(r=>r.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(r=>r.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){D.log("attachMedia"),this._media=t,this.trigger(y.MEDIA_ATTACHING,{media:t})}detachMedia(){D.log("detachMedia"),this.trigger(y.MEDIA_DETACHING,void 0),this._media=null}loadSource(t){this.stopLoad();const r=this.media,i=this.url,s=this.url=Sp.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});D.log(`loadSource:${s}`),r&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(r)),this.trigger(y.MANIFEST_LOADING,{url:t})}startLoad(t=-1){D.log(`startLoad(${t})`),this.networkControllers.forEach(r=>{r.startLoad(t)})}stopLoad(){D.log("stopLoad"),this.networkControllers.forEach(t=>{t.stopLoad()})}swapAudioCodec(){D.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){D.log("recoverMediaError");const t=this._media;this.detachMedia(),t&&this.attachMedia(t)}removeLevel(t,r=0){this.levelController.removeLevel(t,r)}get levels(){return this.levelController.levels||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){D.log(`set currentLevel:${t}`),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){D.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){D.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){D.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){return this.levelController.startLevel}set startLevel(t){D.log(`set startLevel:${t}`),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const r=!!t;r!==this.config.capLevelToPlayerSize&&(r?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=r)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(D.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){Up.indexOf(t)>-1&&(this._maxHdcpLevel=t)}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:r}}=this;if(!t)return 0;const i=t.length;for(let s=0;s<i;s++)if(t[s].maxBitrate>=r)return s;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:r,maxHdcpLevel:i}=this;let s;if(s=-1===r&&t&&t.length?t.length-1:r,i)for(let o=s;o--;){const a=t[o].attrs["HDCP-LEVEL"];if(a&&a<=i)return o}return s}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const r=this.audioTrackController;r&&(r.audioTrack=t)}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const r=this.subtitleTrackController;r&&(r.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return!!t&&t.subtitleDisplay}set subtitleDisplay(t){const r=this.subtitleTrackController;r&&(r.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}return n.defaultConfig=void 0,n})(),KH=(()=>{var n;class e{constructor(){this.localChannels=[{name:"PNN",url:"http://203.176.130.123:8989/live/pnn_480k.stream/playlist.m3u8"},{name:"TVK1",url:"https://live.kh.malimarcdn.com/live/tvk.stream/playlist.m3u8"},{name:"TVK2",url:"https://live.kh.malimarcdn.com/live/tvk2.stream/playlist.m3u8"},{name:"TV5",url:"http://203.176.130.123:8989/live/tv5_480k.stream/playlist.m3u8"},{name:"Bayonv TV",url:"  http://203.176.130.123:8989/live/bayontv_480k.stream/playlist.m3u8"},{name:"BTV",url:"  http://203.176.130.123:8989/live/bayontv1_480k.stream/playlist.m3u8"},{name:"SEA TV",url:"http://203.176.130.123:8989/live/seatv_480k.stream/playlist.m3u8"},{name:"WIKI TV",url:"http://206.189.93.160:1935/live/myStream_720p/playlist.m3u8"},{name:"CTV9",url:"http://203.176.130.123:8989/live/ctv9hd.stream/playlist.m3u8"},{name:"Fresh News",url:"https://streaming.freshnewsasia.com/live/ngrp:myStream_all/chunklist_w1992010384_b1496608.m3u8"},{name:"Apsara TV",url:"http://203.176.130.123:8989/live/apsaratv_480k.stream/playlist.m3u8"},{name:"Hang Meas TV",url:"http://167.99.72.244:1935/hm_hdtv/_definst_/smil:HMHDTV.smil/chunklist_w422093947_b800000_sleng.m3u8"},{name:"Raksmey Hang Mease",url:"http://malisresidencess.com:1934/rhm_hdtv/smil:RHMHDTV.smil/chunklist_w616528546_b1800000_sleng.m3u8"},{name:"TeaTv",url:"https://livefta.malimarcdn.com/ftaedge00/teatv2.sdp/playlist.m3u8"},{name:"KHMERTV",url:"https://livefta.malimarcdn.com/ftaedge00/khmertv2020.stream/chunklist.m3u8"},{name:"MSJ TV",url:"http://124.248.165.18:1935/live/myStream.smil/chunklist_w1860765658_b2260000_sleng.m3u8"},{name:"Netlink TV",url:"https://netlink.netlinkbroadcaster.com/hls/test.m3u8"}],this.globalChannels=[{name:"LOKAL",url:"http://andriant.my.id"},{name:"CH2 STARMAX",url:"http://stream.rs.co.th/ch2-hi/index.m3u8"},{name:"CH3 HD",url:"http://27.254.130.64/feed/ch3hd/playlist.m3u8"},{name:"CH5",url:"http://27.254.130.64/feed/ch5hd/playlist.m3u8"},{name:"CH7 HD",url:"http://27.254.130.64/feed/ch7hd/playlist.m3u8"},{name:"CH8",url:"http://stream.rs.co.th/ch8-hi/index.m3u8"},{name:"MCOT-HD",url:"http://27.254.130.64/feed/chmcothd/playlist.m3u8"},{name:"CH11 NBT",url:"http://27.254.130.64/live01/ch14.m3u8?p=m3u8"},{name:"CH11 NBT",url:"http://122.155.92.8:1935/live/ch1_L.sdp/chunklist.m3u8"},{name:"Workpoint",url:"https://gcorigin.wisdomcloud.net/live/master/playlist.m3u8_500.m3u8"}]}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();try{Em=typeof Intl<"u"&&Intl.v8BreakIterator}catch{Em=!1}let ma,Dm,Us=(()=>{class n{constructor(t){this._platformId=t,this.isBrowser=this._platformId?function ON(n){return n===ZE}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!Em)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(t){return new(t||n)(U(af))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function nu(n){return function zH(){if(null==ma&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>ma=!0}))}finally{ma=ma||!1}return ma}()?n:!!n.capture}function $s(n){return n.composedPath?n.composedPath()[0]:n.target}function FS(n){return Ar((e,t)=>n<=t)}function n3(n,e){return n===e}function kS(n){return Xe((e,t)=>{Jt(n).subscribe(We(t,()=>t.complete(),ku)),!t.closed&&e.subscribe(t)})}function OS(n){return null!=n&&"false"!=`${n}`}function PS(n){return Array.isArray(n)?n:[n]}function ga(n){return n instanceof Ct?n.nativeElement:n}class s3 extends Xt{constructor(e,t){super()}schedule(e,t=0){return this}}const iu={setInterval(n,e,...t){const{delegate:r}=iu;return r?.setInterval?r.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){const{delegate:e}=iu;return(e?.clearInterval||clearInterval)(n)},delegate:void 0},NS={now:()=>(NS.delegate||Date).now(),delegate:void 0};class ya{constructor(e,t=ya.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,r){return new this.schedulerActionCtor(this,e).schedule(r,t)}}ya.now=NS.now;const l3=new class a3 extends ya{constructor(e,t=ya.now){super(e,t),this.actions=[],this._active=!1}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}}(class o3 extends s3{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var r;if(this.closed)return this;this.state=e;const i=this.id,s=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(s,i,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,r=0){return iu.setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,t,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&iu.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let i,r=!1;try{this.work(e)}catch(s){r=!0,i=s||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:r}=t;this.work=this.state=this.scheduler=null,this.pending=!1,ki(r,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}),BS=new Set;let Hs,u3=(()=>{class n{constructor(t){this._platform=t,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):h3}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function d3(n){if(!BS.has(n))try{Hs||(Hs=document.createElement("style"),Hs.setAttribute("type","text/css"),document.head.appendChild(Hs)),Hs.sheet&&(Hs.sheet.insertRule(`@media ${n} {body{ }}`,0),BS.add(n))}catch(e){console.error(e)}}(t),this._matchMedia(t)}}return n.\u0275fac=function(t){return new(t||n)(U(Us))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function h3(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let f3=(()=>{class n{constructor(t,r){this._mediaMatcher=t,this._zone=r,this._queries=new Map,this._destroySubject=new un}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return US(PS(t)).some(i=>this._registerQuery(i).mql.matches)}observe(t){const i=US(PS(t)).map(o=>this._registerQuery(o).observable);let s=Wf(i);return s=pc(s.pipe(vi(1)),s.pipe(FS(1),function c3(n,e=l3){return Xe((t,r)=>{let i=null,s=null,o=null;const a=()=>{if(i){i.unsubscribe(),i=null;const c=s;s=null,r.next(c)}};function l(){const c=o+n,u=e.now();if(u<c)return i=this.schedule(void 0,c-u),void r.add(i);a()}t.subscribe(We(r,c=>{s=c,o=e.now(),i||(i=e.schedule(l,n),r.add(i))},()=>{a(),r.complete()},void 0,()=>{s=i=null}))})}(0))),s.pipe(pe(o=>{const a={matches:!1,breakpoints:{}};return o.forEach(({matches:l,query:c})=>{a.matches=a.matches||l,a.breakpoints[c]=l}),a}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const r=this._mediaMatcher.matchMedia(t),s={observable:new Ze(o=>{const a=l=>this._zone.run(()=>o.next(l));return r.addListener(a),()=>{r.removeListener(a)}}).pipe(MD(r),pe(({matches:o})=>({query:t,matches:o})),kS(this._destroySubject)),mql:r};return this._queries.set(t,s),s}}return n.\u0275fac=function(t){return new(t||n)(U(u3),U(Ae))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function US(n){return n.map(e=>e.split(",")).reduce((e,t)=>e.concat(t)).map(e=>e.trim())}function jS(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}function GS(n){const e=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!e||-1!==e.identifier||null!=e.radiusX&&1!==e.radiusX||null!=e.radiusY&&1!==e.radiusY)}const E3=new j("cdk-input-modality-detector-options"),D3={ignoreKeys:[18,17,224,91,16]},js=nu({passive:!0,capture:!0});let T3=(()=>{class n{get mostRecentModality(){return this._modality.value}constructor(t,r,i,s){this._platform=t,this._mostRecentTarget=null,this._modality=new bn(null),this._lastTouchMs=0,this._onKeydown=o=>{this._options?.ignoreKeys?.some(a=>a===o.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=$s(o))},this._onMousedown=o=>{Date.now()-this._lastTouchMs<650||(this._modality.next(jS(o)?"keyboard":"mouse"),this._mostRecentTarget=$s(o))},this._onTouchstart=o=>{GS(o)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=$s(o))},this._options={...D3,...s},this.modalityDetected=this._modality.pipe(FS(1)),this.modalityChanged=this.modalityDetected.pipe(function t3(n,e=kr){return n=n??n3,Xe((t,r)=>{let i,s=!0;t.subscribe(We(r,o=>{const a=e(o);(s||!n(i,a))&&(s=!1,i=a,r.next(o))}))})}()),t.isBrowser&&r.runOutsideAngular(()=>{i.addEventListener("keydown",this._onKeydown,js),i.addEventListener("mousedown",this._onMousedown,js),i.addEventListener("touchstart",this._onTouchstart,js)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,js),document.removeEventListener("mousedown",this._onMousedown,js),document.removeEventListener("touchstart",this._onTouchstart,js))}}return n.\u0275fac=function(t){return new(t||n)(U(Us),U(Ae),U(et),U(E3,8))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const S3=new j("cdk-focus-monitor-default-options"),su=nu({passive:!0,capture:!0});let C3=(()=>{class n{constructor(t,r,i,s,o){this._ngZone=t,this._platform=r,this._inputModalityDetector=i,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new un,this._rootNodeFocusAndBlurListener=a=>{for(let c=$s(a);c;c=c.parentElement)"focus"===a.type?this._onFocus(a,c):this._onBlur(a,c)},this._document=s,this._detectionMode=o?.detectionMode||0}monitor(t,r=!1){const i=ga(t);if(!this._platform.isBrowser||1!==i.nodeType)return W(null);const s=function qH(n){if(function WH(){if(null==Dm){const n=typeof document<"u"?document.head:null;Dm=!(!n||!n.createShadowRoot&&!n.attachShadow)}return Dm}()){const e=n.getRootNode?n.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&e instanceof ShadowRoot)return e}return null}(i)||this._getDocument(),o=this._elementInfo.get(i);if(o)return r&&(o.checkChildren=!0),o.subject;const a={checkChildren:r,subject:new un,rootNode:s};return this._elementInfo.set(i,a),this._registerGlobalListeners(a),a.subject}stopMonitoring(t){const r=ga(t),i=this._elementInfo.get(r);i&&(i.subject.complete(),this._setClasses(r),this._elementInfo.delete(r),this._removeGlobalListeners(i))}focusVia(t,r,i){const s=ga(t);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([a,l])=>this._originChanged(a,r,l)):(this._setOrigin(r),"function"==typeof s.focus&&s.focus(i))}ngOnDestroy(){this._elementInfo.forEach((t,r)=>this.stopMonitoring(r))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return 1===this._detectionMode||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,r){t.classList.toggle("cdk-focused",!!r),t.classList.toggle("cdk-touch-focused","touch"===r),t.classList.toggle("cdk-keyboard-focused","keyboard"===r),t.classList.toggle("cdk-mouse-focused","mouse"===r),t.classList.toggle("cdk-program-focused","program"===r)}_setOrigin(t,r=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&r,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,r){const i=this._elementInfo.get(r),s=$s(t);!i||!i.checkChildren&&r!==s||this._originChanged(r,this._getFocusOrigin(s),i)}_onBlur(t,r){const i=this._elementInfo.get(r);!i||i.checkChildren&&t.relatedTarget instanceof Node&&r.contains(t.relatedTarget)||(this._setClasses(r),this._emitOrigin(i,null))}_emitOrigin(t,r){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(r))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const r=t.rootNode,i=this._rootNodeFocusListenerCount.get(r)||0;i||this._ngZone.runOutsideAngular(()=>{r.addEventListener("focus",this._rootNodeFocusAndBlurListener,su),r.addEventListener("blur",this._rootNodeFocusAndBlurListener,su)}),this._rootNodeFocusListenerCount.set(r,i+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(kS(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(t){const r=t.rootNode;if(this._rootNodeFocusListenerCount.has(r)){const i=this._rootNodeFocusListenerCount.get(r);i>1?this._rootNodeFocusListenerCount.set(r,i-1):(r.removeEventListener("focus",this._rootNodeFocusAndBlurListener,su),r.removeEventListener("blur",this._rootNodeFocusAndBlurListener,su),this._rootNodeFocusListenerCount.delete(r))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,r,i){this._setClasses(t,r),this._emitOrigin(i,r),this._lastFocusOrigin=r}_getClosestElementsInfo(t){const r=[];return this._elementInfo.forEach((i,s)=>{(s===t||i.checkChildren&&s.contains(t))&&r.push([s,i])}),r}_isLastInteractionFromInputLabel(t){const{_mostRecentTarget:r,mostRecentModality:i}=this._inputModalityDetector;if("mouse"!==i||!r||r===t||"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName||t.disabled)return!1;const s=t.labels;if(s)for(let o=0;o<s.length;o++)if(s[o].contains(r))return!0;return!1}}return n.\u0275fac=function(t){return new(t||n)(U(Ae),U(Us),U(T3),U(et,8),U(S3,8))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const zS="cdk-high-contrast-black-on-white",WS="cdk-high-contrast-white-on-black",Tm="cdk-high-contrast-active";let A3=(()=>{class n{constructor(t,r){this._platform=t,this._document=r,this._breakpointSubscription=de(f3).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const r=this._document.defaultView||window,i=r&&r.getComputedStyle?r.getComputedStyle(t):null,s=(i&&i.backgroundColor||"").replace(/ /g,"");switch(t.remove(),s){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(Tm,zS,WS),this._hasCheckedHighContrastMode=!0;const r=this.getHighContrastMode();1===r?t.add(Tm,zS):2===r&&t.add(Tm,WS)}}}return n.\u0275fac=function(t){return new(t||n)(U(Us),U(et))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),qS=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Lt({type:n}),n.\u0275inj=Et({}),n})();const R3=new j("mat-sanity-checks",{providedIn:"root",factory:function M3(){return!0}});let ou=(()=>{class n{constructor(t,r,i){this._sanityChecks=r,this._document=i,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!function YH(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}}return n.\u0275fac=function(t){return new(t||n)(U(A3),U(R3,8),U(et))},n.\u0275mod=Lt({type:n}),n.\u0275inj=Et({imports:[qS,qS]}),n})();function L3(n){return class extends n{get disabled(){return this._disabled}set disabled(e){this._disabled=OS(e)}constructor(...e){super(...e),this._disabled=!1}}}function F3(n,e){return class extends n{get color(){return this._color}set color(t){const r=t||this.defaultColor;r!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),r&&this._elementRef.nativeElement.classList.add(`mat-${r}`),this._color=r)}constructor(...t){super(...t),this.defaultColor=e,this.color=e}}}function k3(n){return class extends n{get disableRipple(){return this._disableRipple}set disableRipple(e){this._disableRipple=OS(e)}constructor(...e){super(...e),this._disableRipple=!1}}}class P3{constructor(e,t,r,i=!1){this._renderer=e,this.element=t,this.config=r,this._animationForciblyDisabledThroughCss=i,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const ZS=nu({passive:!0,capture:!0});class N3{constructor(){this._events=new Map,this._delegateEventHandler=e=>{const t=$s(e);t&&this._events.get(e.type)?.forEach((r,i)=>{(i===t||i.contains(t))&&r.forEach(s=>s.handleEvent(e))})}}addHandler(e,t,r,i){const s=this._events.get(t);if(s){const o=s.get(r);o?o.add(i):s.set(r,new Set([i]))}else this._events.set(t,new Map([[r,new Set([i])]])),e.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,ZS)})}removeHandler(e,t,r){const i=this._events.get(e);if(!i)return;const s=i.get(t);s&&(s.delete(r),0===s.size&&i.delete(t),0===i.size&&(this._events.delete(e),document.removeEventListener(e,this._delegateEventHandler,ZS)))}}const XS={enterDuration:225,exitDuration:150},JS=nu({passive:!0,capture:!0}),eC=["mousedown","touchstart"],tC=["mouseup","mouseleave","touchend","touchcancel"];class ba{constructor(e,t,r,i){this._target=e,this._ngZone=t,this._platform=i,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,i.isBrowser&&(this._containerElement=ga(r))}fadeInRipple(e,t,r={}){const i=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),s={...XS,...r.animation};r.centered&&(e=i.left+i.width/2,t=i.top+i.height/2);const o=r.radius||function U3(n,e,t){const r=Math.max(Math.abs(n-t.left),Math.abs(n-t.right)),i=Math.max(Math.abs(e-t.top),Math.abs(e-t.bottom));return Math.sqrt(r*r+i*i)}(e,t,i),a=e-i.left,l=t-i.top,c=s.enterDuration,u=document.createElement("div");u.classList.add("mat-ripple-element"),u.style.left=a-o+"px",u.style.top=l-o+"px",u.style.height=2*o+"px",u.style.width=2*o+"px",null!=r.color&&(u.style.backgroundColor=r.color),u.style.transitionDuration=`${c}ms`,this._containerElement.appendChild(u);const d=window.getComputedStyle(u),f=d.transitionDuration,p="none"===d.transitionProperty||"0s"===f||"0s, 0s"===f||0===i.width&&0===i.height,m=new P3(this,u,r,p);u.style.transform="scale3d(1, 1, 1)",m.state=0,r.persistent||(this._mostRecentTransientRipple=m);let g=null;return!p&&(c||s.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const v=()=>this._finishRippleTransition(m),_=()=>this._destroyRipple(m);u.addEventListener("transitionend",v),u.addEventListener("transitioncancel",_),g={onTransitionEnd:v,onTransitionCancel:_}}),this._activeRipples.set(m,g),(p||!c)&&this._finishRippleTransition(m),m}fadeOutRipple(e){if(2===e.state||3===e.state)return;const t=e.element,r={...XS,...e.config.animation};t.style.transitionDuration=`${r.exitDuration}ms`,t.style.opacity="0",e.state=2,(e._animationForciblyDisabledThroughCss||!r.exitDuration)&&this._finishRippleTransition(e)}fadeOutAll(){this._getActiveRipples().forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){const t=ga(e);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,eC.forEach(r=>{ba._eventManager.addHandler(this._ngZone,r,t,this)}))}handleEvent(e){"mousedown"===e.type?this._onMousedown(e):"touchstart"===e.type?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{tC.forEach(t=>{this._triggerElement.addEventListener(t,this,JS)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(e){0===e.state?this._startFadeOutTransition(e):2===e.state&&this._destroyRipple(e)}_startFadeOutTransition(e){const t=e===this._mostRecentTransientRipple,{persistent:r}=e.config;e.state=1,!r&&(!t||!this._isPointerDown)&&e.fadeOut()}_destroyRipple(e){const t=this._activeRipples.get(e)??null;this._activeRipples.delete(e),this._activeRipples.size||(this._containerRect=null),e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),e.state=3,null!==t&&(e.element.removeEventListener("transitionend",t.onTransitionEnd),e.element.removeEventListener("transitioncancel",t.onTransitionCancel)),e.element.remove()}_onMousedown(e){const t=jS(e),r=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!r&&(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!GS(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=e.changedTouches;for(let r=0;r<t.length;r++)this.fadeInRipple(t[r].clientX,t[r].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(e=>{!e.config.persistent&&(1===e.state||e.config.terminateOnPointerUp&&0===e.state)&&e.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const e=this._triggerElement;e&&(eC.forEach(t=>ba._eventManager.removeHandler(t,e,this)),this._pointerUpEventsRegistered&&tC.forEach(t=>e.removeEventListener(t,this,JS)))}}ba._eventManager=new N3;const V3=new j("mat-ripple-global-options");let nC=(()=>{class n{get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}constructor(t,r,i,s,o){this._elementRef=t,this._animationMode=o,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=s||{},this._rippleRenderer=new ba(this,r,t,i)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,r=0,i){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,r,{...this.rippleConfig,...i}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...t})}}return n.\u0275fac=function(t){return new(t||n)(R(Ct),R(Ae),R(Us),R(V3,8),R(Kl,8))},n.\u0275dir=J({type:n,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(t,r){2&t&&Er("mat-ripple-unbounded",r.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]}),n})(),$3=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Lt({type:n}),n.\u0275inj=Et({imports:[ou,ou]}),n})();const H3=["mat-button",""],j3=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],G3=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],K3=[{selector:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{selector:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{selector:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{selector:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{selector:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{selector:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{selector:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],z3=F3(L3(k3(class{constructor(n){this._elementRef=n}})));let W3=(()=>{class n extends z3{constructor(t,r,i,s){super(t),this._platform=r,this._ngZone=i,this._animationMode=s,this._focusMonitor=de(C3),this._isFab=!1;const o=t.nativeElement.classList;for(const a of K3)this._hasHostAttributes(a.selector)&&a.mdcClasses.forEach(l=>{o.add(l)})}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(t="program",r){t?this._focusMonitor.focusVia(this._elementRef.nativeElement,t,r):this._elementRef.nativeElement.focus(r)}_hasHostAttributes(...t){return t.some(r=>this._elementRef.nativeElement.hasAttribute(r))}_isRippleDisabled(){return this.disableRipple||this.disabled}}return n.\u0275fac=function(t){hh()},n.\u0275dir=J({type:n,viewQuery:function(t,r){if(1&t&&Xh(nC,5),2&t){let i;Ul(i=Vl())&&(r.ripple=i.first)}},features:[Te]}),n})(),Y3=(()=>{class n extends W3{constructor(t,r,i,s){super(t,r,i,s)}}return n.\u0275fac=function(t){return new(t||n)(R(Ct),R(Us),R(Ae),R(Kl,8))},n.\u0275cmp=eo({type:n,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:7,hostBindings:function(t,r){2&t&&(Ln("disabled",r.disabled||null),Er("_mat-animation-noopable","NoopAnimations"===r._animationMode)("mat-unthemed",!r.color)("mat-mdc-button-base",!0))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[Te],attrs:H3,ngContentSelectors:G3,decls:8,vars:6,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],["matRipple","",1,"mat-mdc-button-ripple",3,"matRippleDisabled","matRippleTrigger"],[1,"mat-mdc-button-touch-target"]],template:function(t,r){1&t&&(function Yv(n){const e=L()[xt][Tt];if(!e.projection){const r=e.projection=uo(n?n.length:1,null),i=r.slice();let s=e.child;for(;null!==s;){const o=n?k1(s,n):0;null!==o&&(i[o]?i[o].projectionNext=s:r[o]=s,i[o]=s),s=s.next}}}(j3),fi(0,"span",0),Ml(1),je(2,"span",1),Ml(3,1),Be(),Ml(4,2),fi(5,"span",2)(6,"span",3)(7,"span",4)),2&t&&(Er("mdc-button__ripple",!r._isFab)("mdc-fab__ripple",r._isFab),qn(6),ms("matRippleDisabled",r._isRippleDisabled())("matRippleTrigger",r._elementRef.nativeElement))},dependencies:[nC],styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(\n      100% + 4px\n    );width:calc(\n      100% + 4px\n    );display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{height:var(--mdc-text-button-container-height, 36px);border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, inherit)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button{height:var(--mdc-filled-button-container-height, 36px);border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color, transparent)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, inherit)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button{height:var(--mdc-protected-button-container-height, 36px);border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px));box-shadow:var(--mdc-protected-button-container-elevation, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color, transparent)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, inherit)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button.mdc-ripple-upgraded--background-focused,.mat-mdc-raised-button:not(.mdc-ripple-upgraded):focus{box-shadow:var(--mdc-protected-button-focus-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled):active{box-shadow:var(--mdc-protected-button-pressed-container-elevation, 0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation, 0px 0px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 0px rgba(0, 0, 0, 0.14), 0px 0px 0px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button{height:var(--mdc-outlined-button-container-height, 36px);border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px));padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, inherit)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width, 1px));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width, 1px))}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0;background-color:var(--mat-mdc-button-persistent-ripple-color)}.mat-mdc-button .mat-ripple-element,.mat-mdc-unelevated-button .mat-ripple-element,.mat-mdc-raised-button .mat-ripple-element,.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-mdc-button-ripple-color)}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button[disabled],.mat-mdc-unelevated-button[disabled],.mat-mdc-raised-button[disabled],.mat-mdc-outlined-button[disabled]{cursor:default;pointer-events:none}.mat-mdc-button .mat-mdc-button-touch-target,.mat-mdc-unelevated-button .mat-mdc-button-touch-target,.mat-mdc-raised-button .mat-mdc-button-touch-target,.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}[dir=rtl] .mat-mdc-button>.mat-icon,.mat-mdc-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}.mat-mdc-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon,.mat-mdc-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem;margin-left:-4px;margin-right:8px}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:-4px}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon,.mat-mdc-raised-button .mdc-button__label+.mat-icon,.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:-4px}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon,.mat-mdc-unelevated-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-raised-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-outlined-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:-4px;margin-right:8px}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px) * -1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px) * -1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0}),n})(),Z3=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Lt({type:n}),n.\u0275inj=Et({imports:[ou,$3,ou]}),n})();const X3=["videoPlayer"];function J3(n,e){if(1&n){const t=Il();je(0,"button",18),st("click",function(){const s=qa(t).index;return Ya(gs().changeChannel(s,!0))}),ht(1),Be()}if(2&n){const t=e.$implicit,r=e.index;Er("active",gs().activeLocalChannel===r),qn(1),Vr(" ",t.name," ")}}function ej(n,e){if(1&n){const t=Il();je(0,"button",18),st("click",function(){const s=qa(t).index;return Ya(gs().changeChannel(s,!1))}),ht(1),Be()}if(2&n){const t=e.$implicit,r=e.index;Er("active",gs().activeGlobalChannel===r),qn(1),Vr(" ",t.name," ")}}function tj(n,e){if(1&n){const t=Il();je(0,"button",19),st("click",function(){const s=qa(t).$implicit;return Ya(gs().updateChannelIndex(s))}),ht(1),Be()}if(2&n){const t=e.$implicit;qn(1),Vr(" ",t," ")}}const nj=function(){return[1,2,3,4,5,6,7,8,9,0]},rj=[{path:"",component:UT,children:[{path:"",redirectTo:"display/default-channel/0",pathMatch:"full"},{path:"display/:channelName/:index",component:(()=>{var n;class e{constructor(r,i,s){this.route=r,this.router=i,this.store=s,this.activeLocalChannel=-1,this.activeGlobalChannel=-1,this.channelIndex=0,this.hls=new _m,this.volumeLevel=0}handleKeyboardEvent(r){"ArrowLeft"===r.key?this.changeChannel(this.activeLocalChannel-1,!0):"ArrowRight"===r.key&&this.changeChannel(this.activeLocalChannel+1,!0)}ngAfterViewInit(){_m.isSupported()&&this.route.paramMap.subscribe(r=>{(r.get("channelName")||"").replace(/-/g," ");const s=r.get("index");if(null!==s){const o=+s;this.changeChannel(o,o<this.store.localChannels.length)}})}playChannel(r){r.startsWith("blob:")?fetch(r).then(i=>i.blob()).then(i=>{const s=URL.createObjectURL(i);this.videoplayer.nativeElement.src=s,this.videoplayer.nativeElement.play()}):(this.hls.loadSource(r),this.hls.attachMedia(this.videoplayer.nativeElement),this.hls.on(_m.Events.MANIFEST_PARSED,()=>{this.videoplayer.nativeElement.play()}))}changeChannel(r,i){const s=i?this.store.localChannels:this.store.globalChannels;r<0?r=0:r>=s.length&&(r%=s.length),i?(this.activeLocalChannel=r,this.activeGlobalChannel=-1):(this.activeGlobalChannel=r,this.activeLocalChannel=-1);const o=s[r];this.playChannel(o.url);const a=o.name.replace(/ /g,"-");this.router.navigate(["/display",a,r])}increaseVolume(){let r=this.videoplayer.nativeElement.volume;r<1&&(this.videoplayer.nativeElement.volume=Math.min(r+.1,1),this.volumeLevel=Math.round(100*this.videoplayer.nativeElement.volume))}decreaseVolume(){let r=this.videoplayer.nativeElement.volume;r>0&&(this.videoplayer.nativeElement.volume=Math.max(r-.1,0),this.volumeLevel=Math.round(100*this.videoplayer.nativeElement.volume))}onChannelIndexChange(r){this.channelIndex=+r.target.value}updateChannelIndex(r){this.channelIndex=10*this.channelIndex+r,this.changeChannelTimeout&&clearTimeout(this.changeChannelTimeout),this.changeChannelTimeout=setTimeout(()=>{this.changeChannel(this.channelIndex,!0),this.channelIndex=0},2e3)}}return(n=e).\u0275fac=function(r){return new(r||n)(R(Ti),R(Kt),R(KH))},n.\u0275cmp=eo({type:n,selectors:[["app-main-display"]],viewQuery:function(r,i){if(1&r&&Xh(X3,5),2&r){let s;Ul(s=Vl())&&(i.videoplayer=s.first)}},hostBindings:function(r,i){1&r&&st("keydown",function(o){return i.handleKeyboardEvent(o)},0,Qy)},decls:47,vars:6,consts:[[1,"container"],[1,"row"],[1,"text-center","my-3"],[1,"col-12"],["controls","","autoplay","",1,"w-100","video"],["videoPlayer",""],[1,"channel"],["mat-raised-button","","color","primary",3,"active","click",4,"ngFor","ngForOf"],[1,"remote-control"],[1,"volume-display"],[1,"number-display"],[1,""],[1,"remote-button"],[1,"remote-row"],[1,"remote-button",3,"click"],[1,"channel-input"],[1,"number-buttons"],[3,"click",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",3,"click"],[3,"click"]],template:function(r,i){1&r&&(je(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),ht(4,"Welcome to Live TV Streaming!"),Be()(),je(5,"div",3),fi(6,"video",4,5),Be(),je(8,"div",6)(9,"h2"),ht(10,"Local Channels"),Be(),wl(11,J3,2,3,"button",7),Be(),je(12,"div",6)(13,"h2"),ht(14,"Global Channels"),Be(),wl(15,ej,2,3,"button",7),Be()()(),je(16,"div",8)(17,"div",9),ht(18),Be(),je(19,"div",10),ht(20),Be(),je(21,"div",11)(22,"button",12),ht(23,"\u2191"),Be()(),je(24,"div",11)(25,"button",12),ht(26,"\u2190"),Be(),je(27,"button",12),ht(28,"OK"),Be(),je(29,"button",12),ht(30,"\u2192"),Be()(),je(31,"div",11)(32,"button",12),ht(33,"\u2193"),Be()(),je(34,"div",13)(35,"button",14),st("click",function(){return i.increaseVolume()}),ht(36,"Vol +"),Be(),je(37,"button",14),st("click",function(){return i.changeChannel(i.activeLocalChannel+1,!0)}),ht(38," Ch + "),Be()(),je(39,"div",13)(40,"button",14),st("click",function(){return i.decreaseVolume()}),ht(41,"Vol -"),Be(),je(42,"button",14),st("click",function(){return i.changeChannel(i.activeLocalChannel-1,!0)}),ht(43," Ch - "),Be()(),je(44,"div",15)(45,"div",16),wl(46,tj,2,1,"button",17),Be()()()),2&r&&(qn(11),ms("ngForOf",i.store.localChannels),qn(4),ms("ngForOf",i.store.globalChannels),qn(3),Vr(" Volume: ",i.volumeLevel," "),qn(2),Vr(" ",i.channelIndex," "),qn(26),ms("ngForOf",D_(5,nj)))},dependencies:[zE,Y3],styles:[".container[_ngcontent-%COMP%]{font-family:Arial,sans-serif;background-color:#181818;height:100%;min-width:100%;color:#fff}h1[_ngcontent-%COMP%]{color:#fff}.channel[_ngcontent-%COMP%]{width:100%;text-align:center}.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;border-color:#007bff}.video[_ngcontent-%COMP%]{height:460px}button.active[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.remote-control[_ngcontent-%COMP%]{display:none}@media screen and (max-width: 600px){.container[_ngcontent-%COMP%]{display:none}.remote-control[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;justify-content:center;align-items:center}.remote-control[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;background-color:#333;padding:20px;border-radius:15px}.remote-row[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:10px}.remote-button[_ngcontent-%COMP%]{color:#007bff;padding:0 5px;border-radius:5px;margin:5px}.remote-row[_ngcontent-%COMP%]{display:flex;justify-content:center}.remote-button[_ngcontent-%COMP%]{margin:5px;padding:5px 10px;font-size:14px}.number-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}.number-display[_ngcontent-%COMP%]{background-color:#fff;color:#000;padding:0 25px;margin-bottom:20px;border-radius:6px}@keyframes fade{0%{opacity:1}50%{opacity:1}to{opacity:0}}.volume-display[_ngcontent-%COMP%]{animation:fade 3s}}"]}),e})()}]}];let ij=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=Lt({type:n}),n.\u0275inj=Et({imports:[NT.forRoot(rj),NT]}),e})();class rC{}class sj{}const Lr="*";function iC(n,e=null){return{type:2,steps:n,options:e}}function sC(n){return{type:6,styles:n,offset:null}}function oC(n){Promise.resolve().then(n)}class _a{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){oC(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(r=>r()),t.length=0}}class aC{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,r=0,i=0;const s=this.players.length;0==s?oC(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++t==s&&this._onFinish()}),o.onDestroy(()=>{++r==s&&this._onDestroy()}),o.onStart(()=>{++i==s&&this._onStart()})}),this.totalTime=this.players.reduce((o,a)=>Math.max(o,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(r=>{const i=r.totalTime?Math.min(1,t/r.totalTime):1;r.setPosition(i)})}getPosition(){const e=this.players.reduce((t,r)=>null===t||r.totalTime>t.totalTime?r:t,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(r=>r()),t.length=0}}const xm="!";function lC(n){return new w(3e3,!1)}function Vj(){return typeof window<"u"&&typeof window.document<"u"}function Sm(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function Zr(n){switch(n.length){case 0:return new _a;case 1:return n[0];default:return new aC(n)}}function cC(n,e,t,r,i=new Map,s=new Map){const o=[],a=[];let l=-1,c=null;if(r.forEach(u=>{const d=u.get("offset"),h=d==l,f=h&&c||new Map;u.forEach((p,m)=>{let g=m,v=p;if("offset"!==m)switch(g=e.normalizePropertyName(g,o),v){case xm:v=i.get(m);break;case Lr:v=s.get(m);break;default:v=e.normalizeStyleValue(m,g,v,o)}f.set(g,v)}),h||a.push(f),c=f,l=d}),o.length)throw function wj(n){return new w(3502,!1)}();return a}function Cm(n,e,t,r){switch(e){case"start":n.onStart(()=>r(t&&Am(t,"start",n)));break;case"done":n.onDone(()=>r(t&&Am(t,"done",n)));break;case"destroy":n.onDestroy(()=>r(t&&Am(t,"destroy",n)))}}function Am(n,e,t){const s=wm(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,t.totalTime??n.totalTime,!!t.disabled),o=n._data;return null!=o&&(s._data=o),s}function wm(n,e,t,r,i="",s=0,o){return{element:n,triggerName:e,fromState:t,toState:r,phaseName:i,totalTime:s,disabled:!!o}}function ln(n,e,t){let r=n.get(e);return r||n.set(e,r=t),r}function uC(n){const e=n.indexOf(":");return[n.substring(1,e),n.slice(e+1)]}let Im=(n,e)=>!1,dC=(n,e,t)=>[],hC=null;function Mm(n){const e=n.parentNode||n.host;return e===hC?null:e}(Sm()||typeof Element<"u")&&(Vj()?(hC=(()=>document.documentElement)(),Im=(n,e)=>{for(;e;){if(e===n)return!0;e=Mm(e)}return!1}):Im=(n,e)=>n.contains(e),dC=(n,e,t)=>{if(t)return Array.from(n.querySelectorAll(e));const r=n.querySelector(e);return r?[r]:[]});let Ii=null,fC=!1;const pC=Im,mC=dC;let gC=(()=>{class n{validateStyleProperty(t){return function Hj(n){Ii||(Ii=function jj(){return typeof document<"u"?document.body:null}()||{},fC=!!Ii.style&&"WebkitAppearance"in Ii.style);let e=!0;return Ii.style&&!function $j(n){return"ebkit"==n.substring(1,6)}(n)&&(e=n in Ii.style,!e&&fC&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in Ii.style)),e}(t)}matchesElement(t,r){return!1}containsElement(t,r){return pC(t,r)}getParentElement(t){return Mm(t)}query(t,r,i){return mC(t,r,i)}computeStyle(t,r,i){return i||""}animate(t,r,i,s,o,a=[],l){return new _a(i,s)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})(),Rm=(()=>{class n{}return n.NOOP=new gC,n})();const Gj=1e3,Lm="ng-enter",au="ng-leave",lu="ng-trigger",cu=".ng-trigger",vC="ng-animating",Fm=".ng-animating";function Fr(n){if("number"==typeof n)return n;const e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:km(parseFloat(e[1]),e[2])}function km(n,e){return"s"===e?n*Gj:n}function uu(n,e,t){return n.hasOwnProperty("duration")?n:function zj(n,e,t){let i,s=0,o="";if("string"==typeof n){const a=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===a)return e.push(lC()),{duration:0,delay:0,easing:""};i=km(parseFloat(a[1]),a[2]);const l=a[3];null!=l&&(s=km(parseFloat(l),a[4]));const c=a[5];c&&(o=c)}else i=n;if(!t){let a=!1,l=e.length;i<0&&(e.push(function oj(){return new w(3100,!1)}()),a=!0),s<0&&(e.push(function aj(){return new w(3101,!1)}()),a=!0),a&&e.splice(l,0,lC())}return{duration:i,delay:s,easing:o}}(n,e,t)}function Ea(n,e={}){return Object.keys(n).forEach(t=>{e[t]=n[t]}),e}function bC(n){const e=new Map;return Object.keys(n).forEach(t=>{e.set(t,n[t])}),e}function Xr(n,e=new Map,t){if(t)for(let[r,i]of t)e.set(r,i);for(let[r,i]of n)e.set(r,i);return e}function EC(n,e,t){return t?e+":"+t+";":""}function DC(n){let e="";for(let t=0;t<n.style.length;t++){const r=n.style.item(t);e+=EC(0,r,n.style.getPropertyValue(r))}for(const t in n.style)n.style.hasOwnProperty(t)&&!t.startsWith("_")&&(e+=EC(0,Qj(t),n.style[t]));n.setAttribute("style",e)}function ar(n,e,t){n.style&&(e.forEach((r,i)=>{const s=Pm(i);t&&!t.has(i)&&t.set(i,n.style[s]),n.style[s]=r}),Sm()&&DC(n))}function Mi(n,e){n.style&&(e.forEach((t,r)=>{const i=Pm(r);n.style[i]=""}),Sm()&&DC(n))}function Da(n){return Array.isArray(n)?1==n.length?n[0]:iC(n):n}const Om=new RegExp("{{\\s*(.+?)\\s*}}","g");function TC(n){let e=[];if("string"==typeof n){let t;for(;t=Om.exec(n);)e.push(t[1]);Om.lastIndex=0}return e}function Ta(n,e,t){const r=n.toString(),i=r.replace(Om,(s,o)=>{let a=e[o];return null==a&&(t.push(function cj(n){return new w(3003,!1)}()),a=""),a.toString()});return i==r?n:i}function du(n){const e=[];let t=n.next();for(;!t.done;)e.push(t.value),t=n.next();return e}const Yj=/-+([a-z0-9])/g;function Pm(n){return n.replace(Yj,(...e)=>e[1].toUpperCase())}function Qj(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function cn(n,e,t){switch(e.type){case 7:return n.visitTrigger(e,t);case 0:return n.visitState(e,t);case 1:return n.visitTransition(e,t);case 2:return n.visitSequence(e,t);case 3:return n.visitGroup(e,t);case 4:return n.visitAnimate(e,t);case 5:return n.visitKeyframes(e,t);case 6:return n.visitStyle(e,t);case 8:return n.visitReference(e,t);case 9:return n.visitAnimateChild(e,t);case 10:return n.visitAnimateRef(e,t);case 11:return n.visitQuery(e,t);case 12:return n.visitStagger(e,t);default:throw function uj(n){return new w(3004,!1)}()}}function xC(n,e){return window.getComputedStyle(n)[e]}const pu="*";function nG(n,e){const t=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(r=>function rG(n,e,t){if(":"==n[0]){const l=function iG(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,r)=>parseFloat(r)>parseFloat(t);case":decrement":return(t,r)=>parseFloat(r)<parseFloat(t);default:return e.push(function xj(n){return new w(3016,!1)}()),"* => *"}}(n,t);if("function"==typeof l)return void e.push(l);n=l}const r=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==r||r.length<4)return t.push(function Tj(n){return new w(3015,!1)}()),e;const i=r[1],s=r[2],o=r[3];e.push(SC(i,o));"<"==s[0]&&!(i==pu&&o==pu)&&e.push(SC(o,i))}(r,t,e)):t.push(n),t}const mu=new Set(["true","1"]),gu=new Set(["false","0"]);function SC(n,e){const t=mu.has(n)||gu.has(n),r=mu.has(e)||gu.has(e);return(i,s)=>{let o=n==pu||n==i,a=e==pu||e==s;return!o&&t&&"boolean"==typeof i&&(o=i?mu.has(n):gu.has(n)),!a&&r&&"boolean"==typeof s&&(a=s?mu.has(e):gu.has(e)),o&&a}}const sG=new RegExp("s*:selfs*,?","g");function Nm(n,e,t,r){return new oG(n).build(e,t,r)}class oG{constructor(e){this._driver=e}build(e,t,r){const i=new cG(t);return this._resetContextStyleTimingState(i),cn(this,Da(e),i)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles=new Map,e.collectedStyles.set("",new Map),e.currentTime=0}visitTrigger(e,t){let r=t.queryCount=0,i=t.depCount=0;const s=[],o=[];return"@"==e.name.charAt(0)&&t.errors.push(function hj(){return new w(3006,!1)}()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),0==a.type){const l=a,c=l.name;c.toString().split(/\s*,\s*/).forEach(u=>{l.name=u,s.push(this.visitState(l,t))}),l.name=c}else if(1==a.type){const l=this.visitTransition(a,t);r+=l.queryCount,i+=l.depCount,o.push(l)}else t.errors.push(function fj(){return new w(3007,!1)}())}),{type:7,name:e.name,states:s,transitions:o,queryCount:r,depCount:i,options:null}}visitState(e,t){const r=this.visitStyle(e.styles,t),i=e.options&&e.options.params||null;if(r.containsDynamicStyles){const s=new Set,o=i||{};r.styles.forEach(a=>{a instanceof Map&&a.forEach(l=>{TC(l).forEach(c=>{o.hasOwnProperty(c)||s.add(c)})})}),s.size&&(du(s.values()),t.errors.push(function pj(n,e){return new w(3008,!1)}()))}return{type:0,name:e.name,style:r,options:i?{params:i}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const r=cn(this,Da(e.animation),t);return{type:1,matchers:nG(e.expr,t.errors),animation:r,queryCount:t.queryCount,depCount:t.depCount,options:Ri(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(r=>cn(this,r,t)),options:Ri(e.options)}}visitGroup(e,t){const r=t.currentTime;let i=0;const s=e.steps.map(o=>{t.currentTime=r;const a=cn(this,o,t);return i=Math.max(i,t.currentTime),a});return t.currentTime=i,{type:3,steps:s,options:Ri(e.options)}}visitAnimate(e,t){const r=function dG(n,e){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return Bm(uu(n,e).duration,0,"");const t=n;if(t.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=Bm(0,0,"");return s.dynamic=!0,s.strValue=t,s}const i=uu(t,e);return Bm(i.duration,i.delay,i.easing)}(e.timings,t.errors);t.currentAnimateTimings=r;let i,s=e.styles?e.styles:sC({});if(5==s.type)i=this.visitKeyframes(s,t);else{let o=e.styles,a=!1;if(!o){a=!0;const c={};r.easing&&(c.easing=r.easing),o=sC(c)}t.currentTime+=r.duration+r.delay;const l=this.visitStyle(o,t);l.isEmptyStep=a,i=l}return t.currentAnimateTimings=null,{type:4,timings:r,style:i,options:null}}visitStyle(e,t){const r=this._makeStyleAst(e,t);return this._validateStyleAst(r,t),r}_makeStyleAst(e,t){const r=[],i=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of i)"string"==typeof a?a===Lr?r.push(a):t.errors.push(new w(3002,!1)):r.push(bC(a));let s=!1,o=null;return r.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!s))for(let l of a.values())if(l.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:r,easing:o,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,t){const r=t.currentAnimateTimings;let i=t.currentTime,s=t.currentTime;r&&s>0&&(s-=r.duration+r.delay),e.styles.forEach(o=>{"string"!=typeof o&&o.forEach((a,l)=>{const c=t.collectedStyles.get(t.currentQuerySelector),u=c.get(l);let d=!0;u&&(s!=i&&s>=u.startTime&&i<=u.endTime&&(t.errors.push(function gj(n,e,t,r,i){return new w(3010,!1)}()),d=!1),s=u.startTime),d&&c.set(l,{startTime:s,endTime:i}),t.options&&function qj(n,e,t){const r=e.params||{},i=TC(n);i.length&&i.forEach(s=>{r.hasOwnProperty(s)||t.push(function lj(n){return new w(3001,!1)}())})}(a,t.options,t.errors)})})}visitKeyframes(e,t){const r={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function yj(){return new w(3011,!1)}()),r;let s=0;const o=[];let a=!1,l=!1,c=0;const u=e.steps.map(v=>{const _=this._makeStyleAst(v,t);let b=null!=_.offset?_.offset:function uG(n){if("string"==typeof n)return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){const r=t;e=parseFloat(r.get("offset")),r.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}(_.styles),E=0;return null!=b&&(s++,E=_.offset=b),l=l||E<0||E>1,a=a||E<c,c=E,o.push(E),_});l&&t.errors.push(function vj(){return new w(3012,!1)}()),a&&t.errors.push(function bj(){return new w(3200,!1)}());const d=e.steps.length;let h=0;s>0&&s<d?t.errors.push(function _j(){return new w(3202,!1)}()):0==s&&(h=1/(d-1));const f=d-1,p=t.currentTime,m=t.currentAnimateTimings,g=m.duration;return u.forEach((v,_)=>{const b=h>0?_==f?1:h*_:o[_],E=b*g;t.currentTime=p+m.delay+E,m.duration=E,this._validateStyleAst(v,t),v.offset=b,r.styles.push(v)}),r}visitReference(e,t){return{type:8,animation:cn(this,Da(e.animation),t),options:Ri(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:Ri(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:Ri(e.options)}}visitQuery(e,t){const r=t.currentQuerySelector,i=e.options||{};t.queryCount++,t.currentQuery=e;const[s,o]=function aG(n){const e=!!n.split(/\s*,\s*/).find(t=>":self"==t);return e&&(n=n.replace(sG,"")),n=n.replace(/@\*/g,cu).replace(/@\w+/g,t=>cu+"-"+t.slice(1)).replace(/:animating/g,Fm),[n,e]}(e.selector);t.currentQuerySelector=r.length?r+" "+s:s,ln(t.collectedStyles,t.currentQuerySelector,new Map);const a=cn(this,Da(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=r,{type:11,selector:s,limit:i.limit||0,optional:!!i.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:Ri(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(function Ej(){return new w(3013,!1)}());const r="full"===e.timings?{duration:0,delay:0,easing:"full"}:uu(e.timings,t.errors,!0);return{type:12,animation:cn(this,Da(e.animation),t),timings:r,options:null}}}class cG{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Ri(n){return n?(n=Ea(n)).params&&(n.params=function lG(n){return n?Ea(n):null}(n.params)):n={},n}function Bm(n,e,t){return{duration:n,delay:e,easing:t}}function Um(n,e,t,r,i,s,o=null,a=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:r,duration:i,delay:s,totalTime:i+s,easing:o,subTimeline:a}}class yu{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let r=this._map.get(e);r||this._map.set(e,r=[]),r.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const pG=new RegExp(":enter","g"),gG=new RegExp(":leave","g");function Vm(n,e,t,r,i,s=new Map,o=new Map,a,l,c=[]){return(new yG).buildKeyframes(n,e,t,r,i,s,o,a,l,c)}class yG{buildKeyframes(e,t,r,i,s,o,a,l,c,u=[]){c=c||new yu;const d=new $m(e,t,c,i,s,u,[]);d.options=l;const h=l.delay?Fr(l.delay):0;d.currentTimeline.delayNextStep(h),d.currentTimeline.setStyles([o],null,d.errors,l),cn(this,r,d);const f=d.timelines.filter(p=>p.containsAnimation());if(f.length&&a.size){let p;for(let m=f.length-1;m>=0;m--){const g=f[m];if(g.element===t){p=g;break}}p&&!p.allowOnlyTimelineStyles()&&p.setStyles([a],null,d.errors,l)}return f.length?f.map(p=>p.buildKeyframes()):[Um(t,[],[],[],0,h,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const r=t.subInstructions.get(t.element);if(r){const i=t.createSubContext(e.options),s=t.currentTimeline.currentTime,o=this._visitSubInstructions(r,i,i.options);s!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){const r=t.createSubContext(e.options);r.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,r),this.visitReference(e.animation,r),t.transformIntoNewTimeline(r.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,r){for(const i of e){const s=i?.delay;if(s){const o="number"==typeof s?s:Fr(Ta(s,i?.params??{},t.errors));r.delayNextStep(o)}}}_visitSubInstructions(e,t,r){let s=t.currentTimeline.currentTime;const o=null!=r.duration?Fr(r.duration):null,a=null!=r.delay?Fr(r.delay):null;return 0!==o&&e.forEach(l=>{const c=t.appendInstructionToTimeline(l,o,a);s=Math.max(s,c.duration+c.delay)}),s}visitReference(e,t){t.updateOptions(e.options,!0),cn(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const r=t.subContextCount;let i=t;const s=e.options;if(s&&(s.params||s.delay)&&(i=t.createSubContext(s),i.transformIntoNewTimeline(),null!=s.delay)){6==i.previousNode.type&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=vu);const o=Fr(s.delay);i.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>cn(this,o,i)),i.currentTimeline.applyStylesToKeyframe(),i.subContextCount>r&&i.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const r=[];let i=t.currentTimeline.currentTime;const s=e.options&&e.options.delay?Fr(e.options.delay):0;e.steps.forEach(o=>{const a=t.createSubContext(e.options);s&&a.delayNextStep(s),cn(this,o,a),i=Math.max(i,a.currentTimeline.currentTime),r.push(a.currentTimeline)}),r.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(i),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const r=e.strValue;return uu(t.params?Ta(r,t.params,t.errors):r,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const r=t.currentAnimateTimings=this._visitTiming(e.timings,t),i=t.currentTimeline;r.delay&&(t.incrementTime(r.delay),i.snapshotCurrentStyles());const s=e.style;5==s.type?this.visitKeyframes(s,t):(t.incrementTime(r.duration),this.visitStyle(s,t),i.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const r=t.currentTimeline,i=t.currentAnimateTimings;!i&&r.hasCurrentStyleProperties()&&r.forwardFrame();const s=i&&i.easing||e.easing;e.isEmptyStep?r.applyEmptyStep(s):r.setStyles(e.styles,s,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const r=t.currentAnimateTimings,i=t.currentTimeline.duration,s=r.duration,a=t.createSubContext().currentTimeline;a.easing=r.easing,e.styles.forEach(l=>{a.forwardTime((l.offset||0)*s),a.setStyles(l.styles,l.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(i+s),t.previousNode=e}visitQuery(e,t){const r=t.currentTimeline.currentTime,i=e.options||{},s=i.delay?Fr(i.delay):0;s&&(6===t.previousNode.type||0==r&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=vu);let o=r;const a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!i.optional,t.errors);t.currentQueryTotal=a.length;let l=null;a.forEach((c,u)=>{t.currentQueryIndex=u;const d=t.createSubContext(e.options,c);s&&d.delayNextStep(s),c===t.element&&(l=d.currentTimeline),cn(this,e.animation,d),d.currentTimeline.applyStylesToKeyframe(),o=Math.max(o,d.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),l&&(t.currentTimeline.mergeTimelineCollectedStyles(l),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const r=t.parentContext,i=t.currentTimeline,s=e.timings,o=Math.abs(s.duration),a=o*(t.currentQueryTotal-1);let l=o*t.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":l=a-l;break;case"full":l=r.currentStaggerTime}const u=t.currentTimeline;l&&u.delayNextStep(l);const d=u.currentTime;cn(this,e.animation,t),t.previousNode=e,r.currentStaggerTime=i.currentTime-d+(i.startTime-r.currentTimeline.startTime)}}const vu={};class $m{constructor(e,t,r,i,s,o,a,l){this._driver=e,this.element=t,this.subInstructions=r,this._enterClassName=i,this._leaveClassName=s,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=vu,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=l||new bu(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const r=e;let i=this.options;null!=r.duration&&(i.duration=Fr(r.duration)),null!=r.delay&&(i.delay=Fr(r.delay));const s=r.params;if(s){let o=i.params;o||(o=this.options.params={}),Object.keys(s).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=Ta(s[a],o,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const r=e.params={};Object.keys(t).forEach(i=>{r[i]=t[i]})}}return e}createSubContext(e=null,t,r){const i=t||this.element,s=new $m(this._driver,i,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(i,r||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=vu,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,r){const i={duration:t??e.duration,delay:this.currentTimeline.currentTime+(r??0)+e.delay,easing:""},s=new vG(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,i,e.stretchStartingKeyframe);return this.timelines.push(s),i}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,r,i,s,o){let a=[];if(i&&a.push(this.element),e.length>0){e=(e=e.replace(pG,"."+this._enterClassName)).replace(gG,"."+this._leaveClassName);let c=this._driver.query(this.element,e,1!=r);0!==r&&(c=r<0?c.slice(c.length+r,c.length):c.slice(0,r)),a.push(...c)}return!s&&0==a.length&&o.push(function Dj(n){return new w(3014,!1)}()),a}}class bu{constructor(e,t,r,i){this._driver=e,this.element=t,this.startTime=r,this._elementTimelineStylesLookup=i,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new bu(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,r]of this._globalTimelineStyles)this._backFill.set(t,r||Lr),this._currentKeyframe.set(t,Lr);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,r,i){t&&this._previousKeyframe.set("easing",t);const s=i&&i.params||{},o=function bG(n,e){const t=new Map;let r;return n.forEach(i=>{if("*"===i){r=r||e.keys();for(let s of r)t.set(s,Lr)}else Xr(i,t)}),t}(e,this._globalTimelineStyles);for(let[a,l]of o){const c=Ta(l,s,r);this._pendingStyles.set(a,c),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??Lr),this._updateStyle(a,c)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,r)=>{const i=this._styleSummary.get(r);(!i||t.time>i.time)&&this._updateStyle(r,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,r=1===this._keyframes.size&&0===this.duration;let i=[];this._keyframes.forEach((a,l)=>{const c=Xr(a,new Map,this._backFill);c.forEach((u,d)=>{u===xm?e.add(d):u===Lr&&t.add(d)}),r||c.set("offset",l/this.duration),i.push(c)});const s=e.size?du(e.values()):[],o=t.size?du(t.values()):[];if(r){const a=i[0],l=new Map(a);a.set("offset",0),l.set("offset",1),i=[a,l]}return Um(this.element,i,s,o,this.duration,this.startTime,this.easing,!1)}}class vG extends bu{constructor(e,t,r,i,s,o,a=!1){super(e,t,o.delay),this.keyframes=r,this.preStyleProps=i,this.postStyleProps=s,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:r,easing:i}=this.timings;if(this._stretchStartingKeyframe&&t){const s=[],o=r+t,a=t/o,l=Xr(e[0]);l.set("offset",0),s.push(l);const c=Xr(e[0]);c.set("offset",wC(a)),s.push(c);const u=e.length-1;for(let d=1;d<=u;d++){let h=Xr(e[d]);const f=h.get("offset");h.set("offset",wC((t+f*r)/o)),s.push(h)}r=o,t=0,i="",e=s}return Um(this.element,e,this.preStyleProps,this.postStyleProps,r,t,i,!0)}}function wC(n,e=3){const t=Math.pow(10,e-1);return Math.round(n*t)/t}class Hm{}const _G=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class EG extends Hm{normalizePropertyName(e,t){return Pm(e)}normalizeStyleValue(e,t,r,i){let s="";const o=r.toString().trim();if(_G.has(t)&&0!==r&&"0"!==r)if("number"==typeof r)s="px";else{const a=r.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&0==a[1].length&&i.push(function dj(n,e){return new w(3005,!1)}())}return o+s}}function IC(n,e,t,r,i,s,o,a,l,c,u,d,h){return{type:0,element:n,triggerName:e,isRemovalTransition:i,fromState:t,fromStyles:s,toState:r,toStyles:o,timelines:a,queriedElements:l,preStyleProps:c,postStyleProps:u,totalTime:d,errors:h}}const jm={};class MC{constructor(e,t,r){this._triggerName=e,this.ast=t,this._stateStyles=r}match(e,t,r,i){return function DG(n,e,t,r,i){return n.some(s=>s(e,t,r,i))}(this.ast.matchers,e,t,r,i)}buildStyles(e,t,r){let i=this._stateStyles.get("*");return void 0!==e&&(i=this._stateStyles.get(e?.toString())||i),i?i.buildStyles(t,r):new Map}build(e,t,r,i,s,o,a,l,c,u){const d=[],h=this.ast.options&&this.ast.options.params||jm,p=this.buildStyles(r,a&&a.params||jm,d),m=l&&l.params||jm,g=this.buildStyles(i,m,d),v=new Set,_=new Map,b=new Map,E="void"===i,T={params:TG(m,h),delay:this.ast.options?.delay},I=u?[]:Vm(e,t,this.ast.animation,s,o,p,g,T,c,d);let C=0;if(I.forEach(N=>{C=Math.max(N.duration+N.delay,C)}),d.length)return IC(t,this._triggerName,r,i,E,p,g,[],[],_,b,C,d);I.forEach(N=>{const S=N.element,K=ln(_,S,new Set);N.preStyleProps.forEach(ve=>K.add(ve));const $=ln(b,S,new Set);N.postStyleProps.forEach(ve=>$.add(ve)),S!==t&&v.add(S)});const k=du(v.values());return IC(t,this._triggerName,r,i,E,p,g,I,k,_,b,C)}}function TG(n,e){const t=Ea(e);for(const r in n)n.hasOwnProperty(r)&&null!=n[r]&&(t[r]=n[r]);return t}class xG{constructor(e,t,r){this.styles=e,this.defaultParams=t,this.normalizer=r}buildStyles(e,t){const r=new Map,i=Ea(this.defaultParams);return Object.keys(e).forEach(s=>{const o=e[s];null!==o&&(i[s]=o)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((o,a)=>{o&&(o=Ta(o,i,t));const l=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,l,o,t),r.set(a,o)})}),r}}class CG{constructor(e,t,r){this.name=e,this.ast=t,this._normalizer=r,this.transitionFactories=[],this.states=new Map,t.states.forEach(i=>{this.states.set(i.name,new xG(i.style,i.options&&i.options.params||{},r))}),RC(this.states,"true","1"),RC(this.states,"false","0"),t.transitions.forEach(i=>{this.transitionFactories.push(new MC(e,i,this.states))}),this.fallbackTransition=function AG(n,e,t){return new MC(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(o,a)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,r,i){return this.transitionFactories.find(o=>o.match(e,t,r,i))||null}matchStyles(e,t,r){return this.fallbackTransition.buildStyles(e,t,r)}}function RC(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}const wG=new yu;class IG{constructor(e,t,r){this.bodyNode=e,this._driver=t,this._normalizer=r,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){const r=[],i=[],s=Nm(this._driver,t,r,i);if(r.length)throw function Ij(n){return new w(3503,!1)}();this._animations.set(e,s)}_buildPlayer(e,t,r){const i=e.element,s=cC(0,this._normalizer,0,e.keyframes,t,r);return this._driver.animate(i,s,e.duration,e.delay,e.easing,[],!0)}create(e,t,r={}){const i=[],s=this._animations.get(e);let o;const a=new Map;if(s?(o=Vm(this._driver,t,s,Lm,au,new Map,new Map,r,wG,i),o.forEach(u=>{const d=ln(a,u.element,new Map);u.postStyleProps.forEach(h=>d.set(h,null))})):(i.push(function Mj(){return new w(3300,!1)}()),o=[]),i.length)throw function Rj(n){return new w(3504,!1)}();a.forEach((u,d)=>{u.forEach((h,f)=>{u.set(f,this._driver.computeStyle(d,f,Lr))})});const c=Zr(o.map(u=>{const d=a.get(u.element);return this._buildPlayer(u,new Map,d)}));return this._playersById.set(e,c),c.onDestroy(()=>this.destroy(e)),this.players.push(c),c}destroy(e){const t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);const r=this.players.indexOf(t);r>=0&&this.players.splice(r,1)}_getPlayer(e){const t=this._playersById.get(e);if(!t)throw function Lj(n){return new w(3301,!1)}();return t}listen(e,t,r,i){const s=wm(t,"","","");return Cm(this._getPlayer(e),r,s,i),()=>{}}command(e,t,r,i){if("register"==r)return void this.register(e,i[0]);if("create"==r)return void this.create(e,t,i[0]||{});const s=this._getPlayer(e);switch(r){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(i[0]));break;case"destroy":this.destroy(e)}}}const LC="ng-animate-queued",Gm="ng-animate-disabled",kG=[],FC={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},OG={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},xn="__ng_removed";class Km{get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;const r=e&&e.hasOwnProperty("value");if(this.value=function UG(n){return n??null}(r?e.value:e),r){const s=Ea(e);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){const t=e.params;if(t){const r=this.options.params;Object.keys(t).forEach(i=>{null==r[i]&&(r[i]=t[i])})}}}const xa="void",zm=new Km(xa);class PG{constructor(e,t,r){this.id=e,this.hostElement=t,this._engine=r,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,Sn(t,this._hostClassName)}listen(e,t,r,i){if(!this._triggers.has(t))throw function Fj(n,e){return new w(3302,!1)}();if(null==r||0==r.length)throw function kj(n){return new w(3303,!1)}();if(!function VG(n){return"start"==n||"done"==n}(r))throw function Oj(n,e){return new w(3400,!1)}();const s=ln(this._elementListeners,e,[]),o={name:t,phase:r,callback:i};s.push(o);const a=ln(this._engine.statesByElement,e,new Map);return a.has(t)||(Sn(e,lu),Sn(e,lu+"-"+t),a.set(t,zm)),()=>{this._engine.afterFlush(()=>{const l=s.indexOf(o);l>=0&&s.splice(l,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return!this._triggers.has(e)&&(this._triggers.set(e,t),!0)}_getTrigger(e){const t=this._triggers.get(e);if(!t)throw function Pj(n){return new w(3401,!1)}();return t}trigger(e,t,r,i=!0){const s=this._getTrigger(t),o=new Wm(this.id,t,e);let a=this._engine.statesByElement.get(e);a||(Sn(e,lu),Sn(e,lu+"-"+t),this._engine.statesByElement.set(e,a=new Map));let l=a.get(t);const c=new Km(r,this.id);if(!(r&&r.hasOwnProperty("value"))&&l&&c.absorbOptions(l.options),a.set(t,c),l||(l=zm),c.value!==xa&&l.value===c.value){if(!function jG(n,e){const t=Object.keys(n),r=Object.keys(e);if(t.length!=r.length)return!1;for(let i=0;i<t.length;i++){const s=t[i];if(!e.hasOwnProperty(s)||n[s]!==e[s])return!1}return!0}(l.params,c.params)){const m=[],g=s.matchStyles(l.value,l.params,m),v=s.matchStyles(c.value,c.params,m);m.length?this._engine.reportError(m):this._engine.afterFlush(()=>{Mi(e,g),ar(e,v)})}return}const h=ln(this._engine.playersByElement,e,[]);h.forEach(m=>{m.namespaceId==this.id&&m.triggerName==t&&m.queued&&m.destroy()});let f=s.matchTransition(l.value,c.value,e,c.params),p=!1;if(!f){if(!i)return;f=s.fallbackTransition,p=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:f,fromState:l,toState:c,player:o,isFallbackTransition:p}),p||(Sn(e,LC),o.onStart(()=>{Gs(e,LC)})),o.onDone(()=>{let m=this.players.indexOf(o);m>=0&&this.players.splice(m,1);const g=this._engine.playersByElement.get(e);if(g){let v=g.indexOf(o);v>=0&&g.splice(v,1)}}),this.players.push(o),h.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,r)=>{this._elementListeners.set(r,t.filter(i=>i.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(r=>r.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const r=this._engine.driver.query(e,cu,!0);r.forEach(i=>{if(i[xn])return;const s=this._engine.fetchNamespacesByElement(i);s.size?s.forEach(o=>o.triggerLeaveAnimation(i,t,!1,!0)):this.clearElementCache(i)}),this._engine.afterFlushAnimationsDone(()=>r.forEach(i=>this.clearElementCache(i)))}triggerLeaveAnimation(e,t,r,i){const s=this._engine.statesByElement.get(e),o=new Map;if(s){const a=[];if(s.forEach((l,c)=>{if(o.set(c,l.value),this._triggers.has(c)){const u=this.trigger(e,c,xa,i);u&&a.push(u)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),r&&Zr(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),r=this._engine.statesByElement.get(e);if(t&&r){const i=new Set;t.forEach(s=>{const o=s.name;if(i.has(o))return;i.add(o);const l=this._triggers.get(o).fallbackTransition,c=r.get(o)||zm,u=new Km(xa),d=new Wm(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:l,fromState:c,toState:u,player:d,isFallbackTransition:!0})})}}removeNode(e,t){const r=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let i=!1;if(r.totalAnimations){const s=r.players.length?r.playersByQueriedElement.get(e):[];if(s&&s.length)i=!0;else{let o=e;for(;o=o.parentNode;)if(r.statesByElement.get(o)){i=!0;break}}}if(this.prepareLeaveAnimationListeners(e),i)r.markElementAsRemoved(this.id,e,!1,t);else{const s=e[xn];(!s||s===FC)&&(r.afterFlush(()=>this.clearElementCache(e)),r.destroyInnerAnimations(e),r._onRemovalComplete(e,t))}}insertNode(e,t){Sn(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(r=>{const i=r.player;if(i.destroyed)return;const s=r.element,o=this._elementListeners.get(s);o&&o.forEach(a=>{if(a.name==r.triggerName){const l=wm(s,r.triggerName,r.fromState.value,r.toState.value);l._data=e,Cm(r.player,a.phase,l,a.callback)}}),i.markedForDestroy?this._engine.afterFlush(()=>{i.destroy()}):t.push(r)}),this._queue=[],t.sort((r,i)=>{const s=r.transition.ast.depCount,o=i.transition.ast.depCount;return 0==s||0==o?s-o:this._engine.driver.containsElement(r.element,i.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(r=>r.element===e)||t,t}}class NG{_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,r){this.bodyNode=e,this.driver=t,this._normalizer=r,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(i,s)=>{}}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(r=>{r.queued&&e.push(r)})}),e}createNamespace(e,t){const r=new PG(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(r,t):(this.newHostElements.set(t,r),this.collectEnterElement(t)),this._namespaceLookup[e]=r}_balanceNamespaceList(e,t){const r=this._namespaceList,i=this.namespacesByHostElement;if(r.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){const l=i.get(a);if(l){const c=r.indexOf(l);r.splice(c+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||r.unshift(e)}else r.push(e);return i.set(t,e),e}register(e,t){let r=this._namespaceLookup[e];return r||(r=this.createNamespace(e,t)),r}registerTrigger(e,t,r){let i=this._namespaceLookup[e];i&&i.register(t,r)&&this.totalAnimations++}destroy(e,t){if(!e)return;const r=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(r.hostElement),delete this._namespaceLookup[e];const i=this._namespaceList.indexOf(r);i>=0&&this._namespaceList.splice(i,1)}),this.afterFlushAnimationsDone(()=>r.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,r=this.statesByElement.get(e);if(r)for(let i of r.values())if(i.namespaceId){const s=this._fetchNamespace(i.namespaceId);s&&t.add(s)}return t}trigger(e,t,r,i){if(_u(t)){const s=this._fetchNamespace(e);if(s)return s.trigger(t,r,i),!0}return!1}insertNode(e,t,r,i){if(!_u(t))return;const s=t[xn];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){const o=this._fetchNamespace(e);o&&o.insertNode(t,r)}i&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),Sn(e,Gm)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Gs(e,Gm))}removeNode(e,t,r,i){if(_u(t)){const s=e?this._fetchNamespace(e):null;if(s?s.removeNode(t,i):this.markElementAsRemoved(e,t,!1,i),r){const o=this.namespacesByHostElement.get(t);o&&o.id!==e&&o.removeNode(t,i)}}else this._onRemovalComplete(t,i)}markElementAsRemoved(e,t,r,i,s){this.collectedLeaveElements.push(t),t[xn]={namespaceId:e,setForRemoval:i,hasAnimation:r,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,t,r,i,s){return _u(t)?this._fetchNamespace(e).listen(t,r,i,s):()=>{}}_buildInstruction(e,t,r,i,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,r,i,e.fromState.options,e.toState.options,t,s)}destroyInnerAnimations(e){let t=this.driver.query(e,cu,!0);t.forEach(r=>this.destroyActiveAnimationsForElement(r)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,Fm,!0),t.forEach(r=>this.finishActiveQueriedAnimationOnElement(r)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(r=>{r.queued?r.markedForDestroy=!0:r.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(r=>r.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Zr(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[xn];if(t&&t.setForRemoval){if(e[xn]=FC,t.namespaceId){this.destroyInnerAnimations(e);const r=this._fetchNamespace(t.namespaceId);r&&r.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(Gm)&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((r,i)=>this._balanceNamespaceList(r,i)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let r=0;r<this.collectedEnterElements.length;r++)Sn(this.collectedEnterElements[r],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const r=[];try{t=this._flushAnimations(r,e)}finally{for(let i=0;i<r.length;i++)r[i]()}}else for(let r=0;r<this.collectedLeaveElements.length;r++)this.processLeaveNode(this.collectedLeaveElements[r]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(r=>r()),this._flushFns=[],this._whenQuietFns.length){const r=this._whenQuietFns;this._whenQuietFns=[],t.length?Zr(t).onDone(()=>{r.forEach(i=>i())}):r.forEach(i=>i())}}reportError(e){throw function Nj(n){return new w(3402,!1)}()}_flushAnimations(e,t){const r=new yu,i=[],s=new Map,o=[],a=new Map,l=new Map,c=new Map,u=new Set;this.disabledNodes.forEach(O=>{u.add(O);const B=this.driver.query(O,".ng-animate-queued",!0);for(let M=0;M<B.length;M++)u.add(B[M])});const d=this.bodyNode,h=Array.from(this.statesByElement.keys()),f=PC(h,this.collectedEnterElements),p=new Map;let m=0;f.forEach((O,B)=>{const M=Lm+m++;p.set(B,M),O.forEach(P=>Sn(P,M))});const g=[],v=new Set,_=new Set;for(let O=0;O<this.collectedLeaveElements.length;O++){const B=this.collectedLeaveElements[O],M=B[xn];M&&M.setForRemoval&&(g.push(B),v.add(B),M.hasAnimation?this.driver.query(B,".ng-star-inserted",!0).forEach(P=>v.add(P)):_.add(B))}const b=new Map,E=PC(h,Array.from(v));E.forEach((O,B)=>{const M=au+m++;b.set(B,M),O.forEach(P=>Sn(P,M))}),e.push(()=>{f.forEach((O,B)=>{const M=p.get(B);O.forEach(P=>Gs(P,M))}),E.forEach((O,B)=>{const M=b.get(B);O.forEach(P=>Gs(P,M))}),g.forEach(O=>{this.processLeaveNode(O)})});const T=[],I=[];for(let O=this._namespaceList.length-1;O>=0;O--)this._namespaceList[O].drainQueuedTransitions(t).forEach(M=>{const P=M.player,re=M.element;if(T.push(P),this.collectedEnterElements.length){const $e=re[xn];if($e&&$e.setForMove){if($e.previousTriggersValues&&$e.previousTriggersValues.has(M.triggerName)){const Hn=$e.previousTriggersValues.get(M.triggerName),Cn=this.statesByElement.get(M.element);if(Cn&&Cn.has(M.triggerName)){const Fu=Cn.get(M.triggerName);Fu.value=Hn,Cn.set(M.triggerName,Fu)}}return void P.destroy()}}const ge=!d||!this.driver.containsElement(d,re),le=b.get(re),Ie=p.get(re),ye=this._buildInstruction(M,r,Ie,le,ge);if(ye.errors&&ye.errors.length)return void I.push(ye);if(ge)return P.onStart(()=>Mi(re,ye.fromStyles)),P.onDestroy(()=>ar(re,ye.toStyles)),void i.push(P);if(M.isFallbackTransition)return P.onStart(()=>Mi(re,ye.fromStyles)),P.onDestroy(()=>ar(re,ye.toStyles)),void i.push(P);const Qt=[];ye.timelines.forEach($e=>{$e.stretchStartingKeyframe=!0,this.disabledNodes.has($e.element)||Qt.push($e)}),ye.timelines=Qt,r.append(re,ye.timelines),o.push({instruction:ye,player:P,element:re}),ye.queriedElements.forEach($e=>ln(a,$e,[]).push(P)),ye.preStyleProps.forEach(($e,Hn)=>{if($e.size){let Cn=l.get(Hn);Cn||l.set(Hn,Cn=new Set),$e.forEach((Fu,yg)=>Cn.add(yg))}}),ye.postStyleProps.forEach(($e,Hn)=>{let Cn=c.get(Hn);Cn||c.set(Hn,Cn=new Set),$e.forEach((Fu,yg)=>Cn.add(yg))})});if(I.length){const O=[];I.forEach(B=>{O.push(function Bj(n,e){return new w(3505,!1)}())}),T.forEach(B=>B.destroy()),this.reportError(O)}const C=new Map,k=new Map;o.forEach(O=>{const B=O.element;r.has(B)&&(k.set(B,B),this._beforeAnimationBuild(O.player.namespaceId,O.instruction,C))}),i.forEach(O=>{const B=O.element;this._getPreviousPlayers(B,!1,O.namespaceId,O.triggerName,null).forEach(P=>{ln(C,B,[]).push(P),P.destroy()})});const N=g.filter(O=>BC(O,l,c)),S=new Map;OC(S,this.driver,_,c,Lr).forEach(O=>{BC(O,l,c)&&N.push(O)});const $=new Map;f.forEach((O,B)=>{OC($,this.driver,new Set(O),l,xm)}),N.forEach(O=>{const B=S.get(O),M=$.get(O);S.set(O,new Map([...Array.from(B?.entries()??[]),...Array.from(M?.entries()??[])]))});const ve=[],pt=[],Re={};o.forEach(O=>{const{element:B,player:M,instruction:P}=O;if(r.has(B)){if(u.has(B))return M.onDestroy(()=>ar(B,P.toStyles)),M.disabled=!0,M.overrideTotalTime(P.totalTime),void i.push(M);let re=Re;if(k.size>1){let le=B;const Ie=[];for(;le=le.parentNode;){const ye=k.get(le);if(ye){re=ye;break}Ie.push(le)}Ie.forEach(ye=>k.set(ye,re))}const ge=this._buildAnimation(M.namespaceId,P,C,s,$,S);if(M.setRealPlayer(ge),re===Re)ve.push(M);else{const le=this.playersByElement.get(re);le&&le.length&&(M.parentPlayer=Zr(le)),i.push(M)}}else Mi(B,P.fromStyles),M.onDestroy(()=>ar(B,P.toStyles)),pt.push(M),u.has(B)&&i.push(M)}),pt.forEach(O=>{const B=s.get(O.element);if(B&&B.length){const M=Zr(B);O.setRealPlayer(M)}}),i.forEach(O=>{O.parentPlayer?O.syncPlayerEvents(O.parentPlayer):O.destroy()});for(let O=0;O<g.length;O++){const B=g[O],M=B[xn];if(Gs(B,au),M&&M.hasAnimation)continue;let P=[];if(a.size){let ge=a.get(B);ge&&ge.length&&P.push(...ge);let le=this.driver.query(B,Fm,!0);for(let Ie=0;Ie<le.length;Ie++){let ye=a.get(le[Ie]);ye&&ye.length&&P.push(...ye)}}const re=P.filter(ge=>!ge.destroyed);re.length?$G(this,B,re):this.processLeaveNode(B)}return g.length=0,ve.forEach(O=>{this.players.push(O),O.onDone(()=>{O.destroy();const B=this.players.indexOf(O);this.players.splice(B,1)}),O.play()}),ve}elementContainsData(e,t){let r=!1;const i=t[xn];return i&&i.setForRemoval&&(r=!0),this.playersByElement.has(t)&&(r=!0),this.playersByQueriedElement.has(t)&&(r=!0),this.statesByElement.has(t)&&(r=!0),this._fetchNamespace(e).elementContainsData(t)||r}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,r,i,s){let o=[];if(t){const a=this.playersByQueriedElement.get(e);a&&(o=a)}else{const a=this.playersByElement.get(e);if(a){const l=!s||s==xa;a.forEach(c=>{c.queued||!l&&c.triggerName!=i||o.push(c)})}}return(r||i)&&(o=o.filter(a=>!(r&&r!=a.namespaceId||i&&i!=a.triggerName))),o}_beforeAnimationBuild(e,t,r){const s=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:t.triggerName;for(const l of t.timelines){const c=l.element,u=c!==s,d=ln(r,c,[]);this._getPreviousPlayers(c,u,o,a,t.toState).forEach(f=>{const p=f.getRealPlayer();p.beforeDestroy&&p.beforeDestroy(),f.destroy(),d.push(f)})}Mi(s,t.fromStyles)}_buildAnimation(e,t,r,i,s,o){const a=t.triggerName,l=t.element,c=[],u=new Set,d=new Set,h=t.timelines.map(p=>{const m=p.element;u.add(m);const g=m[xn];if(g&&g.removedBeforeQueried)return new _a(p.duration,p.delay);const v=m!==l,_=function HG(n){const e=[];return NC(n,e),e}((r.get(m)||kG).map(C=>C.getRealPlayer())).filter(C=>!!C.element&&C.element===m),b=s.get(m),E=o.get(m),T=cC(0,this._normalizer,0,p.keyframes,b,E),I=this._buildPlayer(p,T,_);if(p.subTimeline&&i&&d.add(m),v){const C=new Wm(e,a,m);C.setRealPlayer(I),c.push(C)}return I});c.forEach(p=>{ln(this.playersByQueriedElement,p.element,[]).push(p),p.onDone(()=>function BG(n,e,t){let r=n.get(e);if(r){if(r.length){const i=r.indexOf(t);r.splice(i,1)}0==r.length&&n.delete(e)}return r}(this.playersByQueriedElement,p.element,p))}),u.forEach(p=>Sn(p,vC));const f=Zr(h);return f.onDestroy(()=>{u.forEach(p=>Gs(p,vC)),ar(l,t.toStyles)}),d.forEach(p=>{ln(i,p,[]).push(f)}),f}_buildPlayer(e,t,r){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,r):new _a(e.duration,e.delay)}}class Wm{constructor(e,t,r){this.namespaceId=e,this.triggerName=t,this.element=r,this._player=new _a,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,r)=>{t.forEach(i=>Cm(e,r,void 0,i))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){ln(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function _u(n){return n&&1===n.nodeType}function kC(n,e){const t=n.style.display;return n.style.display=e??"none",t}function OC(n,e,t,r,i){const s=[];t.forEach(l=>s.push(kC(l)));const o=[];r.forEach((l,c)=>{const u=new Map;l.forEach(d=>{const h=e.computeStyle(c,d,i);u.set(d,h),(!h||0==h.length)&&(c[xn]=OG,o.push(c))}),n.set(c,u)});let a=0;return t.forEach(l=>kC(l,s[a++])),o}function PC(n,e){const t=new Map;if(n.forEach(a=>t.set(a,[])),0==e.length)return t;const r=1,i=new Set(e),s=new Map;function o(a){if(!a)return r;let l=s.get(a);if(l)return l;const c=a.parentNode;return l=t.has(c)?c:i.has(c)?r:o(c),s.set(a,l),l}return e.forEach(a=>{const l=o(a);l!==r&&t.get(l).push(a)}),t}function Sn(n,e){n.classList?.add(e)}function Gs(n,e){n.classList?.remove(e)}function $G(n,e,t){Zr(t).onDone(()=>n.processLeaveNode(e))}function NC(n,e){for(let t=0;t<n.length;t++){const r=n[t];r instanceof aC?NC(r.players,e):e.push(r)}}function BC(n,e,t){const r=t.get(n);if(!r)return!1;let i=e.get(n);return i?r.forEach(s=>i.add(s)):e.set(n,r),t.delete(n),!0}class Eu{constructor(e,t,r){this.bodyNode=e,this._driver=t,this._normalizer=r,this._triggerCache={},this.onRemovalComplete=(i,s)=>{},this._transitionEngine=new NG(e,t,r),this._timelineEngine=new IG(e,t,r),this._transitionEngine.onRemovalComplete=(i,s)=>this.onRemovalComplete(i,s)}registerTrigger(e,t,r,i,s){const o=e+"-"+i;let a=this._triggerCache[o];if(!a){const l=[],c=[],u=Nm(this._driver,s,l,c);if(l.length)throw function Aj(n,e){return new w(3404,!1)}();a=function SG(n,e,t){return new CG(n,e,t)}(i,u,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,i,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,r,i){this._transitionEngine.insertNode(e,t,r,i)}onRemove(e,t,r,i){this._transitionEngine.removeNode(e,t,i||!1,r)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,r,i){if("@"==r.charAt(0)){const[s,o]=uC(r);this._timelineEngine.command(s,t,o,i)}else this._transitionEngine.trigger(e,t,r,i)}listen(e,t,r,i,s){if("@"==r.charAt(0)){const[o,a]=uC(r);return this._timelineEngine.listen(o,t,a,s)}return this._transitionEngine.listen(e,t,r,i,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let KG=(()=>{class n{constructor(t,r,i){this._element=t,this._startStyles=r,this._endStyles=i,this._state=0;let s=n.initialStylesByElement.get(t);s||n.initialStylesByElement.set(t,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&ar(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ar(this._element,this._initialStyles),this._endStyles&&(ar(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(Mi(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Mi(this._element,this._endStyles),this._endStyles=null),ar(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function qm(n){let e=null;return n.forEach((t,r)=>{(function zG(n){return"display"===n||"position"===n})(r)&&(e=e||new Map,e.set(r,t))}),e}class UC{constructor(e,t,r,i){this.element=e,this.keyframes=t,this.options=r,this._specialStyles=i,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=r.duration,this._delay=r.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){const t=[];return e.forEach(r=>{t.push(Object.fromEntries(r))}),t}_triggerWebAnimation(e,t,r){return e.animate(this._convertKeyframesToObject(t),r)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((r,i)=>{"offset"!==i&&e.set(i,this._finished?r:xC(this.element,i))}),this.currentSnapshot=e}triggerCallback(e){const t="start"===e?this._onStartFns:this._onDoneFns;t.forEach(r=>r()),t.length=0}}class WG{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,t){return!1}containsElement(e,t){return pC(e,t)}getParentElement(e){return Mm(e)}query(e,t,r){return mC(e,t,r)}computeStyle(e,t,r){return window.getComputedStyle(e)[t]}animate(e,t,r,i,s,o=[]){const l={duration:r,delay:i,fill:0==i?"both":"forwards"};s&&(l.easing=s);const c=new Map,u=o.filter(f=>f instanceof UC);(function Zj(n,e){return 0===n||0===e})(r,i)&&u.forEach(f=>{f.currentSnapshot.forEach((p,m)=>c.set(m,p))});let d=function Wj(n){return n.length?n[0]instanceof Map?n:n.map(e=>bC(e)):[]}(t).map(f=>Xr(f));d=function Xj(n,e,t){if(t.size&&e.length){let r=e[0],i=[];if(t.forEach((s,o)=>{r.has(o)||i.push(o),r.set(o,s)}),i.length)for(let s=1;s<e.length;s++){let o=e[s];i.forEach(a=>o.set(a,xC(n,a)))}}return e}(e,d,c);const h=function GG(n,e){let t=null,r=null;return Array.isArray(e)&&e.length?(t=qm(e[0]),e.length>1&&(r=qm(e[e.length-1]))):e instanceof Map&&(t=qm(e)),t||r?new KG(n,t,r):null}(e,d);return new UC(e,d,l,h)}}let qG=(()=>{class n extends rC{constructor(t,r){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(r.body,{id:"0",encapsulation:An.None,styles:[],data:{animation:[]}})}build(t){const r=this._nextAnimationId.toString();this._nextAnimationId++;const i=Array.isArray(t)?iC(t):t;return VC(this._renderer,null,r,"register",[i]),new YG(r,this._renderer)}}return n.\u0275fac=function(t){return new(t||n)(U(To),U(et))},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})();class YG extends sj{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new QG(this._id,e,t||{},this._renderer)}}class QG{constructor(e,t,r,i){this.id=e,this.element=t,this._renderer=i,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",r)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return VC(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function VC(n,e,t,r,i){return n.setProperty(e,`@@${t}:${r}`,i)}const $C="@.disabled";let ZG=(()=>{class n{constructor(t,r,i){this.delegate=t,this.engine=r,this._zone=i,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),r.onRemovalComplete=(s,o)=>{const a=o?.parentNode(s);a&&o.removeChild(a,s)}}createRenderer(t,r){const s=this.delegate.createRenderer(t,r);if(!(t&&r&&r.data&&r.data.animation)){let u=this._rendererCache.get(s);return u||(u=new HC("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,u)),u}const o=r.id,a=r.id+"-"+this._currentId;this._currentId++,this.engine.register(a,t);const l=u=>{Array.isArray(u)?u.forEach(l):this.engine.registerTrigger(o,a,t,u.name,u)};return r.data.animation.forEach(l),new XG(this,a,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,r,i){t>=0&&t<this._microtaskId?this._zone.run(()=>r(i)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[o,a]=s;o(a)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([r,i]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(t){return new(t||n)(U(To),U(Eu),U(Ae))},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})();class HC{constructor(e,t,r,i){this.namespaceId=e,this.delegate=t,this.engine=r,this._onDestroy=i,this.destroyNode=this.delegate.destroyNode?s=>t.destroyNode(s):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,r,i=!0){this.delegate.insertBefore(e,t,r),this.engine.onInsert(this.namespaceId,t,e,i)}removeChild(e,t,r){this.engine.onRemove(this.namespaceId,t,this.delegate,r)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,r,i){this.delegate.setAttribute(e,t,r,i)}removeAttribute(e,t,r){this.delegate.removeAttribute(e,t,r)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,r,i){this.delegate.setStyle(e,t,r,i)}removeStyle(e,t,r){this.delegate.removeStyle(e,t,r)}setProperty(e,t,r){"@"==t.charAt(0)&&t==$C?this.disableAnimations(e,!!r):this.delegate.setProperty(e,t,r)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,r){return this.delegate.listen(e,t,r)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class XG extends HC{constructor(e,t,r,i,s){super(t,r,i,s),this.factory=e,this.namespaceId=t}setProperty(e,t,r){"@"==t.charAt(0)?"."==t.charAt(1)&&t==$C?this.disableAnimations(e,r=void 0===r||!!r):this.engine.process(this.namespaceId,e,t.slice(1),r):this.delegate.setProperty(e,t,r)}listen(e,t,r){if("@"==t.charAt(0)){const i=function JG(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(e);let s=t.slice(1),o="";return"@"!=s.charAt(0)&&([s,o]=function e4(n){const e=n.indexOf(".");return[n.substring(0,e),n.slice(e+1)]}(s)),this.engine.listen(this.namespaceId,i,s,o,a=>{this.factory.scheduleListenerCallback(a._data||-1,r,a)})}return this.delegate.listen(e,t,r)}}let t4=(()=>{class n extends Eu{constructor(t,r,i,s){super(t.body,r,i)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(t){return new(t||n)(U(et),U(Rm),U(Hm),U(Uo))},n.\u0275prov=G({token:n,factory:n.\u0275fac}),n})();const jC=[{provide:rC,useClass:qG},{provide:Hm,useFactory:function n4(){return new EG}},{provide:Eu,useClass:t4},{provide:To,useFactory:function r4(n,e,t){return new ZG(n,e,t)},deps:[hc,Eu,Ae]}],Ym=[{provide:Rm,useFactory:()=>new WG},{provide:Kl,useValue:"BrowserAnimations"},...jC],GC=[{provide:Rm,useClass:gC},{provide:Kl,useValue:"NoopAnimations"},...jC];let i4=(()=>{class n{static withConfig(t){return{ngModule:n,providers:t.disableAnimations?GC:Ym}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Lt({type:n}),n.\u0275inj=Et({providers:Ym,imports:[_D]}),n})();const zs=new j("CallSetDisabledState",{providedIn:"root",factory:()=>wu}),wu="always";let RA=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Lt({type:n}),n.\u0275inj=Et({}),n})(),o5=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Lt({type:n}),n.\u0275inj=Et({imports:[RA]}),n})(),l5=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:zs,useValue:t.callSetDisabledState??wu}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Lt({type:n}),n.\u0275inj=Et({imports:[o5]}),n})(),c5=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=Lt({type:n,bootstrap:[UT]}),n.\u0275inj=Et({imports:[_D,ij,Z3,i4,l5]}),e})();FB().bootstrapModule(c5).catch(n=>console.error(n))}},Le=>{Le(Le.s=973)}]);